# Comparing `tmp/primawera-0.4.0-py3-none-any.whl.zip` & `tmp/primawera-0.4.1-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,27 +1,27 @@
-Zip file size: 43965 bytes, number of entries: 25
--rw-r--r--  2.0 unx      981 b- defN 23-Mar-29 20:36 primawera/HighlightScrollArea.py
--rw-r--r--  2.0 unx      332 b- defN 23-Mar-29 20:36 primawera/__init__.py
--rw-r--r--  2.0 unx    14385 b- defN 23-Mar-29 20:36 primawera/app.py
--rw-r--r--  2.0 unx     7627 b- defN 23-Mar-29 20:36 primawera/canvas2d.py
--rw-r--r--  2.0 unx    10444 b- defN 23-Mar-29 20:36 primawera/canvas3d.py
--rw-r--r--  2.0 unx    13568 b- defN 23-Mar-29 20:36 primawera/canvasbase.py
--rw-r--r--  2.0 unx     7090 b- defN 23-Mar-29 20:36 primawera/canvascomplex.py
--rw-r--r--  2.0 unx     1254 b- defN 23-Mar-29 20:36 primawera/filters.py
--rw-r--r--  2.0 unx     1514 b- defN 23-Mar-29 20:36 primawera/html_codes.py
--rw-r--r--  2.0 unx     3166 b- defN 23-Mar-29 20:36 primawera/informationwindow.py
--rw-r--r--  2.0 unx     3723 b- defN 23-Mar-29 20:36 primawera/loading.py
--rw-r--r--  2.0 unx     2183 b- defN 23-Mar-29 20:36 primawera/lut.py
--rw-r--r--  2.0 unx     1387 b- defN 23-Mar-29 20:36 primawera/modeutils.py
--rw-r--r--  2.0 unx     3041 b- defN 23-Mar-29 20:36 primawera/pixmaplabel.py
--rw-r--r--  2.0 unx     4774 b- defN 23-Mar-29 20:36 primawera/previewwindow.py
--rw-r--r--  2.0 unx    10439 b- defN 23-Mar-29 20:36 primawera/visualiser.py
--rw-rw-rw-  2.0 unx     3656 b- defN 23-Mar-29 20:36 primawera/luts/grayscale.lut
--rw-rw-rw-  2.0 unx     3366 b- defN 23-Mar-29 20:36 primawera/luts/jet.lut
--rw-rw-rw-  2.0 unx     3767 b- defN 23-Mar-29 20:36 primawera/luts/sepia.lut
--rw-rw-rw-  2.0 unx    35149 b- defN 23-Mar-29 20:51 primawera-0.4.0.dist-info/COPYING.txt
--rw-r--r--  2.0 unx     2821 b- defN 23-Mar-29 20:51 primawera-0.4.0.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Mar-29 20:51 primawera-0.4.0.dist-info/WHEEL
--rw-r--r--  2.0 unx       46 b- defN 23-Mar-29 20:51 primawera-0.4.0.dist-info/entry_points.txt
--rw-r--r--  2.0 unx       10 b- defN 23-Mar-29 20:51 primawera-0.4.0.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2021 b- defN 23-Mar-29 20:51 primawera-0.4.0.dist-info/RECORD
-25 files, 136836 bytes uncompressed, 40737 bytes compressed:  70.2%
+Zip file size: 44180 bytes, number of entries: 25
+-rw-r--r--  2.0 unx      981 b- defN 23-Apr-27 12:15 primawera/HighlightScrollArea.py
+-rw-r--r--  2.0 unx      332 b- defN 23-Apr-27 12:15 primawera/__init__.py
+-rw-r--r--  2.0 unx    14890 b- defN 23-Apr-27 12:15 primawera/app.py
+-rw-r--r--  2.0 unx     6460 b- defN 23-Apr-27 12:18 primawera/canvas2d.py
+-rw-r--r--  2.0 unx     9339 b- defN 23-Apr-27 12:18 primawera/canvas3d.py
+-rw-r--r--  2.0 unx    16521 b- defN 23-Apr-27 12:18 primawera/canvasbase.py
+-rw-r--r--  2.0 unx     7096 b- defN 23-Apr-27 12:15 primawera/canvascomplex.py
+-rw-r--r--  2.0 unx     1427 b- defN 23-Apr-27 12:15 primawera/filters.py
+-rw-r--r--  2.0 unx     1514 b- defN 23-Apr-27 12:15 primawera/html_codes.py
+-rw-r--r--  2.0 unx     2982 b- defN 23-Apr-27 12:15 primawera/informationwindow.py
+-rw-r--r--  2.0 unx     3731 b- defN 23-Apr-27 12:15 primawera/loading.py
+-rw-r--r--  2.0 unx     2183 b- defN 23-Apr-27 12:15 primawera/lut.py
+-rw-r--r--  2.0 unx     1387 b- defN 23-Apr-27 12:15 primawera/modeutils.py
+-rw-r--r--  2.0 unx     3041 b- defN 23-Apr-27 12:15 primawera/pixmaplabel.py
+-rw-r--r--  2.0 unx     4774 b- defN 23-Apr-27 12:15 primawera/previewwindow.py
+-rw-r--r--  2.0 unx    10154 b- defN 23-Apr-27 12:15 primawera/visualiser.py
+-rw-rw-rw-  2.0 unx     3656 b- defN 23-Apr-27 12:15 primawera/luts/grayscale.lut
+-rw-rw-rw-  2.0 unx     3366 b- defN 23-Apr-27 12:15 primawera/luts/jet.lut
+-rw-rw-rw-  2.0 unx     3767 b- defN 23-Apr-27 12:15 primawera/luts/sepia.lut
+-rw-rw-rw-  2.0 unx    35149 b- defN 23-Apr-27 12:25 primawera-0.4.1.dist-info/COPYING.txt
+-rw-r--r--  2.0 unx     2821 b- defN 23-Apr-27 12:25 primawera-0.4.1.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Apr-27 12:25 primawera-0.4.1.dist-info/WHEEL
+-rw-r--r--  2.0 unx       46 b- defN 23-Apr-27 12:25 primawera-0.4.1.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx       10 b- defN 23-Apr-27 12:25 primawera-0.4.1.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2020 b- defN 23-Apr-27 12:25 primawera-0.4.1.dist-info/RECORD
+25 files, 137739 bytes uncompressed, 40952 bytes compressed:  70.3%
```

## zipnote {}

```diff
@@ -51,26 +51,26 @@
 
 Filename: primawera/luts/jet.lut
 Comment: 
 
 Filename: primawera/luts/sepia.lut
 Comment: 
 
-Filename: primawera-0.4.0.dist-info/COPYING.txt
+Filename: primawera-0.4.1.dist-info/COPYING.txt
 Comment: 
 
-Filename: primawera-0.4.0.dist-info/METADATA
+Filename: primawera-0.4.1.dist-info/METADATA
 Comment: 
 
-Filename: primawera-0.4.0.dist-info/WHEEL
+Filename: primawera-0.4.1.dist-info/WHEEL
 Comment: 
 
-Filename: primawera-0.4.0.dist-info/entry_points.txt
+Filename: primawera-0.4.1.dist-info/entry_points.txt
 Comment: 
 
-Filename: primawera-0.4.0.dist-info/top_level.txt
+Filename: primawera-0.4.1.dist-info/top_level.txt
 Comment: 
 
-Filename: primawera-0.4.0.dist-info/RECORD
+Filename: primawera-0.4.1.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## primawera/app.py

```diff
@@ -264,20 +264,22 @@
         except UnidentifiedImageError as err:
             self.setCentralWidget(QLabel(
                 f"Error inside PIL library with the following message:\n{err}"
             ))
 
     def help_commands(self) -> None:
         self._help_window = QLabel(command_page_content)
+        self._help_window.setWindowTitle("Primawera - Help window.")
         self._help_window.setFont(self.main_font)
         self._help_window.setMargin(10)
         self._help_window.show()
 
     def about_command(self) -> None:
         self._help_window = QLabel(about_page_content)
+        self._help_window.setWindowTitle("Primawera - About window.")
         self._help_window.setFont(self.main_font)
         self._help_window.setMargin(10)
         self._help_window.show()
 
 
 def print_help(name: str) -> None:
     print(f"Usage: {name} FILEPATH\n"
@@ -319,14 +321,23 @@
     app = QtCore.QCoreApplication.instance()
     app_created = False
     if app is None:
         print("Creating app")
         app = QtWidgets.QApplication(sys.argv)
         app_created = True
 
+    if overlay_data is not None:
+        if not isinstance(overlay_data, np.ndarray):
+            print("Error: Overlay data is not a numpy array! It will be"
+                  "ignored.")
+            overlay_data = None
+        elif len(overlay_data.shape) == 2:
+            w, h = overlay_data.shape
+            overlay_data = np.reshape(overlay_data, (1, w, h))
+
     if type(data) == str:
         _window = MainWindow(filepath=data, title=title,
                              overlay_data=overlay_data,
                              overlay_is_grayscale=is_overlay_grayscale)
     elif isinstance(data, np.ndarray):
         if len(data.shape) > 4 or len(data.shape) < 2:
             print(f"Error: Data has invalid shape ({data.shape})!",
```

## primawera/canvas2d.py

```diff
@@ -1,12 +1,12 @@
 from typing import Dict, List, Tuple, Optional
 
 import numpy as np
 from PyQt5.QtCore import Qt, pyqtSignal
-from PyQt5.QtWidgets import QAction, QMessageBox
+from PyQt5.QtWidgets import QAction
 from numpy.typing import ArrayLike, NDArray
 
 from primawera.canvasbase import CanvasBase
 from primawera.filters import linear_stretch, gamma_correction, \
     linear_contrast, logarithm_stretch
 from primawera.lut import apply_lut
 from primawera.visualiser import Visualiser
@@ -27,16 +27,16 @@
                                        overlay_data, overlay_is_grayscale,
                                        *args, **kwargs)
         self._init_interface()
         self._create_actions()
         self._set_actions_checkable()
         self._connect_actions()
 
-        if self.overlay_data is not None:
-            self._add_overlay(self.overlay_data, self.overlay_is_grayscale)
+        if self.raw_overlay_data is not None:
+            self._add_overlay(self.raw_overlay_data, self.overlay_is_grayscale)
 
         if self.mode != 'F':
             self._no_filter()
         else:
             self._linear_stretch()
 
         # Check default options
@@ -87,15 +87,15 @@
         self.view_layout.addWidget(self.visualiser, 0, 0, Qt.AlignTop)
         self.main_layout.addLayout(self.view_layout)
         self.setLayout(self.main_layout)
         self._connect_info_window_and_canvas()
 
     def _connect_info_window_and_canvas(self) -> None:
         self.visualiser.signal_position.connect(
-            self.changed_coordinates_signal)
+            self.changed_coordinates_slot_emitter)
 
     def get_actions(self) -> List[QAction]:
         result = self.get_filters()
         result.extend(self.get_luts())
         return result
 
     def get_filters(self) -> List[QAction]:
@@ -137,47 +137,21 @@
         self.visualiser.increase_zoom_level()
 
     def _decrease_zoom_level(self):
         self.visualiser.decrease_zoom_level()
 
     def _add_overlay(self, overlay_data: NDArray[int],
                      is_grayscale: bool = True) -> None:
-        if self.visualiser.has_overlay():
-            self.visualiser.remove_overlay()
-
-        overlay_original = overlay_data
-        overlay_reshaped = self._reshape_overlay_data(overlay_data,
-                                                      is_grayscale)
-        data_dims = len(self.data.shape)
-
-        # The overlay can have more dimensions if it is coloured and the data
-        # under it is in grayscale.
-        if (data_dims == 3
-            and overlay_reshaped.shape[:-1] != self.data.shape) \
-                or (
-                data_dims == 4 and overlay_reshaped.shape != self.data.shape):
-            QMessageBox.critical(
-                self, "Error", f"The shape {overlay_original.shape} is not"
-                               f" compatible with underlying image. It was "
-                               f"automatically reshaped to "
-                               f"{overlay_reshaped.shape}",
-                buttons=QMessageBox.Ok,
-                defaultButton=QMessageBox.Ok)
-            return
-
-        # TODO: right now the opacity is fixed
-        opacity_mask_shape = list(overlay_reshaped.shape)
-        opacity_mask_shape[-1] = 1
-        opacity_mask = np.zeros(shape=tuple(opacity_mask_shape)).astype(
-            np.uint8)
-        opacity_mask[overlay_reshaped[:, :, :, 0] != 0] = 255
-
-        # Add opacity (alpha channel) to the overlay data
-        overlay_reshaped = np.append(overlay_reshaped, opacity_mask, axis=3)
+        overlay_reshaped = self._add_overlay_aux(overlay_data, is_grayscale)
+        if overlay_reshaped is None:
+            return  # Failed to use the overlay data
+        self.raw_overlay_data = overlay_data
+        self.overlay_is_grayscale = is_grayscale
 
+        # Upload to visualiser
         self.visualiser.update_overlay(overlay_reshaped)
         # TODO: It does not make sense to reset the overlay_data when
         #       new filter or LUT is applied.
         #       => Separate this behaviour in other functions.
         self.visualiser.redraw()
 
     def _remove_overlay(self) -> None:
```

## primawera/canvas3d.py

```diff
@@ -1,13 +1,13 @@
 from typing import Dict, Optional
 
 import numpy as np
 from PyQt5 import QtCore
 from PyQt5.QtCore import Qt
-from PyQt5.QtWidgets import QGridLayout, QMessageBox
+from PyQt5.QtWidgets import QGridLayout
 from numpy.typing import ArrayLike, NDArray
 
 from primawera.canvasbase import CanvasBase
 from primawera.filters import linear_stretch, gamma_correction, \
     linear_contrast, logarithm_stretch
 from primawera.lut import apply_lut
 from primawera.visualiser import Visualiser
@@ -25,15 +25,15 @@
                          filters, filters_options, overlay_data,
                          overlay_is_grayscale, *args, **kwargs)
         self._init_interface()
         self._create_actions()
         self._set_actions_checkable()
         self._connect_actions()
 
-        if overlay_data is not None:
+        if self.raw_overlay_data is not None:
             self._add_overlay(overlay_data, overlay_is_grayscale)
 
         # TODO: move this higher, so that we do not have to process image
         #       twice during this constructor.
         if self.mode != 'F':
             self._no_filter()
         else:
@@ -90,19 +90,19 @@
         self.vis_col_time.value_change_emitter_vertical.connect(
             self.vis_main_window.get_vertical_bar().setValue)
         self.vis_row_time.value_change_emitter_horizontal.connect(
             self.vis_main_window.get_horizontal_bar().setValue)
 
     def _connect_info_window_and_canvas(self):
         self.vis_main_window.signal_position.connect(
-            self.changed_coordinates_signal)
+            self.changed_coordinates_slot_emitter)
         self.vis_col_time.signal_position.connect(
-            self.changed_coordinates_signal)
+            self.changed_coordinates_slot_emitter)
         self.vis_row_time.signal_position.connect(
-            self.changed_coordinates_signal)
+            self.changed_coordinates_slot_emitter)
 
     def _hide_scroll_bars(self):
         # Hide unused bars
         row_time = self.vis_row_time.get_scroll_area()
         row_time.setHorizontalScrollBarPolicy(Qt.ScrollBarAlwaysOff)
         row_time.setVerticalScrollBarPolicy(Qt.ScrollBarAlwaysOff)
 
@@ -191,47 +191,23 @@
 
     def _decrease_zoom_level(self):
         for vis in self.visualisers:
             vis.decrease_zoom_level()
 
     def _add_overlay(self, overlay_data: NDArray[int],
                      is_grayscale: bool = True) -> None:
-        if self.visualisers[0].has_overlay():
-            self._remove_overlay()
 
-        # TODO: duplication in Canvas2D
-        overlay_original = overlay_data
-        overlay_reshaped = self._reshape_overlay_data(overlay_data,
-                                                      is_grayscale)
-        data_dims = len(self.data.shape)
-
-        # The overlay can have more dimensions if it is coloured and the data
-        # under it is in grayscale.
-        if (data_dims == 3
-            and overlay_reshaped.shape[:-1] != self.data.shape) \
-                or (
-                data_dims == 4 and overlay_reshaped.shape != self.data.shape):
-            QMessageBox.critical(
-                self, "Error",
-                f"The shape {overlay_original.shape} is not compatible "
-                f"with underlying image {self.data.shape}. It was "
-                f"automatically reshaped to {overlay_reshaped.shape}",
-                buttons=QMessageBox.Ok,
-                defaultButton=QMessageBox.Ok)
-            return
-
-        # TODO: right now the opacity is fixed
-        opacity_mask_shape = list(overlay_reshaped.shape)
-        opacity_mask_shape[-1] = 1
-        opacity_mask = np.zeros(shape=tuple(opacity_mask_shape)).astype(
-            np.uint8)
-        opacity_mask[overlay_reshaped[:, :, :, 0] != 0] = 255
+        overlay_reshaped = self._add_overlay_aux(overlay_data, is_grayscale)
+        if overlay_reshaped is None:
+            return  # Failed to use the overlay data
+        self.raw_overlay_data = overlay_data
+        self.overlay_is_grayscale = is_grayscale
 
-        # Add opacity (alpha channel) to the overlay data
-        overlay_reshaped = np.append(overlay_reshaped, opacity_mask, axis=3)
+        if self.visualisers[0].has_overlay():
+            self._remove_overlay()
 
         # Upload data to visualisers
         for visualiser, orientation in zip(self.visualisers,
                                            self.axes_orientations):
             # Specify the order of axis. (color is always the last one)
             frames, width, height = orientation
             orientation = frames, width, height, 3
```

## primawera/canvasbase.py

```diff
@@ -6,15 +6,15 @@
 from PyQt5.QtCore import pyqtSignal, pyqtSlot
 from PyQt5.QtGui import QKeyEvent
 from PyQt5.QtWidgets import QWidget, QVBoxLayout, QGridLayout, QAction, \
     QFileDialog, QMessageBox
 from numpy.typing import ArrayLike, NDArray
 
 import primawera.lut as lut
-from primawera.filters import linear_contrast, gamma_correction
+from primawera.filters import linear_contrast, gamma_correction, linear_stretch
 from primawera.informationwindow import InformationWindow
 from primawera.loading import load_data
 from primawera.modeutils import is_mode_color, is_mode_grayscale
 from primawera.previewwindow import PreviewDialog
 
 
 class CanvasBase(QWidget):
@@ -29,29 +29,32 @@
                  filters_options: Optional[Dict[str, int]] = None,
                  overlay_data: Optional[NDArray[int]] = None,
                  overlay_is_grayscale: bool = True,
                  *args, **kwargs) -> None:
         super(CanvasBase, self).__init__(*args, **kwargs)
         self.data = np.asanyarray(data)
         if overlay_data is not None \
-                and self._check_overlay_dtype(overlay_data):
-            self.overlay_data = overlay_data
-            self.overlay_is_grayscale = overlay_is_grayscale
+                and self._check_overlay_dtype(overlay_data,
+                                              overlay_is_grayscale):
+            self.raw_overlay_data = overlay_data
         elif overlay_data is not None:
-            overlay_data = None
             QMessageBox.information(
                 self, "Information",
-                f"Could not safely convert the overlay's type "
-                f"({overlay_data.dtype}) to an unsigned 8 bit integer. "
-                f"Supplied overlay data will be ignored.",
+                "Could not safely convert the overlay's type to a suitable"
+                "format. Note that while any bit long integer grayscale data "
+                "is supported, coloured overlays can only use 8bit integers."
+                f"Supplied overlay data (with type={overlay_data.dtype}) will"
+                " be ignored.",
                 buttons=QMessageBox.Ok,
                 defaultButton=QMessageBox.Ok)
+            self.raw_overlay_data = None
         else:
-            self.overlay_data = None
-            self.overlay_is_grayscale = overlay_is_grayscale
+            self.raw_overlay_data = None
+
+        self.overlay_is_grayscale = overlay_is_grayscale
         self.filters = filters
         self.filters_options = filters_options
         self.lut = None
         self.mode = mode
         self._showing_info_panel = False
         # This may change, for example when applying LUTs.
         self.mode_visualisation = mode
@@ -158,62 +161,75 @@
         if name == "None":
             self.mode_visualisation = self.mode
             self.lut = None
         else:
             self.lut = lut.get_lut(name)
         self._redraw(self._process_data())
 
-    def _check_overlay_dtype(self, overlay: NDArray) -> bool:
+    def _check_overlay_dtype(self, overlay: NDArray,
+                             is_overlay_grayscale: bool) -> bool:
+        if is_overlay_grayscale:
+            # We can linearly stretch it later
+            return np.can_cast(overlay.dtype, int)
+
+        # Overlay contains RGB data
         return np.can_cast(overlay.dtype, np.uint8)
 
     def _add_overlay_io(self) -> Optional[Tuple[ArrayLike, bool]]:
         # TODO: duplicate in app.py
         file_name, _ = QFileDialog.getOpenFileName(self, "Open file", ".",
                                                    "Image file (*.jpg *.png"
                                                    " *.h5 *.tif *.tiff)")
         if file_name == "":
             # User did not select a file
             return
         try:
             data, mode = load_data(file_name)
-            if not self._check_overlay_dtype(data):
+            if is_mode_color(mode):
+                is_grayscale = False
+            elif is_mode_grayscale(mode):
+                is_grayscale = True
+            else:
+                raise RuntimeError("Cannot determine if the data is grayscale"
+                                   f"or colored! Modes is {mode}!")
+            if not self._check_overlay_dtype(data, is_grayscale):
                 raise RuntimeError(
                     f"Cannot safely cast {data.dtype} to an unsigned 8 bit "
                     f"integer!")
         except RuntimeError as err:
             QMessageBox.critical(self, "Error",
                                  f"Failed to load data ({file_name}) "
                                  f"with message: {err}",
                                  buttons=QMessageBox.Ok,
                                  defaultButton=QMessageBox.Ok)
             return None
-        if is_mode_color(mode):
-            is_grayscale = False
-        elif is_mode_grayscale(mode):
-            is_grayscale = True
-        else:
-            return None
         return data, is_grayscale
 
     def _reshape_overlay_data(self, overlay_data: NDArray[int],
                               is_grayscale: bool) -> NDArray[int]:
         overlay_dims = len(overlay_data.shape)
 
         if is_grayscale and overlay_dims == 2:
+            # TODO: this is probably never called. Need to investigate further.
             w, h = overlay_data.shape
             overlay_data = np.reshape(overlay_data, (1, w, h))
             overlay_dims = len(overlay_data.shape)
             assert overlay_dims == 3
         elif not is_grayscale and overlay_dims == 3:
             w, h, ch = overlay_data.shape
             overlay_data = np.reshape(overlay_data, (1, w, h, ch))
             overlay_dims = len(overlay_data.shape)
             assert overlay_dims == 4
 
         if is_grayscale and overlay_dims == 3:
+            # Rescale labels for visualisation purposes
+            overlay_data = np.array(255.0 * linear_stretch(overlay_data),
+                                    dtype=np.uint8)
+
+            # Reshape
             f, w, h = overlay_data.shape
             overlay_data = np.reshape(overlay_data, (f, w, h, 1))
             orig_overlay = overlay_data
             overlay_data = np.append(overlay_data, overlay_data, axis=3)
             overlay_data = np.append(overlay_data, orig_overlay, axis=3)
             overlay_dims = len(overlay_data.shape)
             assert overlay_dims == 4, "Reshaping overlay into higher" \
@@ -228,14 +244,47 @@
         result = self._add_overlay_io()
         if result is None:
             return
 
         overlay_data, is_grayscale = result
         self._add_overlay(overlay_data, is_grayscale)
 
+    def _add_overlay_aux(self, overlay_data: NDArray[int],
+                         is_grayscale: bool = True) -> Optional[NDArray[int]]:
+        overlay_original = overlay_data
+        overlay_reshaped = self._reshape_overlay_data(overlay_data,
+                                                      is_grayscale)
+        data_dims = len(self.data.shape)
+
+        # The overlay can have more dimensions if it is coloured and the data
+        # under it is in grayscale.
+        if (data_dims == 3
+            and overlay_reshaped.shape[:-1] != self.data.shape) \
+                or (
+                data_dims == 4 and overlay_reshaped.shape != self.data.shape):
+            QMessageBox.critical(
+                self, "Error",
+                f"The shape {overlay_original.shape} is not compatible "
+                f"with underlying image {self.data.shape}. It was "
+                f"automatically reshaped to {overlay_reshaped.shape}",
+                buttons=QMessageBox.Ok,
+                defaultButton=QMessageBox.Ok)
+            return
+
+        # TODO: right now the opacity is fixed
+        opacity_mask_shape = list(overlay_reshaped.shape)
+        opacity_mask_shape[-1] = 1
+        opacity_mask = np.zeros(shape=tuple(opacity_mask_shape)).astype(
+            np.uint8)
+        opacity_mask[overlay_reshaped[:, :, :, 0] != 0] = 255
+
+        # Add opacity (alpha channel) to the overlay data
+        overlay_reshaped = np.append(overlay_reshaped, opacity_mask, axis=3)
+        return overlay_reshaped
+
     def _add_overlay(self, overlay_data: NDArray[int],
                      is_grayscale: bool = True) -> None:
         raise NotImplementedError("CanvasBase should not be directly created!")
 
     def _remove_overlay(self) -> None:
         raise NotImplementedError("CanvasBase should not be directly created!")
 
@@ -304,22 +353,35 @@
         self.desktop_width = width
         self.desktop_height = height
 
     @pyqtSlot(list)
     def preview_dialog_slot(self, data: List[Union[int, float]]) -> None:
         self.preview_dialog_value = data[0]
 
-    @pyqtSlot(int, int, int, list, list)
-    def changed_coordinates_signal(self, frame: int, row: int, col: int,
-                                   mapped_val: ArrayLike,
-                                   overlay_label: ArrayLike) -> None:
+    @pyqtSlot(int, int, int, list)
+    def changed_coordinates_slot_emitter(self, frame: int, row: int, col: int,
+                                         mapped_val: ArrayLike) -> None:
+        if self.raw_overlay_data is not None:
+            chosen_coords = (frame, row, col)
+            # Note: unlike the data, overlay data can have all sorts of shapes-
+            # mainly (f, w, h, ch), (w, h, ch) or (f, w, h).
+            # Since the signal always returns coordinates in the form (f, w, h)
+            # we need to handle the (w, h, ch) case specially
+            if not self.overlay_is_grayscale \
+                    and len(self.raw_overlay_data.shape) == 3:
+                chosen_coords = (row, col)
+
+            overlay_label = self.raw_overlay_data[chosen_coords]
+        else:
+            overlay_label = None
+
         self.signal_changed_coordinates.emit(frame, row, col,
                                              mapped_val,
                                              self.data[frame, row, col],
-                                             overlay_label)
+                                             [overlay_label])
 
     def closeEvent(self, event) -> None:
         self._information_window.close()
         super().closeEvent(event)
 
     def _hide_overlay(self) -> None:
         raise NotImplementedError("CanvasBase should not be directly created!")
```

## primawera/canvascomplex.py

```diff
@@ -57,15 +57,15 @@
         self.view_layout.addWidget(self.visualiser, 0, 0, Qt.AlignTop)
         self.main_layout.addLayout(self.view_layout)
 
         self.setLayout(self.main_layout)
 
     def _connect_info_window_and_canvas(self):
         self.visualiser.signal_position.connect(
-            self.changed_coordinates_signal)
+            self.changed_coordinates_slot_emitter)
 
     def _process_data(self) -> ArrayLike:
         super()._process_data()
         data = self.data.copy()
         if self.show == ShowEnum.MAGNITUDE:
             data = np.abs(data)
         elif self.show == ShowEnum.PHASE:
```

## primawera/filters.py

```diff
@@ -1,43 +1,47 @@
 import numpy as np
 from numpy.typing import ArrayLike
 
 
 # Expects an array with dtype=float
 def linear_stretch(array: ArrayLike) -> ArrayLike:
+    array = np.array(array, dtype=float, copy=True)
     frames, height, width = array.shape
     max_val, min_val = np.max(array), np.min(array)
     if max_val - min_val == 0:
         print("Error: Cannot apply linear stretch filter on constant images, "
               "which would cause a division by 0 error! Ignoring filter.")
         return array
     factor = 1.0 / (max_val - min_val)
     for n in range(frames):
         array[n] = array[n] - min_val
         array[n] = array[n] * factor
     return array
 
 
 def gamma_correction(array: ArrayLike, factor: float) -> ArrayLike:
-    array = array.astype(float)
+    array = np.array(array, dtype=float, copy=True)
     max_value = array.max()
     array = array / max_value
     array **= factor
     array *= max_value
     return array
 
 
 def linear_contrast(array: ArrayLike, factor: float) -> ArrayLike:
     modified = array * factor
     return modified
 
 
 def logarithm_stretch(array: ArrayLike, factor=1.0) -> ArrayLike:
+    array = np.asanyarray(array)
     shift = False
+    original_signs = None
     if array.min() < 0:
         shift = True
         original_signs = np.sign(array)
         array = np.abs(array)
     result = factor * np.log(array + 1)
     if shift:
+        assert original_signs is not None
         result = result * original_signs
     return result
```

## primawera/informationwindow.py

```diff
@@ -1,31 +1,27 @@
 from typing import Tuple
 
+import numpy as np
+
 from PyQt5.QtCore import pyqtSlot, Qt
 from PyQt5.QtWidgets import QWidget, QVBoxLayout, QLabel, QHBoxLayout
 from numpy.typing import DTypeLike, ArrayLike
 
 from primawera.modeutils import print_mode
 
 
 class InformationWindow(QWidget):
     def __init__(self, parent=None) -> None:
         """
         Auxiliary window showing information about the visualised data.
 
             Parameters
             ----------
-            shape: tuple of ints
-                Tuple describing the data's shape.
-            datatype: DTypeLike object
-                Dtype of numpy array.
-            mode: str
-                Used image mode.
-            filter_name: str
-                Name of the used filter.
+            parent: QtWidget
+                Parent of this widget.
         """
         super().__init__(parent)
         self.setWindowTitle("Primawera - Info panel")
         self.label_format_info = QLabel()
         self.main_layout = QVBoxLayout()
 
         self.label_format_info.setAlignment(Qt.AlignTop)
@@ -66,19 +62,19 @@
 
     @pyqtSlot(int, int, int, object, object, object)
     def update_coordinates_slot(self, frame: int, row: int, col: int,
                                 mapped_value: ArrayLike,
                                 original_value: ArrayLike,
                                 overlay_label: ArrayLike) -> None:
         # Note: numpy is row-centric, that's why y and x are switched
-        text = f"frame={frame}, row={row}, col={col}\n " \
-               f"original value={original_value})\n" \
+        text = f"frame={frame}, row={row}, col={col}\n" \
+               f"original value={original_value}\n" \
                f"mapped value={mapped_value}\n"
-        if overlay_label[0][0] != -1:
-            text += f"overlay label={overlay_label}"
+        if overlay_label[0] is not None:
+            text += f"overlay label={np.array(overlay_label)[0]}"
 
         self.label_coordinates.setText(text)
 
     @staticmethod
     def _transform_shape(shape: Tuple[int, ...]) -> str:
         dimensions = [str(x) for x in shape]
         if dimensions[0] == '1':
```

## primawera/loading.py

```diff
@@ -55,15 +55,15 @@
             f"'{data_path}' is neither a regular file nor a directory!")
     return raw_data, mode
 
 
 def load_folder(path_to_dir: str):
     raw_data = []
     mode = ""
-    for file in listdir(path_to_dir):
+    for file in sorted(listdir(path_to_dir)):
         if file.endswith(".png"):
             file_data, file_mode = load_file(
                 path.join(path_to_dir, file))
 
             # Check if files are compatible
             if mode != "" and mode != file_mode:
                 print(
```

## primawera/visualiser.py

```diff
@@ -7,15 +7,15 @@
 
 from primawera.HighlightScrollArea import HighlightScrollArea
 from primawera.loading import UnsupportedFormatError
 from primawera.pixmaplabel import PixmapLabel
 
 
 class Visualiser(QWidget):
-    signal_position = pyqtSignal(int, int, int, list, list)
+    signal_position = pyqtSignal(int, int, int, list)
     value_change_emitter_vertical = pyqtSignal(int)
     value_change_emitter_horizontal = pyqtSignal(int)
 
     def __init__(self, data, axes_orientation, mode, maximum_height,
                  maximum_width, main_window, *args, overlay_data=None,
                  **kwargs):
         super(Visualiser, self).__init__(*args, **kwargs)
@@ -59,16 +59,15 @@
         self.layout.setContentsMargins(0, 0, 0, 0)
         self.setLayout(self.layout)
 
         # Set up event handling
         self.connect_horizontal_bar()
         self.connect_vertical_bar()
 
-        self.setStyleSheet(
-            "padding: 0px; margin:0px; border: 0px")
+        self.setStyleSheet("padding: 0px; margin:0px; border: 0px")
 
         # Set up focus in/out border change
         # self.focusChanged.connect(self.focus_changed)
 
     def connect_vertical_bar(self):
         self.get_vertical_bar().valueChanged.connect(
             self._value_change_wrapper_vertical)
@@ -88,21 +87,21 @@
         self.data = np.transpose(data, axes_orientation).copy()
         self.frames, self.height, self.width = self.data.shape[0], \
             self.data.shape[1], \
             self.data.shape[2]
         self.frame = 0
         self.background_pixmaps = [None] * self.frames
         self.overlay_pixmaps = [None] * self.frames
-        self.label.mouse_position_signal.connect(self.print_info)
+        self.label.mouse_position_signal.connect(self.print_info_emitter)
 
     def redraw(self):
         self._generate(self.frame)
         self.choose_frame(self.frame)
 
-    def print_info(self, relative_x: float, relative_y: float) -> None:
+    def print_info_emitter(self, relative_x: float, relative_y: float) -> None:
         if self.mode in {"grayscale", "1", "F", "C"}:
             _, data_rows, data_cols = self.data.shape
         else:
             _, data_rows, data_cols, _ = self.data.shape
         position_x = int(relative_x * data_cols)
         position_y = int(relative_y * data_rows)
 
@@ -111,22 +110,15 @@
         real_frame = transposed_coords[self.axes_orientation.index(0)]
         real_x = transposed_coords[self.axes_orientation.index(1)]
         real_y = transposed_coords[self.axes_orientation.index(2)]
 
         # Note: numpy is row-centric, that's why y and x are switched
         mapped_value = [self.data[self.frame, position_y, position_x]]
 
-        # Overlay label at given position
-        if self.overlay_data is not None:
-            overlay_label = \
-                self.overlay_data[self.frame, position_y, position_x]
-        else:
-            overlay_label = [-1]
-        self.signal_position.emit(real_frame, real_x, real_y, mapped_value,
-                                  [overlay_label])
+        self.signal_position.emit(real_frame, real_x, real_y, mapped_value)
 
     def _generate(self, frame: int) -> None:
         if self.background_pixmaps[frame] is None:
             self.background_pixmaps[frame] = self._generate_background(frame)
 
         if self.overlay_data is not None \
                 and self.overlay_pixmaps[frame] is None:
```

## Comparing `primawera-0.4.0.dist-info/COPYING.txt` & `primawera-0.4.1.dist-info/COPYING.txt`

 * *Files identical despite different names*

## Comparing `primawera-0.4.0.dist-info/METADATA` & `primawera-0.4.1.dist-info/METADATA`

 * *Files 4% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: primawera
-Version: 0.4.0
+Version: 0.4.1
 Summary: Simple image viewer with 3D, complex and floating images support.
 Author-email: Bruno Petrus <xpetrus@fi.muni.cz>
 Project-URL: Source, https://gitlab.fi.muni.cz/xpetrus/primawera
 Project-URL: Bug tracker, https://gitlab.fi.muni.cz/xpetrus/primawera/-/issues
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: GNU General Public License v3 (GPLv3)
 Classifier: Development Status :: 3 - Alpha
```

## Comparing `primawera-0.4.0.dist-info/RECORD` & `primawera-0.4.1.dist-info/RECORD`

 * *Files 11% similar despite different names*

```diff
@@ -1,25 +1,25 @@
 primawera/HighlightScrollArea.py,sha256=FjoXNUa36PtJPWIgw8vHibsqGDmAPoD60lO1TeObkp8,981
 primawera/__init__.py,sha256=ePNs-xclORfBJ8nLZgrfvKuIIf1sLWozhTxGNaSNnzI,332
-primawera/app.py,sha256=lddftUGwVnrgB-V-AfmFQeboGt1Rg0F7ZJf5VMbs9Dc,14385
-primawera/canvas2d.py,sha256=LUDZwiRP5Ff_Cg3_y4dzqyACrDQaalOTiEGnY5VyT8Q,7627
-primawera/canvas3d.py,sha256=W8_l24n5jA1zV1jxtSmqQzAJiFpmznFkxSZa4q6rmfU,10444
-primawera/canvasbase.py,sha256=o_i9XDhY5_-Y5t6o1wkh4DpVqPLTC4jg8VFZAvtvFf8,13568
-primawera/canvascomplex.py,sha256=xw7p9xp7mFmlCwjlCpfk9ENWV_q1z89xugiBhEBRgw4,7090
-primawera/filters.py,sha256=qdSDOLFBBW-oRFT0gVGF8J25RzmgS0CmQnxm9JXJtO8,1254
+primawera/app.py,sha256=QREEhslogJCN4NOzq0Cg-BpH1dTT4HD8OzlLlOPPSCk,14890
+primawera/canvas2d.py,sha256=2ZuA4w9cho_5NYoj7txR7uK-DUF_Ycyxk3mzMPwkVMk,6460
+primawera/canvas3d.py,sha256=6mTlMh_pxMIBMr4rFgsNQ-uz8RvpbXVxOpjbRRpgbC8,9339
+primawera/canvasbase.py,sha256=UPLCtINirBU9S4uDv7M30kPeKYt8zi8LMdlEi6BszWc,16521
+primawera/canvascomplex.py,sha256=rcRXAqs885xjBpll_SYKrSGlcO4zTPjPo3wKaCBK66c,7096
+primawera/filters.py,sha256=0wFr0q9vcRfOj-2SdIu0YTfxH6oZF4YJY3DCunpdW6g,1427
 primawera/html_codes.py,sha256=p-Ra6YLqApfh0OSXzU4SsE-LbsDGIs5dfaQEFMM76Nw,1514
-primawera/informationwindow.py,sha256=Lx-wsncdTq9NwWviz__yn9DTwk1HX33Qy4TIW6kcBnE,3166
-primawera/loading.py,sha256=lCS5Vruagyvk9rf1rAR-KBCjlk7sjq5u-YEgHxGd7Fs,3723
+primawera/informationwindow.py,sha256=Gs_rGah_pzlaDPW00b2joo0TsHWSv9n8QMLtgmGWPLs,2982
+primawera/loading.py,sha256=tp54p9psiz7-CR_FvL39PG2TYQWQjZ6_U5sDlC26gbg,3731
 primawera/lut.py,sha256=rbCygkEOB1d3CpBRi_Xga9JgorZmy7rOcWPzps8ejyI,2183
 primawera/modeutils.py,sha256=btbc18qjTfw-DfBxe-pFzeX0iNMUrFHyyJZ48lVceaI,1387
 primawera/pixmaplabel.py,sha256=_nG8d1eihS9DR-L6GccLqAjpOz1kfp51t4Db__vU6Wk,3041
 primawera/previewwindow.py,sha256=yKtnPf1TQdfQ_UmC10PVIHw3bh60M5jKinrlE_uRuvY,4774
-primawera/visualiser.py,sha256=SB62NifxDC7ZpxyGVoXpk11jfEwUJzkrpyJONWaoL5o,10439
+primawera/visualiser.py,sha256=BLxHGu_R8lpA2wNyq3OIiQCPw0vx2cYieJPjG3KUtUk,10154
 primawera/luts/grayscale.lut,sha256=9TVO_IhYWXtn1vI99RX8Gp8zrnYMnCW_KzOi4DFGOxs,3656
 primawera/luts/jet.lut,sha256=o1TAkAO-Xz47WpeSn2KZW_-4_vRXugmVQ5esJtbscSo,3366
 primawera/luts/sepia.lut,sha256=uDHATW9-t3ArAtYN6s0Wh8yFl7Tu1MllKPaGC8i4YtU,3767
-primawera-0.4.0.dist-info/COPYING.txt,sha256=OXLcl0T2SZ8Pmy2_dmlvKuetivmyPd5m1q-Gyd-zaYY,35149
-primawera-0.4.0.dist-info/METADATA,sha256=TlN0gUC2uQkTBxizVlAKXGoQmbtORH4a3QBYKrvKb4I,2821
-primawera-0.4.0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-primawera-0.4.0.dist-info/entry_points.txt,sha256=45CSMKGMvbRZAWyosbH0DNWMqhkX32T4egoJrlKzOdM,46
-primawera-0.4.0.dist-info/top_level.txt,sha256=JYh4fep6QQlzXuAbJxUllSjnupXyTh-7MshyywqRPZg,10
-primawera-0.4.0.dist-info/RECORD,,
+primawera-0.4.1.dist-info/COPYING.txt,sha256=OXLcl0T2SZ8Pmy2_dmlvKuetivmyPd5m1q-Gyd-zaYY,35149
+primawera-0.4.1.dist-info/METADATA,sha256=THL7D17z-jJ5WRVUFQBC2clcnjKuApq2ZsDgTVrV_gw,2821
+primawera-0.4.1.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+primawera-0.4.1.dist-info/entry_points.txt,sha256=45CSMKGMvbRZAWyosbH0DNWMqhkX32T4egoJrlKzOdM,46
+primawera-0.4.1.dist-info/top_level.txt,sha256=JYh4fep6QQlzXuAbJxUllSjnupXyTh-7MshyywqRPZg,10
+primawera-0.4.1.dist-info/RECORD,,
```

