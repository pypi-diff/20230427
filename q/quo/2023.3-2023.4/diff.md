# Comparing `tmp/quo-2023.3-py3-none-any.whl.zip` & `tmp/quo-2023.4-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,206 +1,207 @@
-Zip file size: 526513 bytes, number of entries: 204
--rw-rw-r--  2.0 unx     3776 b- defN 23-Mar-30 12:14 quo/__init__.py
--rw-rw-r--  2.0 unx     3877 b- defN 23-Mar-22 11:32 quo/__main__.py
--rw-rw-r--  2.0 unx    19919 b- defN 23-Mar-22 11:32 quo/__spinners.py
--rw-rw-r--  2.0 unx     1597 b- defN 23-Mar-28 20:34 quo/_spinners.py
--rw-rw-r--  2.0 unx    17520 b- defN 23-Mar-22 11:32 quo/accordance.py
--rw-rw-r--  2.0 unx    99285 b- defN 23-Mar-22 11:32 quo/argparse.py
--rw-rw-r--  2.0 unx    12380 b- defN 23-Mar-22 11:32 quo/bar.py
--rw-rw-r--  2.0 unx       31 b- defN 23-Mar-30 08:14 quo/box.py
--rw-rw-r--  2.0 unx    72647 b- defN 23-Mar-22 11:32 quo/buffer.py
+Zip file size: 526172 bytes, number of entries: 205
+-rw-rw-r--  2.0 unx     2970 b- defN 23-Apr-27 16:43 quo/__init__.py
+-rw-rw-r--  2.0 unx     3877 b- defN 23-Apr-27 15:24 quo/__main__.py
+-rw-rw-r--  2.0 unx    19919 b- defN 23-Apr-27 15:24 quo/__spinners.py
+-rw-rw-r--  2.0 unx     1622 b- defN 23-Apr-27 15:24 quo/_spinners.py
+-rw-rw-r--  2.0 unx    17520 b- defN 23-Apr-27 15:24 quo/accordance.py
+-rw-rw-r--  2.0 unx    99285 b- defN 23-Apr-27 15:24 quo/argparse.py
+-rw-rw-r--  2.0 unx    12380 b- defN 23-Apr-27 15:24 quo/bar.py
+-rw-rw-r--  2.0 unx       31 b- defN 23-Apr-27 16:36 quo/box.py
+-rw-rw-r--  2.0 unx    72647 b- defN 23-Apr-27 15:24 quo/buffer.py
 -rw-rw-r--  2.0 unx       34 b- defN 23-Mar-30 10:02 quo/button.py
--rw-rw-r--  2.0 unx     7539 b- defN 23-Mar-22 11:32 quo/consoleapp.py
--rw-rw-r--  2.0 unx    13607 b- defN 23-Mar-22 11:32 quo/dialog.py
--rw-rw-r--  2.0 unx    40681 b- defN 23-Mar-22 11:32 quo/document.py
--rw-rw-r--  2.0 unx      322 b- defN 23-Mar-22 11:32 quo/enums.py
--rw-rw-r--  2.0 unx     9589 b- defN 23-Mar-22 11:32 quo/errors.py
--rw-rw-r--  2.0 unx       85 b- defN 23-Mar-22 11:32 quo/event.py
--rw-rw-r--  2.0 unx      322 b- defN 23-Mar-22 11:32 quo/frame.py
--rw-rw-r--  2.0 unx     9418 b- defN 23-Mar-22 11:32 quo/history.py
--rw-rw-r--  2.0 unx    12457 b- defN 23-Mar-22 11:32 quo/implementation.py
+-rw-rw-r--  2.0 unx     7539 b- defN 23-Apr-27 15:24 quo/consoleapp.py
+-rw-rw-r--  2.0 unx    13494 b- defN 23-Apr-27 15:43 quo/dialog.py
+-rw-rw-r--  2.0 unx    40681 b- defN 23-Apr-27 15:24 quo/document.py
+-rw-rw-r--  2.0 unx      322 b- defN 23-Apr-27 15:24 quo/enums.py
+-rw-rw-r--  2.0 unx     9589 b- defN 23-Apr-27 15:24 quo/errors.py
+-rw-rw-r--  2.0 unx       85 b- defN 23-Apr-27 15:24 quo/event.py
+-rw-rw-r--  2.0 unx      322 b- defN 23-Apr-27 15:24 quo/frame.py
+-rw-rw-r--  2.0 unx     9418 b- defN 23-Apr-27 15:24 quo/history.py
+-rw-rw-r--  2.0 unx    12457 b- defN 23-Apr-27 15:24 quo/implementation.py
 -rw-rw-r--  2.0 unx       33 b- defN 23-Mar-30 11:21 quo/label.py
--rw-rw-r--  2.0 unx      116 b- defN 23-Mar-22 11:32 quo/log.py
--rw-rw-r--  2.0 unx      354 b- defN 23-Mar-22 11:32 quo/main.py
--rw-rw-r--  2.0 unx     1409 b- defN 23-Mar-22 11:32 quo/mouse_events.py
--rw-rw-r--  2.0 unx   101134 b- defN 23-Mar-22 11:32 quo/parse.py
--rw-rw-r--  2.0 unx    14738 b- defN 23-Mar-22 11:32 quo/parser.py
--rw-rw-r--  2.0 unx     9108 b- defN 23-Mar-22 11:32 quo/patch_stdout.py
--rw-rw-r--  2.0 unx      982 b- defN 23-Mar-22 11:32 quo/pause.py
--rw-rw-r--  2.0 unx    59997 b- defN 23-Mar-23 10:40 quo/prompt.py
--rw-rw-r--  2.0 unx    28427 b- defN 23-Mar-22 11:32 quo/renderer.py
--rw-rw-r--  2.0 unx      132 b- defN 23-Mar-22 11:32 quo/rmreplica.py
--rw-rw-r--  2.0 unx     1433 b- defN 23-Mar-24 08:03 quo/rule.py
--rw-rw-r--  2.0 unx     6994 b- defN 23-Mar-22 11:32 quo/search.py
--rw-rw-r--  2.0 unx     1289 b- defN 23-Mar-22 11:32 quo/selection.py
--rw-rw-r--  2.0 unx     9096 b- defN 23-Mar-22 11:32 quo/setout.py
--rw-rw-r--  2.0 unx    21656 b- defN 23-Mar-22 11:32 quo/shelldone.py
+-rw-rw-r--  2.0 unx      116 b- defN 23-Apr-27 15:24 quo/log.py
+-rw-rw-r--  2.0 unx      354 b- defN 23-Apr-27 15:24 quo/main.py
+-rw-rw-r--  2.0 unx     1409 b- defN 23-Apr-27 15:24 quo/mouse_events.py
+-rw-rw-r--  2.0 unx   101134 b- defN 23-Apr-27 15:24 quo/parse.py
+-rw-rw-r--  2.0 unx    14738 b- defN 23-Apr-27 15:24 quo/parser.py
+-rw-rw-r--  2.0 unx     9108 b- defN 23-Apr-27 15:24 quo/patch_stdout.py
+-rw-rw-r--  2.0 unx      982 b- defN 23-Apr-27 15:24 quo/pause.py
+-rw-rw-r--  2.0 unx    59985 b- defN 23-Apr-27 15:54 quo/prompt.py
+-rw-rw-r--  2.0 unx    28427 b- defN 23-Apr-27 15:24 quo/renderer.py
+-rw-rw-r--  2.0 unx      132 b- defN 23-Apr-27 15:24 quo/rmreplica.py
+-rw-rw-r--  2.0 unx     1433 b- defN 23-Apr-27 06:34 quo/rule.py
+-rw-rw-r--  2.0 unx     1361 b- defN 23-Apr-27 15:24 quo/rules.py
+-rw-rw-r--  2.0 unx     6994 b- defN 23-Apr-27 15:24 quo/search.py
+-rw-rw-r--  2.0 unx     1289 b- defN 23-Apr-27 15:24 quo/selection.py
+-rw-rw-r--  2.0 unx     9096 b- defN 23-Apr-27 15:24 quo/setout.py
+-rw-rw-r--  2.0 unx    21656 b- defN 23-Apr-27 15:24 quo/shelldone.py
 -rw-rw-r--  2.0 unx     9114 b- defN 23-Mar-29 18:50 quo/something.py
--rw-rw-r--  2.0 unx     2231 b- defN 23-Mar-22 11:32 quo/spin.py
--rw-rw-r--  2.0 unx      884 b- defN 23-Mar-22 11:32 quo/syntax.py
--rw-rw-r--  2.0 unx    69842 b- defN 23-Mar-22 11:32 quo/table.py
+-rw-rw-r--  2.0 unx     2231 b- defN 23-Apr-27 15:24 quo/spin.py
+-rw-rw-r--  2.0 unx      884 b- defN 23-Apr-27 15:24 quo/syntax.py
+-rw-rw-r--  2.0 unx    69842 b- defN 23-Apr-27 15:24 quo/table.py
 -rw-rw-r--  2.0 unx     2244 b- defN 23-Mar-29 17:07 quo/template.py
 -rw-rw-r--  2.0 unx       50 b- defN 23-Mar-30 09:15 quo/textfield.py
--rw-rw-r--  2.0 unx    36560 b- defN 23-Mar-22 11:32 quo/types.py
--rw-rw-r--  2.0 unx     2810 b- defN 23-Mar-22 11:32 quo/universal.py
--rw-rw-r--  2.0 unx     6245 b- defN 23-Mar-22 11:32 quo/win32_types.py
+-rw-rw-r--  2.0 unx    36560 b- defN 23-Apr-27 15:24 quo/types.py
+-rw-rw-r--  2.0 unx     2810 b- defN 23-Apr-27 15:24 quo/universal.py
+-rw-rw-r--  2.0 unx     6245 b- defN 23-Apr-27 15:24 quo/win32_types.py
 -rw-rw-r--  2.0 unx       41 b- defN 23-Mar-29 18:27 quo/window.py
--rw-rw-r--  2.0 unx       90 b- defN 23-Mar-22 11:32 quo/cache/__init__.py
--rw-rw-r--  2.0 unx     1246 b- defN 23-Mar-22 11:32 quo/cache/_lru_cache.py
--rw-rw-r--  2.0 unx     3801 b- defN 23-Mar-22 11:32 quo/cache/core.py
--rw-rw-r--  2.0 unx      303 b- defN 23-Mar-22 11:32 quo/clipboard/__init__.py
--rw-rw-r--  2.0 unx     2380 b- defN 23-Mar-22 11:32 quo/clipboard/core.py
--rw-rw-r--  2.0 unx     1009 b- defN 23-Mar-22 11:32 quo/clipboard/momento.py
--rw-rw-r--  2.0 unx     1228 b- defN 23-Mar-22 11:32 quo/clipboard/pyperclip.py
--rw-rw-r--  2.0 unx      407 b- defN 23-Mar-22 22:39 quo/color/__init__.py
--rw-rw-r--  2.0 unx     4997 b- defN 23-Mar-22 11:32 quo/color/ansi.py
--rw-rw-r--  2.0 unx      619 b- defN 23-Mar-22 11:32 quo/color/rgb.py
--rw-rw-r--  2.0 unx     1071 b- defN 23-Mar-22 11:32 quo/completion/__init__.py
--rw-rw-r--  2.0 unx     5921 b- defN 23-Mar-22 11:32 quo/completion/auto_suggest.py
--rw-rw-r--  2.0 unx    13295 b- defN 23-Mar-22 11:32 quo/completion/core.py
--rw-rw-r--  2.0 unx     1394 b- defN 23-Mar-22 11:32 quo/completion/deduplicate.py
--rw-rw-r--  2.0 unx     3816 b- defN 23-Mar-22 11:32 quo/completion/filesystem.py
--rw-rw-r--  2.0 unx     7056 b- defN 23-Mar-22 11:32 quo/completion/fuzzy_completer.py
--rw-rw-r--  2.0 unx     3822 b- defN 23-Mar-22 11:32 quo/completion/nested.py
--rw-rw-r--  2.0 unx     3539 b- defN 23-Mar-22 11:32 quo/completion/word_completer.py
--rw-rw-r--  2.0 unx      613 b- defN 23-Mar-30 10:09 quo/console/__init__.py
--rw-rw-r--  2.0 unx    52390 b- defN 23-Mar-22 11:32 quo/console/console.py
--rw-rw-r--  2.0 unx     4968 b- defN 23-Mar-22 11:32 quo/console/current.py
--rw-rw-r--  2.0 unx     1342 b- defN 23-Mar-22 11:32 quo/console/dummy.py
--rw-rw-r--  2.0 unx     3687 b- defN 23-Mar-22 11:32 quo/console/run_in_terminal.py
--rw-rw-r--  2.0 unx        1 b- defN 23-Mar-22 11:32 quo/context/__init__.py
--rw-rw-r--  2.0 unx      709 b- defN 23-Mar-22 11:32 quo/context/current.py
--rw-rw-r--  2.0 unx        0 b- defN 23-Mar-22 11:32 quo/contrib/__init__.py
--rw-rw-r--  2.0 unx       67 b- defN 23-Mar-22 11:32 quo/contrib/completers/__init__.py
--rw-rw-r--  2.0 unx     1988 b- defN 23-Mar-22 11:32 quo/contrib/completers/system.py
--rw-rw-r--  2.0 unx     3243 b- defN 23-Mar-22 11:32 quo/contrib/regular_languages/__init__.py
--rw-rw-r--  2.0 unx    21854 b- defN 23-Mar-22 11:32 quo/contrib/regular_languages/compiler.py
--rw-rw-r--  2.0 unx     3223 b- defN 23-Mar-22 11:32 quo/contrib/regular_languages/completion.py
--rw-rw-r--  2.0 unx     3337 b- defN 23-Mar-22 11:32 quo/contrib/regular_languages/lexer.py
--rw-rw-r--  2.0 unx     7825 b- defN 23-Mar-22 11:32 quo/contrib/regular_languages/regex_parser.py
--rw-rw-r--  2.0 unx     2026 b- defN 23-Mar-22 11:32 quo/contrib/regular_languages/validation.py
--rw-rw-r--  2.0 unx       92 b- defN 23-Mar-22 11:32 quo/contrib/ssh/__init__.py
--rw-rw-r--  2.0 unx     4942 b- defN 23-Mar-22 11:32 quo/contrib/ssh/server.py
--rw-rw-r--  2.0 unx       68 b- defN 23-Mar-22 11:32 quo/contrib/telnet/__init__.py
--rw-rw-r--  2.0 unx      130 b- defN 23-Mar-22 11:32 quo/contrib/telnet/log.py
--rw-rw-r--  2.0 unx     5553 b- defN 23-Mar-22 11:32 quo/contrib/telnet/protocol.py
--rw-rw-r--  2.0 unx    10457 b- defN 23-Mar-22 11:32 quo/contrib/telnet/server.py
--rw-rw-r--  2.0 unx      267 b- defN 23-Mar-22 11:32 quo/decorators/__init__.py
--rw-rw-r--  2.0 unx      825 b- defN 23-Mar-22 11:32 quo/decorators/autoconfirm.py
--rw-rw-r--  2.0 unx     1020 b- defN 23-Mar-22 11:32 quo/decorators/autohelp.py
--rw-rw-r--  2.0 unx      747 b- defN 23-Mar-22 11:32 quo/decorators/autopasswd.py
--rw-rw-r--  2.0 unx     3867 b- defN 23-Mar-22 11:32 quo/decorators/autoversion.py
--rw-rw-r--  2.0 unx     6226 b- defN 23-Mar-22 11:32 quo/decorators/core.py
--rw-rw-r--  2.0 unx      636 b- defN 23-Mar-22 11:32 quo/eventloop/__init__.py
--rw-rw-r--  2.0 unx     4126 b- defN 23-Mar-22 11:32 quo/eventloop/async_context_manager.py
--rw-rw-r--  2.0 unx     2075 b- defN 23-Mar-22 11:32 quo/eventloop/async_generator.py
--rw-rw-r--  2.0 unx     1160 b- defN 23-Mar-22 11:32 quo/eventloop/dummy_contextvars.py
--rw-rw-r--  2.0 unx     5490 b- defN 23-Mar-22 11:32 quo/eventloop/inputhook.py
--rw-rw-r--  2.0 unx     3251 b- defN 23-Mar-22 11:32 quo/eventloop/utils.py
--rw-rw-r--  2.0 unx     2241 b- defN 23-Mar-22 11:32 quo/eventloop/win32.py
--rw-rw-r--  2.0 unx      331 b- defN 23-Mar-22 11:32 quo/expediency/__init__.py
--rw-rw-r--  2.0 unx    16503 b- defN 23-Mar-22 11:32 quo/expediency/vitals.py
--rw-rw-r--  2.0 unx     2044 b- defN 23-Mar-22 11:32 quo/filters/__init__.py
--rw-rw-r--  2.0 unx     9674 b- defN 23-Mar-22 11:32 quo/filters/app.py
--rw-rw-r--  2.0 unx     1719 b- defN 23-Mar-22 11:32 quo/filters/cli.py
--rw-rw-r--  2.0 unx     5710 b- defN 23-Mar-22 11:32 quo/filters/core.py
--rw-rw-r--  2.0 unx      859 b- defN 23-Mar-22 11:32 quo/filters/utils.py
--rw-rw-r--  2.0 unx     4339 b- defN 23-Mar-22 11:32 quo/highlight/__init__.py
--rw-rw-r--  2.0 unx     2272 b- defN 23-Mar-22 11:32 quo/highlight/core.py
--rw-rw-r--  2.0 unx    11843 b- defN 23-Mar-22 11:32 quo/highlight/pygments.py
--rw-rw-r--  2.0 unx      135 b- defN 23-Mar-22 11:32 quo/i_o/__init__.py
--rw-rw-r--  2.0 unx    13684 b- defN 23-Mar-22 11:32 quo/i_o/termui.py
--rw-rw-r--  2.0 unx        1 b- defN 23-Mar-22 11:32 quo/i_o/output/__init__.py
--rw-rw-r--  2.0 unx     8086 b- defN 23-Mar-22 11:32 quo/i_o/output/ansi.py
--rw-rw-r--  2.0 unx    13252 b- defN 23-Mar-22 11:32 quo/i_o/output/ansi_escape_sequences.py
--rw-rw-r--  2.0 unx      230 b- defN 23-Mar-22 11:32 quo/input/__init__.py
--rw-rw-r--  2.0 unx     3344 b- defN 23-Mar-22 11:32 quo/input/core.py
--rw-rw-r--  2.0 unx     1550 b- defN 23-Mar-22 11:32 quo/input/defaults.py
--rw-rw-r--  2.0 unx     1833 b- defN 23-Mar-22 11:32 quo/input/posix_pipe.py
--rw-rw-r--  2.0 unx     3937 b- defN 23-Mar-22 11:32 quo/input/posix_utils.py
--rw-rw-r--  2.0 unx     2536 b- defN 23-Mar-22 11:32 quo/input/typeahead.py
--rw-rw-r--  2.0 unx     9191 b- defN 23-Mar-22 11:32 quo/input/videoterminal.py
--rw-rw-r--  2.0 unx     8428 b- defN 23-Mar-22 11:32 quo/input/vt100_parser.py
--rw-rw-r--  2.0 unx    23176 b- defN 23-Mar-22 11:32 quo/input/win32.py
--rw-rw-r--  2.0 unx     4124 b- defN 23-Mar-22 11:32 quo/input/win32_pipe.py
--rw-rw-r--  2.0 unx      196 b- defN 23-Mar-22 11:32 quo/keys/__init__.py
--rw-rw-r--  2.0 unx       71 b- defN 23-Mar-22 11:32 quo/keys/focus.py
--rw-rw-r--  2.0 unx     5126 b- defN 23-Mar-22 11:32 quo/keys/list.py
--rw-rw-r--  2.0 unx      394 b- defN 23-Mar-22 11:32 quo/keys/key_binding/__init__.py
--rw-rw-r--  2.0 unx     1893 b- defN 23-Mar-22 11:32 quo/keys/key_binding/defaults.py
--rw-rw-r--  2.0 unx    32798 b- defN 23-Mar-22 11:32 quo/keys/key_binding/digraphs.py
--rw-rw-r--  2.0 unx      889 b- defN 23-Mar-22 11:32 quo/keys/key_binding/emacs_state.py
--rw-rw-r--  2.0 unx    19738 b- defN 23-Mar-22 11:32 quo/keys/key_binding/key_bindings.py
--rw-rw-r--  2.0 unx    17598 b- defN 23-Mar-22 11:32 quo/keys/key_binding/key_processor.py
--rw-rw-r--  2.0 unx     3345 b- defN 23-Mar-22 11:32 quo/keys/key_binding/vi_state.py
--rw-rw-r--  2.0 unx        0 b- defN 23-Mar-22 11:32 quo/keys/key_binding/bindings/__init__.py
--rw-rw-r--  2.0 unx     1755 b- defN 23-Mar-22 11:32 quo/keys/key_binding/bindings/auto_suggest.py
--rw-rw-r--  2.0 unx     7103 b- defN 23-Mar-22 11:32 quo/keys/key_binding/bindings/basic.py
--rw-rw-r--  2.0 unx     6784 b- defN 23-Mar-22 11:32 quo/keys/key_binding/bindings/completion.py
--rw-rw-r--  2.0 unx      735 b- defN 23-Mar-22 11:32 quo/keys/key_binding/bindings/cpr.py
--rw-rw-r--  2.0 unx    19687 b- defN 23-Mar-22 11:32 quo/keys/key_binding/bindings/emacs.py
--rw-rw-r--  2.0 unx      429 b- defN 23-Mar-22 11:32 quo/keys/key_binding/bindings/focus.py
--rw-rw-r--  2.0 unx     5036 b- defN 23-Mar-22 11:32 quo/keys/key_binding/bindings/mouse.py
--rw-rw-r--  2.0 unx    18302 b- defN 23-Mar-22 11:32 quo/keys/key_binding/bindings/named_commands.py
--rw-rw-r--  2.0 unx     1343 b- defN 23-Mar-22 11:32 quo/keys/key_binding/bindings/open_in_editor.py
--rw-rw-r--  2.0 unx     2369 b- defN 23-Mar-22 11:32 quo/keys/key_binding/bindings/page_navigation.py
--rw-rw-r--  2.0 unx     5570 b- defN 23-Mar-22 11:32 quo/keys/key_binding/bindings/scroll.py
--rw-rw-r--  2.0 unx     2571 b- defN 23-Mar-22 11:32 quo/keys/key_binding/bindings/search.py
--rw-rw-r--  2.0 unx    75437 b- defN 23-Mar-22 11:32 quo/keys/key_binding/bindings/vi.py
--rw-rw-r--  2.0 unx     3602 b- defN 23-Mar-22 11:32 quo/layout/__init__.py
--rw-rw-r--  2.0 unx    99453 b- defN 23-Mar-29 19:25 quo/layout/containers.py
--rw-rw-r--  2.0 unx    36001 b- defN 23-Mar-22 11:32 quo/layout/controls.py
--rw-rw-r--  2.0 unx     7000 b- defN 23-Mar-22 11:32 quo/layout/dimension.py
--rw-rw-r--  2.0 unx     1008 b- defN 23-Mar-22 11:32 quo/layout/dummy.py
--rw-rw-r--  2.0 unx    14099 b- defN 23-Mar-22 11:32 quo/layout/layout.py
--rw-rw-r--  2.0 unx     8242 b- defN 23-Mar-30 09:04 quo/layout/margin.py
--rw-rw-r--  2.0 unx    25279 b- defN 23-Mar-22 11:32 quo/layout/menus.py
--rw-rw-r--  2.0 unx     1394 b- defN 23-Mar-22 11:32 quo/layout/mouse_handlers.py
--rw-rw-r--  2.0 unx    34046 b- defN 23-Mar-22 11:32 quo/layout/processors.py
--rw-rw-r--  2.0 unx     9926 b- defN 23-Mar-22 11:32 quo/layout/screen.py
--rw-rw-r--  2.0 unx    19129 b- defN 23-Mar-22 11:32 quo/layout/scrollable_pane.py
--rw-rw-r--  2.0 unx     2397 b- defN 23-Mar-22 11:32 quo/layout/utils.py
--rw-rw-r--  2.0 unx      255 b- defN 23-Mar-22 11:32 quo/output/__init__.py
--rw-rw-r--  2.0 unx     1380 b- defN 23-Mar-22 11:32 quo/output/color.py
--rw-rw-r--  2.0 unx     1842 b- defN 23-Mar-22 11:32 quo/output/console_emulator.py
--rw-rw-r--  2.0 unx     7835 b- defN 23-Mar-22 11:32 quo/output/core.py
--rw-rw-r--  2.0 unx     2559 b- defN 23-Mar-22 11:32 quo/output/defaults.py
--rw-rw-r--  2.0 unx    24612 b- defN 23-Mar-22 11:32 quo/output/videoterminal.py
--rw-rw-r--  2.0 unx    21671 b- defN 23-Mar-22 11:32 quo/output/win32.py
--rw-rw-r--  2.0 unx     3149 b- defN 23-Mar-22 11:32 quo/output/windows10.py
--rw-rw-r--  2.0 unx      517 b- defN 23-Mar-22 11:32 quo/progress/__init__.py
--rw-rw-r--  2.0 unx    15639 b- defN 23-Mar-29 11:52 quo/progress/core.py
--rw-rw-r--  2.0 unx    13052 b- defN 23-Mar-28 13:53 quo/progress/formatters.py
--rw-rw-r--  2.0 unx      214 b- defN 23-Mar-22 11:32 quo/shortcuts/__init__.py
--rw-rw-r--  2.0 unx     7721 b- defN 23-Mar-22 11:32 quo/shortcuts/utils.py
--rw-rw-r--  2.0 unx     1652 b- defN 23-Mar-22 11:32 quo/style/__init__.py
--rw-rw-r--  2.0 unx     5185 b- defN 23-Mar-22 11:32 quo/style/core.py
--rw-rw-r--  2.0 unx     8622 b- defN 23-Mar-22 11:32 quo/style/defaults.py
--rw-rw-r--  2.0 unx     1918 b- defN 23-Mar-22 11:32 quo/style/pygments.py
--rw-rw-r--  2.0 unx    13392 b- defN 23-Mar-22 11:32 quo/style/style.py
--rw-rw-r--  2.0 unx    12420 b- defN 23-Mar-22 11:32 quo/style/transformation.py
--rw-rw-r--  2.0 unx     4769 b- defN 23-Mar-22 11:32 quo/style/webcolors.py
--rw-rw-r--  2.0 unx     1351 b- defN 23-Mar-22 11:32 quo/text/__init__.py
--rw-rw-r--  2.0 unx     4988 b- defN 23-Mar-22 11:32 quo/text/core.py
--rw-rw-r--  2.0 unx     4337 b- defN 23-Mar-22 11:32 quo/text/html.py
--rw-rw-r--  2.0 unx      736 b- defN 23-Mar-22 11:32 quo/text/pygments.py
--rw-rw-r--  2.0 unx     2743 b- defN 23-Mar-22 11:32 quo/text/utils.py
--rw-rw-r--  2.0 unx        0 b- defN 23-Mar-22 11:32 quo/utils/__init__.py
--rw-rw-r--  2.0 unx     8621 b- defN 23-Mar-22 11:32 quo/utils/utils.py
--rw-rw-r--  2.0 unx     1163 b- defN 23-Mar-30 09:14 quo/widget/__init__.py
--rw-rw-r--  2.0 unx    31771 b- defN 23-Mar-30 11:36 quo/widget/core.py
--rw-rw-r--  2.0 unx       30 b- defN 23-Mar-22 11:32 quo/widget/design.py
--rw-rw-r--  2.0 unx     3200 b- defN 23-Mar-22 11:32 quo/widget/dialogs.py
--rw-rw-r--  2.0 unx    12598 b- defN 23-Mar-22 11:32 quo/widget/menus.py
--rw-rw-r--  2.0 unx    12098 b- defN 23-Mar-22 11:32 quo/widget/toolbars.py
--rw-rw-r--  2.0 unx      102 b- defN 23-Mar-22 11:32 quo/width/__init__.py
--rw-rw-r--  2.0 unx    10571 b- defN 23-Mar-22 11:32 quo/width/estasian_table.py
--rw-rw-r--  2.0 unx     7918 b- defN 23-Mar-22 11:32 quo/width/width.py
--rw-rw-r--  2.0 unx    31453 b- defN 23-Mar-22 11:32 quo/width/zero_width_table.py
--rw-rw-r--  2.0 unx        1 b- defN 23-Mar-22 11:32 quo/wrapper/__init__.py
--rw-rw-r--  2.0 unx     1201 b- defN 23-Mar-22 11:32 quo/wrapper/textshawl.py
--rw-rw-r--  2.0 unx     1073 b- defN 23-Mar-30 12:15 quo-2023.3.dist-info/LICENSE
--rw-rw-r--  2.0 unx    19263 b- defN 23-Mar-30 12:15 quo-2023.3.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 23-Mar-30 12:15 quo-2023.3.dist-info/WHEEL
--rw-rw-r--  2.0 unx        4 b- defN 23-Mar-30 12:15 quo-2023.3.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx    16331 b- defN 23-Mar-30 12:15 quo-2023.3.dist-info/RECORD
-204 files, 1888040 bytes uncompressed, 501415 bytes compressed:  73.4%
+-rw-rw-r--  2.0 unx       90 b- defN 23-Apr-27 15:24 quo/cache/__init__.py
+-rw-rw-r--  2.0 unx     1246 b- defN 23-Apr-27 15:24 quo/cache/_lru_cache.py
+-rw-rw-r--  2.0 unx     3801 b- defN 23-Apr-27 15:24 quo/cache/core.py
+-rw-rw-r--  2.0 unx      303 b- defN 23-Apr-27 15:24 quo/clipboard/__init__.py
+-rw-rw-r--  2.0 unx     2380 b- defN 23-Apr-27 15:24 quo/clipboard/core.py
+-rw-rw-r--  2.0 unx     1009 b- defN 23-Apr-27 15:24 quo/clipboard/momento.py
+-rw-rw-r--  2.0 unx     1228 b- defN 23-Apr-27 15:24 quo/clipboard/pyperclip.py
+-rw-rw-r--  2.0 unx      407 b- defN 23-Apr-27 15:24 quo/color/__init__.py
+-rw-rw-r--  2.0 unx     4997 b- defN 23-Apr-27 15:24 quo/color/ansi.py
+-rw-rw-r--  2.0 unx      619 b- defN 23-Apr-27 15:24 quo/color/rgb.py
+-rw-rw-r--  2.0 unx     1071 b- defN 23-Apr-27 15:24 quo/completion/__init__.py
+-rw-rw-r--  2.0 unx     5921 b- defN 23-Apr-27 15:24 quo/completion/auto_suggest.py
+-rw-rw-r--  2.0 unx    13295 b- defN 23-Apr-27 15:24 quo/completion/core.py
+-rw-rw-r--  2.0 unx     1394 b- defN 23-Apr-27 15:24 quo/completion/deduplicate.py
+-rw-rw-r--  2.0 unx     3816 b- defN 23-Apr-27 15:24 quo/completion/filesystem.py
+-rw-rw-r--  2.0 unx     7056 b- defN 23-Apr-27 15:24 quo/completion/fuzzy_completer.py
+-rw-rw-r--  2.0 unx     3822 b- defN 23-Apr-27 15:24 quo/completion/nested.py
+-rw-rw-r--  2.0 unx     3539 b- defN 23-Apr-27 15:24 quo/completion/word_completer.py
+-rw-rw-r--  2.0 unx      584 b- defN 23-Apr-27 15:24 quo/console/__init__.py
+-rw-rw-r--  2.0 unx    52390 b- defN 23-Apr-27 15:24 quo/console/console.py
+-rw-rw-r--  2.0 unx     4968 b- defN 23-Apr-27 15:24 quo/console/current.py
+-rw-rw-r--  2.0 unx     1342 b- defN 23-Apr-27 15:24 quo/console/dummy.py
+-rw-rw-r--  2.0 unx     3687 b- defN 23-Apr-27 15:24 quo/console/run_in_terminal.py
+-rw-rw-r--  2.0 unx        1 b- defN 23-Apr-27 15:24 quo/context/__init__.py
+-rw-rw-r--  2.0 unx      709 b- defN 23-Apr-27 15:24 quo/context/current.py
+-rw-rw-r--  2.0 unx        0 b- defN 23-Apr-27 15:24 quo/contrib/__init__.py
+-rw-rw-r--  2.0 unx       67 b- defN 23-Apr-27 15:24 quo/contrib/completers/__init__.py
+-rw-rw-r--  2.0 unx     1988 b- defN 23-Apr-27 15:24 quo/contrib/completers/system.py
+-rw-rw-r--  2.0 unx     3243 b- defN 23-Apr-27 15:24 quo/contrib/regular_languages/__init__.py
+-rw-rw-r--  2.0 unx    21854 b- defN 23-Apr-27 15:24 quo/contrib/regular_languages/compiler.py
+-rw-rw-r--  2.0 unx     3223 b- defN 23-Apr-27 15:24 quo/contrib/regular_languages/completion.py
+-rw-rw-r--  2.0 unx     3337 b- defN 23-Apr-27 15:24 quo/contrib/regular_languages/lexer.py
+-rw-rw-r--  2.0 unx     7825 b- defN 23-Apr-27 15:24 quo/contrib/regular_languages/regex_parser.py
+-rw-rw-r--  2.0 unx     2026 b- defN 23-Apr-27 15:24 quo/contrib/regular_languages/validation.py
+-rw-rw-r--  2.0 unx       92 b- defN 23-Apr-27 15:24 quo/contrib/ssh/__init__.py
+-rw-rw-r--  2.0 unx     4942 b- defN 23-Apr-27 15:24 quo/contrib/ssh/server.py
+-rw-rw-r--  2.0 unx       68 b- defN 23-Apr-27 15:24 quo/contrib/telnet/__init__.py
+-rw-rw-r--  2.0 unx      130 b- defN 23-Apr-27 15:24 quo/contrib/telnet/log.py
+-rw-rw-r--  2.0 unx     5553 b- defN 23-Apr-27 15:24 quo/contrib/telnet/protocol.py
+-rw-rw-r--  2.0 unx    10457 b- defN 23-Apr-27 15:24 quo/contrib/telnet/server.py
+-rw-rw-r--  2.0 unx      267 b- defN 23-Apr-27 15:24 quo/decorators/__init__.py
+-rw-rw-r--  2.0 unx      825 b- defN 23-Apr-27 15:24 quo/decorators/autoconfirm.py
+-rw-rw-r--  2.0 unx     1020 b- defN 23-Apr-27 15:24 quo/decorators/autohelp.py
+-rw-rw-r--  2.0 unx      747 b- defN 23-Apr-27 15:24 quo/decorators/autopasswd.py
+-rw-rw-r--  2.0 unx     3867 b- defN 23-Apr-27 15:24 quo/decorators/autoversion.py
+-rw-rw-r--  2.0 unx     6226 b- defN 23-Apr-27 15:24 quo/decorators/core.py
+-rw-rw-r--  2.0 unx      636 b- defN 23-Apr-27 15:24 quo/eventloop/__init__.py
+-rw-rw-r--  2.0 unx     4126 b- defN 23-Apr-27 15:24 quo/eventloop/async_context_manager.py
+-rw-rw-r--  2.0 unx     2075 b- defN 23-Apr-27 15:24 quo/eventloop/async_generator.py
+-rw-rw-r--  2.0 unx     1160 b- defN 23-Apr-27 15:24 quo/eventloop/dummy_contextvars.py
+-rw-rw-r--  2.0 unx     5490 b- defN 23-Apr-27 15:24 quo/eventloop/inputhook.py
+-rw-rw-r--  2.0 unx     3251 b- defN 23-Apr-27 15:24 quo/eventloop/utils.py
+-rw-rw-r--  2.0 unx     2241 b- defN 23-Apr-27 15:24 quo/eventloop/win32.py
+-rw-rw-r--  2.0 unx      331 b- defN 23-Apr-27 15:24 quo/expediency/__init__.py
+-rw-rw-r--  2.0 unx    16503 b- defN 23-Apr-27 15:24 quo/expediency/vitals.py
+-rw-rw-r--  2.0 unx     2044 b- defN 23-Apr-27 15:24 quo/filters/__init__.py
+-rw-rw-r--  2.0 unx     9674 b- defN 23-Apr-27 15:24 quo/filters/app.py
+-rw-rw-r--  2.0 unx     1719 b- defN 23-Apr-27 15:24 quo/filters/cli.py
+-rw-rw-r--  2.0 unx     5710 b- defN 23-Apr-27 15:24 quo/filters/core.py
+-rw-rw-r--  2.0 unx      859 b- defN 23-Apr-27 15:24 quo/filters/utils.py
+-rw-rw-r--  2.0 unx     4339 b- defN 23-Apr-27 15:24 quo/highlight/__init__.py
+-rw-rw-r--  2.0 unx     2272 b- defN 23-Apr-27 15:24 quo/highlight/core.py
+-rw-rw-r--  2.0 unx    11843 b- defN 23-Apr-27 15:24 quo/highlight/pygments.py
+-rw-rw-r--  2.0 unx      135 b- defN 23-Apr-27 15:24 quo/i_o/__init__.py
+-rw-rw-r--  2.0 unx    13684 b- defN 23-Apr-27 15:24 quo/i_o/termui.py
+-rw-rw-r--  2.0 unx        1 b- defN 23-Apr-27 15:24 quo/i_o/output/__init__.py
+-rw-rw-r--  2.0 unx     8086 b- defN 23-Apr-27 15:24 quo/i_o/output/ansi.py
+-rw-rw-r--  2.0 unx    13252 b- defN 23-Apr-27 15:24 quo/i_o/output/ansi_escape_sequences.py
+-rw-rw-r--  2.0 unx      230 b- defN 23-Apr-27 15:24 quo/input/__init__.py
+-rw-rw-r--  2.0 unx     3344 b- defN 23-Apr-27 15:24 quo/input/core.py
+-rw-rw-r--  2.0 unx     1550 b- defN 23-Apr-27 15:24 quo/input/defaults.py
+-rw-rw-r--  2.0 unx     1833 b- defN 23-Apr-27 15:24 quo/input/posix_pipe.py
+-rw-rw-r--  2.0 unx     3937 b- defN 23-Apr-27 15:24 quo/input/posix_utils.py
+-rw-rw-r--  2.0 unx     2536 b- defN 23-Apr-27 15:24 quo/input/typeahead.py
+-rw-rw-r--  2.0 unx     9191 b- defN 23-Apr-27 15:24 quo/input/videoterminal.py
+-rw-rw-r--  2.0 unx     8428 b- defN 23-Apr-27 15:24 quo/input/vt100_parser.py
+-rw-rw-r--  2.0 unx    23176 b- defN 23-Apr-27 15:24 quo/input/win32.py
+-rw-rw-r--  2.0 unx     4124 b- defN 23-Apr-27 15:24 quo/input/win32_pipe.py
+-rw-rw-r--  2.0 unx      196 b- defN 23-Apr-27 15:24 quo/keys/__init__.py
+-rw-rw-r--  2.0 unx       71 b- defN 23-Apr-27 15:24 quo/keys/focus.py
+-rw-rw-r--  2.0 unx     5126 b- defN 23-Apr-27 15:24 quo/keys/list.py
+-rw-rw-r--  2.0 unx      394 b- defN 23-Apr-27 15:24 quo/keys/key_binding/__init__.py
+-rw-rw-r--  2.0 unx     1893 b- defN 23-Apr-27 15:24 quo/keys/key_binding/defaults.py
+-rw-rw-r--  2.0 unx    32798 b- defN 23-Apr-27 15:24 quo/keys/key_binding/digraphs.py
+-rw-rw-r--  2.0 unx      889 b- defN 23-Apr-27 15:24 quo/keys/key_binding/emacs_state.py
+-rw-rw-r--  2.0 unx    19738 b- defN 23-Apr-27 15:24 quo/keys/key_binding/key_bindings.py
+-rw-rw-r--  2.0 unx    17598 b- defN 23-Apr-27 15:24 quo/keys/key_binding/key_processor.py
+-rw-rw-r--  2.0 unx     3345 b- defN 23-Apr-27 15:24 quo/keys/key_binding/vi_state.py
+-rw-rw-r--  2.0 unx        0 b- defN 23-Apr-27 15:24 quo/keys/key_binding/bindings/__init__.py
+-rw-rw-r--  2.0 unx     1755 b- defN 23-Apr-27 15:24 quo/keys/key_binding/bindings/auto_suggest.py
+-rw-rw-r--  2.0 unx     7103 b- defN 23-Apr-27 15:24 quo/keys/key_binding/bindings/basic.py
+-rw-rw-r--  2.0 unx     6784 b- defN 23-Apr-27 15:24 quo/keys/key_binding/bindings/completion.py
+-rw-rw-r--  2.0 unx      735 b- defN 23-Apr-27 15:24 quo/keys/key_binding/bindings/cpr.py
+-rw-rw-r--  2.0 unx    19687 b- defN 23-Apr-27 15:24 quo/keys/key_binding/bindings/emacs.py
+-rw-rw-r--  2.0 unx      429 b- defN 23-Apr-27 15:24 quo/keys/key_binding/bindings/focus.py
+-rw-rw-r--  2.0 unx     5036 b- defN 23-Apr-27 15:24 quo/keys/key_binding/bindings/mouse.py
+-rw-rw-r--  2.0 unx    18302 b- defN 23-Apr-27 15:24 quo/keys/key_binding/bindings/named_commands.py
+-rw-rw-r--  2.0 unx     1343 b- defN 23-Apr-27 15:24 quo/keys/key_binding/bindings/open_in_editor.py
+-rw-rw-r--  2.0 unx     2369 b- defN 23-Apr-27 15:24 quo/keys/key_binding/bindings/page_navigation.py
+-rw-rw-r--  2.0 unx     5570 b- defN 23-Apr-27 15:24 quo/keys/key_binding/bindings/scroll.py
+-rw-rw-r--  2.0 unx     2571 b- defN 23-Apr-27 15:24 quo/keys/key_binding/bindings/search.py
+-rw-rw-r--  2.0 unx    75437 b- defN 23-Apr-27 15:24 quo/keys/key_binding/bindings/vi.py
+-rw-rw-r--  2.0 unx     3602 b- defN 23-Apr-27 15:24 quo/layout/__init__.py
+-rw-rw-r--  2.0 unx    99267 b- defN 23-Apr-27 15:51 quo/layout/containers.py
+-rw-rw-r--  2.0 unx    36001 b- defN 23-Apr-27 15:24 quo/layout/controls.py
+-rw-rw-r--  2.0 unx     7000 b- defN 23-Apr-27 15:24 quo/layout/dimension.py
+-rw-rw-r--  2.0 unx     1008 b- defN 23-Apr-27 15:24 quo/layout/dummy.py
+-rw-rw-r--  2.0 unx    14099 b- defN 23-Apr-27 15:24 quo/layout/layout.py
+-rw-rw-r--  2.0 unx     8365 b- defN 23-Apr-27 15:24 quo/layout/margin.py
+-rw-rw-r--  2.0 unx    25273 b- defN 23-Apr-27 15:55 quo/layout/menus.py
+-rw-rw-r--  2.0 unx     1394 b- defN 23-Apr-27 15:24 quo/layout/mouse_handlers.py
+-rw-rw-r--  2.0 unx    34046 b- defN 23-Apr-27 15:24 quo/layout/processors.py
+-rw-rw-r--  2.0 unx     9926 b- defN 23-Apr-27 15:24 quo/layout/screen.py
+-rw-rw-r--  2.0 unx    19129 b- defN 23-Apr-27 15:24 quo/layout/scrollable_pane.py
+-rw-rw-r--  2.0 unx     2397 b- defN 23-Apr-27 15:24 quo/layout/utils.py
+-rw-rw-r--  2.0 unx      255 b- defN 23-Apr-27 15:24 quo/output/__init__.py
+-rw-rw-r--  2.0 unx     1380 b- defN 23-Apr-27 15:24 quo/output/color.py
+-rw-rw-r--  2.0 unx     1842 b- defN 23-Apr-27 15:24 quo/output/console_emulator.py
+-rw-rw-r--  2.0 unx     7835 b- defN 23-Apr-27 15:24 quo/output/core.py
+-rw-rw-r--  2.0 unx     2559 b- defN 23-Apr-27 15:24 quo/output/defaults.py
+-rw-rw-r--  2.0 unx    24612 b- defN 23-Apr-27 15:24 quo/output/videoterminal.py
+-rw-rw-r--  2.0 unx    21671 b- defN 23-Apr-27 15:24 quo/output/win32.py
+-rw-rw-r--  2.0 unx     3149 b- defN 23-Apr-27 15:24 quo/output/windows10.py
+-rw-rw-r--  2.0 unx      517 b- defN 23-Apr-27 15:24 quo/progress/__init__.py
+-rw-rw-r--  2.0 unx    13552 b- defN 23-Apr-27 15:24 quo/progress/core.py
+-rw-rw-r--  2.0 unx    12666 b- defN 23-Apr-27 15:24 quo/progress/formatters.py
+-rw-rw-r--  2.0 unx      214 b- defN 23-Apr-27 15:24 quo/shortcuts/__init__.py
+-rw-rw-r--  2.0 unx     7721 b- defN 23-Apr-27 15:24 quo/shortcuts/utils.py
+-rw-rw-r--  2.0 unx     1652 b- defN 23-Apr-27 15:24 quo/style/__init__.py
+-rw-rw-r--  2.0 unx     5185 b- defN 23-Apr-27 15:24 quo/style/core.py
+-rw-rw-r--  2.0 unx     8622 b- defN 23-Apr-27 15:24 quo/style/defaults.py
+-rw-rw-r--  2.0 unx     1918 b- defN 23-Apr-27 15:24 quo/style/pygments.py
+-rw-rw-r--  2.0 unx    13392 b- defN 23-Apr-27 15:24 quo/style/style.py
+-rw-rw-r--  2.0 unx    12420 b- defN 23-Apr-27 15:24 quo/style/transformation.py
+-rw-rw-r--  2.0 unx     4769 b- defN 23-Apr-27 15:24 quo/style/webcolors.py
+-rw-rw-r--  2.0 unx     1351 b- defN 23-Apr-27 15:24 quo/text/__init__.py
+-rw-rw-r--  2.0 unx     4988 b- defN 23-Apr-27 15:24 quo/text/core.py
+-rw-rw-r--  2.0 unx     4337 b- defN 23-Apr-27 15:24 quo/text/html.py
+-rw-rw-r--  2.0 unx      736 b- defN 23-Apr-27 15:24 quo/text/pygments.py
+-rw-rw-r--  2.0 unx     2743 b- defN 23-Apr-27 15:24 quo/text/utils.py
+-rw-rw-r--  2.0 unx        0 b- defN 23-Apr-27 15:24 quo/utils/__init__.py
+-rw-rw-r--  2.0 unx     8621 b- defN 23-Apr-27 15:24 quo/utils/utils.py
+-rw-rw-r--  2.0 unx     1199 b- defN 23-Apr-27 15:24 quo/widget/__init__.py
+-rw-rw-r--  2.0 unx    30720 b- defN 23-Apr-27 15:46 quo/widget/core.py
+-rw-rw-r--  2.0 unx       30 b- defN 23-Apr-27 15:24 quo/widget/design.py
+-rw-rw-r--  2.0 unx     3200 b- defN 23-Apr-27 15:24 quo/widget/dialogs.py
+-rw-rw-r--  2.0 unx    12598 b- defN 23-Apr-27 15:24 quo/widget/menus.py
+-rw-rw-r--  2.0 unx    12098 b- defN 23-Apr-27 15:24 quo/widget/toolbars.py
+-rw-rw-r--  2.0 unx      102 b- defN 23-Apr-27 15:24 quo/width/__init__.py
+-rw-rw-r--  2.0 unx    10571 b- defN 23-Apr-27 15:24 quo/width/estasian_table.py
+-rw-rw-r--  2.0 unx     7918 b- defN 23-Apr-27 15:24 quo/width/width.py
+-rw-rw-r--  2.0 unx    31453 b- defN 23-Apr-27 15:24 quo/width/zero_width_table.py
+-rw-rw-r--  2.0 unx        1 b- defN 23-Apr-27 15:24 quo/wrapper/__init__.py
+-rw-rw-r--  2.0 unx     1201 b- defN 23-Apr-27 15:24 quo/wrapper/textshawl.py
+-rw-rw-r--  2.0 unx     1073 b- defN 23-Apr-27 16:45 quo-2023.4.dist-info/LICENSE
+-rw-rw-r--  2.0 unx    19239 b- defN 23-Apr-27 16:45 quo-2023.4.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 23-Apr-27 16:45 quo-2023.4.dist-info/WHEEL
+-rw-rw-r--  2.0 unx        4 b- defN 23-Apr-27 16:45 quo-2023.4.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx    16400 b- defN 23-Apr-27 16:45 quo-2023.4.dist-info/RECORD
+205 files, 1884954 bytes uncompressed, 500974 bytes compressed:  73.4%
```

## zipnote {}

```diff
@@ -87,14 +87,17 @@
 
 Filename: quo/rmreplica.py
 Comment: 
 
 Filename: quo/rule.py
 Comment: 
 
+Filename: quo/rules.py
+Comment: 
+
 Filename: quo/search.py
 Comment: 
 
 Filename: quo/selection.py
 Comment: 
 
 Filename: quo/setout.py
@@ -591,23 +594,23 @@
 
 Filename: quo/wrapper/__init__.py
 Comment: 
 
 Filename: quo/wrapper/textshawl.py
 Comment: 
 
-Filename: quo-2023.3.dist-info/LICENSE
+Filename: quo-2023.4.dist-info/LICENSE
 Comment: 
 
-Filename: quo-2023.3.dist-info/METADATA
+Filename: quo-2023.4.dist-info/METADATA
 Comment: 
 
-Filename: quo-2023.3.dist-info/WHEEL
+Filename: quo-2023.4.dist-info/WHEEL
 Comment: 
 
-Filename: quo-2023.3.dist-info/top_level.txt
+Filename: quo-2023.4.dist-info/top_level.txt
 Comment: 
 
-Filename: quo-2023.3.dist-info/RECORD
+Filename: quo-2023.4.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## quo/__init__.py

```diff
@@ -2,81 +2,46 @@
 Quo is a Python based Command Line toolkit for writing Command-Line Interface(CLI) applications. It improves programmer's productivity because it's easy to use and supports auto completion which means less time will be spent debugging. Simple to code, easy to learn, and does not come with needless baggage.
 
 """
 
 import os
 import sys
 
-# from .core import Clime as Clime
-# from .core import Parameter as Parameter
-# from .core import App as App
-# from .core import Tether as Tether
 from .pause import pause as pause
 from .prompt import (
     prompt as prompt,
 )  # dont confuse this with :class: quo.prompt.Prompt()
 
 
-#             Arg,
-#             BaseCommand,
-#             Command,
-#             CommandCollection,
-#             MultiCommand,
-
-
-# from quo.accordance import (
-#        DEFAULT_COLUMNS,
-#        get_winterm_size,
-#        strip_ansi_colors
-#        )
-
-# from quo.context.current import resolve_color_default
-# from quo.expediency import inscribe # LazyFile
-
-# from quo.decorators import (
-#             contextualize,
-#             objectualize,
-#             make_pass_decorator
-#             autoversion,
-#             autopasswd,
-#             autohelp,
-#             autoconfirm
-
-
-# from .setout import HelpFormatter, wraptext
-# from quo.context.current import currentcontext as pass_clime
-# from .parser import AppParser
-
-#from quo.expediency.vitals import (
- #   appdir,
-  #  formatfilename,
-   # os_args,
-    #textstream,
-    #binarystream,
-#)
-
 
 def clear() -> None:
-    from .accordance import isatty, WIN
 
     """Clears the terminal screen and moves the cursor to the top left.
+       :return: None
     """
-    if not isatty(sys.stdout):
-        return
 
-    if WIN:
-        os.system("class")
-    else:
-        sys.stdout.write("\033[2J\033[1;1H")
+    os.system('cls' if os.name == 'nt' else 'clear')
 
+    
 
 def exit(code: int):
 
-    """Low-level exit that skips Python's cleanup but speeds up exit by about 10ms for things like shell completion.
-    :param code: Exit code.
+    """
+    Exit the interpreter immediately using os._exit()
+
+    This function provides a low-level exit that bypasses the normal Python
+    shutdown process and immediately terminates the interpreter. This can
+    be useful in situations where a faster exit is needed, such as shell
+    completion or other interactive applications.
+
+    Args:
+        code (int, optional): The exit status code. Defaults to 0.
+
+    Returns:
+        None
     """
     sys.stdout.flush()
     sys.stderr.flush()
     os._exit(code)
 
 
 def getchar(inscribe: bool = False):
@@ -120,8 +85,8 @@
         
     
 
 #from quo.shortcuts.utils import print
 from quo.i_o.termui import confirm, echo
 from quo.shortcuts.utils import container
 
-__version__ = "2023.3"
+__version__ = "2023.4"
```

## quo/_spinners.py

```diff
@@ -18,16 +18,18 @@
     THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
     INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR
     PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
     FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
     ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGs IN THE SOFTWARE.
 
     """
-    # This code has been reformatted...
 
-class Spinners:
-    arrows = r"▹▹▹▹▹▸▹▹▹▹ ▹▸▹▹▹ ▹▹▸▹▹ ▹▹▹▸▹ ▹▹▹▹▸"
+    # This code has been reformatted to suit our purpose...
+
+class SPINNERS():
+    arrows3 = r"▹▹▹▹▹▸▹▹▹▹ ▹▸▹▹▹ ▹▹▸▹▹ ▹▹▹▸▹ ▹▹▹▹▸"
     dots = r"⠋⠙⠹⠸⠼⠴⠦⠧⠇⠏"
     dots2 = r"⣾⣽⣻⢿⡿⣟⣯⣷"
     dots3 = r"⠋⠙⠚⠞⠖⠦⠴⠲⠳⠓"
     dots4 = r"⠄⠆⠇⠋⠙⠸⠰⠠⠰⠸⠙⠋⠇⠆"
+
     hamburger = r"☱☲☴"
```

## quo/dialog.py

```diff
@@ -9,24 +9,17 @@
 from quo.filters.core import FilterOrBool
 from quo.text.core import AnyFormattedText
 from quo.layout.layout import Layout
 from quo.layout.containers import AnyContainer, HSplit
 from quo.layout.dimension import Dimension as D
 from quo.style.core import BaseStyle
 from quo.types import Validator
-from quo.widget import (
-    Box,
-    Button,
-    #  CheckboxList,
-    Dialog,
-    Label,
-    #    ProgressBar,
-    #   RadioList
-)
 
+from quo.widget.core import Box, Button, Label
+from quo.widget.dialogs import Dialog
 __all__ = [
     "ConfirmBox",
     "ChoiceBox",
     "InputBox",
     "MessageBox",
     "RadiolistBox",
     "CheckBox",
@@ -52,25 +45,25 @@
 
     def no_handler() -> None:
         get_app().exit(result=False)
 
     if bg is False:
         dialog = Dialog(
             title=title,
-            body=Label(text=text, dont_extend_height=True),
+            body=Label(text=text, fixed_height=True),
             buttons=[
                 Button(text=yes_text, handler=yes_handler),
                 Button(text=no_text, handler=no_handler),
             ],
             with_background=False,
         )
     else:
         dialog = Dialog(
             title=title,
-            body=Label(text=text, dont_extend_height=True),
+            body=Label(text=text, fixed_height=True),
             buttons=[
                 Button(text=yes_text, handler=yes_handler),
                 Button(text=no_text, handler=no_handler),
             ],
             with_background=True,
         )  
 
@@ -94,25 +87,25 @@
 
     def button_handler(v: _T) -> None:
         get_app().exit(result=v)
 
     if bg is False:
         dialog = Dialog(
             title=title,
-            body=Label(text=text, dont_extend_height=True),
+            body=Label(text=text, fixed_height=True),
             buttons=[
                 Button(text=t, handler=functools.partial(button_handler, v))
                 for t, v in buttons
             ],
             with_background=False,
         )
     else:
         dialog = Dialog(
             title=title,
-            body=Label(text=text, dont_extend_height=True),
+            body=Label(text=text, fixed_height=True),
             buttons=[
                 Button(text=t, handler=functools.partial(button_handler, v))
                 for t, v in buttons
             ],
             with_background=True,
         )
 
@@ -157,29 +150,29 @@
         accept_handler=accept,
     )
 
     dialog = Dialog(
         title=title,
         body=HSplit(
             [
-                Label(text=text, dont_extend_height=True),
+                Label(text=text, fixed_height=True),
                 textfield,
                 ValidationToolbar(),
             ],
             padding=D(preferred=1, max=1),
         ),
         buttons=[ok_button, cancel_button],
         with_background=True,
     )
     if bg is False:
         dialog = Dialog(
             title=title,
             body=HSplit(
                 [
-                    Label(text=text, dont_extend_height=True),
+                    Label(text=text, fixed_height=True),
                     textfield,
                     ValidationToolbar(),
                 ],
                 padding=D(preferred=1, max=1),
             ),
             buttons=[ok_button, cancel_button],
             with_background=False,
@@ -196,22 +189,22 @@
     bg: bool = True,
 ) -> Console[None]:
     """
     Display a simple message box and wait until the user presses enter.
     """
     dialog = Dialog(
         title=title,
-        body=Label(text=text, dont_extend_height=True),
+        body=Label(text=text, fixed_height=True),
         buttons=[Button(text=ok_text, handler=_return_none)],
         with_background=True,
     )
     if bg is False:
         dialog = Dialog(
             title=title,
-            body=Label(text=text, dont_extend_height=True),
+            body=Label(text=text, fixed_height=True),
             buttons=[Button(text=ok_text, handler=_return_none)],
             with_background=False,
         )
 
     return _create_app(dialog, style)
 
 
@@ -239,15 +232,15 @@
         get_app().exit(result=radio_list.current_value)
 
     radio_list = RadioList(values)
 
     dialog = Dialog(
         title=title,
         body=HSplit(
-            [Label(text=text, dont_extend_height=True), radio_list],
+            [Label(text=text, fixed_height=True), radio_list],
             padding=1,
         ),
         buttons=[
             Button(text=ok_text, handler=ok_handler),
             Button(text=cancel_text, handler=_return_none),
         ],
         with_background=True,
@@ -281,28 +274,28 @@
 
     cb_list = CheckboxList(values)
 
     if bg is False:
         dialog = Dialog(
             title=title,
             body=HSplit(
-                [Label(text=text, dont_extend_height=True), cb_list], padding=1
+                [Label(text=text, fixed_height=True), cb_list], padding=1
             ),
             buttons=[
                 Button(text=ok_text, handler=ok_handler),
                 Button(text=cancel_text, handler=_return_none),
             ],
             with_background=False,
         )
 
     else:
         dialog = Dialog(
             title=title,
             body=HSplit(
-                [Label(text=text, dont_extend_height=True), cb_list], padding=1
+                [Label(text=text, fixed_height=True), cb_list], padding=1
             ),
             buttons=[
                 Button(text=ok_text, handler=ok_handler),
                 Button(text=cancel_text, handler=_return_none),
             ],
             with_background=True,
         )
```

## quo/prompt.py

```diff
@@ -712,15 +712,15 @@
         # Create bottom toolbars.
         bottom_toolbar = ConditionalContainer(
             Window(
                 FormattedTextControl(
                     lambda: self.bottom_toolbar, style="class:bottom-toolbar.text"
                 ),
                 style="class:bottom-toolbar",
-                dont_extend_height=True,
+                fixed_height=True,
                 height=Dimension(min=1),
             ),
             filter=~is_done
             & renderer_height_is_known
             & Condition(lambda: self.bottom_toolbar is not None),
         )
 
@@ -771,15 +771,15 @@
                 # The main input, with completion menus floating on top of it.
                 FloatContainer(
                     HSplit(
                         [
                             ConditionalContainer(
                                 Window(
                                     FormattedTextControl(get_elicit_text_1),
-                                    dont_extend_height=True,
+                                    fixed_height=True,
                                 ),
                                 Condition(has_before_fragments),
                             ),
                             ConditionalContainer(
                                 default_buffer_window,
                                 Condition(
                                     lambda: get_app().layout.current_control
```

## quo/console/__init__.py

```diff
@@ -1,20 +1,16 @@
 from quo.console.console import Console
-from .current import get_app as application
-
-
-
-#(
+from .current import (
     #    AppSession,
     #    create_app_session,
- #   get_app,
+    get_app,
     #    get_app_or_none,
     #    get_app_session,
     #    set_app,
-#)
+)
 
 # from .dummy import DummyApplication
 # from .run_in_terminal import in_terminal, run_in_terminal
 
 
 # __all__ = [
 # Application.
```

## quo/layout/containers.py

```diff
@@ -282,5935 +282,5924 @@
 00001190: 696e 6572 225d 0a0a 0a64 6566 205f 7769  iner"]...def _wi
 000011a0: 6e64 6f77 5f74 6f6f 5f73 6d61 6c6c 2829  ndow_too_small()
 000011b0: 202d 3e20 2257 696e 646f 7722 3a0a 2020   -> "Window":.  
 000011c0: 2020 2243 7265 6174 6520 6120 6057 696e    "Create a `Win
 000011d0: 646f 7760 2074 6861 7420 6469 7370 6c61  dow` that displa
 000011e0: 7973 2074 6865 2027 5769 6e64 6f77 2074  ys the 'Window t
 000011f0: 6f6f 2073 6d61 6c6c 2720 7465 7874 2e22  oo small' text."
-00001200: 0a20 2020 2069 6d70 6f72 7420 6765 7470  .    import getp
-00001210: 6173 730a 2020 2020 7265 7475 726e 2057  ass.    return W
-00001220: 696e 646f 7728 0a20 2020 2020 2020 2020  indow(.         
-00001230: 2020 2046 6f72 6d61 7474 6564 5465 7874     FormattedText
-00001240: 436f 6e74 726f 6c28 7465 7874 3d5b 2822  Control(text=[("
-00001250: 636c 6173 733a 7769 6e64 6f77 2d74 6f6f  class:window-too
-00001260: 2d73 6d61 6c6c 222c 2066 2248 6920 7b67  -small", f"Hi {g
-00001270: 6574 7061 7373 2e67 6574 7573 6572 2829  etpass.getuser()
-00001280: 7d2c 2079 6f75 7220 5769 6e64 6f77 2069  }, your Window i
-00001290: 7320 746f 6f20 736d 616c 6c5c 6e45 6e6c  s too small\nEnl
-000012a0: 6172 6765 2079 6f75 7220 7465 726d 696e  arge your termin
-000012b0: 616c 2077 696e 646f 7722 295d 292c 2061  al window")]), a
-000012c0: 6c69 676e 3d22 6365 6e74 6572 2229 0a0a  lign="center")..
-000012d0: 0a63 6c61 7373 2056 6572 7469 6361 6c41  .class VerticalA
-000012e0: 6c69 676e 2845 6e75 6d29 3a0a 2020 2020  lign(Enum):.    
-000012f0: 2241 6c69 676e 6d65 6e74 2066 6f72 2060  "Alignment for `
-00001300: 4853 706c 6974 602e 220a 2020 2020 544f  HSplit`.".    TO
-00001310: 5020 3d20 2254 4f50 220a 2020 2020 4345  P = "TOP".    CE
-00001320: 4e54 4552 203d 2022 4345 4e54 4552 220a  NTER = "CENTER".
-00001330: 2020 2020 424f 5454 4f4d 203d 2022 424f      BOTTOM = "BO
-00001340: 5454 4f4d 220a 2020 2020 4a55 5354 4946  TTOM".    JUSTIF
-00001350: 5920 3d20 224a 5553 5449 4659 220a 0a63  Y = "JUSTIFY"..c
-00001360: 6c61 7373 2048 6f72 697a 6f6e 7461 6c41  lass HorizontalA
-00001370: 6c69 676e 2845 6e75 6d29 3a0a 2020 2020  lign(Enum):.    
-00001380: 2241 6c69 676e 6d65 6e74 2066 6f72 2060  "Alignment for `
-00001390: 5653 706c 6974 602e 220a 2020 2020 4c45  VSplit`.".    LE
-000013a0: 4654 203d 2022 4c45 4654 220a 2020 2020  FT = "LEFT".    
-000013b0: 4345 4e54 4552 203d 2022 4345 4e54 4552  CENTER = "CENTER
-000013c0: 220a 2020 2020 5249 4748 5420 3d20 2252  ".    RIGHT = "R
-000013d0: 4947 4854 220a 2020 2020 4a55 5354 4946  IGHT".    JUSTIF
-000013e0: 5920 3d20 224a 5553 5449 4659 220a 0a0a  Y = "JUSTIFY"...
-000013f0: 636c 6173 7320 5f53 706c 6974 2843 6f6e  class _Split(Con
-00001400: 7461 696e 6572 293a 0a20 2020 2022 2222  tainer):.    """
-00001410: 0a20 2020 2054 6865 2063 6f6d 6d6f 6e20  .    The common 
-00001420: 7061 7274 7320 6f66 2060 5653 706c 6974  parts of `VSplit
-00001430: 6020 616e 6420 6048 5370 6c69 7460 2e0a  ` and `HSplit`..
-00001440: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
-00001450: 205f 5f69 6e69 745f 5f28 0a20 2020 2020   __init__(.     
-00001460: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00001470: 2073 7562 7365 743a 2053 6571 7565 6e63   subset: Sequenc
-00001480: 655b 416e 7943 6f6e 7461 696e 6572 5d2c  e[AnyContainer],
-00001490: 0a20 2020 2020 2020 2077 696e 646f 775f  .        window_
-000014a0: 746f 6f5f 736d 616c 6c3a 204f 7074 696f  too_small: Optio
-000014b0: 6e61 6c5b 436f 6e74 6169 6e65 725d 203d  nal[Container] =
-000014c0: 204e 6f6e 652c 0a20 2020 2020 2020 2070   None,.        p
-000014d0: 6164 6469 6e67 3a20 416e 7944 696d 656e  adding: AnyDimen
-000014e0: 7369 6f6e 203d 2044 696d 656e 7369 6f6e  sion = Dimension
-000014f0: 2e65 7861 6374 2830 292c 0a20 2020 2020  .exact(0),.     
-00001500: 2020 2070 6164 6469 6e67 5f63 6861 723a     padding_char:
-00001510: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-00001520: 204e 6f6e 652c 0a20 2020 2020 2020 2070   None,.        p
-00001530: 6164 6469 6e67 5f73 7479 6c65 3a20 7374  adding_style: st
-00001540: 7220 3d20 2222 2c0a 2020 2020 2020 2020  r = "",.        
-00001550: 7769 6474 683a 2041 6e79 4469 6d65 6e73  width: AnyDimens
-00001560: 696f 6e20 3d20 4e6f 6e65 2c0a 2020 2020  ion = None,.    
-00001570: 2020 2020 6865 6967 6874 3a20 416e 7944      height: AnyD
-00001580: 696d 656e 7369 6f6e 203d 204e 6f6e 652c  imension = None,
-00001590: 0a20 2020 2020 2020 207a 5f69 6e64 6578  .        z_index
-000015a0: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
-000015b0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-000015c0: 6d6f 6461 6c3a 2062 6f6f 6c20 3d20 4661  modal: bool = Fa
-000015d0: 6c73 652c 0a20 2020 2020 2020 2062 696e  lse,.        bin
-000015e0: 643a 204f 7074 696f 6e61 6c5b 4b65 7942  d: Optional[KeyB
-000015f0: 696e 6469 6e67 7342 6173 655d 203d 204e  indingsBase] = N
-00001600: 6f6e 652c 0a20 2020 2020 2020 2073 7479  one,.        sty
-00001610: 6c65 3a20 556e 696f 6e5b 7374 722c 2043  le: Union[str, C
-00001620: 616c 6c61 626c 655b 5b5d 2c20 7374 725d  allable[[], str]
-00001630: 5d20 3d20 2222 2c0a 2020 2020 2920 2d3e  ] = "",.    ) ->
-00001640: 204e 6f6e 653a 0a0a 2020 2020 2020 2020   None:..        
-00001650: 7365 6c66 2e73 7562 7365 7420 3d20 5b74  self.subset = [t
-00001660: 6f5f 636f 6e74 6169 6e65 7228 6329 2066  o_container(c) f
-00001670: 6f72 2063 2069 6e20 7375 6273 6574 5d0a  or c in subset].
-00001680: 2020 2020 2020 2020 7365 6c66 2e77 696e          self.win
-00001690: 646f 775f 746f 6f5f 736d 616c 6c20 3d20  dow_too_small = 
-000016a0: 7769 6e64 6f77 5f74 6f6f 5f73 6d61 6c6c  window_too_small
-000016b0: 206f 7220 5f77 696e 646f 775f 746f 6f5f   or _window_too_
-000016c0: 736d 616c 6c28 290a 2020 2020 2020 2020  small().        
-000016d0: 7365 6c66 2e70 6164 6469 6e67 203d 2070  self.padding = p
-000016e0: 6164 6469 6e67 0a20 2020 2020 2020 2073  adding.        s
-000016f0: 656c 662e 7061 6464 696e 675f 6368 6172  elf.padding_char
-00001700: 203d 2070 6164 6469 6e67 5f63 6861 720a   = padding_char.
-00001710: 2020 2020 2020 2020 7365 6c66 2e70 6164          self.pad
-00001720: 6469 6e67 5f73 7479 6c65 203d 2070 6164  ding_style = pad
-00001730: 6469 6e67 5f73 7479 6c65 0a0a 2020 2020  ding_style..    
-00001740: 2020 2020 7365 6c66 2e77 6964 7468 203d      self.width =
-00001750: 2077 6964 7468 0a20 2020 2020 2020 2073   width.        s
-00001760: 656c 662e 6865 6967 6874 203d 2068 6569  elf.height = hei
-00001770: 6768 740a 2020 2020 2020 2020 7365 6c66  ght.        self
-00001780: 2e7a 5f69 6e64 6578 203d 207a 5f69 6e64  .z_index = z_ind
-00001790: 6578 0a0a 2020 2020 2020 2020 7365 6c66  ex..        self
-000017a0: 2e6d 6f64 616c 203d 206d 6f64 616c 0a20  .modal = modal. 
-000017b0: 2020 2020 2020 2073 656c 662e 6269 6e64         self.bind
-000017c0: 203d 2062 696e 640a 2020 2020 2020 2020   = bind.        
-000017d0: 7365 6c66 2e73 7479 6c65 203d 2073 7479  self.style = sty
-000017e0: 6c65 0a0a 2020 2020 6465 6620 6973 5f6d  le..    def is_m
-000017f0: 6f64 616c 2873 656c 6629 202d 3e20 626f  odal(self) -> bo
-00001800: 6f6c 3a0a 2020 2020 2020 2020 7265 7475  ol:.        retu
-00001810: 726e 2073 656c 662e 6d6f 6461 6c0a 0a20  rn self.modal.. 
-00001820: 2020 2064 6566 2067 6574 5f6b 6579 5f62     def get_key_b
-00001830: 696e 6469 6e67 7328 7365 6c66 2920 2d3e  indings(self) ->
-00001840: 204f 7074 696f 6e61 6c5b 4b65 7942 696e   Optional[KeyBin
-00001850: 6469 6e67 7342 6173 655d 3a0a 2020 2020  dingsBase]:.    
-00001860: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00001870: 6269 6e64 0a0a 2020 2020 6465 6620 6765  bind..    def ge
-00001880: 745f 6368 696c 6472 656e 2873 656c 6629  t_children(self)
-00001890: 202d 3e20 4c69 7374 5b43 6f6e 7461 696e   -> List[Contain
-000018a0: 6572 5d3a 0a20 2020 2020 2020 2072 6574  er]:.        ret
-000018b0: 7572 6e20 7365 6c66 2e73 7562 7365 740a  urn self.subset.
-000018c0: 0a0a 636c 6173 7320 4853 706c 6974 285f  ..class HSplit(_
-000018d0: 5370 6c69 7429 3a0a 2020 2020 2222 220a  Split):.    """.
-000018e0: 2020 2020 5365 7665 7261 6c20 6c61 796f      Several layo
-000018f0: 7574 732c 206f 6e65 2073 7461 636b 6564  uts, one stacked
-00001900: 2061 626f 7665 2f75 6e64 6572 2074 6865   above/under the
-00001910: 206f 7468 6572 2e20 3a3a 0a0a 2020 2020   other. ::..    
-00001920: 2020 2020 2b2d 2d2d 2d2d 2d2d 2d2d 2d2d      +-----------
-00001930: 2d2d 2d2d 2d2d 2d2d 2d2b 0a20 2020 2020  ---------+.     
-00001940: 2020 207c 2020 2020 2020 2020 2020 2020     |            
-00001950: 2020 2020 2020 2020 7c0a 2020 2020 2020          |.      
-00001960: 2020 2b2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d    +-------------
-00001970: 2d2d 2d2d 2d2d 2d2b 0a20 2020 2020 2020  -------+.       
-00001980: 207c 2020 2020 2020 2020 2020 2020 2020   |              
-00001990: 2020 2020 2020 7c0a 2020 2020 2020 2020        |.        
-000019a0: 2b2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  +---------------
-000019b0: 2d2d 2d2d 2d2b 0a0a 2020 2020 4279 2064  -----+..    By d
-000019c0: 6566 6175 6c74 2c20 7468 6973 2064 6f65  efault, this doe
-000019d0: 736e 2774 2064 6973 706c 6179 2061 2068  sn't display a h
-000019e0: 6f72 697a 6f6e 7461 6c20 6c69 6e65 2062  orizontal line b
-000019f0: 6574 7765 656e 2074 6865 2063 6869 6c64  etween the child
-00001a00: 7265 6e2c 0a20 2020 2062 7574 2069 6620  ren,.    but if 
-00001a10: 7468 6973 2069 7320 736f 6d65 7468 696e  this is somethin
-00001a20: 6720 796f 7520 6e65 6564 2c20 7468 656e  g you need, then
-00001a30: 2063 7265 6174 6520 6120 4853 706c 6974   create a HSplit
-00001a40: 2061 7320 666f 6c6c 6f77 733a 3a0a 0a20   as follows::.. 
-00001a50: 2020 2020 2020 2048 5370 6c69 7428 6368         HSplit(ch
-00001a60: 696c 6472 656e 3d5b 202e 2e2e 205d 2c20  ildren=[ ... ], 
-00001a70: 7061 6464 696e 675f 6368 6172 3d27 2d27  padding_char='-'
-00001a80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00001a90: 2070 6164 6469 6e67 3d31 2c20 7061 6464   padding=1, padd
-00001aa0: 696e 675f 7374 796c 653d 2723 6666 6666  ing_style='#ffff
-00001ab0: 3030 2729 0a0a 2020 2020 3a70 6172 616d  00')..    :param
-00001ac0: 2063 6869 6c64 7265 6e3a 204c 6973 7420   children: List 
-00001ad0: 6f66 2063 6869 6c64 203a 636c 6173 733a  of child :class:
-00001ae0: 602e 436f 6e74 6169 6e65 7260 206f 626a  `.Container` obj
-00001af0: 6563 7473 2e0a 2020 2020 3a70 6172 616d  ects..    :param
-00001b00: 2077 696e 646f 775f 746f 6f5f 736d 616c   window_too_smal
-00001b10: 6c3a 2041 203a 636c 6173 733a 602e 436f  l: A :class:`.Co
-00001b20: 6e74 6169 6e65 7260 206f 626a 6563 7420  ntainer` object 
-00001b30: 7468 6174 2069 7320 6469 7370 6c61 7965  that is displaye
-00001b40: 6420 6966 0a20 2020 2020 2020 2074 6865  d if.        the
-00001b50: 7265 2069 7320 6e6f 7420 656e 6f75 6768  re is not enough
-00001b60: 2073 7061 6365 2066 6f72 2061 6c6c 2074   space for all t
-00001b70: 6865 2063 6869 6c64 7265 6e2e 2042 7920  he children. By 
-00001b80: 6465 6661 756c 742c 2074 6869 7320 6973  default, this is
-00001b90: 2061 0a20 2020 2020 2020 2022 5769 6e64   a.        "Wind
-00001ba0: 6f77 2074 6f6f 2073 6d61 6c6c 2220 6d65  ow too small" me
-00001bb0: 7373 6167 652e 0a20 2020 203a 7061 7261  ssage..    :para
-00001bc0: 6d20 616c 6967 6e3a 2060 5665 7274 6963  m align: `Vertic
-00001bd0: 616c 416c 6967 6e60 2076 616c 7565 2e0a  alAlign` value..
-00001be0: 2020 2020 3a70 6172 616d 2077 6964 7468      :param width
-00001bf0: 3a20 5768 656e 2067 6976 656e 2c20 7573  : When given, us
-00001c00: 6520 7468 6973 2077 6964 7468 2069 6e73  e this width ins
-00001c10: 7465 6164 206f 6620 6c6f 6f6b 696e 6720  tead of looking 
-00001c20: 6174 2074 6865 2063 6869 6c64 7265 6e2e  at the children.
-00001c30: 0a20 2020 203a 7061 7261 6d20 6865 6967  .    :param heig
-00001c40: 6874 3a20 5768 656e 2067 6976 656e 2c20  ht: When given, 
-00001c50: 7573 6520 7468 6973 2068 6569 6768 7420  use this height 
-00001c60: 696e 7374 6561 6420 6f66 206c 6f6f 6b69  instead of looki
-00001c70: 6e67 2061 7420 7468 6520 6368 696c 6472  ng at the childr
-00001c80: 656e 2e0a 2020 2020 3a70 6172 616d 207a  en..    :param z
-00001c90: 5f69 6e64 6578 3a20 2869 6e74 206f 7220  _index: (int or 
-00001ca0: 4e6f 6e65 2920 5768 656e 2073 7065 6369  None) When speci
-00001cb0: 6669 6564 2c20 7468 6973 2063 616e 2062  fied, this can b
-00001cc0: 6520 7573 6564 2074 6f20 6272 696e 670a  e used to bring.
-00001cd0: 2020 2020 2020 2020 656c 656d 656e 7420          element 
-00001ce0: 696e 2066 726f 6e74 206f 6620 666c 6f61  in front of floa
-00001cf0: 7469 6e67 2065 6c65 6d65 6e74 732e 2020  ting elements.  
-00001d00: 604e 6f6e 6560 206d 6561 6e73 3a20 696e  `None` means: in
-00001d10: 6865 7269 7420 6672 6f6d 2070 6172 656e  herit from paren
-00001d20: 742e 0a20 2020 203a 7061 7261 6d20 7374  t..    :param st
-00001d30: 796c 653a 2041 2073 7479 6c65 2073 7472  yle: A style str
-00001d40: 696e 672e 0a20 2020 203a 7061 7261 6d20  ing..    :param 
-00001d50: 6d6f 6461 6c3a 2060 6054 7275 6560 6020  modal: ``True`` 
-00001d60: 6f72 2060 6046 616c 7365 6060 2e0a 2020  or ``False``..  
-00001d70: 2020 3a70 6172 616d 2062 696e 643a 2060    :param bind: `
-00001d80: 604e 6f6e 6560 6020 6f72 2061 203a 636c  `None`` or a :cl
-00001d90: 6173 733a 602e 4269 6e64 6020 6f62 6a65  ass:`.Bind` obje
-00001da0: 6374 2e0a 0a20 2020 203a 7061 7261 6d20  ct...    :param 
-00001db0: 7061 6464 696e 673a 2028 6044 696d 656e  padding: (`Dimen
-00001dc0: 7369 6f6e 6020 6f72 2069 6e74 292c 2073  sion` or int), s
-00001dd0: 697a 6520 746f 2062 6520 7573 6564 2066  ize to be used f
-00001de0: 6f72 2074 6865 2070 6164 6469 6e67 2e0a  or the padding..
-00001df0: 2020 2020 3a70 6172 616d 2070 6164 6469      :param paddi
-00001e00: 6e67 5f63 6861 723a 2043 6861 7261 6374  ng_char: Charact
-00001e10: 6572 2074 6f20 6265 2075 7365 6420 666f  er to be used fo
-00001e20: 7220 6669 6c6c 696e 6720 696e 2074 6865  r filling in the
-00001e30: 2070 6164 6469 6e67 2e0a 2020 2020 3a70   padding..    :p
-00001e40: 6172 616d 2070 6164 6469 6e67 5f73 7479  aram padding_sty
-00001e50: 6c65 3a20 5374 796c 6520 746f 2061 7070  le: Style to app
-00001e60: 6c69 6564 2074 6f20 7468 6520 7061 6464  lied to the padd
-00001e70: 696e 672e 0a20 2020 2022 2222 0a20 2020  ing..    """.   
-00001e80: 2074 6f70 203d 2056 6572 7469 6361 6c41   top = VerticalA
-00001e90: 6c69 676e 2e54 4f50 0a20 2020 2063 656e  lign.TOP.    cen
-00001ea0: 7465 7220 3d20 5665 7274 6963 616c 416c  ter = VerticalAl
-00001eb0: 6967 6e2e 4345 4e54 4552 0a20 2020 2062  ign.CENTER.    b
-00001ec0: 6f74 746f 6d20 3d20 5665 7274 6963 616c  ottom = Vertical
-00001ed0: 416c 6967 6e2e 424f 5454 4f4d 0a20 2020  Align.BOTTOM.   
-00001ee0: 206a 7573 7469 6679 203d 2056 6572 7469   justify = Verti
-00001ef0: 6361 6c41 6c69 676e 2e4a 5553 5449 4659  calAlign.JUSTIFY
-00001f00: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-00001f10: 5f5f 280a 2020 2020 2020 2020 7365 6c66  __(.        self
-00001f20: 2c0a 2020 2020 2020 2020 7375 6273 6574  ,.        subset
-00001f30: 3a20 5365 7175 656e 6365 5b41 6e79 436f  : Sequence[AnyCo
-00001f40: 6e74 6169 6e65 725d 2c0a 2020 2020 2020  ntainer],.      
-00001f50: 2020 7769 6e64 6f77 5f74 6f6f 5f73 6d61    window_too_sma
-00001f60: 6c6c 3a20 4f70 7469 6f6e 616c 5b43 6f6e  ll: Optional[Con
-00001f70: 7461 696e 6572 5d20 3d20 4e6f 6e65 2c0a  tainer] = None,.
-00001f80: 2020 2020 2020 2020 616c 6967 6e3a 2056          align: V
-00001f90: 6572 7469 6361 6c41 6c69 676e 203d 2022  erticalAlign = "
-00001fa0: 6a75 7374 6966 7922 2c0a 2020 2020 2020  justify",.      
-00001fb0: 2020 7061 6464 696e 673a 2041 6e79 4469    padding: AnyDi
-00001fc0: 6d65 6e73 696f 6e20 3d20 302c 0a20 2020  mension = 0,.   
-00001fd0: 2020 2020 2070 6164 6469 6e67 5f63 6861       padding_cha
-00001fe0: 723a 204f 7074 696f 6e61 6c5b 7374 725d  r: Optional[str]
-00001ff0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00002000: 2070 6164 6469 6e67 5f73 7479 6c65 3a20   padding_style: 
-00002010: 7374 7220 3d20 2222 2c0a 2020 2020 2020  str = "",.      
-00002020: 2020 7769 6474 683a 2041 6e79 4469 6d65    width: AnyDime
-00002030: 6e73 696f 6e20 3d20 4e6f 6e65 2c0a 2020  nsion = None,.  
-00002040: 2020 2020 2020 6865 6967 6874 3a20 416e        height: An
-00002050: 7944 696d 656e 7369 6f6e 203d 204e 6f6e  yDimension = Non
-00002060: 652c 0a20 2020 2020 2020 207a 5f69 6e64  e,.        z_ind
-00002070: 6578 3a20 4f70 7469 6f6e 616c 5b69 6e74  ex: Optional[int
-00002080: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-00002090: 2020 6d6f 6461 6c3a 2062 6f6f 6c20 3d20    modal: bool = 
-000020a0: 4661 6c73 652c 0a20 2020 2020 2020 2062  False,.        b
-000020b0: 696e 643a 204f 7074 696f 6e61 6c5b 4b65  ind: Optional[Ke
-000020c0: 7942 696e 6469 6e67 7342 6173 655d 203d  yBindingsBase] =
-000020d0: 204e 6f6e 652c 0a20 2020 2020 2020 2073   None,.        s
-000020e0: 7479 6c65 3a20 556e 696f 6e5b 7374 722c  tyle: Union[str,
-000020f0: 2043 616c 6c61 626c 655b 5b5d 2c20 7374   Callable[[], st
-00002100: 725d 5d20 3d20 2222 2c0a 2020 2020 2920  r]] = "",.    ) 
-00002110: 2d3e 204e 6f6e 653a 0a0a 2020 2020 2020  -> None:..      
-00002120: 2020 7375 7065 7228 292e 5f5f 696e 6974    super().__init
-00002130: 5f5f 280a 2020 2020 2020 2020 2020 2020  __(.            
-00002140: 7375 6273 6574 3d73 7562 7365 742c 0a20  subset=subset,. 
-00002150: 2020 2020 2020 2020 2020 2077 696e 646f             windo
-00002160: 775f 746f 6f5f 736d 616c 6c3d 7769 6e64  w_too_small=wind
-00002170: 6f77 5f74 6f6f 5f73 6d61 6c6c 2c0a 2020  ow_too_small,.  
-00002180: 2020 2020 2020 2020 2020 7061 6464 696e            paddin
-00002190: 673d 7061 6464 696e 672c 0a20 2020 2020  g=padding,.     
-000021a0: 2020 2020 2020 2070 6164 6469 6e67 5f63         padding_c
-000021b0: 6861 723d 7061 6464 696e 675f 6368 6172  har=padding_char
-000021c0: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
-000021d0: 6464 696e 675f 7374 796c 653d 7061 6464  dding_style=padd
-000021e0: 696e 675f 7374 796c 652c 0a20 2020 2020  ing_style,.     
-000021f0: 2020 2020 2020 2077 6964 7468 3d77 6964         width=wid
-00002200: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
-00002210: 6865 6967 6874 3d68 6569 6768 742c 0a20  height=height,. 
-00002220: 2020 2020 2020 2020 2020 207a 5f69 6e64             z_ind
-00002230: 6578 3d7a 5f69 6e64 6578 2c0a 2020 2020  ex=z_index,.    
-00002240: 2020 2020 2020 2020 6d6f 6461 6c3d 6d6f          modal=mo
-00002250: 6461 6c2c 0a20 2020 2020 2020 2020 2020  dal,.           
-00002260: 2062 696e 643d 6269 6e64 2c0a 2020 2020   bind=bind,.    
-00002270: 2020 2020 2020 2020 7374 796c 653d 7374          style=st
-00002280: 796c 652c 0a20 2020 2020 2020 2029 0a0a  yle,.        )..
-00002290: 2020 2020 2020 2020 7365 6c66 2e61 6c69          self.ali
-000022a0: 676e 203d 2061 6c69 676e 0a0a 2020 2020  gn = align..    
-000022b0: 2020 2020 7365 6c66 2e5f 6368 696c 6472      self._childr
-000022c0: 656e 5f63 6163 6865 3a20 5369 6d70 6c65  en_cache: Simple
-000022d0: 4361 6368 655b 0a20 2020 2020 2020 2020  Cache[.         
-000022e0: 2020 2054 7570 6c65 5b43 6f6e 7461 696e     Tuple[Contain
-000022f0: 6572 2c20 2e2e 2e5d 2c20 4c69 7374 5b43  er, ...], List[C
-00002300: 6f6e 7461 696e 6572 5d0a 2020 2020 2020  ontainer].      
-00002310: 2020 5d20 3d20 5369 6d70 6c65 4361 6368    ] = SimpleCach
-00002320: 6528 6d61 7873 697a 653d 3129 0a20 2020  e(maxsize=1).   
-00002330: 2020 2020 2073 656c 662e 5f72 656d 6169       self._remai
-00002340: 6e69 6e67 5f73 7061 6365 5f77 696e 646f  ning_space_windo
-00002350: 7720 3d20 5769 6e64 6f77 2829 2020 2320  w = Window()  # 
-00002360: 4475 6d6d 7920 7769 6e64 6f77 2e0a 0a20  Dummy window... 
-00002370: 2020 2064 6566 2070 7265 6665 7272 6564     def preferred
-00002380: 5f77 6964 7468 2873 656c 662c 206d 6178  _width(self, max
-00002390: 5f61 7661 696c 6162 6c65 5f77 6964 7468  _available_width
-000023a0: 3a20 696e 7429 202d 3e20 4469 6d65 6e73  : int) -> Dimens
-000023b0: 696f 6e3a 0a20 2020 2020 2020 2069 6620  ion:.        if 
-000023c0: 7365 6c66 2e77 6964 7468 2069 7320 6e6f  self.width is no
-000023d0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-000023e0: 2020 2020 7265 7475 726e 2074 6f5f 6469      return to_di
-000023f0: 6d65 6e73 696f 6e28 7365 6c66 2e77 6964  mension(self.wid
-00002400: 7468 290a 0a20 2020 2020 2020 2069 6620  th)..        if 
-00002410: 7365 6c66 2e73 7562 7365 743a 0a20 2020  self.subset:.   
-00002420: 2020 2020 2020 2020 2064 696d 656e 7369           dimensi
-00002430: 6f6e 7320 3d20 5b63 2e70 7265 6665 7272  ons = [c.preferr
-00002440: 6564 5f77 6964 7468 286d 6178 5f61 7661  ed_width(max_ava
-00002450: 696c 6162 6c65 5f77 6964 7468 2920 666f  ilable_width) fo
-00002460: 7220 6320 696e 2073 656c 662e 7375 6273  r c in self.subs
-00002470: 6574 5d0a 2020 2020 2020 2020 2020 2020  et].            
-00002480: 7265 7475 726e 206d 6178 5f6c 6179 6f75  return max_layou
-00002490: 745f 6469 6d65 6e73 696f 6e73 2864 696d  t_dimensions(dim
-000024a0: 656e 7369 6f6e 7329 0a20 2020 2020 2020  ensions).       
-000024b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000024c0: 2020 2072 6574 7572 6e20 4469 6d65 6e73     return Dimens
-000024d0: 696f 6e28 290a 0a20 2020 2064 6566 2070  ion()..    def p
-000024e0: 7265 6665 7272 6564 5f68 6569 6768 7428  referred_height(
-000024f0: 7365 6c66 2c20 7769 6474 683a 2069 6e74  self, width: int
-00002500: 2c20 6d61 785f 6176 6169 6c61 626c 655f  , max_available_
-00002510: 6865 6967 6874 3a20 696e 7429 202d 3e20  height: int) -> 
-00002520: 4469 6d65 6e73 696f 6e3a 0a20 2020 2020  Dimension:.     
-00002530: 2020 2069 6620 7365 6c66 2e68 6569 6768     if self.heigh
-00002540: 7420 6973 206e 6f74 204e 6f6e 653a 0a20  t is not None:. 
-00002550: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00002560: 6e20 746f 5f64 696d 656e 7369 6f6e 2873  n to_dimension(s
-00002570: 656c 662e 6865 6967 6874 290a 0a20 2020  elf.height)..   
-00002580: 2020 2020 2064 696d 656e 7369 6f6e 7320       dimensions 
-00002590: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
-000025a0: 632e 7072 6566 6572 7265 645f 6865 6967  c.preferred_heig
-000025b0: 6874 2877 6964 7468 2c20 6d61 785f 6176  ht(width, max_av
-000025c0: 6169 6c61 626c 655f 6865 6967 6874 2920  ailable_height) 
-000025d0: 666f 7220 6320 696e 2073 656c 662e 5f61  for c in self._a
-000025e0: 6c6c 5f63 6869 6c64 7265 6e0a 2020 2020  ll_children.    
-000025f0: 2020 2020 5d0a 2020 2020 2020 2020 7265      ].        re
-00002600: 7475 726e 2073 756d 5f6c 6179 6f75 745f  turn sum_layout_
-00002610: 6469 6d65 6e73 696f 6e73 2864 696d 656e  dimensions(dimen
-00002620: 7369 6f6e 7329 0a0a 2020 2020 6465 6620  sions)..    def 
-00002630: 7265 7365 7428 7365 6c66 2920 2d3e 204e  reset(self) -> N
-00002640: 6f6e 653a 0a20 2020 2020 2020 2066 6f72  one:.        for
-00002650: 2063 2069 6e20 7365 6c66 2e73 7562 7365   c in self.subse
-00002660: 743a 0a20 2020 2020 2020 2020 2020 2063  t:.            c
-00002670: 2e72 6573 6574 2829 0a0a 2020 2020 4070  .reset()..    @p
-00002680: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00002690: 5f61 6c6c 5f63 6869 6c64 7265 6e28 7365  _all_children(se
-000026a0: 6c66 2920 2d3e 204c 6973 745b 436f 6e74  lf) -> List[Cont
-000026b0: 6169 6e65 725d 3a0a 2020 2020 2020 2020  ainer]:.        
-000026c0: 2222 220a 2020 2020 2020 2020 4c69 7374  """.        List
-000026d0: 206f 6620 6368 696c 6420 6f62 6a65 6374   of child object
-000026e0: 732c 2069 6e63 6c75 6469 6e67 2070 6164  s, including pad
-000026f0: 6469 6e67 2e0a 2020 2020 2020 2020 2222  ding..        ""
-00002700: 220a 0a20 2020 2020 2020 2064 6566 2067  "..        def g
-00002710: 6574 2829 202d 3e20 4c69 7374 5b43 6f6e  et() -> List[Con
-00002720: 7461 696e 6572 5d3a 0a20 2020 2020 2020  tainer]:.       
-00002730: 2020 2020 2072 6573 756c 743a 204c 6973       result: Lis
-00002740: 745b 436f 6e74 6169 6e65 725d 203d 205b  t[Container] = [
-00002750: 5d0a 0a20 2020 2020 2020 2020 2020 2023  ]..            #
-00002760: 2050 6164 6469 6e67 2054 6f70 2e0a 2020   Padding Top..  
-00002770: 2020 2020 2020 2020 2020 6365 6e74 6572            center
-00002780: 203d 2056 6572 7469 6361 6c41 6c69 676e   = VerticalAlign
-00002790: 2e43 454e 5445 520a 2020 2020 2020 2020  .CENTER.        
-000027a0: 2020 2020 626f 7474 6f6d 203d 2056 6572      bottom = Ver
-000027b0: 7469 6361 6c41 6c69 676e 2e42 4f54 544f  ticalAlign.BOTTO
-000027c0: 4d0a 2020 2020 2020 2020 2020 2020 6966  M.            if
-000027d0: 2073 656c 662e 616c 6967 6e20 696e 2028   self.align in (
-000027e0: 6365 6e74 6572 2c20 626f 7474 6f6d 293a  center, bottom):
-000027f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002800: 2072 6573 756c 742e 6170 7065 6e64 2857   result.append(W
-00002810: 696e 646f 7728 7769 6474 683d 4469 6d65  indow(width=Dime
-00002820: 6e73 696f 6e28 7072 6566 6572 7265 643d  nsion(preferred=
-00002830: 3029 2929 0a0a 2020 2020 2020 2020 2020  0)))..          
-00002840: 2020 2320 5468 6520 7375 6273 6574 7320    # The subsets 
-00002850: 7769 7468 2070 6164 6469 6e67 2e0a 2020  with padding..  
-00002860: 2020 2020 2020 2020 2020 666f 7220 6368            for ch
-00002870: 696c 6420 696e 2073 656c 662e 7375 6273  ild in self.subs
-00002880: 6574 3a0a 2020 2020 2020 2020 2020 2020  et:.            
-00002890: 2020 2020 7265 7375 6c74 2e61 7070 656e      result.appen
-000028a0: 6428 6368 696c 6429 0a20 2020 2020 2020  d(child).       
-000028b0: 2020 2020 2020 2020 2072 6573 756c 742e           result.
-000028c0: 6170 7065 6e64 280a 2020 2020 2020 2020  append(.        
-000028d0: 2020 2020 2020 2020 2020 2020 5769 6e64              Wind
-000028e0: 6f77 280a 2020 2020 2020 2020 2020 2020  ow(.            
-000028f0: 2020 2020 2020 2020 2020 2020 6865 6967              heig
-00002900: 6874 3d73 656c 662e 7061 6464 696e 672c  ht=self.padding,
-00002910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002920: 2020 2020 2020 2020 2063 6861 723d 7365           char=se
-00002930: 6c66 2e70 6164 6469 6e67 5f63 6861 722c  lf.padding_char,
-00002940: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002950: 2020 2020 2020 2020 2073 7479 6c65 3d73           style=s
-00002960: 656c 662e 7061 6464 696e 675f 7374 796c  elf.padding_styl
-00002970: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00002980: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00002990: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000029a0: 2020 2020 2020 2069 6620 7265 7375 6c74         if result
-000029b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000029c0: 2020 7265 7375 6c74 2e70 6f70 2829 0a0a    result.pop()..
-000029d0: 2020 2020 2020 2020 2020 2020 2320 5061              # Pa
-000029e0: 6464 696e 6720 7269 6768 742e 0a20 2020  dding right..   
-000029f0: 2020 2020 2020 2020 2074 6f70 203d 2056           top = V
-00002a00: 6572 7469 6361 6c41 6c69 676e 2e54 4f50  erticalAlign.TOP
-00002a10: 0a20 2020 2020 2020 2020 2020 2063 656e  .            cen
-00002a20: 7465 7220 3d20 5665 7274 6963 616c 416c  ter = VerticalAl
-00002a30: 6967 6e2e 4345 4e54 4552 0a20 2020 2020  ign.CENTER.     
-00002a40: 2020 2020 2020 2069 6620 7365 6c66 2e61         if self.a
-00002a50: 6c69 676e 2069 6e20 2863 656e 7465 722c  lign in (center,
-00002a60: 2074 6f70 293a 0a20 2020 2020 2020 2020   top):.         
-00002a70: 2020 2020 2020 2072 6573 756c 742e 6170         result.ap
-00002a80: 7065 6e64 2857 696e 646f 7728 7769 6474  pend(Window(widt
-00002a90: 683d 4469 6d65 6e73 696f 6e28 7072 6566  h=Dimension(pref
-00002aa0: 6572 7265 643d 3029 2929 0a0a 2020 2020  erred=0)))..    
-00002ab0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00002ac0: 6573 756c 740a 0a20 2020 2020 2020 2072  esult..        r
-00002ad0: 6574 7572 6e20 7365 6c66 2e5f 6368 696c  eturn self._chil
-00002ae0: 6472 656e 5f63 6163 6865 2e67 6574 2874  dren_cache.get(t
-00002af0: 7570 6c65 2873 656c 662e 7375 6273 6574  uple(self.subset
-00002b00: 292c 2067 6574 290a 0a20 2020 2064 6566  ), get)..    def
-00002b10: 2077 7269 7465 5f74 6f5f 7363 7265 656e   write_to_screen
-00002b20: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-00002b30: 2020 2020 2020 2020 7363 7265 656e 3a20          screen: 
-00002b40: 5363 7265 656e 2c0a 2020 2020 2020 2020  Screen,.        
-00002b50: 6d6f 7573 655f 6861 6e64 6c65 7273 3a20  mouse_handlers: 
-00002b60: 4d6f 7573 6548 616e 646c 6572 732c 0a20  MouseHandlers,. 
-00002b70: 2020 2020 2020 2077 7269 7465 5f70 6f73         write_pos
-00002b80: 6974 696f 6e3a 2057 7269 7465 506f 7369  ition: WritePosi
-00002b90: 7469 6f6e 2c0a 2020 2020 2020 2020 7061  tion,.        pa
-00002ba0: 7265 6e74 5f73 7479 6c65 3a20 7374 722c  rent_style: str,
-00002bb0: 0a20 2020 2020 2020 2065 7261 7365 5f62  .        erase_b
-00002bc0: 673a 2062 6f6f 6c2c 0a20 2020 2020 2020  g: bool,.       
-00002bd0: 207a 5f69 6e64 6578 3a20 4f70 7469 6f6e   z_index: Option
-00002be0: 616c 5b69 6e74 5d2c 0a20 2020 2029 202d  al[int],.    ) -
-00002bf0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00002c00: 2222 220a 2020 2020 2020 2020 5265 6e64  """.        Rend
-00002c10: 6572 2074 6865 2070 726f 6d70 7420 746f  er the prompt to
-00002c20: 2061 2060 5363 7265 656e 6020 696e 7374   a `Screen` inst
-00002c30: 616e 6365 2e0a 0a20 2020 2020 2020 203a  ance...        :
-00002c40: 7061 7261 6d20 7363 7265 656e 3a20 5468  param screen: Th
-00002c50: 6520 3a63 6c61 7373 3a60 7e71 756f 2e6c  e :class:`~quo.l
-00002c60: 6179 6f75 742e 7363 7265 656e 2e53 6372  ayout.screen.Scr
-00002c70: 6565 6e60 2063 6c61 7373 0a20 2020 2020  een` class.     
-00002c80: 2020 2020 2020 2074 6f20 7768 6963 6820         to which 
-00002c90: 7468 6520 6f75 7470 7574 2068 6173 2074  the output has t
-00002ca0: 6f20 6265 2077 7269 7474 656e 2e0a 2020  o be written..  
-00002cb0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00002cc0: 2020 7369 7a65 7320 3d20 7365 6c66 2e5f    sizes = self._
-00002cd0: 6469 7669 6465 5f68 6569 6768 7473 2877  divide_heights(w
-00002ce0: 7269 7465 5f70 6f73 6974 696f 6e29 0a20  rite_position). 
-00002cf0: 2020 2020 2020 2073 7479 6c65 203d 2070         style = p
-00002d00: 6172 656e 745f 7374 796c 6520 2b20 2220  arent_style + " 
-00002d10: 2220 2b20 746f 5f73 7472 2873 656c 662e  " + to_str(self.
-00002d20: 7374 796c 6529 0a20 2020 2020 2020 207a  style).        z
-00002d30: 5f69 6e64 6578 203d 207a 5f69 6e64 6578  _index = z_index
-00002d40: 2069 6620 7365 6c66 2e7a 5f69 6e64 6578   if self.z_index
-00002d50: 2069 7320 4e6f 6e65 2065 6c73 6520 7365   is None else se
-00002d60: 6c66 2e7a 5f69 6e64 6578 0a0a 2020 2020  lf.z_index..    
-00002d70: 2020 2020 6966 2073 697a 6573 2069 7320      if sizes is 
-00002d80: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00002d90: 2020 7365 6c66 2e77 696e 646f 775f 746f    self.window_to
-00002da0: 6f5f 736d 616c 6c2e 7772 6974 655f 746f  o_small.write_to
-00002db0: 5f73 6372 6565 6e28 0a20 2020 2020 2020  _screen(.       
-00002dc0: 2020 2020 2020 2020 2073 6372 6565 6e2c           screen,
-00002dd0: 206d 6f75 7365 5f68 616e 646c 6572 732c   mouse_handlers,
-00002de0: 2077 7269 7465 5f70 6f73 6974 696f 6e2c   write_position,
-00002df0: 2073 7479 6c65 2c20 6572 6173 655f 6267   style, erase_bg
-00002e00: 2c20 7a5f 696e 6465 780a 2020 2020 2020  , z_index.      
-00002e10: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00002e20: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00002e30: 2020 230a 2020 2020 2020 2020 2020 2020    #.            
-00002e40: 7970 6f73 203d 2077 7269 7465 5f70 6f73  ypos = write_pos
-00002e50: 6974 696f 6e2e 7970 6f73 0a20 2020 2020  ition.ypos.     
-00002e60: 2020 2020 2020 2078 706f 7320 3d20 7772         xpos = wr
-00002e70: 6974 655f 706f 7369 7469 6f6e 2e78 706f  ite_position.xpo
-00002e80: 730a 2020 2020 2020 2020 2020 2020 7769  s.            wi
-00002e90: 6474 6820 3d20 7772 6974 655f 706f 7369  dth = write_posi
-00002ea0: 7469 6f6e 2e77 6964 7468 0a0a 2020 2020  tion.width..    
-00002eb0: 2020 2020 2020 2020 2320 4472 6177 2063          # Draw c
-00002ec0: 6869 6c64 2070 616e 6573 2e0a 2020 2020  hild panes..    
-00002ed0: 2020 2020 2020 2020 666f 7220 732c 2063          for s, c
-00002ee0: 2069 6e20 7a69 7028 7369 7a65 732c 2073   in zip(sizes, s
-00002ef0: 656c 662e 5f61 6c6c 5f63 6869 6c64 7265  elf._all_childre
-00002f00: 6e29 3a0a 2020 2020 2020 2020 2020 2020  n):.            
-00002f10: 2020 2020 632e 7772 6974 655f 746f 5f73      c.write_to_s
-00002f20: 6372 6565 6e28 0a20 2020 2020 2020 2020  creen(.         
-00002f30: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-00002f40: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-00002f50: 2020 2020 2020 206d 6f75 7365 5f68 616e         mouse_han
-00002f60: 646c 6572 732c 0a20 2020 2020 2020 2020  dlers,.         
-00002f70: 2020 2020 2020 2020 2020 2057 7269 7465             Write
-00002f80: 506f 7369 7469 6f6e 2878 706f 732c 2079  Position(xpos, y
-00002f90: 706f 732c 2077 6964 7468 2c20 7329 2c0a  pos, width, s),.
-00002fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002fb0: 2020 2020 7374 796c 652c 0a20 2020 2020      style,.     
-00002fc0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00002fd0: 7261 7365 5f62 672c 0a20 2020 2020 2020  rase_bg,.       
-00002fe0: 2020 2020 2020 2020 2020 2020 207a 5f69               z_i
-00002ff0: 6e64 6578 2c0a 2020 2020 2020 2020 2020  ndex,.          
-00003000: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00003010: 2020 2020 2020 2020 7970 6f73 202b 3d20          ypos += 
-00003020: 730a 0a20 2020 2020 2020 2020 2020 2023  s..            #
-00003030: 2046 696c 6c20 696e 2074 6865 2072 656d   Fill in the rem
-00003040: 6169 6e69 6e67 2073 7061 6365 2e20 5468  aining space. Th
-00003050: 6973 2068 6170 7065 6e73 2077 6865 6e20  is happens when 
-00003060: 6120 6368 696c 6420 636f 6e74 726f 6c0a  a child control.
-00003070: 2020 2020 2020 2020 2020 2020 2320 7265              # re
-00003080: 6675 7365 7320 746f 2074 616b 6520 6d6f  fuses to take mo
-00003090: 7265 2073 7061 6365 2061 6e64 2077 6520  re space and we 
-000030a0: 646f 6e27 7420 6861 7665 2061 6e79 2070  don't have any p
-000030b0: 6164 6469 6e67 2e20 4164 6469 6e67 2061  adding. Adding a
-000030c0: 0a20 2020 2020 2020 2020 2020 2023 2064  .            # d
-000030d0: 756d 6d79 2063 6869 6c64 2063 6f6e 7472  ummy child contr
-000030e0: 6f6c 2066 6f72 2074 6869 7320 2869 6e20  ol for this (in 
-000030f0: 6073 656c 662e 5f61 6c6c 5f63 6869 6c64  `self._all_child
-00003100: 7265 6e60 2920 6973 206e 6f74 0a20 2020  ren`) is not.   
-00003110: 2020 2020 2020 2020 2023 2064 6573 6972           # desir
-00003120: 6564 2c20 6265 6361 7573 6520 696e 2073  ed, because in s
-00003130: 6f6d 6520 7369 7475 6174 696f 6e73 2c20  ome situations, 
-00003140: 6974 2077 6f75 6c64 2074 616b 6520 6d6f  it would take mo
-00003150: 7265 2073 7061 6365 2c20 6576 656e 0a20  re space, even. 
-00003160: 2020 2020 2020 2020 2020 2023 2077 6865             # whe
-00003170: 6e20 6974 2773 206e 6f74 2072 6571 7569  n it's not requi
-00003180: 7265 642e 2054 6869 7320 6973 2072 6571  red. This is req
-00003190: 7569 7265 6420 746f 2061 7070 6c79 2074  uired to apply t
-000031a0: 6865 2073 7479 6c69 6e67 2e0a 2020 2020  he styling..    
-000031b0: 2020 2020 2020 2020 7265 6d61 696e 696e          remainin
-000031c0: 675f 6865 6967 6874 203d 2077 7269 7465  g_height = write
-000031d0: 5f70 6f73 6974 696f 6e2e 7970 6f73 202b  _position.ypos +
-000031e0: 2077 7269 7465 5f70 6f73 6974 696f 6e2e   write_position.
-000031f0: 6865 6967 6874 202d 2079 706f 730a 2020  height - ypos.  
-00003200: 2020 2020 2020 2020 2020 6966 2072 656d            if rem
-00003210: 6169 6e69 6e67 5f68 6569 6768 7420 3e20  aining_height > 
-00003220: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00003230: 2020 2073 656c 662e 5f72 656d 6169 6e69     self._remaini
-00003240: 6e67 5f73 7061 6365 5f77 696e 646f 772e  ng_space_window.
-00003250: 7772 6974 655f 746f 5f73 6372 6565 6e28  write_to_screen(
-00003260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003270: 2020 2020 2073 6372 6565 6e2c 0a20 2020       screen,.   
-00003280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003290: 206d 6f75 7365 5f68 616e 646c 6572 732c   mouse_handlers,
-000032a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000032b0: 2020 2020 2057 7269 7465 506f 7369 7469       WritePositi
-000032c0: 6f6e 2878 706f 732c 2079 706f 732c 2077  on(xpos, ypos, w
-000032d0: 6964 7468 2c20 7265 6d61 696e 696e 675f  idth, remaining_
-000032e0: 6865 6967 6874 292c 0a20 2020 2020 2020  height),.       
-000032f0: 2020 2020 2020 2020 2020 2020 2073 7479               sty
-00003300: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-00003310: 2020 2020 2020 2020 6572 6173 655f 6267          erase_bg
-00003320: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00003330: 2020 2020 2020 7a5f 696e 6465 782c 0a20        z_index,. 
-00003340: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00003350: 0a0a 2020 2020 6465 6620 5f64 6976 6964  ..    def _divid
-00003360: 655f 6865 6967 6874 7328 7365 6c66 2c20  e_heights(self, 
-00003370: 7772 6974 655f 706f 7369 7469 6f6e 3a20  write_position: 
-00003380: 5772 6974 6550 6f73 6974 696f 6e29 202d  WritePosition) -
-00003390: 3e20 4f70 7469 6f6e 616c 5b4c 6973 745b  > Optional[List[
-000033a0: 696e 745d 5d3a 0a20 2020 2020 2020 2022  int]]:.        "
-000033b0: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
-000033c0: 6e20 7468 6520 6865 6967 6874 7320 666f  n the heights fo
-000033d0: 7220 616c 6c20 726f 7773 2e0a 2020 2020  r all rows..    
-000033e0: 2020 2020 4f72 204e 6f6e 6520 7768 656e      Or None when
-000033f0: 2074 6865 7265 2069 7320 6e6f 7420 656e   there is not en
-00003400: 6f75 6768 2073 7061 6365 2e0a 2020 2020  ough space..    
-00003410: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00003420: 6966 206e 6f74 2073 656c 662e 7375 6273  if not self.subs
-00003430: 6574 3a0a 2020 2020 2020 2020 2020 2020  et:.            
-00003440: 7265 7475 726e 205b 5d0a 0a20 2020 2020  return []..     
-00003450: 2020 2077 6964 7468 203d 2077 7269 7465     width = write
-00003460: 5f70 6f73 6974 696f 6e2e 7769 6474 680a  _position.width.
-00003470: 2020 2020 2020 2020 6865 6967 6874 203d          height =
-00003480: 2077 7269 7465 5f70 6f73 6974 696f 6e2e   write_position.
-00003490: 6865 6967 6874 0a0a 2020 2020 2020 2020  height..        
-000034a0: 2320 4361 6c63 756c 6174 6520 6865 6967  # Calculate heig
-000034b0: 6874 732e 0a20 2020 2020 2020 2064 696d  hts..        dim
-000034c0: 656e 7369 6f6e 7320 3d20 5b63 2e70 7265  ensions = [c.pre
-000034d0: 6665 7272 6564 5f68 6569 6768 7428 7769  ferred_height(wi
-000034e0: 6474 682c 2068 6569 6768 7429 2066 6f72  dth, height) for
-000034f0: 2063 2069 6e20 7365 6c66 2e5f 616c 6c5f   c in self._all_
-00003500: 6368 696c 6472 656e 5d0a 0a20 2020 2020  children]..     
-00003510: 2020 2023 2053 756d 2064 696d 656e 7369     # Sum dimensi
-00003520: 6f6e 730a 2020 2020 2020 2020 7375 6d5f  ons.        sum_
-00003530: 6469 6d65 6e73 696f 6e73 203d 2073 756d  dimensions = sum
-00003540: 5f6c 6179 6f75 745f 6469 6d65 6e73 696f  _layout_dimensio
-00003550: 6e73 2864 696d 656e 7369 6f6e 7329 0a0a  ns(dimensions)..
-00003560: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
-00003570: 7265 2069 7320 6e6f 7420 656e 6f75 6768  re is not enough
-00003580: 2073 7061 6365 2066 6f72 2062 6f74 682e   space for both.
-00003590: 0a20 2020 2020 2020 2023 2044 6f6e 2774  .        # Don't
-000035a0: 2064 6f20 616e 7974 6869 6e67 2e0a 2020   do anything..  
-000035b0: 2020 2020 2020 6966 2073 756d 5f64 696d        if sum_dim
-000035c0: 656e 7369 6f6e 732e 6d69 6e20 3e20 6865  ensions.min > he
-000035d0: 6967 6874 3a0a 2020 2020 2020 2020 2020  ight:.          
-000035e0: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
-000035f0: 2020 2020 2020 2023 2046 696e 6420 6f70         # Find op
-00003600: 7469 6d61 6c20 7369 7a65 732e 2028 5374  timal sizes. (St
-00003610: 6172 7420 7769 7468 206d 696e 696d 616c  art with minimal
-00003620: 2073 697a 652c 2069 6e63 7265 6173 6520   size, increase 
-00003630: 756e 7469 6c20 7765 2063 6f76 6572 0a20  until we cover. 
-00003640: 2020 2020 2020 2023 2074 6865 2077 686f         # the who
-00003650: 6c65 2068 6569 6768 742e 290a 2020 2020  le height.).    
-00003660: 2020 2020 7369 7a65 7320 3d20 5b64 2e6d      sizes = [d.m
-00003670: 696e 2066 6f72 2064 2069 6e20 6469 6d65  in for d in dime
-00003680: 6e73 696f 6e73 5d0a 0a20 2020 2020 2020  nsions]..       
-00003690: 2063 6869 6c64 5f67 656e 6572 6174 6f72   child_generator
-000036a0: 203d 2074 616b 655f 7573 696e 675f 7765   = take_using_we
-000036b0: 6967 6874 7328 0a20 2020 2020 2020 2020  ights(.         
-000036c0: 2020 2069 7465 6d73 3d6c 6973 7428 7261     items=list(ra
-000036d0: 6e67 6528 6c65 6e28 6469 6d65 6e73 696f  nge(len(dimensio
-000036e0: 6e73 2929 292c 2077 6569 6768 7473 3d5b  ns))), weights=[
-000036f0: 642e 7765 6967 6874 2066 6f72 2064 2069  d.weight for d i
-00003700: 6e20 6469 6d65 6e73 696f 6e73 5d0a 2020  n dimensions].  
-00003710: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00003720: 2069 203d 206e 6578 7428 6368 696c 645f   i = next(child_
-00003730: 6765 6e65 7261 746f 7229 0a0a 2020 2020  generator)..    
-00003740: 2020 2020 2320 496e 6372 6561 7365 2075      # Increase u
-00003750: 6e74 696c 2077 6520 6d65 6574 2061 7420  ntil we meet at 
-00003760: 6c65 6173 7420 7468 6520 2770 7265 6665  least the 'prefe
-00003770: 7272 6564 2720 7369 7a65 2e0a 2020 2020  rred' size..    
-00003780: 2020 2020 7072 6566 6572 7265 645f 7374      preferred_st
-00003790: 6f70 203d 206d 696e 2868 6569 6768 742c  op = min(height,
-000037a0: 2073 756d 5f64 696d 656e 7369 6f6e 732e   sum_dimensions.
-000037b0: 7072 6566 6572 7265 6429 0a20 2020 2020  preferred).     
-000037c0: 2020 2070 7265 6665 7272 6564 5f64 696d     preferred_dim
-000037d0: 656e 7369 6f6e 7320 3d20 5b64 2e70 7265  ensions = [d.pre
-000037e0: 6665 7272 6564 2066 6f72 2064 2069 6e20  ferred for d in 
-000037f0: 6469 6d65 6e73 696f 6e73 5d0a 0a20 2020  dimensions]..   
-00003800: 2020 2020 2077 6869 6c65 2073 756d 2873       while sum(s
-00003810: 697a 6573 2920 3c20 7072 6566 6572 7265  izes) < preferre
-00003820: 645f 7374 6f70 3a0a 2020 2020 2020 2020  d_stop:.        
-00003830: 2020 2020 6966 2073 697a 6573 5b69 5d20      if sizes[i] 
-00003840: 3c20 7072 6566 6572 7265 645f 6469 6d65  < preferred_dime
-00003850: 6e73 696f 6e73 5b69 5d3a 0a20 2020 2020  nsions[i]:.     
-00003860: 2020 2020 2020 2020 2020 2073 697a 6573             sizes
-00003870: 5b69 5d20 2b3d 2031 0a20 2020 2020 2020  [i] += 1.       
-00003880: 2020 2020 2069 203d 206e 6578 7428 6368       i = next(ch
-00003890: 696c 645f 6765 6e65 7261 746f 7229 0a0a  ild_generator)..
-000038a0: 2020 2020 2020 2020 2320 496e 6372 6561          # Increa
-000038b0: 7365 2075 6e74 696c 2077 6520 7573 6520  se until we use 
-000038c0: 616c 6c20 7468 6520 6176 6169 6c61 626c  all the availabl
-000038d0: 6520 7370 6163 652e 2028 6f72 2075 6e74  e space. (or unt
-000038e0: 696c 2022 6d61 7822 290a 2020 2020 2020  il "max").      
-000038f0: 2020 6966 206e 6f74 2067 6574 5f61 7070    if not get_app
-00003900: 2829 2e69 735f 646f 6e65 3a0a 2020 2020  ().is_done:.    
-00003910: 2020 2020 2020 2020 6d61 785f 7374 6f70          max_stop
-00003920: 203d 206d 696e 2868 6569 6768 742c 2073   = min(height, s
-00003930: 756d 5f64 696d 656e 7369 6f6e 732e 6d61  um_dimensions.ma
-00003940: 7829 0a20 2020 2020 2020 2020 2020 206d  x).            m
-00003950: 6178 5f64 696d 656e 7369 6f6e 7320 3d20  ax_dimensions = 
-00003960: 5b64 2e6d 6178 2066 6f72 2064 2069 6e20  [d.max for d in 
-00003970: 6469 6d65 6e73 696f 6e73 5d0a 0a20 2020  dimensions]..   
-00003980: 2020 2020 2020 2020 2077 6869 6c65 2073           while s
-00003990: 756d 2873 697a 6573 2920 3c20 6d61 785f  um(sizes) < max_
-000039a0: 7374 6f70 3a0a 2020 2020 2020 2020 2020  stop:.          
-000039b0: 2020 2020 2020 6966 2073 697a 6573 5b69        if sizes[i
-000039c0: 5d20 3c20 6d61 785f 6469 6d65 6e73 696f  ] < max_dimensio
-000039d0: 6e73 5b69 5d3a 0a20 2020 2020 2020 2020  ns[i]:.         
-000039e0: 2020 2020 2020 2020 2020 2073 697a 6573             sizes
-000039f0: 5b69 5d20 2b3d 2031 0a20 2020 2020 2020  [i] += 1.       
-00003a00: 2020 2020 2020 2020 2069 203d 206e 6578           i = nex
-00003a10: 7428 6368 696c 645f 6765 6e65 7261 746f  t(child_generato
-00003a20: 7229 0a0a 2020 2020 2020 2020 7265 7475  r)..        retu
-00003a30: 726e 2073 697a 6573 0a0a 0a63 6c61 7373  rn sizes...class
-00003a40: 2056 5370 6c69 7428 5f53 706c 6974 293a   VSplit(_Split):
-00003a50: 0a20 2020 2022 2222 0a20 2020 2053 6576  .    """.    Sev
-00003a60: 6572 616c 206c 6179 6f75 7473 2c20 6f6e  eral layouts, on
-00003a70: 6520 7374 6163 6b65 6420 6c65 6674 2f72  e stacked left/r
-00003a80: 6967 6874 206f 6620 7468 6520 6f74 6865  ight of the othe
-00003a90: 722e 203a 3a0a 0a20 2020 2020 2020 202b  r. ::..        +
-00003aa0: 2d2d 2d2d 2d2d 2d2d 2d2b 2d2d 2d2d 2d2d  ---------+------
-00003ab0: 2d2d 2d2d 2b0a 2020 2020 2020 2020 7c20  ----+.        | 
-00003ac0: 2020 2020 2020 2020 7c20 2020 2020 2020          |       
-00003ad0: 2020 207c 0a20 2020 2020 2020 207c 2020     |.        |  
-00003ae0: 2020 2020 2020 207c 2020 2020 2020 2020         |        
-00003af0: 2020 7c0a 2020 2020 2020 2020 2b2d 2d2d    |.        +---
-00003b00: 2d2d 2d2d 2d2d 2b2d 2d2d 2d2d 2d2d 2d2d  ------+---------
-00003b10: 2d2b 0a0a 2020 2020 4279 2064 6566 6175  -+..    By defau
-00003b20: 6c74 2c20 7468 6973 2064 6f65 736e 2774  lt, this doesn't
-00003b30: 2064 6973 706c 6179 2061 2076 6572 7469   display a verti
-00003b40: 6361 6c20 6c69 6e65 2062 6574 7765 656e  cal line between
-00003b50: 2074 6865 2063 6869 6c64 7265 6e2c 2062   the children, b
-00003b60: 7574 0a20 2020 2069 6620 7468 6973 2069  ut.    if this i
-00003b70: 7320 736f 6d65 7468 696e 6720 796f 7520  s something you 
-00003b80: 6e65 6564 2c20 7468 656e 2063 7265 6174  need, then creat
-00003b90: 6520 6120 4853 706c 6974 2061 7320 666f  e a HSplit as fo
-00003ba0: 6c6c 6f77 733a 3a0a 0a20 2020 2020 2020  llows::..       
-00003bb0: 2056 5370 6c69 7428 6368 696c 6472 656e   VSplit(children
-00003bc0: 3d5b 202e 2e2e 205d 2c20 7061 6464 696e  =[ ... ], paddin
-00003bd0: 675f 6368 6172 3d27 7c27 2c0a 2020 2020  g_char='|',.    
-00003be0: 2020 2020 2020 2020 2020 2070 6164 6469             paddi
-00003bf0: 6e67 3d31 2c20 7061 6464 696e 675f 7374  ng=1, padding_st
-00003c00: 796c 653d 2723 6666 6666 3030 2729 0a0a  yle='#ffff00')..
-00003c10: 2020 2020 3a70 6172 616d 2063 6869 6c64      :param child
-00003c20: 7265 6e3a 204c 6973 7420 6f66 2063 6869  ren: List of chi
-00003c30: 6c64 203a 636c 6173 733a 602e 436f 6e74  ld :class:`.Cont
-00003c40: 6169 6e65 7260 206f 626a 6563 7473 2e0a  ainer` objects..
-00003c50: 2020 2020 3a70 6172 616d 2077 696e 646f      :param windo
-00003c60: 775f 746f 6f5f 736d 616c 6c3a 2041 203a  w_too_small: A :
-00003c70: 636c 6173 733a 602e 436f 6e74 6169 6e65  class:`.Containe
-00003c80: 7260 206f 626a 6563 7420 7468 6174 2069  r` object that i
-00003c90: 7320 6469 7370 6c61 7965 6420 6966 0a20  s displayed if. 
-00003ca0: 2020 2020 2020 2074 6865 7265 2069 7320         there is 
-00003cb0: 6e6f 7420 656e 6f75 6768 2073 7061 6365  not enough space
-00003cc0: 2066 6f72 2061 6c6c 2074 6865 2063 6869   for all the chi
-00003cd0: 6c64 7265 6e2e 2042 7920 6465 6661 756c  ldren. By defaul
-00003ce0: 742c 2074 6869 7320 6973 2061 0a20 2020  t, this is a.   
-00003cf0: 2020 2020 2022 5769 6e64 6f77 2074 6f6f       "Window too
-00003d00: 2073 6d61 6c6c 2220 6d65 7373 6167 652e   small" message.
-00003d10: 0a20 2020 203a 7061 7261 6d20 616c 6967  .    :param alig
-00003d20: 6e3a 2060 486f 7269 7a6f 6e74 616c 416c  n: `HorizontalAl
-00003d30: 6967 6e60 2076 616c 7565 2e0a 2020 2020  ign` value..    
-00003d40: 3a70 6172 616d 2077 6964 7468 3a20 5768  :param width: Wh
-00003d50: 656e 2067 6976 656e 2c20 7573 6520 7468  en given, use th
-00003d60: 6973 2077 6964 7468 2069 6e73 7465 6164  is width instead
-00003d70: 206f 6620 6c6f 6f6b 696e 6720 6174 2074   of looking at t
-00003d80: 6865 2063 6869 6c64 7265 6e2e 0a20 2020  he children..   
-00003d90: 203a 7061 7261 6d20 6865 6967 6874 3a20   :param height: 
-00003da0: 5768 656e 2067 6976 656e 2c20 7573 6520  When given, use 
-00003db0: 7468 6973 2068 6569 6768 7420 696e 7374  this height inst
-00003dc0: 6561 6420 6f66 206c 6f6f 6b69 6e67 2061  ead of looking a
-00003dd0: 7420 7468 6520 6368 696c 6472 656e 2e0a  t the children..
-00003de0: 2020 2020 3a70 6172 616d 207a 5f69 6e64      :param z_ind
-00003df0: 6578 3a20 2869 6e74 206f 7220 4e6f 6e65  ex: (int or None
-00003e00: 2920 5768 656e 2073 7065 6369 6669 6564  ) When specified
-00003e10: 2c20 7468 6973 2063 616e 2062 6520 7573  , this can be us
-00003e20: 6564 2074 6f20 6272 696e 670a 2020 2020  ed to bring.    
-00003e30: 2020 2020 656c 656d 656e 7420 696e 2066      element in f
-00003e40: 726f 6e74 206f 6620 666c 6f61 7469 6e67  ront of floating
-00003e50: 2065 6c65 6d65 6e74 732e 2020 604e 6f6e   elements.  `Non
-00003e60: 6560 206d 6561 6e73 3a20 696e 6865 7269  e` means: inheri
-00003e70: 7420 6672 6f6d 2070 6172 656e 742e 0a20  t from parent.. 
-00003e80: 2020 203a 7061 7261 6d20 7374 796c 653a     :param style:
-00003e90: 2041 2073 7479 6c65 2073 7472 696e 672e   A style string.
-00003ea0: 0a20 2020 203a 7061 7261 6d20 6d6f 6461  .    :param moda
-00003eb0: 6c3a 2060 6054 7275 6560 6020 6f72 2060  l: ``True`` or `
-00003ec0: 6046 616c 7365 6060 2e0a 2020 2020 3a70  `False``..    :p
-00003ed0: 6172 616d 206b 6579 5f62 696e 6469 6e67  aram key_binding
-00003ee0: 733a 2060 604e 6f6e 6560 6020 6f72 2061  s: ``None`` or a
-00003ef0: 203a 636c 6173 733a 602e 4b65 7942 696e   :class:`.KeyBin
-00003f00: 6469 6e67 7360 206f 626a 6563 742e 0a0a  dings` object...
-00003f10: 2020 2020 3a70 6172 616d 2070 6164 6469      :param paddi
-00003f20: 6e67 3a20 2860 4469 6d65 6e73 696f 6e60  ng: (`Dimension`
-00003f30: 206f 7220 696e 7429 2c20 7369 7a65 2074   or int), size t
-00003f40: 6f20 6265 2075 7365 6420 666f 7220 7468  o be used for th
-00003f50: 6520 7061 6464 696e 672e 0a20 2020 203a  e padding..    :
-00003f60: 7061 7261 6d20 7061 6464 696e 675f 6368  param padding_ch
-00003f70: 6172 3a20 4368 6172 6163 7465 7220 746f  ar: Character to
-00003f80: 2062 6520 7573 6564 2066 6f72 2066 696c   be used for fil
-00003f90: 6c69 6e67 2069 6e20 7468 6520 7061 6464  ling in the padd
-00003fa0: 696e 672e 0a20 2020 203a 7061 7261 6d20  ing..    :param 
-00003fb0: 7061 6464 696e 675f 7374 796c 653a 2053  padding_style: S
-00003fc0: 7479 6c65 2074 6f20 6170 706c 6965 6420  tyle to applied 
-00003fd0: 746f 2074 6865 2070 6164 6469 6e67 2e0a  to the padding..
-00003fe0: 2020 2020 2222 220a 2020 2020 6c65 6674      """.    left
-00003ff0: 203d 2048 6f72 697a 6f6e 7461 6c41 6c69   = HorizontalAli
-00004000: 676e 2e4c 4546 540a 2020 2020 6365 6e74  gn.LEFT.    cent
-00004010: 6572 203d 2048 6f72 697a 6f6e 7461 6c41  er = HorizontalA
-00004020: 6c69 676e 2e43 454e 5445 520a 2020 2020  lign.CENTER.    
-00004030: 7269 6768 7420 3d20 486f 7269 7a6f 6e74  right = Horizont
-00004040: 616c 416c 6967 6e2e 5249 4748 540a 2020  alAlign.RIGHT.  
-00004050: 2020 6a75 7374 6966 7920 3d20 486f 7269    justify = Hori
-00004060: 7a6f 6e74 616c 416c 6967 6e2e 4a55 5354  zontalAlign.JUST
-00004070: 4946 590a 0a20 2020 2064 6566 205f 5f69  IFY..    def __i
-00004080: 6e69 745f 5f28 0a20 2020 2020 2020 2073  nit__(.        s
-00004090: 656c 662c 0a20 2020 2020 2020 2073 7562  elf,.        sub
-000040a0: 7365 743a 2053 6571 7565 6e63 655b 416e  set: Sequence[An
-000040b0: 7943 6f6e 7461 696e 6572 5d2c 0a20 2020  yContainer],.   
-000040c0: 2020 2020 2077 696e 646f 775f 746f 6f5f       window_too_
-000040d0: 736d 616c 6c3a 204f 7074 696f 6e61 6c5b  small: Optional[
-000040e0: 436f 6e74 6169 6e65 725d 203d 204e 6f6e  Container] = Non
-000040f0: 652c 0a20 2020 2020 2020 2061 6c69 676e  e,.        align
-00004100: 3a20 486f 7269 7a6f 6e74 616c 416c 6967  : HorizontalAlig
-00004110: 6e20 3d20 226a 7573 7469 6679 222c 0a20  n = "justify",. 
-00004120: 2020 2020 2020 2070 6164 6469 6e67 3a20         padding: 
-00004130: 416e 7944 696d 656e 7369 6f6e 203d 2030  AnyDimension = 0
-00004140: 2c0a 2020 2020 2020 2020 7061 6464 696e  ,.        paddin
-00004150: 675f 6368 6172 3a20 4f70 7469 6f6e 616c  g_char: Optional
-00004160: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
-00004170: 2020 2020 2020 7061 6464 696e 675f 7374        padding_st
-00004180: 796c 653a 2073 7472 203d 2022 222c 0a20  yle: str = "",. 
-00004190: 2020 2020 2020 2077 6964 7468 3a20 416e         width: An
-000041a0: 7944 696d 656e 7369 6f6e 203d 204e 6f6e  yDimension = Non
-000041b0: 652c 0a20 2020 2020 2020 2068 6569 6768  e,.        heigh
-000041c0: 743a 2041 6e79 4469 6d65 6e73 696f 6e20  t: AnyDimension 
-000041d0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-000041e0: 7a5f 696e 6465 783a 204f 7074 696f 6e61  z_index: Optiona
-000041f0: 6c5b 696e 745d 203d 204e 6f6e 652c 0a20  l[int] = None,. 
-00004200: 2020 2020 2020 206d 6f64 616c 3a20 626f         modal: bo
-00004210: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-00004220: 2020 2020 6269 6e64 3a20 4f70 7469 6f6e      bind: Option
-00004230: 616c 5b4b 6579 4269 6e64 696e 6773 4261  al[KeyBindingsBa
-00004240: 7365 5d20 3d20 4e6f 6e65 2c0a 2020 2020  se] = None,.    
-00004250: 2020 2020 7374 796c 653a 2055 6e69 6f6e      style: Union
-00004260: 5b73 7472 2c20 4361 6c6c 6162 6c65 5b5b  [str, Callable[[
-00004270: 5d2c 2073 7472 5d5d 203d 2022 222c 0a20  ], str]] = "",. 
-00004280: 2020 2029 202d 3e20 4e6f 6e65 3a0a 0a20     ) -> None:.. 
-00004290: 2020 2020 2020 2073 7570 6572 2829 2e5f         super()._
-000042a0: 5f69 6e69 745f 5f28 0a20 2020 2020 2020  _init__(.       
-000042b0: 2020 2020 2073 7562 7365 743d 7375 6273       subset=subs
-000042c0: 6574 2c0a 2020 2020 2020 2020 2020 2020  et,.            
-000042d0: 7769 6e64 6f77 5f74 6f6f 5f73 6d61 6c6c  window_too_small
-000042e0: 3d77 696e 646f 775f 746f 6f5f 736d 616c  =window_too_smal
-000042f0: 6c2c 0a20 2020 2020 2020 2020 2020 2070  l,.            p
-00004300: 6164 6469 6e67 3d70 6164 6469 6e67 2c0a  adding=padding,.
-00004310: 2020 2020 2020 2020 2020 2020 7061 6464              padd
-00004320: 696e 675f 6368 6172 3d70 6164 6469 6e67  ing_char=padding
-00004330: 5f63 6861 722c 0a20 2020 2020 2020 2020  _char,.         
-00004340: 2020 2070 6164 6469 6e67 5f73 7479 6c65     padding_style
-00004350: 3d70 6164 6469 6e67 5f73 7479 6c65 2c0a  =padding_style,.
-00004360: 2020 2020 2020 2020 2020 2020 7769 6474              widt
-00004370: 683d 7769 6474 682c 0a20 2020 2020 2020  h=width,.       
-00004380: 2020 2020 2068 6569 6768 743d 6865 6967       height=heig
-00004390: 6874 2c0a 2020 2020 2020 2020 2020 2020  ht,.            
-000043a0: 7a5f 696e 6465 783d 7a5f 696e 6465 782c  z_index=z_index,
-000043b0: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
-000043c0: 616c 3d6d 6f64 616c 2c0a 2020 2020 2020  al=modal,.      
-000043d0: 2020 2020 2020 6269 6e64 3d62 696e 642c        bind=bind,
-000043e0: 0a20 2020 2020 2020 2020 2020 2073 7479  .            sty
-000043f0: 6c65 3d73 7479 6c65 2c0a 2020 2020 2020  le=style,.      
-00004400: 2020 290a 0a20 2020 2020 2020 2073 656c    )..        sel
-00004410: 662e 616c 6967 6e20 3d20 616c 6967 6e0a  f.align = align.
-00004420: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
-00004430: 6869 6c64 7265 6e5f 6361 6368 653a 2053  hildren_cache: S
-00004440: 696d 706c 6543 6163 6865 5b0a 2020 2020  impleCache[.    
-00004450: 2020 2020 2020 2020 5475 706c 655b 436f          Tuple[Co
-00004460: 6e74 6169 6e65 722c 202e 2e2e 5d2c 204c  ntainer, ...], L
-00004470: 6973 745b 436f 6e74 6169 6e65 725d 0a20  ist[Container]. 
-00004480: 2020 2020 2020 205d 203d 2053 696d 706c         ] = Simpl
-00004490: 6543 6163 6865 286d 6178 7369 7a65 3d31  eCache(maxsize=1
-000044a0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
-000044b0: 7265 6d61 696e 696e 675f 7370 6163 655f  remaining_space_
-000044c0: 7769 6e64 6f77 203d 2057 696e 646f 7728  window = Window(
-000044d0: 2920 2023 2044 756d 6d79 2077 696e 646f  )  # Dummy windo
-000044e0: 772e 0a0a 2020 2020 6465 6620 7072 6566  w...    def pref
-000044f0: 6572 7265 645f 7769 6474 6828 7365 6c66  erred_width(self
-00004500: 2c20 6d61 785f 6176 6169 6c61 626c 655f  , max_available_
-00004510: 7769 6474 683a 2069 6e74 2920 2d3e 2044  width: int) -> D
-00004520: 696d 656e 7369 6f6e 3a0a 2020 2020 2020  imension:.      
-00004530: 2020 6966 2073 656c 662e 7769 6474 6820    if self.width 
-00004540: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00004550: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00004560: 746f 5f64 696d 656e 7369 6f6e 2873 656c  to_dimension(sel
-00004570: 662e 7769 6474 6829 0a0a 2020 2020 2020  f.width)..      
-00004580: 2020 6469 6d65 6e73 696f 6e73 203d 205b    dimensions = [
-00004590: 0a20 2020 2020 2020 2020 2020 2063 2e70  .            c.p
-000045a0: 7265 6665 7272 6564 5f77 6964 7468 286d  referred_width(m
-000045b0: 6178 5f61 7661 696c 6162 6c65 5f77 6964  ax_available_wid
-000045c0: 7468 2920 666f 7220 6320 696e 2073 656c  th) for c in sel
-000045d0: 662e 5f61 6c6c 5f63 6869 6c64 7265 6e0a  f._all_children.
-000045e0: 2020 2020 2020 2020 5d0a 0a20 2020 2020          ]..     
-000045f0: 2020 2072 6574 7572 6e20 7375 6d5f 6c61     return sum_la
-00004600: 796f 7574 5f64 696d 656e 7369 6f6e 7328  yout_dimensions(
-00004610: 6469 6d65 6e73 696f 6e73 290a 0a20 2020  dimensions)..   
-00004620: 2064 6566 2070 7265 6665 7272 6564 5f68   def preferred_h
-00004630: 6569 6768 7428 7365 6c66 2c20 7769 6474  eight(self, widt
-00004640: 683a 2069 6e74 2c20 6d61 785f 6176 6169  h: int, max_avai
-00004650: 6c61 626c 655f 6865 6967 6874 3a20 696e  lable_height: in
-00004660: 7429 202d 3e20 4469 6d65 6e73 696f 6e3a  t) -> Dimension:
-00004670: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00004680: 2e68 6569 6768 7420 6973 206e 6f74 204e  .height is not N
-00004690: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000046a0: 2072 6574 7572 6e20 746f 5f64 696d 656e   return to_dimen
-000046b0: 7369 6f6e 2873 656c 662e 6865 6967 6874  sion(self.height
-000046c0: 290a 0a20 2020 2020 2020 2023 2041 7420  )..        # At 
-000046d0: 7468 6520 706f 696e 7420 7768 6572 6520  the point where 
-000046e0: 7765 2077 616e 7420 746f 2063 616c 6375  we want to calcu
-000046f0: 6c61 7465 2074 6865 2068 6569 6768 7473  late the heights
-00004700: 2c20 7468 6520 7769 6474 6873 2068 6176  , the widths hav
-00004710: 650a 2020 2020 2020 2020 2320 616c 7265  e.        # alre
-00004720: 6164 7920 6265 656e 2064 6563 6964 6564  ady been decided
-00004730: 2e20 536f 2077 6520 6361 6e20 7472 7573  . So we can trus
-00004740: 7420 6077 6964 7468 6020 746f 2062 6520  t `width` to be 
-00004750: 7468 6520 6163 7475 616c 0a20 2020 2020  the actual.     
-00004760: 2020 2023 2060 7769 6474 6860 2074 6861     # `width` tha
-00004770: 7427 7320 676f 696e 6720 746f 2062 6520  t's going to be 
-00004780: 7573 6564 2066 6f72 2074 6865 2072 656e  used for the ren
-00004790: 6465 7269 6e67 2e20 536f 2c0a 2020 2020  dering. So,.    
-000047a0: 2020 2020 2320 6064 6976 6964 655f 7769      # `divide_wi
-000047b0: 6474 6873 6020 6973 2073 7570 706f 7365  dths` is suppose
-000047c0: 6420 746f 2075 7365 2061 6c6c 206f 6620  d to use all of 
-000047d0: 7468 6520 6176 6169 6c61 626c 6520 7769  the available wi
-000047e0: 6474 682e 0a20 2020 2020 2020 2023 2055  dth..        # U
-000047f0: 7369 6e67 206f 6e6c 7920 7468 6520 6070  sing only the `p
-00004800: 7265 6665 7272 6564 6020 7769 6474 6820  referred` width 
-00004810: 6361 7573 6564 2061 2062 7567 2077 6865  caused a bug whe
-00004820: 7265 2074 6865 2072 6570 6f72 7465 640a  re the reported.
-00004830: 2020 2020 2020 2020 2320 6865 6967 6874          # height
-00004840: 2077 6173 206d 6f72 6520 7468 616e 2072   was more than r
-00004850: 6571 7569 7265 642e 2028 7765 2068 6164  equired. (we had
-00004860: 2061 2060 4275 6666 6572 436f 6e74 726f   a `BufferContro
-00004870: 6c60 2077 6869 6368 2064 6964 0a20 2020  l` which did.   
-00004880: 2020 2020 2023 2077 7261 7020 6c69 6e65       # wrap line
-00004890: 7320 6265 6361 7573 6520 6f66 2074 6865  s because of the
-000048a0: 2073 6d61 6c6c 6572 2077 6964 7468 2072   smaller width r
-000048b0: 6574 7572 6e65 6420 6279 2060 5f64 6976  eturned by `_div
-000048c0: 6964 655f 7769 6474 6873 602e 0a0a 2020  ide_widths`...  
-000048d0: 2020 2020 2020 7369 7a65 7320 3d20 7365        sizes = se
-000048e0: 6c66 2e5f 6469 7669 6465 5f77 6964 7468  lf._divide_width
-000048f0: 7328 7769 6474 6829 0a20 2020 2020 2020  s(width).       
-00004900: 2073 7562 7365 7420 3d20 7365 6c66 2e5f   subset = self._
-00004910: 616c 6c5f 6368 696c 6472 656e 0a0a 2020  all_children..  
-00004920: 2020 2020 2020 6966 2073 697a 6573 2069        if sizes i
-00004930: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00004940: 2020 2020 7265 7475 726e 2044 696d 656e      return Dimen
-00004950: 7369 6f6e 2829 0a20 2020 2020 2020 2065  sion().        e
-00004960: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00004970: 2064 696d 656e 7369 6f6e 7320 3d20 5b0a   dimensions = [.
-00004980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004990: 632e 7072 6566 6572 7265 645f 6865 6967  c.preferred_heig
-000049a0: 6874 2873 2c20 6d61 785f 6176 6169 6c61  ht(s, max_availa
-000049b0: 626c 655f 6865 6967 6874 290a 2020 2020  ble_height).    
-000049c0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000049d0: 732c 2063 2069 6e20 7a69 7028 7369 7a65  s, c in zip(size
-000049e0: 732c 2073 7562 7365 7429 0a20 2020 2020  s, subset).     
-000049f0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
-00004a00: 2020 2020 2072 6574 7572 6e20 6d61 785f       return max_
-00004a10: 6c61 796f 7574 5f64 696d 656e 7369 6f6e  layout_dimension
-00004a20: 7328 6469 6d65 6e73 696f 6e73 290a 0a20  s(dimensions).. 
-00004a30: 2020 2064 6566 2072 6573 6574 2873 656c     def reset(sel
-00004a40: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00004a50: 2020 2020 666f 7220 6320 696e 2073 656c      for c in sel
-00004a60: 662e 7375 6273 6574 3a0a 2020 2020 2020  f.subset:.      
-00004a70: 2020 2020 2020 632e 7265 7365 7428 290a        c.reset().
-00004a80: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-00004a90: 2020 2064 6566 205f 616c 6c5f 6368 696c     def _all_chil
-00004aa0: 6472 656e 2873 656c 6629 202d 3e20 4c69  dren(self) -> Li
-00004ab0: 7374 5b43 6f6e 7461 696e 6572 5d3a 0a20  st[Container]:. 
-00004ac0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00004ad0: 2020 204c 6973 7420 6f66 2063 6869 6c64     List of child
-00004ae0: 206f 626a 6563 7473 2c20 696e 636c 7564   objects, includ
-00004af0: 696e 6720 7061 6464 696e 672e 0a20 2020  ing padding..   
-00004b00: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00004b10: 2020 6465 6620 6765 7428 2920 2d3e 204c    def get() -> L
-00004b20: 6973 745b 436f 6e74 6169 6e65 725d 3a0a  ist[Container]:.
-00004b30: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00004b40: 6c74 3a20 4c69 7374 5b43 6f6e 7461 696e  lt: List[Contain
-00004b50: 6572 5d20 3d20 5b5d 0a0a 2020 2020 2020  er] = []..      
-00004b60: 2020 2020 2020 2320 5061 6464 696e 6720        # Padding 
-00004b70: 6c65 6674 2e0a 2020 2020 2020 2020 2020  left..          
-00004b80: 2020 6365 6e74 6572 203d 2048 6f72 697a    center = Horiz
-00004b90: 6f6e 7461 6c41 6c69 676e 2e43 454e 5445  ontalAlign.CENTE
-00004ba0: 520a 2020 2020 2020 2020 2020 2020 7269  R.            ri
-00004bb0: 6768 7420 3d48 6f72 697a 6f6e 7461 6c41  ght =HorizontalA
-00004bc0: 6c69 676e 2e52 4947 4854 0a20 2020 2020  lign.RIGHT.     
-00004bd0: 2020 2020 2020 2069 6620 7365 6c66 2e61         if self.a
-00004be0: 6c69 676e 2069 6e20 2863 656e 7465 722c  lign in (center,
-00004bf0: 2072 6967 6874 293a 0a20 2020 2020 2020   right):.       
-00004c00: 2020 2020 2020 2020 2072 6573 756c 742e           result.
-00004c10: 6170 7065 6e64 2857 696e 646f 7728 7769  append(Window(wi
-00004c20: 6474 683d 4469 6d65 6e73 696f 6e28 7072  dth=Dimension(pr
-00004c30: 6566 6572 7265 643d 3029 2929 0a0a 2020  eferred=0)))..  
-00004c40: 2020 2020 2020 2020 2020 2320 5468 6520            # The 
-00004c50: 7375 6273 6574 7320 7769 7468 2070 6164  subsets with pad
-00004c60: 6469 6e67 2e0a 2020 2020 2020 2020 2020  ding..          
-00004c70: 2020 666f 7220 6368 696c 6420 696e 2073    for child in s
-00004c80: 656c 662e 7375 6273 6574 3a0a 2020 2020  elf.subset:.    
-00004c90: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00004ca0: 6c74 2e61 7070 656e 6428 6368 696c 6429  lt.append(child)
-00004cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004cc0: 2072 6573 756c 742e 6170 7065 6e64 280a   result.append(.
-00004cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ce0: 2020 2020 5769 6e64 6f77 280a 2020 2020      Window(.    
-00004cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d00: 2020 2020 7769 6474 683d 7365 6c66 2e70      width=self.p
-00004d10: 6164 6469 6e67 2c0a 2020 2020 2020 2020  adding,.        
-00004d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d30: 6368 6172 3d73 656c 662e 7061 6464 696e  char=self.paddin
-00004d40: 675f 6368 6172 2c0a 2020 2020 2020 2020  g_char,.        
-00004d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d60: 7374 796c 653d 7365 6c66 2e70 6164 6469  style=self.paddi
-00004d70: 6e67 5f73 7479 6c65 2c0a 2020 2020 2020  ng_style,.      
-00004d80: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00004d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004da0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00004db0: 2072 6573 756c 743a 0a20 2020 2020 2020   result:.       
-00004dc0: 2020 2020 2020 2020 2072 6573 756c 742e           result.
-00004dd0: 706f 7028 290a 0a20 2020 2020 2020 2020  pop()..         
-00004de0: 2020 2023 2050 6164 6469 6e67 2072 6967     # Padding rig
-00004df0: 6874 2e0a 2020 2020 2020 2020 2020 2020  ht..            
-00004e00: 6365 6e74 6572 203d 2048 6f72 697a 6f6e  center = Horizon
-00004e10: 7461 6c41 6c69 676e 2e43 454e 5445 520a  talAlign.CENTER.
-00004e20: 2020 2020 2020 2020 2020 2020 6c65 6674              left
-00004e30: 203d 2048 6f72 697a 6f6e 7461 6c41 6c69   = HorizontalAli
-00004e40: 676e 2e4c 4546 540a 2020 2020 2020 2020  gn.LEFT.        
-00004e50: 2020 2020 6966 2073 656c 662e 616c 6967      if self.alig
-00004e60: 6e20 696e 2028 6365 6e74 6572 2c20 6c65  n in (center, le
-00004e70: 6674 293a 0a20 2020 2020 2020 2020 2020  ft):.           
-00004e80: 2020 2020 2072 6573 756c 742e 6170 7065       result.appe
-00004e90: 6e64 2857 696e 646f 7728 7769 6474 683d  nd(Window(width=
-00004ea0: 4469 6d65 6e73 696f 6e28 7072 6566 6572  Dimension(prefer
-00004eb0: 7265 643d 3029 2929 0a0a 2020 2020 2020  red=0)))..      
-00004ec0: 2020 2020 2020 7265 7475 726e 2072 6573        return res
-00004ed0: 756c 740a 0a20 2020 2020 2020 2072 6574  ult..        ret
-00004ee0: 7572 6e20 7365 6c66 2e5f 6368 696c 6472  urn self._childr
-00004ef0: 656e 5f63 6163 6865 2e67 6574 2874 7570  en_cache.get(tup
-00004f00: 6c65 2873 656c 662e 7375 6273 6574 292c  le(self.subset),
-00004f10: 2067 6574 290a 0a20 2020 2064 6566 205f   get)..    def _
-00004f20: 6469 7669 6465 5f77 6964 7468 7328 7365  divide_widths(se
-00004f30: 6c66 2c20 7769 6474 683a 2069 6e74 2920  lf, width: int) 
-00004f40: 2d3e 204f 7074 696f 6e61 6c5b 4c69 7374  -> Optional[List
-00004f50: 5b69 6e74 5d5d 3a0a 2020 2020 2020 2020  [int]]:.        
-00004f60: 2222 220a 2020 2020 2020 2020 5265 7475  """.        Retu
-00004f70: 726e 2074 6865 2077 6964 7468 7320 666f  rn the widths fo
-00004f80: 7220 616c 6c20 636f 6c75 6d6e 732e 0a20  r all columns.. 
-00004f90: 2020 2020 2020 204f 7220 4e6f 6e65 2077         Or None w
-00004fa0: 6865 6e20 7468 6572 6520 6973 206e 6f74  hen there is not
-00004fb0: 2065 6e6f 7567 6820 7370 6163 652e 0a20   enough space.. 
-00004fc0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00004fd0: 2020 2073 7562 7365 7420 3d20 7365 6c66     subset = self
-00004fe0: 2e5f 616c 6c5f 6368 696c 6472 656e 0a0a  ._all_children..
-00004ff0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00005000: 7562 7365 743a 0a20 2020 2020 2020 2020  ubset:.         
-00005010: 2020 2072 6574 7572 6e20 5b5d 0a0a 2020     return []..  
-00005020: 2020 2020 2020 2320 4361 6c63 756c 6174        # Calculat
-00005030: 6520 7769 6474 6873 2e0a 2020 2020 2020  e widths..      
-00005040: 2020 6469 6d65 6e73 696f 6e73 203d 205b    dimensions = [
-00005050: 632e 7072 6566 6572 7265 645f 7769 6474  c.preferred_widt
-00005060: 6828 7769 6474 6829 2066 6f72 2063 2069  h(width) for c i
-00005070: 6e20 7375 6273 6574 5d0a 2020 2020 2020  n subset].      
-00005080: 2020 7072 6566 6572 7265 645f 6469 6d65    preferred_dime
-00005090: 6e73 696f 6e73 203d 205b 642e 7072 6566  nsions = [d.pref
-000050a0: 6572 7265 6420 666f 7220 6420 696e 2064  erred for d in d
-000050b0: 696d 656e 7369 6f6e 735d 0a0a 2020 2020  imensions]..    
-000050c0: 2020 2020 2320 5375 6d20 6469 6d65 6e73      # Sum dimens
-000050d0: 696f 6e73 0a20 2020 2020 2020 2073 756d  ions.        sum
-000050e0: 5f64 696d 656e 7369 6f6e 7320 3d20 7375  _dimensions = su
-000050f0: 6d5f 6c61 796f 7574 5f64 696d 656e 7369  m_layout_dimensi
-00005100: 6f6e 7328 6469 6d65 6e73 696f 6e73 290a  ons(dimensions).
-00005110: 0a20 2020 2020 2020 2023 2049 6620 7468  .        # If th
-00005120: 6572 6520 6973 206e 6f74 2065 6e6f 7567  ere is not enoug
-00005130: 6820 7370 6163 6520 666f 7220 626f 7468  h space for both
-00005140: 2e0a 2020 2020 2020 2020 2320 446f 6e27  ..        # Don'
-00005150: 7420 646f 2061 6e79 7468 696e 672e 0a20  t do anything.. 
-00005160: 2020 2020 2020 2069 6620 7375 6d5f 6469         if sum_di
-00005170: 6d65 6e73 696f 6e73 2e6d 696e 203e 2077  mensions.min > w
-00005180: 6964 7468 3a0a 2020 2020 2020 2020 2020  idth:.          
-00005190: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
-000051a0: 2020 2020 2020 2023 2046 696e 6420 6f70         # Find op
-000051b0: 7469 6d61 6c20 7369 7a65 732e 2028 5374  timal sizes. (St
-000051c0: 6172 7420 7769 7468 206d 696e 696d 616c  art with minimal
-000051d0: 2073 697a 652c 2069 6e63 7265 6173 6520   size, increase 
-000051e0: 756e 7469 6c20 7765 2063 6f76 6572 0a20  until we cover. 
-000051f0: 2020 2020 2020 2023 2074 6865 2077 686f         # the who
-00005200: 6c65 2077 6964 7468 2e29 0a20 2020 2020  le width.).     
-00005210: 2020 2073 697a 6573 203d 205b 642e 6d69     sizes = [d.mi
-00005220: 6e20 666f 7220 6420 696e 2064 696d 656e  n for d in dimen
-00005230: 7369 6f6e 735d 0a0a 2020 2020 2020 2020  sions]..        
-00005240: 6368 696c 645f 6765 6e65 7261 746f 7220  child_generator 
-00005250: 3d20 7461 6b65 5f75 7369 6e67 5f77 6569  = take_using_wei
-00005260: 6768 7473 280a 2020 2020 2020 2020 2020  ghts(.          
-00005270: 2020 6974 656d 733d 6c69 7374 2872 616e    items=list(ran
-00005280: 6765 286c 656e 2864 696d 656e 7369 6f6e  ge(len(dimension
-00005290: 7329 2929 2c20 7765 6967 6874 733d 5b64  s))), weights=[d
-000052a0: 2e77 6569 6768 7420 666f 7220 6420 696e  .weight for d in
-000052b0: 2064 696d 656e 7369 6f6e 735d 0a20 2020   dimensions].   
-000052c0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-000052d0: 6920 3d20 6e65 7874 2863 6869 6c64 5f67  i = next(child_g
-000052e0: 656e 6572 6174 6f72 290a 0a20 2020 2020  enerator)..     
-000052f0: 2020 2023 2049 6e63 7265 6173 6520 756e     # Increase un
-00005300: 7469 6c20 7765 206d 6565 7420 6174 206c  til we meet at l
-00005310: 6561 7374 2074 6865 2027 7072 6566 6572  east the 'prefer
-00005320: 7265 6427 2073 697a 652e 0a20 2020 2020  red' size..     
-00005330: 2020 2070 7265 6665 7272 6564 5f73 746f     preferred_sto
-00005340: 7020 3d20 6d69 6e28 7769 6474 682c 2073  p = min(width, s
-00005350: 756d 5f64 696d 656e 7369 6f6e 732e 7072  um_dimensions.pr
-00005360: 6566 6572 7265 6429 0a0a 2020 2020 2020  eferred)..      
-00005370: 2020 7768 696c 6520 7375 6d28 7369 7a65    while sum(size
-00005380: 7329 203c 2070 7265 6665 7272 6564 5f73  s) < preferred_s
-00005390: 746f 703a 0a20 2020 2020 2020 2020 2020  top:.           
-000053a0: 2069 6620 7369 7a65 735b 695d 203c 2070   if sizes[i] < p
-000053b0: 7265 6665 7272 6564 5f64 696d 656e 7369  referred_dimensi
-000053c0: 6f6e 735b 695d 3a0a 2020 2020 2020 2020  ons[i]:.        
-000053d0: 2020 2020 2020 2020 7369 7a65 735b 695d          sizes[i]
-000053e0: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-000053f0: 2020 6920 3d20 6e65 7874 2863 6869 6c64    i = next(child
-00005400: 5f67 656e 6572 6174 6f72 290a 0a20 2020  _generator)..   
-00005410: 2020 2020 2023 2049 6e63 7265 6173 6520       # Increase 
-00005420: 756e 7469 6c20 7765 2075 7365 2061 6c6c  until we use all
-00005430: 2074 6865 2061 7661 696c 6162 6c65 2073   the available s
-00005440: 7061 6365 2e0a 2020 2020 2020 2020 6d61  pace..        ma
-00005450: 785f 6469 6d65 6e73 696f 6e73 203d 205b  x_dimensions = [
-00005460: 642e 6d61 7820 666f 7220 6420 696e 2064  d.max for d in d
-00005470: 696d 656e 7369 6f6e 735d 0a20 2020 2020  imensions].     
-00005480: 2020 206d 6178 5f73 746f 7020 3d20 6d69     max_stop = mi
-00005490: 6e28 7769 6474 682c 2073 756d 5f64 696d  n(width, sum_dim
-000054a0: 656e 7369 6f6e 732e 6d61 7829 0a0a 2020  ensions.max)..  
-000054b0: 2020 2020 2020 7768 696c 6520 7375 6d28        while sum(
-000054c0: 7369 7a65 7329 203c 206d 6178 5f73 746f  sizes) < max_sto
-000054d0: 703a 0a20 2020 2020 2020 2020 2020 2069  p:.            i
-000054e0: 6620 7369 7a65 735b 695d 203c 206d 6178  f sizes[i] < max
-000054f0: 5f64 696d 656e 7369 6f6e 735b 695d 3a0a  _dimensions[i]:.
-00005500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005510: 7369 7a65 735b 695d 202b 3d20 310a 2020  sizes[i] += 1.  
-00005520: 2020 2020 2020 2020 2020 6920 3d20 6e65            i = ne
-00005530: 7874 2863 6869 6c64 5f67 656e 6572 6174  xt(child_generat
-00005540: 6f72 290a 0a20 2020 2020 2020 2072 6574  or)..        ret
-00005550: 7572 6e20 7369 7a65 730a 0a20 2020 2064  urn sizes..    d
-00005560: 6566 2077 7269 7465 5f74 6f5f 7363 7265  ef write_to_scre
-00005570: 656e 280a 2020 2020 2020 2020 7365 6c66  en(.        self
-00005580: 2c0a 2020 2020 2020 2020 7363 7265 656e  ,.        screen
-00005590: 3a20 5363 7265 656e 2c0a 2020 2020 2020  : Screen,.      
-000055a0: 2020 6d6f 7573 655f 6861 6e64 6c65 7273    mouse_handlers
-000055b0: 3a20 4d6f 7573 6548 616e 646c 6572 732c  : MouseHandlers,
-000055c0: 0a20 2020 2020 2020 2077 7269 7465 5f70  .        write_p
-000055d0: 6f73 6974 696f 6e3a 2057 7269 7465 506f  osition: WritePo
-000055e0: 7369 7469 6f6e 2c0a 2020 2020 2020 2020  sition,.        
-000055f0: 7061 7265 6e74 5f73 7479 6c65 3a20 7374  parent_style: st
-00005600: 722c 0a20 2020 2020 2020 2065 7261 7365  r,.        erase
-00005610: 5f62 673a 2062 6f6f 6c2c 0a20 2020 2020  _bg: bool,.     
-00005620: 2020 207a 5f69 6e64 6578 3a20 4f70 7469     z_index: Opti
-00005630: 6f6e 616c 5b69 6e74 5d2c 0a20 2020 2029  onal[int],.    )
-00005640: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00005650: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-00005660: 6e64 6572 2074 6865 2070 726f 6d70 7420  nder the prompt 
-00005670: 746f 2061 2060 5363 7265 656e 6020 696e  to a `Screen` in
-00005680: 7374 616e 6365 2e0a 0a20 2020 2020 2020  stance...       
-00005690: 203a 7061 7261 6d20 7363 7265 656e 3a20   :param screen: 
-000056a0: 5468 6520 3a63 6c61 7373 3a60 7e71 756f  The :class:`~quo
-000056b0: 2e6c 6179 6f75 742e 7363 7265 656e 2e53  .layout.screen.S
-000056c0: 6372 6565 6e60 2063 6c61 7373 0a20 2020  creen` class.   
-000056d0: 2020 2020 2020 2020 2074 6f20 7768 6963           to whic
-000056e0: 6820 7468 6520 6f75 7470 7574 2068 6173  h the output has
-000056f0: 2074 6f20 6265 2077 7269 7474 656e 2e0a   to be written..
-00005700: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00005710: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-00005720: 7375 6273 6574 3a0a 2020 2020 2020 2020  subset:.        
-00005730: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-00005740: 2020 2020 7375 6273 6574 203d 2073 656c      subset = sel
-00005750: 662e 5f61 6c6c 5f63 6869 6c64 7265 6e0a  f._all_children.
-00005760: 2020 2020 2020 2020 7369 7a65 7320 3d20          sizes = 
-00005770: 7365 6c66 2e5f 6469 7669 6465 5f77 6964  self._divide_wid
-00005780: 7468 7328 7772 6974 655f 706f 7369 7469  ths(write_positi
-00005790: 6f6e 2e77 6964 7468 290a 2020 2020 2020  on.width).      
-000057a0: 2020 7374 796c 6520 3d20 7061 7265 6e74    style = parent
-000057b0: 5f73 7479 6c65 202b 2022 2022 202b 2074  _style + " " + t
-000057c0: 6f5f 7374 7228 7365 6c66 2e73 7479 6c65  o_str(self.style
-000057d0: 290a 2020 2020 2020 2020 7a5f 696e 6465  ).        z_inde
-000057e0: 7820 3d20 7a5f 696e 6465 7820 6966 2073  x = z_index if s
-000057f0: 656c 662e 7a5f 696e 6465 7820 6973 204e  elf.z_index is N
-00005800: 6f6e 6520 656c 7365 2073 656c 662e 7a5f  one else self.z_
-00005810: 696e 6465 780a 0a20 2020 2020 2020 2023  index..        #
-00005820: 2049 6620 7468 6572 6520 6973 206e 6f74   If there is not
-00005830: 2065 6e6f 7567 6820 7370 6163 652e 0a20   enough space.. 
-00005840: 2020 2020 2020 2069 6620 7369 7a65 7320         if sizes 
-00005850: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00005860: 2020 2020 2073 656c 662e 7769 6e64 6f77       self.window
-00005870: 5f74 6f6f 5f73 6d61 6c6c 2e77 7269 7465  _too_small.write
-00005880: 5f74 6f5f 7363 7265 656e 280a 2020 2020  _to_screen(.    
-00005890: 2020 2020 2020 2020 2020 2020 7363 7265              scre
-000058a0: 656e 2c20 6d6f 7573 655f 6861 6e64 6c65  en, mouse_handle
-000058b0: 7273 2c20 7772 6974 655f 706f 7369 7469  rs, write_positi
-000058c0: 6f6e 2c20 7374 796c 652c 2065 7261 7365  on, style, erase
-000058d0: 5f62 672c 207a 5f69 6e64 6578 0a20 2020  _bg, z_index.   
-000058e0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000058f0: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
-00005900: 2020 2020 2020 2023 2043 616c 6375 6c61         # Calcula
-00005910: 7465 2068 6569 6768 7473 2c20 7461 6b65  te heights, take
-00005920: 2074 6865 206c 6172 6765 7374 2070 6f73   the largest pos
-00005930: 7369 626c 652c 2062 7574 206e 6f74 206c  sible, but not l
-00005940: 6172 6765 7220 7468 616e 0a20 2020 2020  arger than.     
-00005950: 2020 2023 2077 7269 7465 5f70 6f73 6974     # write_posit
-00005960: 696f 6e2e 6865 6967 6874 2e0a 2020 2020  ion.height..    
-00005970: 2020 2020 6865 6967 6874 7320 3d20 5b0a      heights = [.
-00005980: 2020 2020 2020 2020 2020 2020 6368 696c              chil
-00005990: 642e 7072 6566 6572 7265 645f 6865 6967  d.preferred_heig
-000059a0: 6874 2877 6964 7468 2c20 7772 6974 655f  ht(width, write_
-000059b0: 706f 7369 7469 6f6e 2e68 6569 6768 7429  position.height)
-000059c0: 2e70 7265 6665 7272 6564 0a20 2020 2020  .preferred.     
-000059d0: 2020 2020 2020 2066 6f72 2077 6964 7468         for width
-000059e0: 2c20 6368 696c 6420 696e 207a 6970 2873  , child in zip(s
-000059f0: 697a 6573 2c20 7375 6273 6574 290a 2020  izes, subset).  
-00005a00: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-00005a10: 6865 6967 6874 203d 206d 6178 2877 7269  height = max(wri
-00005a20: 7465 5f70 6f73 6974 696f 6e2e 6865 6967  te_position.heig
-00005a30: 6874 2c20 6d69 6e28 7772 6974 655f 706f  ht, min(write_po
-00005a40: 7369 7469 6f6e 2e68 6569 6768 742c 206d  sition.height, m
-00005a50: 6178 2868 6569 6768 7473 2929 290a 0a20  ax(heights))).. 
-00005a60: 2020 2020 2020 2023 0a20 2020 2020 2020         #.       
-00005a70: 2079 706f 7320 3d20 7772 6974 655f 706f   ypos = write_po
-00005a80: 7369 7469 6f6e 2e79 706f 730a 2020 2020  sition.ypos.    
-00005a90: 2020 2020 7870 6f73 203d 2077 7269 7465      xpos = write
-00005aa0: 5f70 6f73 6974 696f 6e2e 7870 6f73 0a0a  _position.xpos..
-00005ab0: 2020 2020 2020 2020 2320 4472 6177 2061          # Draw a
-00005ac0: 6c6c 2063 6869 6c64 2070 616e 6573 2e0a  ll child panes..
-00005ad0: 2020 2020 2020 2020 666f 7220 732c 2063          for s, c
-00005ae0: 2069 6e20 7a69 7028 7369 7a65 732c 2073   in zip(sizes, s
-00005af0: 7562 7365 7429 3a0a 2020 2020 2020 2020  ubset):.        
-00005b00: 2020 2020 632e 7772 6974 655f 746f 5f73      c.write_to_s
-00005b10: 6372 6565 6e28 0a20 2020 2020 2020 2020  creen(.         
-00005b20: 2020 2020 2020 2073 6372 6565 6e2c 0a20         screen,. 
-00005b30: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00005b40: 6f75 7365 5f68 616e 646c 6572 732c 0a20  ouse_handlers,. 
-00005b50: 2020 2020 2020 2020 2020 2020 2020 2057                 W
-00005b60: 7269 7465 506f 7369 7469 6f6e 2878 706f  ritePosition(xpo
-00005b70: 732c 2079 706f 732c 2073 2c20 6865 6967  s, ypos, s, heig
-00005b80: 6874 292c 0a20 2020 2020 2020 2020 2020  ht),.           
-00005b90: 2020 2020 2073 7479 6c65 2c0a 2020 2020       style,.    
-00005ba0: 2020 2020 2020 2020 2020 2020 6572 6173              eras
-00005bb0: 655f 6267 2c0a 2020 2020 2020 2020 2020  e_bg,.          
-00005bc0: 2020 2020 2020 7a5f 696e 6465 782c 0a20        z_index,. 
-00005bd0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00005be0: 2020 2020 2020 2020 2078 706f 7320 2b3d           xpos +=
-00005bf0: 2073 0a0a 2020 2020 2020 2020 2320 4669   s..        # Fi
-00005c00: 6c6c 2069 6e20 7468 6520 7265 6d61 696e  ll in the remain
-00005c10: 696e 6720 7370 6163 652e 2054 6869 7320  ing space. This 
-00005c20: 6861 7070 656e 7320 7768 656e 2061 2063  happens when a c
-00005c30: 6869 6c64 2063 6f6e 7472 6f6c 0a20 2020  hild control.   
-00005c40: 2020 2020 2023 2072 6566 7573 6573 2074       # refuses t
-00005c50: 6f20 7461 6b65 206d 6f72 6520 7370 6163  o take more spac
-00005c60: 6520 616e 6420 7765 2064 6f6e 2774 2068  e and we don't h
-00005c70: 6176 6520 616e 7920 7061 6464 696e 672e  ave any padding.
-00005c80: 2041 6464 696e 6720 610a 2020 2020 2020   Adding a.      
-00005c90: 2020 2320 6475 6d6d 7920 6368 696c 6420    # dummy child 
-00005ca0: 636f 6e74 726f 6c20 666f 7220 7468 6973  control for this
-00005cb0: 2028 696e 2060 7365 6c66 2e5f 616c 6c5f   (in `self._all_
-00005cc0: 6368 696c 6472 656e 6029 2069 7320 6e6f  children`) is no
-00005cd0: 740a 2020 2020 2020 2020 2320 6465 7369  t.        # desi
-00005ce0: 7265 642c 2062 6563 6175 7365 2069 6e20  red, because in 
-00005cf0: 736f 6d65 2073 6974 7561 7469 6f6e 732c  some situations,
-00005d00: 2069 7420 776f 756c 6420 7461 6b65 206d   it would take m
-00005d10: 6f72 6520 7370 6163 652c 2065 7665 6e0a  ore space, even.
-00005d20: 2020 2020 2020 2020 2320 7768 656e 2069          # when i
-00005d30: 7427 7320 6e6f 7420 7265 7175 6972 6564  t's not required
-00005d40: 2e20 5468 6973 2069 7320 7265 7175 6972  . This is requir
-00005d50: 6564 2074 6f20 6170 706c 7920 7468 6520  ed to apply the 
-00005d60: 7374 796c 696e 672e 0a20 2020 2020 2020  styling..       
-00005d70: 2072 656d 6169 6e69 6e67 5f77 6964 7468   remaining_width
-00005d80: 203d 2077 7269 7465 5f70 6f73 6974 696f   = write_positio
-00005d90: 6e2e 7870 6f73 202b 2077 7269 7465 5f70  n.xpos + write_p
-00005da0: 6f73 6974 696f 6e2e 7769 6474 6820 2d20  osition.width - 
-00005db0: 7870 6f73 0a20 2020 2020 2020 2069 6620  xpos.        if 
-00005dc0: 7265 6d61 696e 696e 675f 7769 6474 6820  remaining_width 
-00005dd0: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-00005de0: 2073 656c 662e 5f72 656d 6169 6e69 6e67   self._remaining
-00005df0: 5f73 7061 6365 5f77 696e 646f 772e 7772  _space_window.wr
-00005e00: 6974 655f 746f 5f73 6372 6565 6e28 0a20  ite_to_screen(. 
-00005e10: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00005e20: 6372 6565 6e2c 0a20 2020 2020 2020 2020  creen,.         
-00005e30: 2020 2020 2020 206d 6f75 7365 5f68 616e         mouse_han
-00005e40: 646c 6572 732c 0a20 2020 2020 2020 2020  dlers,.         
-00005e50: 2020 2020 2020 2057 7269 7465 506f 7369         WritePosi
-00005e60: 7469 6f6e 2878 706f 732c 2079 706f 732c  tion(xpos, ypos,
-00005e70: 2072 656d 6169 6e69 6e67 5f77 6964 7468   remaining_width
-00005e80: 2c20 6865 6967 6874 292c 0a20 2020 2020  , height),.     
-00005e90: 2020 2020 2020 2020 2020 2073 7479 6c65             style
-00005ea0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00005eb0: 2020 6572 6173 655f 6267 2c0a 2020 2020    erase_bg,.    
-00005ec0: 2020 2020 2020 2020 2020 2020 7a5f 696e              z_in
-00005ed0: 6465 782c 0a20 2020 2020 2020 2020 2020  dex,.           
-00005ee0: 2029 0a0a 0a63 6c61 7373 2046 6c6f 6174   )...class Float
-00005ef0: 436f 6e74 6169 6e65 7228 436f 6e74 6169  Container(Contai
-00005f00: 6e65 7229 3a0a 2020 2020 2222 220a 2020  ner):.    """.  
-00005f10: 2020 436f 6e74 6169 6e65 7220 7768 6963    Container whic
-00005f20: 6820 6361 6e20 636f 6e74 6169 6e20 616e  h can contain an
-00005f30: 6f74 6865 7220 636f 6e74 6169 6e65 7220  other container 
-00005f40: 666f 7220 7468 6520 6261 636b 6772 6f75  for the backgrou
-00005f50: 6e64 2c20 6173 2077 656c 6c0a 2020 2020  nd, as well.    
-00005f60: 6173 2061 206c 6973 7420 6f66 2066 6c6f  as a list of flo
-00005f70: 6174 696e 6720 636f 6e74 6169 6e65 7273  ating containers
-00005f80: 206f 6e20 746f 7020 6f66 2069 742e 0a0a   on top of it...
-00005f90: 2020 2020 4578 616d 706c 6520 5573 6167      Example Usag
-00005fa0: 653a 3a0a 0a20 2020 2020 2020 2046 6c6f  e::..        Flo
-00005fb0: 6174 436f 6e74 6169 6e65 7228 636f 6e74  atContainer(cont
-00005fc0: 656e 743d 5769 6e64 6f77 282e 2e2e 292c  ent=Window(...),
-00005fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005fe0: 2020 2020 2020 2020 666c 6f61 7473 3d5b          floats=[
-00005ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006000: 2020 2020 2020 2020 2020 2020 466c 6f61              Floa
-00006010: 7428 7863 7572 736f 723d 5472 7565 2c0a  t(xcursor=True,.
-00006020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001200: 0a20 2020 2072 6574 7572 6e20 5769 6e64  .    return Wind
+00001210: 6f77 280a 2020 2020 2020 2020 2020 2020  ow(.            
+00001220: 466f 726d 6174 7465 6454 6578 7443 6f6e  FormattedTextCon
+00001230: 7472 6f6c 2874 6578 743d 5b28 2263 6c61  trol(text=[("cla
+00001240: 7373 3a77 696e 646f 772d 746f 6f2d 736d  ss:window-too-sm
+00001250: 616c 6c22 2c20 2220 5769 6e64 6f77 2074  all", " Window t
+00001260: 6f6f 2073 6d61 6c6c 2229 5d29 290a 0a0a  oo small")]))...
+00001270: 636c 6173 7320 5665 7274 6963 616c 416c  class VerticalAl
+00001280: 6967 6e28 456e 756d 293a 0a20 2020 2022  ign(Enum):.    "
+00001290: 416c 6967 6e6d 656e 7420 666f 7220 6048  Alignment for `H
+000012a0: 5370 6c69 7460 2e22 0a20 2020 2054 4f50  Split`.".    TOP
+000012b0: 203d 2022 544f 5022 0a20 2020 2043 454e   = "TOP".    CEN
+000012c0: 5445 5220 3d20 2243 454e 5445 5222 0a20  TER = "CENTER". 
+000012d0: 2020 2042 4f54 544f 4d20 3d20 2242 4f54     BOTTOM = "BOT
+000012e0: 544f 4d22 0a20 2020 204a 5553 5449 4659  TOM".    JUSTIFY
+000012f0: 203d 2022 4a55 5354 4946 5922 0a0a 636c   = "JUSTIFY"..cl
+00001300: 6173 7320 486f 7269 7a6f 6e74 616c 416c  ass HorizontalAl
+00001310: 6967 6e28 456e 756d 293a 0a20 2020 2022  ign(Enum):.    "
+00001320: 416c 6967 6e6d 656e 7420 666f 7220 6056  Alignment for `V
+00001330: 5370 6c69 7460 2e22 0a20 2020 204c 4546  Split`.".    LEF
+00001340: 5420 3d20 224c 4546 5422 0a20 2020 2043  T = "LEFT".    C
+00001350: 454e 5445 5220 3d20 2243 454e 5445 5222  ENTER = "CENTER"
+00001360: 0a20 2020 2052 4947 4854 203d 2022 5249  .    RIGHT = "RI
+00001370: 4748 5422 0a20 2020 204a 5553 5449 4659  GHT".    JUSTIFY
+00001380: 203d 2022 4a55 5354 4946 5922 0a0a 0a63   = "JUSTIFY"...c
+00001390: 6c61 7373 205f 5370 6c69 7428 436f 6e74  lass _Split(Cont
+000013a0: 6169 6e65 7229 3a0a 2020 2020 2222 220a  ainer):.    """.
+000013b0: 2020 2020 5468 6520 636f 6d6d 6f6e 2070      The common p
+000013c0: 6172 7473 206f 6620 6056 5370 6c69 7460  arts of `VSplit`
+000013d0: 2061 6e64 2060 4853 706c 6974 602e 0a20   and `HSplit`.. 
+000013e0: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
+000013f0: 5f5f 696e 6974 5f5f 280a 2020 2020 2020  __init__(.      
+00001400: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00001410: 7375 6273 6574 3a20 5365 7175 656e 6365  subset: Sequence
+00001420: 5b41 6e79 436f 6e74 6169 6e65 725d 2c0a  [AnyContainer],.
+00001430: 2020 2020 2020 2020 7769 6e64 6f77 5f74          window_t
+00001440: 6f6f 5f73 6d61 6c6c 3a20 4f70 7469 6f6e  oo_small: Option
+00001450: 616c 5b43 6f6e 7461 696e 6572 5d20 3d20  al[Container] = 
+00001460: 4e6f 6e65 2c0a 2020 2020 2020 2020 7061  None,.        pa
+00001470: 6464 696e 673a 2041 6e79 4469 6d65 6e73  dding: AnyDimens
+00001480: 696f 6e20 3d20 4469 6d65 6e73 696f 6e2e  ion = Dimension.
+00001490: 6578 6163 7428 3029 2c0a 2020 2020 2020  exact(0),.      
+000014a0: 2020 7061 6464 696e 675f 6368 6172 3a20    padding_char: 
+000014b0: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+000014c0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7061  None,.        pa
+000014d0: 6464 696e 675f 7374 796c 653a 2073 7472  dding_style: str
+000014e0: 203d 2022 222c 0a20 2020 2020 2020 2077   = "",.        w
+000014f0: 6964 7468 3a20 416e 7944 696d 656e 7369  idth: AnyDimensi
+00001500: 6f6e 203d 204e 6f6e 652c 0a20 2020 2020  on = None,.     
+00001510: 2020 2068 6569 6768 743a 2041 6e79 4469     height: AnyDi
+00001520: 6d65 6e73 696f 6e20 3d20 4e6f 6e65 2c0a  mension = None,.
+00001530: 2020 2020 2020 2020 7a5f 696e 6465 783a          z_index:
+00001540: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
+00001550: 204e 6f6e 652c 0a20 2020 2020 2020 206d   None,.        m
+00001560: 6f64 616c 3a20 626f 6f6c 203d 2046 616c  odal: bool = Fal
+00001570: 7365 2c0a 2020 2020 2020 2020 6269 6e64  se,.        bind
+00001580: 3a20 4f70 7469 6f6e 616c 5b4b 6579 4269  : Optional[KeyBi
+00001590: 6e64 696e 6773 4261 7365 5d20 3d20 4e6f  ndingsBase] = No
+000015a0: 6e65 2c0a 2020 2020 2020 2020 7374 796c  ne,.        styl
+000015b0: 653a 2055 6e69 6f6e 5b73 7472 2c20 4361  e: Union[str, Ca
+000015c0: 6c6c 6162 6c65 5b5b 5d2c 2073 7472 5d5d  llable[[], str]]
+000015d0: 203d 2022 222c 0a20 2020 2029 202d 3e20   = "",.    ) -> 
+000015e0: 4e6f 6e65 3a0a 0a20 2020 2020 2020 2073  None:..        s
+000015f0: 656c 662e 7375 6273 6574 203d 205b 746f  elf.subset = [to
+00001600: 5f63 6f6e 7461 696e 6572 2863 2920 666f  _container(c) fo
+00001610: 7220 6320 696e 2073 7562 7365 745d 0a20  r c in subset]. 
+00001620: 2020 2020 2020 2073 656c 662e 7769 6e64         self.wind
+00001630: 6f77 5f74 6f6f 5f73 6d61 6c6c 203d 2077  ow_too_small = w
+00001640: 696e 646f 775f 746f 6f5f 736d 616c 6c20  indow_too_small 
+00001650: 6f72 205f 7769 6e64 6f77 5f74 6f6f 5f73  or _window_too_s
+00001660: 6d61 6c6c 2829 0a20 2020 2020 2020 2073  mall().        s
+00001670: 656c 662e 7061 6464 696e 6720 3d20 7061  elf.padding = pa
+00001680: 6464 696e 670a 2020 2020 2020 2020 7365  dding.        se
+00001690: 6c66 2e70 6164 6469 6e67 5f63 6861 7220  lf.padding_char 
+000016a0: 3d20 7061 6464 696e 675f 6368 6172 0a20  = padding_char. 
+000016b0: 2020 2020 2020 2073 656c 662e 7061 6464         self.padd
+000016c0: 696e 675f 7374 796c 6520 3d20 7061 6464  ing_style = padd
+000016d0: 696e 675f 7374 796c 650a 0a20 2020 2020  ing_style..     
+000016e0: 2020 2073 656c 662e 7769 6474 6820 3d20     self.width = 
+000016f0: 7769 6474 680a 2020 2020 2020 2020 7365  width.        se
+00001700: 6c66 2e68 6569 6768 7420 3d20 6865 6967  lf.height = heig
+00001710: 6874 0a20 2020 2020 2020 2073 656c 662e  ht.        self.
+00001720: 7a5f 696e 6465 7820 3d20 7a5f 696e 6465  z_index = z_inde
+00001730: 780a 0a20 2020 2020 2020 2073 656c 662e  x..        self.
+00001740: 6d6f 6461 6c20 3d20 6d6f 6461 6c0a 2020  modal = modal.  
+00001750: 2020 2020 2020 7365 6c66 2e62 696e 6420        self.bind 
+00001760: 3d20 6269 6e64 0a20 2020 2020 2020 2073  = bind.        s
+00001770: 656c 662e 7374 796c 6520 3d20 7374 796c  elf.style = styl
+00001780: 650a 0a20 2020 2064 6566 2069 735f 6d6f  e..    def is_mo
+00001790: 6461 6c28 7365 6c66 2920 2d3e 2062 6f6f  dal(self) -> boo
+000017a0: 6c3a 0a20 2020 2020 2020 2072 6574 7572  l:.        retur
+000017b0: 6e20 7365 6c66 2e6d 6f64 616c 0a0a 2020  n self.modal..  
+000017c0: 2020 6465 6620 6765 745f 6b65 795f 6269    def get_key_bi
+000017d0: 6e64 696e 6773 2873 656c 6629 202d 3e20  ndings(self) -> 
+000017e0: 4f70 7469 6f6e 616c 5b4b 6579 4269 6e64  Optional[KeyBind
+000017f0: 696e 6773 4261 7365 5d3a 0a20 2020 2020  ingsBase]:.     
+00001800: 2020 2072 6574 7572 6e20 7365 6c66 2e62     return self.b
+00001810: 696e 640a 0a20 2020 2064 6566 2067 6574  ind..    def get
+00001820: 5f63 6869 6c64 7265 6e28 7365 6c66 2920  _children(self) 
+00001830: 2d3e 204c 6973 745b 436f 6e74 6169 6e65  -> List[Containe
+00001840: 725d 3a0a 2020 2020 2020 2020 7265 7475  r]:.        retu
+00001850: 726e 2073 656c 662e 7375 6273 6574 0a0a  rn self.subset..
+00001860: 0a63 6c61 7373 2048 5370 6c69 7428 5f53  .class HSplit(_S
+00001870: 706c 6974 293a 0a20 2020 2022 2222 0a20  plit):.    """. 
+00001880: 2020 2053 6576 6572 616c 206c 6179 6f75     Several layou
+00001890: 7473 2c20 6f6e 6520 7374 6163 6b65 6420  ts, one stacked 
+000018a0: 6162 6f76 652f 756e 6465 7220 7468 6520  above/under the 
+000018b0: 6f74 6865 722e 203a 3a0a 0a20 2020 2020  other. ::..     
+000018c0: 2020 202b 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d     +------------
+000018d0: 2d2d 2d2d 2d2d 2d2d 2b0a 2020 2020 2020  --------+.      
+000018e0: 2020 7c20 2020 2020 2020 2020 2020 2020    |             
+000018f0: 2020 2020 2020 207c 0a20 2020 2020 2020         |.       
+00001900: 202b 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d   +--------------
+00001910: 2d2d 2d2d 2d2d 2b0a 2020 2020 2020 2020  ------+.        
+00001920: 7c20 2020 2020 2020 2020 2020 2020 2020  |               
+00001930: 2020 2020 207c 0a20 2020 2020 2020 202b       |.        +
+00001940: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+00001950: 2d2d 2d2d 2b0a 0a20 2020 2042 7920 6465  ----+..    By de
+00001960: 6661 756c 742c 2074 6869 7320 646f 6573  fault, this does
+00001970: 6e27 7420 6469 7370 6c61 7920 6120 686f  n't display a ho
+00001980: 7269 7a6f 6e74 616c 206c 696e 6520 6265  rizontal line be
+00001990: 7477 6565 6e20 7468 6520 6368 696c 6472  tween the childr
+000019a0: 656e 2c0a 2020 2020 6275 7420 6966 2074  en,.    but if t
+000019b0: 6869 7320 6973 2073 6f6d 6574 6869 6e67  his is something
+000019c0: 2079 6f75 206e 6565 642c 2074 6865 6e20   you need, then 
+000019d0: 6372 6561 7465 2061 2048 5370 6c69 7420  create a HSplit 
+000019e0: 6173 2066 6f6c 6c6f 7773 3a3a 0a0a 2020  as follows::..  
+000019f0: 2020 2020 2020 4853 706c 6974 2863 6869        HSplit(chi
+00001a00: 6c64 7265 6e3d 5b20 2e2e 2e20 5d2c 2070  ldren=[ ... ], p
+00001a10: 6164 6469 6e67 5f63 6861 723d 272d 272c  adding_char='-',
+00001a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001a30: 7061 6464 696e 673d 312c 2070 6164 6469  padding=1, paddi
+00001a40: 6e67 5f73 7479 6c65 3d27 2366 6666 6630  ng_style='#ffff0
+00001a50: 3027 290a 0a20 2020 203a 7061 7261 6d20  0')..    :param 
+00001a60: 6368 696c 6472 656e 3a20 4c69 7374 206f  children: List o
+00001a70: 6620 6368 696c 6420 3a63 6c61 7373 3a60  f child :class:`
+00001a80: 2e43 6f6e 7461 696e 6572 6020 6f62 6a65  .Container` obje
+00001a90: 6374 732e 0a20 2020 203a 7061 7261 6d20  cts..    :param 
+00001aa0: 7769 6e64 6f77 5f74 6f6f 5f73 6d61 6c6c  window_too_small
+00001ab0: 3a20 4120 3a63 6c61 7373 3a60 2e43 6f6e  : A :class:`.Con
+00001ac0: 7461 696e 6572 6020 6f62 6a65 6374 2074  tainer` object t
+00001ad0: 6861 7420 6973 2064 6973 706c 6179 6564  hat is displayed
+00001ae0: 2069 660a 2020 2020 2020 2020 7468 6572   if.        ther
+00001af0: 6520 6973 206e 6f74 2065 6e6f 7567 6820  e is not enough 
+00001b00: 7370 6163 6520 666f 7220 616c 6c20 7468  space for all th
+00001b10: 6520 6368 696c 6472 656e 2e20 4279 2064  e children. By d
+00001b20: 6566 6175 6c74 2c20 7468 6973 2069 7320  efault, this is 
+00001b30: 610a 2020 2020 2020 2020 2257 696e 646f  a.        "Windo
+00001b40: 7720 746f 6f20 736d 616c 6c22 206d 6573  w too small" mes
+00001b50: 7361 6765 2e0a 2020 2020 3a70 6172 616d  sage..    :param
+00001b60: 2061 6c69 676e 3a20 6056 6572 7469 6361   align: `Vertica
+00001b70: 6c41 6c69 676e 6020 7661 6c75 652e 0a20  lAlign` value.. 
+00001b80: 2020 203a 7061 7261 6d20 7769 6474 683a     :param width:
+00001b90: 2057 6865 6e20 6769 7665 6e2c 2075 7365   When given, use
+00001ba0: 2074 6869 7320 7769 6474 6820 696e 7374   this width inst
+00001bb0: 6561 6420 6f66 206c 6f6f 6b69 6e67 2061  ead of looking a
+00001bc0: 7420 7468 6520 6368 696c 6472 656e 2e0a  t the children..
+00001bd0: 2020 2020 3a70 6172 616d 2068 6569 6768      :param heigh
+00001be0: 743a 2057 6865 6e20 6769 7665 6e2c 2075  t: When given, u
+00001bf0: 7365 2074 6869 7320 6865 6967 6874 2069  se this height i
+00001c00: 6e73 7465 6164 206f 6620 6c6f 6f6b 696e  nstead of lookin
+00001c10: 6720 6174 2074 6865 2063 6869 6c64 7265  g at the childre
+00001c20: 6e2e 0a20 2020 203a 7061 7261 6d20 7a5f  n..    :param z_
+00001c30: 696e 6465 783a 2028 696e 7420 6f72 204e  index: (int or N
+00001c40: 6f6e 6529 2057 6865 6e20 7370 6563 6966  one) When specif
+00001c50: 6965 642c 2074 6869 7320 6361 6e20 6265  ied, this can be
+00001c60: 2075 7365 6420 746f 2062 7269 6e67 0a20   used to bring. 
+00001c70: 2020 2020 2020 2065 6c65 6d65 6e74 2069         element i
+00001c80: 6e20 6672 6f6e 7420 6f66 2066 6c6f 6174  n front of float
+00001c90: 696e 6720 656c 656d 656e 7473 2e20 2060  ing elements.  `
+00001ca0: 4e6f 6e65 6020 6d65 616e 733a 2069 6e68  None` means: inh
+00001cb0: 6572 6974 2066 726f 6d20 7061 7265 6e74  erit from parent
+00001cc0: 2e0a 2020 2020 3a70 6172 616d 2073 7479  ..    :param sty
+00001cd0: 6c65 3a20 4120 7374 796c 6520 7374 7269  le: A style stri
+00001ce0: 6e67 2e0a 2020 2020 3a70 6172 616d 206d  ng..    :param m
+00001cf0: 6f64 616c 3a20 6060 5472 7565 6060 206f  odal: ``True`` o
+00001d00: 7220 6060 4661 6c73 6560 602e 0a20 2020  r ``False``..   
+00001d10: 203a 7061 7261 6d20 6269 6e64 3a20 6060   :param bind: ``
+00001d20: 4e6f 6e65 6060 206f 7220 6120 3a63 6c61  None`` or a :cla
+00001d30: 7373 3a60 2e42 696e 6460 206f 626a 6563  ss:`.Bind` objec
+00001d40: 742e 0a0a 2020 2020 3a70 6172 616d 2070  t...    :param p
+00001d50: 6164 6469 6e67 3a20 2860 4469 6d65 6e73  adding: (`Dimens
+00001d60: 696f 6e60 206f 7220 696e 7429 2c20 7369  ion` or int), si
+00001d70: 7a65 2074 6f20 6265 2075 7365 6420 666f  ze to be used fo
+00001d80: 7220 7468 6520 7061 6464 696e 672e 0a20  r the padding.. 
+00001d90: 2020 203a 7061 7261 6d20 7061 6464 696e     :param paddin
+00001da0: 675f 6368 6172 3a20 4368 6172 6163 7465  g_char: Characte
+00001db0: 7220 746f 2062 6520 7573 6564 2066 6f72  r to be used for
+00001dc0: 2066 696c 6c69 6e67 2069 6e20 7468 6520   filling in the 
+00001dd0: 7061 6464 696e 672e 0a20 2020 203a 7061  padding..    :pa
+00001de0: 7261 6d20 7061 6464 696e 675f 7374 796c  ram padding_styl
+00001df0: 653a 2053 7479 6c65 2074 6f20 6170 706c  e: Style to appl
+00001e00: 6965 6420 746f 2074 6865 2070 6164 6469  ied to the paddi
+00001e10: 6e67 2e0a 2020 2020 2222 220a 2020 2020  ng..    """.    
+00001e20: 746f 7020 3d20 5665 7274 6963 616c 416c  top = VerticalAl
+00001e30: 6967 6e2e 544f 500a 2020 2020 6365 6e74  ign.TOP.    cent
+00001e40: 6572 203d 2056 6572 7469 6361 6c41 6c69  er = VerticalAli
+00001e50: 676e 2e43 454e 5445 520a 2020 2020 626f  gn.CENTER.    bo
+00001e60: 7474 6f6d 203d 2056 6572 7469 6361 6c41  ttom = VerticalA
+00001e70: 6c69 676e 2e42 4f54 544f 4d0a 2020 2020  lign.BOTTOM.    
+00001e80: 6a75 7374 6966 7920 3d20 5665 7274 6963  justify = Vertic
+00001e90: 616c 416c 6967 6e2e 4a55 5354 4946 590a  alAlign.JUSTIFY.
+00001ea0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00001eb0: 5f28 0a20 2020 2020 2020 2073 656c 662c  _(.        self,
+00001ec0: 0a20 2020 2020 2020 2073 7562 7365 743a  .        subset:
+00001ed0: 2053 6571 7565 6e63 655b 416e 7943 6f6e   Sequence[AnyCon
+00001ee0: 7461 696e 6572 5d2c 0a20 2020 2020 2020  tainer],.       
+00001ef0: 2077 696e 646f 775f 746f 6f5f 736d 616c   window_too_smal
+00001f00: 6c3a 204f 7074 696f 6e61 6c5b 436f 6e74  l: Optional[Cont
+00001f10: 6169 6e65 725d 203d 204e 6f6e 652c 0a20  ainer] = None,. 
+00001f20: 2020 2020 2020 2061 6c69 676e 3a20 5665         align: Ve
+00001f30: 7274 6963 616c 416c 6967 6e20 3d20 226a  rticalAlign = "j
+00001f40: 7573 7469 6679 222c 0a20 2020 2020 2020  ustify",.       
+00001f50: 2070 6164 6469 6e67 3a20 416e 7944 696d   padding: AnyDim
+00001f60: 656e 7369 6f6e 203d 2030 2c0a 2020 2020  ension = 0,.    
+00001f70: 2020 2020 7061 6464 696e 675f 6368 6172      padding_char
+00001f80: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
+00001f90: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00001fa0: 7061 6464 696e 675f 7374 796c 653a 2073  padding_style: s
+00001fb0: 7472 203d 2022 222c 0a20 2020 2020 2020  tr = "",.       
+00001fc0: 2077 6964 7468 3a20 416e 7944 696d 656e   width: AnyDimen
+00001fd0: 7369 6f6e 203d 204e 6f6e 652c 0a20 2020  sion = None,.   
+00001fe0: 2020 2020 2068 6569 6768 743a 2041 6e79       height: Any
+00001ff0: 4469 6d65 6e73 696f 6e20 3d20 4e6f 6e65  Dimension = None
+00002000: 2c0a 2020 2020 2020 2020 7a5f 696e 6465  ,.        z_inde
+00002010: 783a 204f 7074 696f 6e61 6c5b 696e 745d  x: Optional[int]
+00002020: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00002030: 206d 6f64 616c 3a20 626f 6f6c 203d 2046   modal: bool = F
+00002040: 616c 7365 2c0a 2020 2020 2020 2020 6269  alse,.        bi
+00002050: 6e64 3a20 4f70 7469 6f6e 616c 5b4b 6579  nd: Optional[Key
+00002060: 4269 6e64 696e 6773 4261 7365 5d20 3d20  BindingsBase] = 
+00002070: 4e6f 6e65 2c0a 2020 2020 2020 2020 7374  None,.        st
+00002080: 796c 653a 2055 6e69 6f6e 5b73 7472 2c20  yle: Union[str, 
+00002090: 4361 6c6c 6162 6c65 5b5b 5d2c 2073 7472  Callable[[], str
+000020a0: 5d5d 203d 2022 222c 0a20 2020 2029 202d  ]] = "",.    ) -
+000020b0: 3e20 4e6f 6e65 3a0a 0a20 2020 2020 2020  > None:..       
+000020c0: 2073 7570 6572 2829 2e5f 5f69 6e69 745f   super().__init_
+000020d0: 5f28 0a20 2020 2020 2020 2020 2020 2073  _(.            s
+000020e0: 7562 7365 743d 7375 6273 6574 2c0a 2020  ubset=subset,.  
+000020f0: 2020 2020 2020 2020 2020 7769 6e64 6f77            window
+00002100: 5f74 6f6f 5f73 6d61 6c6c 3d77 696e 646f  _too_small=windo
+00002110: 775f 746f 6f5f 736d 616c 6c2c 0a20 2020  w_too_small,.   
+00002120: 2020 2020 2020 2020 2070 6164 6469 6e67           padding
+00002130: 3d70 6164 6469 6e67 2c0a 2020 2020 2020  =padding,.      
+00002140: 2020 2020 2020 7061 6464 696e 675f 6368        padding_ch
+00002150: 6172 3d70 6164 6469 6e67 5f63 6861 722c  ar=padding_char,
+00002160: 0a20 2020 2020 2020 2020 2020 2070 6164  .            pad
+00002170: 6469 6e67 5f73 7479 6c65 3d70 6164 6469  ding_style=paddi
+00002180: 6e67 5f73 7479 6c65 2c0a 2020 2020 2020  ng_style,.      
+00002190: 2020 2020 2020 7769 6474 683d 7769 6474        width=widt
+000021a0: 682c 0a20 2020 2020 2020 2020 2020 2068  h,.            h
+000021b0: 6569 6768 743d 6865 6967 6874 2c0a 2020  eight=height,.  
+000021c0: 2020 2020 2020 2020 2020 7a5f 696e 6465            z_inde
+000021d0: 783d 7a5f 696e 6465 782c 0a20 2020 2020  x=z_index,.     
+000021e0: 2020 2020 2020 206d 6f64 616c 3d6d 6f64         modal=mod
+000021f0: 616c 2c0a 2020 2020 2020 2020 2020 2020  al,.            
+00002200: 6269 6e64 3d62 696e 642c 0a20 2020 2020  bind=bind,.     
+00002210: 2020 2020 2020 2073 7479 6c65 3d73 7479         style=sty
+00002220: 6c65 2c0a 2020 2020 2020 2020 290a 0a20  le,.        ).. 
+00002230: 2020 2020 2020 2073 656c 662e 616c 6967         self.alig
+00002240: 6e20 3d20 616c 6967 6e0a 0a20 2020 2020  n = align..     
+00002250: 2020 2073 656c 662e 5f63 6869 6c64 7265     self._childre
+00002260: 6e5f 6361 6368 653a 2053 696d 706c 6543  n_cache: SimpleC
+00002270: 6163 6865 5b0a 2020 2020 2020 2020 2020  ache[.          
+00002280: 2020 5475 706c 655b 436f 6e74 6169 6e65    Tuple[Containe
+00002290: 722c 202e 2e2e 5d2c 204c 6973 745b 436f  r, ...], List[Co
+000022a0: 6e74 6169 6e65 725d 0a20 2020 2020 2020  ntainer].       
+000022b0: 205d 203d 2053 696d 706c 6543 6163 6865   ] = SimpleCache
+000022c0: 286d 6178 7369 7a65 3d31 290a 2020 2020  (maxsize=1).    
+000022d0: 2020 2020 7365 6c66 2e5f 7265 6d61 696e      self._remain
+000022e0: 696e 675f 7370 6163 655f 7769 6e64 6f77  ing_space_window
+000022f0: 203d 2057 696e 646f 7728 2920 2023 2044   = Window()  # D
+00002300: 756d 6d79 2077 696e 646f 772e 0a0a 2020  ummy window...  
+00002310: 2020 6465 6620 7072 6566 6572 7265 645f    def preferred_
+00002320: 7769 6474 6828 7365 6c66 2c20 6d61 785f  width(self, max_
+00002330: 6176 6169 6c61 626c 655f 7769 6474 683a  available_width:
+00002340: 2069 6e74 2920 2d3e 2044 696d 656e 7369   int) -> Dimensi
+00002350: 6f6e 3a0a 2020 2020 2020 2020 6966 2073  on:.        if s
+00002360: 656c 662e 7769 6474 6820 6973 206e 6f74  elf.width is not
+00002370: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00002380: 2020 2072 6574 7572 6e20 746f 5f64 696d     return to_dim
+00002390: 656e 7369 6f6e 2873 656c 662e 7769 6474  ension(self.widt
+000023a0: 6829 0a0a 2020 2020 2020 2020 6966 2073  h)..        if s
+000023b0: 656c 662e 7375 6273 6574 3a0a 2020 2020  elf.subset:.    
+000023c0: 2020 2020 2020 2020 6469 6d65 6e73 696f          dimensio
+000023d0: 6e73 203d 205b 632e 7072 6566 6572 7265  ns = [c.preferre
+000023e0: 645f 7769 6474 6828 6d61 785f 6176 6169  d_width(max_avai
+000023f0: 6c61 626c 655f 7769 6474 6829 2066 6f72  lable_width) for
+00002400: 2063 2069 6e20 7365 6c66 2e73 7562 7365   c in self.subse
+00002410: 745d 0a20 2020 2020 2020 2020 2020 2072  t].            r
+00002420: 6574 7572 6e20 6d61 785f 6c61 796f 7574  eturn max_layout
+00002430: 5f64 696d 656e 7369 6f6e 7328 6469 6d65  _dimensions(dime
+00002440: 6e73 696f 6e73 290a 2020 2020 2020 2020  nsions).        
+00002450: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00002460: 2020 7265 7475 726e 2044 696d 656e 7369    return Dimensi
+00002470: 6f6e 2829 0a0a 2020 2020 6465 6620 7072  on()..    def pr
+00002480: 6566 6572 7265 645f 6865 6967 6874 2873  eferred_height(s
+00002490: 656c 662c 2077 6964 7468 3a20 696e 742c  elf, width: int,
+000024a0: 206d 6178 5f61 7661 696c 6162 6c65 5f68   max_available_h
+000024b0: 6569 6768 743a 2069 6e74 2920 2d3e 2044  eight: int) -> D
+000024c0: 696d 656e 7369 6f6e 3a0a 2020 2020 2020  imension:.      
+000024d0: 2020 6966 2073 656c 662e 6865 6967 6874    if self.height
+000024e0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+000024f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00002500: 2074 6f5f 6469 6d65 6e73 696f 6e28 7365   to_dimension(se
+00002510: 6c66 2e68 6569 6768 7429 0a0a 2020 2020  lf.height)..    
+00002520: 2020 2020 6469 6d65 6e73 696f 6e73 203d      dimensions =
+00002530: 205b 0a20 2020 2020 2020 2020 2020 2063   [.            c
+00002540: 2e70 7265 6665 7272 6564 5f68 6569 6768  .preferred_heigh
+00002550: 7428 7769 6474 682c 206d 6178 5f61 7661  t(width, max_ava
+00002560: 696c 6162 6c65 5f68 6569 6768 7429 2066  ilable_height) f
+00002570: 6f72 2063 2069 6e20 7365 6c66 2e5f 616c  or c in self._al
+00002580: 6c5f 6368 696c 6472 656e 0a20 2020 2020  l_children.     
+00002590: 2020 205d 0a20 2020 2020 2020 2072 6574     ].        ret
+000025a0: 7572 6e20 7375 6d5f 6c61 796f 7574 5f64  urn sum_layout_d
+000025b0: 696d 656e 7369 6f6e 7328 6469 6d65 6e73  imensions(dimens
+000025c0: 696f 6e73 290a 0a20 2020 2064 6566 2072  ions)..    def r
+000025d0: 6573 6574 2873 656c 6629 202d 3e20 4e6f  eset(self) -> No
+000025e0: 6e65 3a0a 2020 2020 2020 2020 666f 7220  ne:.        for 
+000025f0: 6320 696e 2073 656c 662e 7375 6273 6574  c in self.subset
+00002600: 3a0a 2020 2020 2020 2020 2020 2020 632e  :.            c.
+00002610: 7265 7365 7428 290a 0a20 2020 2040 7072  reset()..    @pr
+00002620: 6f70 6572 7479 0a20 2020 2064 6566 205f  operty.    def _
+00002630: 616c 6c5f 6368 696c 6472 656e 2873 656c  all_children(sel
+00002640: 6629 202d 3e20 4c69 7374 5b43 6f6e 7461  f) -> List[Conta
+00002650: 696e 6572 5d3a 0a20 2020 2020 2020 2022  iner]:.        "
+00002660: 2222 0a20 2020 2020 2020 204c 6973 7420  "".        List 
+00002670: 6f66 2063 6869 6c64 206f 626a 6563 7473  of child objects
+00002680: 2c20 696e 636c 7564 696e 6720 7061 6464  , including padd
+00002690: 696e 672e 0a20 2020 2020 2020 2022 2222  ing..        """
+000026a0: 0a0a 2020 2020 2020 2020 6465 6620 6765  ..        def ge
+000026b0: 7428 2920 2d3e 204c 6973 745b 436f 6e74  t() -> List[Cont
+000026c0: 6169 6e65 725d 3a0a 2020 2020 2020 2020  ainer]:.        
+000026d0: 2020 2020 7265 7375 6c74 3a20 4c69 7374      result: List
+000026e0: 5b43 6f6e 7461 696e 6572 5d20 3d20 5b5d  [Container] = []
+000026f0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00002700: 5061 6464 696e 6720 546f 702e 0a20 2020  Padding Top..   
+00002710: 2020 2020 2020 2020 2063 656e 7465 7220           center 
+00002720: 3d20 5665 7274 6963 616c 416c 6967 6e2e  = VerticalAlign.
+00002730: 4345 4e54 4552 0a20 2020 2020 2020 2020  CENTER.         
+00002740: 2020 2062 6f74 746f 6d20 3d20 5665 7274     bottom = Vert
+00002750: 6963 616c 416c 6967 6e2e 424f 5454 4f4d  icalAlign.BOTTOM
+00002760: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00002770: 7365 6c66 2e61 6c69 676e 2069 6e20 2863  self.align in (c
+00002780: 656e 7465 722c 2062 6f74 746f 6d29 3a0a  enter, bottom):.
+00002790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000027a0: 7265 7375 6c74 2e61 7070 656e 6428 5769  result.append(Wi
+000027b0: 6e64 6f77 2877 6964 7468 3d44 696d 656e  ndow(width=Dimen
+000027c0: 7369 6f6e 2870 7265 6665 7272 6564 3d30  sion(preferred=0
+000027d0: 2929 290a 0a20 2020 2020 2020 2020 2020  )))..           
+000027e0: 2023 2054 6865 2073 7562 7365 7473 2077   # The subsets w
+000027f0: 6974 6820 7061 6464 696e 672e 0a20 2020  ith padding..   
+00002800: 2020 2020 2020 2020 2066 6f72 2063 6869           for chi
+00002810: 6c64 2069 6e20 7365 6c66 2e73 7562 7365  ld in self.subse
+00002820: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00002830: 2020 2072 6573 756c 742e 6170 7065 6e64     result.append
+00002840: 2863 6869 6c64 290a 2020 2020 2020 2020  (child).        
+00002850: 2020 2020 2020 2020 7265 7375 6c74 2e61          result.a
+00002860: 7070 656e 6428 0a20 2020 2020 2020 2020  ppend(.         
+00002870: 2020 2020 2020 2020 2020 2057 696e 646f             Windo
+00002880: 7728 0a20 2020 2020 2020 2020 2020 2020  w(.             
+00002890: 2020 2020 2020 2020 2020 2068 6569 6768             heigh
+000028a0: 743d 7365 6c66 2e70 6164 6469 6e67 2c0a  t=self.padding,.
+000028b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000028c0: 2020 2020 2020 2020 6368 6172 3d73 656c          char=sel
+000028d0: 662e 7061 6464 696e 675f 6368 6172 2c0a  f.padding_char,.
+000028e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000028f0: 2020 2020 2020 2020 7374 796c 653d 7365          style=se
+00002900: 6c66 2e70 6164 6469 6e67 5f73 7479 6c65  lf.padding_style
+00002910: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00002920: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00002930: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00002940: 2020 2020 2020 6966 2072 6573 756c 743a        if result:
+00002950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002960: 2072 6573 756c 742e 706f 7028 290a 0a20   result.pop().. 
+00002970: 2020 2020 2020 2020 2020 2023 2050 6164             # Pad
+00002980: 6469 6e67 2072 6967 6874 2e0a 2020 2020  ding right..    
+00002990: 2020 2020 2020 2020 746f 7020 3d20 5665          top = Ve
+000029a0: 7274 6963 616c 416c 6967 6e2e 544f 500a  rticalAlign.TOP.
+000029b0: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
+000029c0: 6572 203d 2056 6572 7469 6361 6c41 6c69  er = VerticalAli
+000029d0: 676e 2e43 454e 5445 520a 2020 2020 2020  gn.CENTER.      
+000029e0: 2020 2020 2020 6966 2073 656c 662e 616c        if self.al
+000029f0: 6967 6e20 696e 2028 6365 6e74 6572 2c20  ign in (center, 
+00002a00: 746f 7029 3a0a 2020 2020 2020 2020 2020  top):.          
+00002a10: 2020 2020 2020 7265 7375 6c74 2e61 7070        result.app
+00002a20: 656e 6428 5769 6e64 6f77 2877 6964 7468  end(Window(width
+00002a30: 3d44 696d 656e 7369 6f6e 2870 7265 6665  =Dimension(prefe
+00002a40: 7272 6564 3d30 2929 290a 0a20 2020 2020  rred=0)))..     
+00002a50: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+00002a60: 7375 6c74 0a0a 2020 2020 2020 2020 7265  sult..        re
+00002a70: 7475 726e 2073 656c 662e 5f63 6869 6c64  turn self._child
+00002a80: 7265 6e5f 6361 6368 652e 6765 7428 7475  ren_cache.get(tu
+00002a90: 706c 6528 7365 6c66 2e73 7562 7365 7429  ple(self.subset)
+00002aa0: 2c20 6765 7429 0a0a 2020 2020 6465 6620  , get)..    def 
+00002ab0: 7772 6974 655f 746f 5f73 6372 6565 6e28  write_to_screen(
+00002ac0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00002ad0: 2020 2020 2020 2073 6372 6565 6e3a 2053         screen: S
+00002ae0: 6372 6565 6e2c 0a20 2020 2020 2020 206d  creen,.        m
+00002af0: 6f75 7365 5f68 616e 646c 6572 733a 204d  ouse_handlers: M
+00002b00: 6f75 7365 4861 6e64 6c65 7273 2c0a 2020  ouseHandlers,.  
+00002b10: 2020 2020 2020 7772 6974 655f 706f 7369        write_posi
+00002b20: 7469 6f6e 3a20 5772 6974 6550 6f73 6974  tion: WritePosit
+00002b30: 696f 6e2c 0a20 2020 2020 2020 2070 6172  ion,.        par
+00002b40: 656e 745f 7374 796c 653a 2073 7472 2c0a  ent_style: str,.
+00002b50: 2020 2020 2020 2020 6572 6173 655f 6267          erase_bg
+00002b60: 3a20 626f 6f6c 2c0a 2020 2020 2020 2020  : bool,.        
+00002b70: 7a5f 696e 6465 783a 204f 7074 696f 6e61  z_index: Optiona
+00002b80: 6c5b 696e 745d 2c0a 2020 2020 2920 2d3e  l[int],.    ) ->
+00002b90: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00002ba0: 2222 0a20 2020 2020 2020 2052 656e 6465  "".        Rende
+00002bb0: 7220 7468 6520 7072 6f6d 7074 2074 6f20  r the prompt to 
+00002bc0: 6120 6053 6372 6565 6e60 2069 6e73 7461  a `Screen` insta
+00002bd0: 6e63 652e 0a0a 2020 2020 2020 2020 3a70  nce...        :p
+00002be0: 6172 616d 2073 6372 6565 6e3a 2054 6865  aram screen: The
+00002bf0: 203a 636c 6173 733a 607e 7175 6f2e 6c61   :class:`~quo.la
+00002c00: 796f 7574 2e73 6372 6565 6e2e 5363 7265  yout.screen.Scre
+00002c10: 656e 6020 636c 6173 730a 2020 2020 2020  en` class.      
+00002c20: 2020 2020 2020 746f 2077 6869 6368 2074        to which t
+00002c30: 6865 206f 7574 7075 7420 6861 7320 746f  he output has to
+00002c40: 2062 6520 7772 6974 7465 6e2e 0a20 2020   be written..   
+00002c50: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00002c60: 2073 697a 6573 203d 2073 656c 662e 5f64   sizes = self._d
+00002c70: 6976 6964 655f 6865 6967 6874 7328 7772  ivide_heights(wr
+00002c80: 6974 655f 706f 7369 7469 6f6e 290a 2020  ite_position).  
+00002c90: 2020 2020 2020 7374 796c 6520 3d20 7061        style = pa
+00002ca0: 7265 6e74 5f73 7479 6c65 202b 2022 2022  rent_style + " "
+00002cb0: 202b 2074 6f5f 7374 7228 7365 6c66 2e73   + to_str(self.s
+00002cc0: 7479 6c65 290a 2020 2020 2020 2020 7a5f  tyle).        z_
+00002cd0: 696e 6465 7820 3d20 7a5f 696e 6465 7820  index = z_index 
+00002ce0: 6966 2073 656c 662e 7a5f 696e 6465 7820  if self.z_index 
+00002cf0: 6973 204e 6f6e 6520 656c 7365 2073 656c  is None else sel
+00002d00: 662e 7a5f 696e 6465 780a 0a20 2020 2020  f.z_index..     
+00002d10: 2020 2069 6620 7369 7a65 7320 6973 204e     if sizes is N
+00002d20: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00002d30: 2073 656c 662e 7769 6e64 6f77 5f74 6f6f   self.window_too
+00002d40: 5f73 6d61 6c6c 2e77 7269 7465 5f74 6f5f  _small.write_to_
+00002d50: 7363 7265 656e 280a 2020 2020 2020 2020  screen(.        
+00002d60: 2020 2020 2020 2020 7363 7265 656e 2c20          screen, 
+00002d70: 6d6f 7573 655f 6861 6e64 6c65 7273 2c20  mouse_handlers, 
+00002d80: 7772 6974 655f 706f 7369 7469 6f6e 2c20  write_position, 
+00002d90: 7374 796c 652c 2065 7261 7365 5f62 672c  style, erase_bg,
+00002da0: 207a 5f69 6e64 6578 0a20 2020 2020 2020   z_index.       
+00002db0: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
+00002dc0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00002dd0: 2023 0a20 2020 2020 2020 2020 2020 2079   #.            y
+00002de0: 706f 7320 3d20 7772 6974 655f 706f 7369  pos = write_posi
+00002df0: 7469 6f6e 2e79 706f 730a 2020 2020 2020  tion.ypos.      
+00002e00: 2020 2020 2020 7870 6f73 203d 2077 7269        xpos = wri
+00002e10: 7465 5f70 6f73 6974 696f 6e2e 7870 6f73  te_position.xpos
+00002e20: 0a20 2020 2020 2020 2020 2020 2077 6964  .            wid
+00002e30: 7468 203d 2077 7269 7465 5f70 6f73 6974  th = write_posit
+00002e40: 696f 6e2e 7769 6474 680a 0a20 2020 2020  ion.width..     
+00002e50: 2020 2020 2020 2023 2044 7261 7720 6368         # Draw ch
+00002e60: 696c 6420 7061 6e65 732e 0a20 2020 2020  ild panes..     
+00002e70: 2020 2020 2020 2066 6f72 2073 2c20 6320         for s, c 
+00002e80: 696e 207a 6970 2873 697a 6573 2c20 7365  in zip(sizes, se
+00002e90: 6c66 2e5f 616c 6c5f 6368 696c 6472 656e  lf._all_children
+00002ea0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00002eb0: 2020 2063 2e77 7269 7465 5f74 6f5f 7363     c.write_to_sc
+00002ec0: 7265 656e 280a 2020 2020 2020 2020 2020  reen(.          
+00002ed0: 2020 2020 2020 2020 2020 7363 7265 656e            screen
+00002ee0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00002ef0: 2020 2020 2020 6d6f 7573 655f 6861 6e64        mouse_hand
+00002f00: 6c65 7273 2c0a 2020 2020 2020 2020 2020  lers,.          
+00002f10: 2020 2020 2020 2020 2020 5772 6974 6550            WriteP
+00002f20: 6f73 6974 696f 6e28 7870 6f73 2c20 7970  osition(xpos, yp
+00002f30: 6f73 2c20 7769 6474 682c 2073 292c 0a20  os, width, s),. 
+00002f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002f50: 2020 2073 7479 6c65 2c0a 2020 2020 2020     style,.      
+00002f60: 2020 2020 2020 2020 2020 2020 2020 6572                er
+00002f70: 6173 655f 6267 2c0a 2020 2020 2020 2020  ase_bg,.        
+00002f80: 2020 2020 2020 2020 2020 2020 7a5f 696e              z_in
+00002f90: 6465 782c 0a20 2020 2020 2020 2020 2020  dex,.           
+00002fa0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00002fb0: 2020 2020 2020 2079 706f 7320 2b3d 2073         ypos += s
+00002fc0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00002fd0: 4669 6c6c 2069 6e20 7468 6520 7265 6d61  Fill in the rema
+00002fe0: 696e 696e 6720 7370 6163 652e 2054 6869  ining space. Thi
+00002ff0: 7320 6861 7070 656e 7320 7768 656e 2061  s happens when a
+00003000: 2063 6869 6c64 2063 6f6e 7472 6f6c 0a20   child control. 
+00003010: 2020 2020 2020 2020 2020 2023 2072 6566             # ref
+00003020: 7573 6573 2074 6f20 7461 6b65 206d 6f72  uses to take mor
+00003030: 6520 7370 6163 6520 616e 6420 7765 2064  e space and we d
+00003040: 6f6e 2774 2068 6176 6520 616e 7920 7061  on't have any pa
+00003050: 6464 696e 672e 2041 6464 696e 6720 610a  dding. Adding a.
+00003060: 2020 2020 2020 2020 2020 2020 2320 6475              # du
+00003070: 6d6d 7920 6368 696c 6420 636f 6e74 726f  mmy child contro
+00003080: 6c20 666f 7220 7468 6973 2028 696e 2060  l for this (in `
+00003090: 7365 6c66 2e5f 616c 6c5f 6368 696c 6472  self._all_childr
+000030a0: 656e 6029 2069 7320 6e6f 740a 2020 2020  en`) is not.    
+000030b0: 2020 2020 2020 2020 2320 6465 7369 7265          # desire
+000030c0: 642c 2062 6563 6175 7365 2069 6e20 736f  d, because in so
+000030d0: 6d65 2073 6974 7561 7469 6f6e 732c 2069  me situations, i
+000030e0: 7420 776f 756c 6420 7461 6b65 206d 6f72  t would take mor
+000030f0: 6520 7370 6163 652c 2065 7665 6e0a 2020  e space, even.  
+00003100: 2020 2020 2020 2020 2020 2320 7768 656e            # when
+00003110: 2069 7427 7320 6e6f 7420 7265 7175 6972   it's not requir
+00003120: 6564 2e20 5468 6973 2069 7320 7265 7175  ed. This is requ
+00003130: 6972 6564 2074 6f20 6170 706c 7920 7468  ired to apply th
+00003140: 6520 7374 796c 696e 672e 0a20 2020 2020  e styling..     
+00003150: 2020 2020 2020 2072 656d 6169 6e69 6e67         remaining
+00003160: 5f68 6569 6768 7420 3d20 7772 6974 655f  _height = write_
+00003170: 706f 7369 7469 6f6e 2e79 706f 7320 2b20  position.ypos + 
+00003180: 7772 6974 655f 706f 7369 7469 6f6e 2e68  write_position.h
+00003190: 6569 6768 7420 2d20 7970 6f73 0a20 2020  eight - ypos.   
+000031a0: 2020 2020 2020 2020 2069 6620 7265 6d61           if rema
+000031b0: 696e 696e 675f 6865 6967 6874 203e 2030  ining_height > 0
+000031c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000031d0: 2020 7365 6c66 2e5f 7265 6d61 696e 696e    self._remainin
+000031e0: 675f 7370 6163 655f 7769 6e64 6f77 2e77  g_space_window.w
+000031f0: 7269 7465 5f74 6f5f 7363 7265 656e 280a  rite_to_screen(.
+00003200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003210: 2020 2020 7363 7265 656e 2c0a 2020 2020      screen,.    
+00003220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003230: 6d6f 7573 655f 6861 6e64 6c65 7273 2c0a  mouse_handlers,.
+00003240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003250: 2020 2020 5772 6974 6550 6f73 6974 696f      WritePositio
+00003260: 6e28 7870 6f73 2c20 7970 6f73 2c20 7769  n(xpos, ypos, wi
+00003270: 6474 682c 2072 656d 6169 6e69 6e67 5f68  dth, remaining_h
+00003280: 6569 6768 7429 2c0a 2020 2020 2020 2020  eight),.        
+00003290: 2020 2020 2020 2020 2020 2020 7374 796c              styl
+000032a0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+000032b0: 2020 2020 2020 2065 7261 7365 5f62 672c         erase_bg,
+000032c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000032d0: 2020 2020 207a 5f69 6e64 6578 2c0a 2020       z_index,.  
+000032e0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000032f0: 0a20 2020 2064 6566 205f 6469 7669 6465  .    def _divide
+00003300: 5f68 6569 6768 7473 2873 656c 662c 2077  _heights(self, w
+00003310: 7269 7465 5f70 6f73 6974 696f 6e3a 2057  rite_position: W
+00003320: 7269 7465 506f 7369 7469 6f6e 2920 2d3e  ritePosition) ->
+00003330: 204f 7074 696f 6e61 6c5b 4c69 7374 5b69   Optional[List[i
+00003340: 6e74 5d5d 3a0a 2020 2020 2020 2020 2222  nt]]:.        ""
+00003350: 220a 2020 2020 2020 2020 5265 7475 726e  ".        Return
+00003360: 2074 6865 2068 6569 6768 7473 2066 6f72   the heights for
+00003370: 2061 6c6c 2072 6f77 732e 0a20 2020 2020   all rows..     
+00003380: 2020 204f 7220 4e6f 6e65 2077 6865 6e20     Or None when 
+00003390: 7468 6572 6520 6973 206e 6f74 2065 6e6f  there is not eno
+000033a0: 7567 6820 7370 6163 652e 0a20 2020 2020  ugh space..     
+000033b0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+000033c0: 6620 6e6f 7420 7365 6c66 2e73 7562 7365  f not self.subse
+000033d0: 743a 0a20 2020 2020 2020 2020 2020 2072  t:.            r
+000033e0: 6574 7572 6e20 5b5d 0a0a 2020 2020 2020  eturn []..      
+000033f0: 2020 7769 6474 6820 3d20 7772 6974 655f    width = write_
+00003400: 706f 7369 7469 6f6e 2e77 6964 7468 0a20  position.width. 
+00003410: 2020 2020 2020 2068 6569 6768 7420 3d20         height = 
+00003420: 7772 6974 655f 706f 7369 7469 6f6e 2e68  write_position.h
+00003430: 6569 6768 740a 0a20 2020 2020 2020 2023  eight..        #
+00003440: 2043 616c 6375 6c61 7465 2068 6569 6768   Calculate heigh
+00003450: 7473 2e0a 2020 2020 2020 2020 6469 6d65  ts..        dime
+00003460: 6e73 696f 6e73 203d 205b 632e 7072 6566  nsions = [c.pref
+00003470: 6572 7265 645f 6865 6967 6874 2877 6964  erred_height(wid
+00003480: 7468 2c20 6865 6967 6874 2920 666f 7220  th, height) for 
+00003490: 6320 696e 2073 656c 662e 5f61 6c6c 5f63  c in self._all_c
+000034a0: 6869 6c64 7265 6e5d 0a0a 2020 2020 2020  hildren]..      
+000034b0: 2020 2320 5375 6d20 6469 6d65 6e73 696f    # Sum dimensio
+000034c0: 6e73 0a20 2020 2020 2020 2073 756d 5f64  ns.        sum_d
+000034d0: 696d 656e 7369 6f6e 7320 3d20 7375 6d5f  imensions = sum_
+000034e0: 6c61 796f 7574 5f64 696d 656e 7369 6f6e  layout_dimension
+000034f0: 7328 6469 6d65 6e73 696f 6e73 290a 0a20  s(dimensions).. 
+00003500: 2020 2020 2020 2023 2049 6620 7468 6572         # If ther
+00003510: 6520 6973 206e 6f74 2065 6e6f 7567 6820  e is not enough 
+00003520: 7370 6163 6520 666f 7220 626f 7468 2e0a  space for both..
+00003530: 2020 2020 2020 2020 2320 446f 6e27 7420          # Don't 
+00003540: 646f 2061 6e79 7468 696e 672e 0a20 2020  do anything..   
+00003550: 2020 2020 2069 6620 7375 6d5f 6469 6d65       if sum_dime
+00003560: 6e73 696f 6e73 2e6d 696e 203e 2068 6569  nsions.min > hei
+00003570: 6768 743a 0a20 2020 2020 2020 2020 2020  ght:.           
+00003580: 2072 6574 7572 6e20 4e6f 6e65 0a0a 2020   return None..  
+00003590: 2020 2020 2020 2320 4669 6e64 206f 7074        # Find opt
+000035a0: 696d 616c 2073 697a 6573 2e20 2853 7461  imal sizes. (Sta
+000035b0: 7274 2077 6974 6820 6d69 6e69 6d61 6c20  rt with minimal 
+000035c0: 7369 7a65 2c20 696e 6372 6561 7365 2075  size, increase u
+000035d0: 6e74 696c 2077 6520 636f 7665 720a 2020  ntil we cover.  
+000035e0: 2020 2020 2020 2320 7468 6520 7768 6f6c        # the whol
+000035f0: 6520 6865 6967 6874 2e29 0a20 2020 2020  e height.).     
+00003600: 2020 2073 697a 6573 203d 205b 642e 6d69     sizes = [d.mi
+00003610: 6e20 666f 7220 6420 696e 2064 696d 656e  n for d in dimen
+00003620: 7369 6f6e 735d 0a0a 2020 2020 2020 2020  sions]..        
+00003630: 6368 696c 645f 6765 6e65 7261 746f 7220  child_generator 
+00003640: 3d20 7461 6b65 5f75 7369 6e67 5f77 6569  = take_using_wei
+00003650: 6768 7473 280a 2020 2020 2020 2020 2020  ghts(.          
+00003660: 2020 6974 656d 733d 6c69 7374 2872 616e    items=list(ran
+00003670: 6765 286c 656e 2864 696d 656e 7369 6f6e  ge(len(dimension
+00003680: 7329 2929 2c20 7765 6967 6874 733d 5b64  s))), weights=[d
+00003690: 2e77 6569 6768 7420 666f 7220 6420 696e  .weight for d in
+000036a0: 2064 696d 656e 7369 6f6e 735d 0a20 2020   dimensions].   
+000036b0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+000036c0: 6920 3d20 6e65 7874 2863 6869 6c64 5f67  i = next(child_g
+000036d0: 656e 6572 6174 6f72 290a 0a20 2020 2020  enerator)..     
+000036e0: 2020 2023 2049 6e63 7265 6173 6520 756e     # Increase un
+000036f0: 7469 6c20 7765 206d 6565 7420 6174 206c  til we meet at l
+00003700: 6561 7374 2074 6865 2027 7072 6566 6572  east the 'prefer
+00003710: 7265 6427 2073 697a 652e 0a20 2020 2020  red' size..     
+00003720: 2020 2070 7265 6665 7272 6564 5f73 746f     preferred_sto
+00003730: 7020 3d20 6d69 6e28 6865 6967 6874 2c20  p = min(height, 
+00003740: 7375 6d5f 6469 6d65 6e73 696f 6e73 2e70  sum_dimensions.p
+00003750: 7265 6665 7272 6564 290a 2020 2020 2020  referred).      
+00003760: 2020 7072 6566 6572 7265 645f 6469 6d65    preferred_dime
+00003770: 6e73 696f 6e73 203d 205b 642e 7072 6566  nsions = [d.pref
+00003780: 6572 7265 6420 666f 7220 6420 696e 2064  erred for d in d
+00003790: 696d 656e 7369 6f6e 735d 0a0a 2020 2020  imensions]..    
+000037a0: 2020 2020 7768 696c 6520 7375 6d28 7369      while sum(si
+000037b0: 7a65 7329 203c 2070 7265 6665 7272 6564  zes) < preferred
+000037c0: 5f73 746f 703a 0a20 2020 2020 2020 2020  _stop:.         
+000037d0: 2020 2069 6620 7369 7a65 735b 695d 203c     if sizes[i] <
+000037e0: 2070 7265 6665 7272 6564 5f64 696d 656e   preferred_dimen
+000037f0: 7369 6f6e 735b 695d 3a0a 2020 2020 2020  sions[i]:.      
+00003800: 2020 2020 2020 2020 2020 7369 7a65 735b            sizes[
+00003810: 695d 202b 3d20 310a 2020 2020 2020 2020  i] += 1.        
+00003820: 2020 2020 6920 3d20 6e65 7874 2863 6869      i = next(chi
+00003830: 6c64 5f67 656e 6572 6174 6f72 290a 0a20  ld_generator).. 
+00003840: 2020 2020 2020 2023 2049 6e63 7265 6173         # Increas
+00003850: 6520 756e 7469 6c20 7765 2075 7365 2061  e until we use a
+00003860: 6c6c 2074 6865 2061 7661 696c 6162 6c65  ll the available
+00003870: 2073 7061 6365 2e20 286f 7220 756e 7469   space. (or unti
+00003880: 6c20 226d 6178 2229 0a20 2020 2020 2020  l "max").       
+00003890: 2069 6620 6e6f 7420 6765 745f 6170 7028   if not get_app(
+000038a0: 292e 6973 5f64 6f6e 653a 0a20 2020 2020  ).is_done:.     
+000038b0: 2020 2020 2020 206d 6178 5f73 746f 7020         max_stop 
+000038c0: 3d20 6d69 6e28 6865 6967 6874 2c20 7375  = min(height, su
+000038d0: 6d5f 6469 6d65 6e73 696f 6e73 2e6d 6178  m_dimensions.max
+000038e0: 290a 2020 2020 2020 2020 2020 2020 6d61  ).            ma
+000038f0: 785f 6469 6d65 6e73 696f 6e73 203d 205b  x_dimensions = [
+00003900: 642e 6d61 7820 666f 7220 6420 696e 2064  d.max for d in d
+00003910: 696d 656e 7369 6f6e 735d 0a0a 2020 2020  imensions]..    
+00003920: 2020 2020 2020 2020 7768 696c 6520 7375          while su
+00003930: 6d28 7369 7a65 7329 203c 206d 6178 5f73  m(sizes) < max_s
+00003940: 746f 703a 0a20 2020 2020 2020 2020 2020  top:.           
+00003950: 2020 2020 2069 6620 7369 7a65 735b 695d       if sizes[i]
+00003960: 203c 206d 6178 5f64 696d 656e 7369 6f6e   < max_dimension
+00003970: 735b 695d 3a0a 2020 2020 2020 2020 2020  s[i]:.          
+00003980: 2020 2020 2020 2020 2020 7369 7a65 735b            sizes[
+00003990: 695d 202b 3d20 310a 2020 2020 2020 2020  i] += 1.        
+000039a0: 2020 2020 2020 2020 6920 3d20 6e65 7874          i = next
+000039b0: 2863 6869 6c64 5f67 656e 6572 6174 6f72  (child_generator
+000039c0: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+000039d0: 6e20 7369 7a65 730a 0a0a 636c 6173 7320  n sizes...class 
+000039e0: 5653 706c 6974 285f 5370 6c69 7429 3a0a  VSplit(_Split):.
+000039f0: 2020 2020 2222 220a 2020 2020 5365 7665      """.    Seve
+00003a00: 7261 6c20 6c61 796f 7574 732c 206f 6e65  ral layouts, one
+00003a10: 2073 7461 636b 6564 206c 6566 742f 7269   stacked left/ri
+00003a20: 6768 7420 6f66 2074 6865 206f 7468 6572  ght of the other
+00003a30: 2e20 3a3a 0a0a 2020 2020 2020 2020 2b2d  . ::..        +-
+00003a40: 2d2d 2d2d 2d2d 2d2d 2b2d 2d2d 2d2d 2d2d  --------+-------
+00003a50: 2d2d 2d2b 0a20 2020 2020 2020 207c 2020  ---+.        |  
+00003a60: 2020 2020 2020 207c 2020 2020 2020 2020         |        
+00003a70: 2020 7c0a 2020 2020 2020 2020 7c20 2020    |.        |   
+00003a80: 2020 2020 2020 7c20 2020 2020 2020 2020        |         
+00003a90: 207c 0a20 2020 2020 2020 202b 2d2d 2d2d   |.        +----
+00003aa0: 2d2d 2d2d 2d2b 2d2d 2d2d 2d2d 2d2d 2d2d  -----+----------
+00003ab0: 2b0a 0a20 2020 2042 7920 6465 6661 756c  +..    By defaul
+00003ac0: 742c 2074 6869 7320 646f 6573 6e27 7420  t, this doesn't 
+00003ad0: 6469 7370 6c61 7920 6120 7665 7274 6963  display a vertic
+00003ae0: 616c 206c 696e 6520 6265 7477 6565 6e20  al line between 
+00003af0: 7468 6520 6368 696c 6472 656e 2c20 6275  the children, bu
+00003b00: 740a 2020 2020 6966 2074 6869 7320 6973  t.    if this is
+00003b10: 2073 6f6d 6574 6869 6e67 2079 6f75 206e   something you n
+00003b20: 6565 642c 2074 6865 6e20 6372 6561 7465  eed, then create
+00003b30: 2061 2048 5370 6c69 7420 6173 2066 6f6c   a HSplit as fol
+00003b40: 6c6f 7773 3a3a 0a0a 2020 2020 2020 2020  lows::..        
+00003b50: 5653 706c 6974 2863 6869 6c64 7265 6e3d  VSplit(children=
+00003b60: 5b20 2e2e 2e20 5d2c 2070 6164 6469 6e67  [ ... ], padding
+00003b70: 5f63 6861 723d 277c 272c 0a20 2020 2020  _char='|',.     
+00003b80: 2020 2020 2020 2020 2020 7061 6464 696e            paddin
+00003b90: 673d 312c 2070 6164 6469 6e67 5f73 7479  g=1, padding_sty
+00003ba0: 6c65 3d27 2366 6666 6630 3027 290a 0a20  le='#ffff00').. 
+00003bb0: 2020 203a 7061 7261 6d20 6368 696c 6472     :param childr
+00003bc0: 656e 3a20 4c69 7374 206f 6620 6368 696c  en: List of chil
+00003bd0: 6420 3a63 6c61 7373 3a60 2e43 6f6e 7461  d :class:`.Conta
+00003be0: 696e 6572 6020 6f62 6a65 6374 732e 0a20  iner` objects.. 
+00003bf0: 2020 203a 7061 7261 6d20 7769 6e64 6f77     :param window
+00003c00: 5f74 6f6f 5f73 6d61 6c6c 3a20 4120 3a63  _too_small: A :c
+00003c10: 6c61 7373 3a60 2e43 6f6e 7461 696e 6572  lass:`.Container
+00003c20: 6020 6f62 6a65 6374 2074 6861 7420 6973  ` object that is
+00003c30: 2064 6973 706c 6179 6564 2069 660a 2020   displayed if.  
+00003c40: 2020 2020 2020 7468 6572 6520 6973 206e        there is n
+00003c50: 6f74 2065 6e6f 7567 6820 7370 6163 6520  ot enough space 
+00003c60: 666f 7220 616c 6c20 7468 6520 6368 696c  for all the chil
+00003c70: 6472 656e 2e20 4279 2064 6566 6175 6c74  dren. By default
+00003c80: 2c20 7468 6973 2069 7320 610a 2020 2020  , this is a.    
+00003c90: 2020 2020 2257 696e 646f 7720 746f 6f20      "Window too 
+00003ca0: 736d 616c 6c22 206d 6573 7361 6765 2e0a  small" message..
+00003cb0: 2020 2020 3a70 6172 616d 2061 6c69 676e      :param align
+00003cc0: 3a20 6048 6f72 697a 6f6e 7461 6c41 6c69  : `HorizontalAli
+00003cd0: 676e 6020 7661 6c75 652e 0a20 2020 203a  gn` value..    :
+00003ce0: 7061 7261 6d20 7769 6474 683a 2057 6865  param width: Whe
+00003cf0: 6e20 6769 7665 6e2c 2075 7365 2074 6869  n given, use thi
+00003d00: 7320 7769 6474 6820 696e 7374 6561 6420  s width instead 
+00003d10: 6f66 206c 6f6f 6b69 6e67 2061 7420 7468  of looking at th
+00003d20: 6520 6368 696c 6472 656e 2e0a 2020 2020  e children..    
+00003d30: 3a70 6172 616d 2068 6569 6768 743a 2057  :param height: W
+00003d40: 6865 6e20 6769 7665 6e2c 2075 7365 2074  hen given, use t
+00003d50: 6869 7320 6865 6967 6874 2069 6e73 7465  his height inste
+00003d60: 6164 206f 6620 6c6f 6f6b 696e 6720 6174  ad of looking at
+00003d70: 2074 6865 2063 6869 6c64 7265 6e2e 0a20   the children.. 
+00003d80: 2020 203a 7061 7261 6d20 7a5f 696e 6465     :param z_inde
+00003d90: 783a 2028 696e 7420 6f72 204e 6f6e 6529  x: (int or None)
+00003da0: 2057 6865 6e20 7370 6563 6966 6965 642c   When specified,
+00003db0: 2074 6869 7320 6361 6e20 6265 2075 7365   this can be use
+00003dc0: 6420 746f 2062 7269 6e67 0a20 2020 2020  d to bring.     
+00003dd0: 2020 2065 6c65 6d65 6e74 2069 6e20 6672     element in fr
+00003de0: 6f6e 7420 6f66 2066 6c6f 6174 696e 6720  ont of floating 
+00003df0: 656c 656d 656e 7473 2e20 2060 4e6f 6e65  elements.  `None
+00003e00: 6020 6d65 616e 733a 2069 6e68 6572 6974  ` means: inherit
+00003e10: 2066 726f 6d20 7061 7265 6e74 2e0a 2020   from parent..  
+00003e20: 2020 3a70 6172 616d 2073 7479 6c65 3a20    :param style: 
+00003e30: 4120 7374 796c 6520 7374 7269 6e67 2e0a  A style string..
+00003e40: 2020 2020 3a70 6172 616d 206d 6f64 616c      :param modal
+00003e50: 3a20 6060 5472 7565 6060 206f 7220 6060  : ``True`` or ``
+00003e60: 4661 6c73 6560 602e 0a20 2020 203a 7061  False``..    :pa
+00003e70: 7261 6d20 6b65 795f 6269 6e64 696e 6773  ram key_bindings
+00003e80: 3a20 6060 4e6f 6e65 6060 206f 7220 6120  : ``None`` or a 
+00003e90: 3a63 6c61 7373 3a60 2e4b 6579 4269 6e64  :class:`.KeyBind
+00003ea0: 696e 6773 6020 6f62 6a65 6374 2e0a 0a20  ings` object... 
+00003eb0: 2020 203a 7061 7261 6d20 7061 6464 696e     :param paddin
+00003ec0: 673a 2028 6044 696d 656e 7369 6f6e 6020  g: (`Dimension` 
+00003ed0: 6f72 2069 6e74 292c 2073 697a 6520 746f  or int), size to
+00003ee0: 2062 6520 7573 6564 2066 6f72 2074 6865   be used for the
+00003ef0: 2070 6164 6469 6e67 2e0a 2020 2020 3a70   padding..    :p
+00003f00: 6172 616d 2070 6164 6469 6e67 5f63 6861  aram padding_cha
+00003f10: 723a 2043 6861 7261 6374 6572 2074 6f20  r: Character to 
+00003f20: 6265 2075 7365 6420 666f 7220 6669 6c6c  be used for fill
+00003f30: 696e 6720 696e 2074 6865 2070 6164 6469  ing in the paddi
+00003f40: 6e67 2e0a 2020 2020 3a70 6172 616d 2070  ng..    :param p
+00003f50: 6164 6469 6e67 5f73 7479 6c65 3a20 5374  adding_style: St
+00003f60: 796c 6520 746f 2061 7070 6c69 6564 2074  yle to applied t
+00003f70: 6f20 7468 6520 7061 6464 696e 672e 0a20  o the padding.. 
+00003f80: 2020 2022 2222 0a20 2020 206c 6566 7420     """.    left 
+00003f90: 3d20 486f 7269 7a6f 6e74 616c 416c 6967  = HorizontalAlig
+00003fa0: 6e2e 4c45 4654 0a20 2020 2063 656e 7465  n.LEFT.    cente
+00003fb0: 7220 3d20 486f 7269 7a6f 6e74 616c 416c  r = HorizontalAl
+00003fc0: 6967 6e2e 4345 4e54 4552 0a20 2020 2072  ign.CENTER.    r
+00003fd0: 6967 6874 203d 2048 6f72 697a 6f6e 7461  ight = Horizonta
+00003fe0: 6c41 6c69 676e 2e52 4947 4854 0a20 2020  lAlign.RIGHT.   
+00003ff0: 206a 7573 7469 6679 203d 2048 6f72 697a   justify = Horiz
+00004000: 6f6e 7461 6c41 6c69 676e 2e4a 5553 5449  ontalAlign.JUSTI
+00004010: 4659 0a0a 2020 2020 6465 6620 5f5f 696e  FY..    def __in
+00004020: 6974 5f5f 280a 2020 2020 2020 2020 7365  it__(.        se
+00004030: 6c66 2c0a 2020 2020 2020 2020 7375 6273  lf,.        subs
+00004040: 6574 3a20 5365 7175 656e 6365 5b41 6e79  et: Sequence[Any
+00004050: 436f 6e74 6169 6e65 725d 2c0a 2020 2020  Container],.    
+00004060: 2020 2020 7769 6e64 6f77 5f74 6f6f 5f73      window_too_s
+00004070: 6d61 6c6c 3a20 4f70 7469 6f6e 616c 5b43  mall: Optional[C
+00004080: 6f6e 7461 696e 6572 5d20 3d20 4e6f 6e65  ontainer] = None
+00004090: 2c0a 2020 2020 2020 2020 616c 6967 6e3a  ,.        align:
+000040a0: 2048 6f72 697a 6f6e 7461 6c41 6c69 676e   HorizontalAlign
+000040b0: 203d 2022 6a75 7374 6966 7922 2c0a 2020   = "justify",.  
+000040c0: 2020 2020 2020 7061 6464 696e 673a 2041        padding: A
+000040d0: 6e79 4469 6d65 6e73 696f 6e20 3d20 302c  nyDimension = 0,
+000040e0: 0a20 2020 2020 2020 2070 6164 6469 6e67  .        padding
+000040f0: 5f63 6861 723a 204f 7074 696f 6e61 6c5b  _char: Optional[
+00004100: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+00004110: 2020 2020 2070 6164 6469 6e67 5f73 7479       padding_sty
+00004120: 6c65 3a20 7374 7220 3d20 2222 2c0a 2020  le: str = "",.  
+00004130: 2020 2020 2020 7769 6474 683a 2041 6e79        width: Any
+00004140: 4469 6d65 6e73 696f 6e20 3d20 4e6f 6e65  Dimension = None
+00004150: 2c0a 2020 2020 2020 2020 6865 6967 6874  ,.        height
+00004160: 3a20 416e 7944 696d 656e 7369 6f6e 203d  : AnyDimension =
+00004170: 204e 6f6e 652c 0a20 2020 2020 2020 207a   None,.        z
+00004180: 5f69 6e64 6578 3a20 4f70 7469 6f6e 616c  _index: Optional
+00004190: 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a 2020  [int] = None,.  
+000041a0: 2020 2020 2020 6d6f 6461 6c3a 2062 6f6f        modal: boo
+000041b0: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
+000041c0: 2020 2062 696e 643a 204f 7074 696f 6e61     bind: Optiona
+000041d0: 6c5b 4b65 7942 696e 6469 6e67 7342 6173  l[KeyBindingsBas
+000041e0: 655d 203d 204e 6f6e 652c 0a20 2020 2020  e] = None,.     
+000041f0: 2020 2073 7479 6c65 3a20 556e 696f 6e5b     style: Union[
+00004200: 7374 722c 2043 616c 6c61 626c 655b 5b5d  str, Callable[[]
+00004210: 2c20 7374 725d 5d20 3d20 2222 2c0a 2020  , str]] = "",.  
+00004220: 2020 2920 2d3e 204e 6f6e 653a 0a0a 2020    ) -> None:..  
+00004230: 2020 2020 2020 7375 7065 7228 292e 5f5f        super().__
+00004240: 696e 6974 5f5f 280a 2020 2020 2020 2020  init__(.        
+00004250: 2020 2020 7375 6273 6574 3d73 7562 7365      subset=subse
+00004260: 742c 0a20 2020 2020 2020 2020 2020 2077  t,.            w
+00004270: 696e 646f 775f 746f 6f5f 736d 616c 6c3d  indow_too_small=
+00004280: 7769 6e64 6f77 5f74 6f6f 5f73 6d61 6c6c  window_too_small
+00004290: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
+000042a0: 6464 696e 673d 7061 6464 696e 672c 0a20  dding=padding,. 
+000042b0: 2020 2020 2020 2020 2020 2070 6164 6469             paddi
+000042c0: 6e67 5f63 6861 723d 7061 6464 696e 675f  ng_char=padding_
+000042d0: 6368 6172 2c0a 2020 2020 2020 2020 2020  char,.          
+000042e0: 2020 7061 6464 696e 675f 7374 796c 653d    padding_style=
+000042f0: 7061 6464 696e 675f 7374 796c 652c 0a20  padding_style,. 
+00004300: 2020 2020 2020 2020 2020 2077 6964 7468             width
+00004310: 3d77 6964 7468 2c0a 2020 2020 2020 2020  =width,.        
+00004320: 2020 2020 6865 6967 6874 3d68 6569 6768      height=heigh
+00004330: 742c 0a20 2020 2020 2020 2020 2020 207a  t,.            z
+00004340: 5f69 6e64 6578 3d7a 5f69 6e64 6578 2c0a  _index=z_index,.
+00004350: 2020 2020 2020 2020 2020 2020 6d6f 6461              moda
+00004360: 6c3d 6d6f 6461 6c2c 0a20 2020 2020 2020  l=modal,.       
+00004370: 2020 2020 2062 696e 643d 6269 6e64 2c0a       bind=bind,.
+00004380: 2020 2020 2020 2020 2020 2020 7374 796c              styl
+00004390: 653d 7374 796c 652c 0a20 2020 2020 2020  e=style,.       
+000043a0: 2029 0a0a 2020 2020 2020 2020 7365 6c66   )..        self
+000043b0: 2e61 6c69 676e 203d 2061 6c69 676e 0a0a  .align = align..
+000043c0: 2020 2020 2020 2020 7365 6c66 2e5f 6368          self._ch
+000043d0: 696c 6472 656e 5f63 6163 6865 3a20 5369  ildren_cache: Si
+000043e0: 6d70 6c65 4361 6368 655b 0a20 2020 2020  mpleCache[.     
+000043f0: 2020 2020 2020 2054 7570 6c65 5b43 6f6e         Tuple[Con
+00004400: 7461 696e 6572 2c20 2e2e 2e5d 2c20 4c69  tainer, ...], Li
+00004410: 7374 5b43 6f6e 7461 696e 6572 5d0a 2020  st[Container].  
+00004420: 2020 2020 2020 5d20 3d20 5369 6d70 6c65        ] = Simple
+00004430: 4361 6368 6528 6d61 7873 697a 653d 3129  Cache(maxsize=1)
+00004440: 0a20 2020 2020 2020 2073 656c 662e 5f72  .        self._r
+00004450: 656d 6169 6e69 6e67 5f73 7061 6365 5f77  emaining_space_w
+00004460: 696e 646f 7720 3d20 5769 6e64 6f77 2829  indow = Window()
+00004470: 2020 2320 4475 6d6d 7920 7769 6e64 6f77    # Dummy window
+00004480: 2e0a 0a20 2020 2064 6566 2070 7265 6665  ...    def prefe
+00004490: 7272 6564 5f77 6964 7468 2873 656c 662c  rred_width(self,
+000044a0: 206d 6178 5f61 7661 696c 6162 6c65 5f77   max_available_w
+000044b0: 6964 7468 3a20 696e 7429 202d 3e20 4469  idth: int) -> Di
+000044c0: 6d65 6e73 696f 6e3a 0a20 2020 2020 2020  mension:.       
+000044d0: 2069 6620 7365 6c66 2e77 6964 7468 2069   if self.width i
+000044e0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+000044f0: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+00004500: 6f5f 6469 6d65 6e73 696f 6e28 7365 6c66  o_dimension(self
+00004510: 2e77 6964 7468 290a 0a20 2020 2020 2020  .width)..       
+00004520: 2064 696d 656e 7369 6f6e 7320 3d20 5b0a   dimensions = [.
+00004530: 2020 2020 2020 2020 2020 2020 632e 7072              c.pr
+00004540: 6566 6572 7265 645f 7769 6474 6828 6d61  eferred_width(ma
+00004550: 785f 6176 6169 6c61 626c 655f 7769 6474  x_available_widt
+00004560: 6829 2066 6f72 2063 2069 6e20 7365 6c66  h) for c in self
+00004570: 2e5f 616c 6c5f 6368 696c 6472 656e 0a20  ._all_children. 
+00004580: 2020 2020 2020 205d 0a0a 2020 2020 2020         ]..      
+00004590: 2020 7265 7475 726e 2073 756d 5f6c 6179    return sum_lay
+000045a0: 6f75 745f 6469 6d65 6e73 696f 6e73 2864  out_dimensions(d
+000045b0: 696d 656e 7369 6f6e 7329 0a0a 2020 2020  imensions)..    
+000045c0: 6465 6620 7072 6566 6572 7265 645f 6865  def preferred_he
+000045d0: 6967 6874 2873 656c 662c 2077 6964 7468  ight(self, width
+000045e0: 3a20 696e 742c 206d 6178 5f61 7661 696c  : int, max_avail
+000045f0: 6162 6c65 5f68 6569 6768 743a 2069 6e74  able_height: int
+00004600: 2920 2d3e 2044 696d 656e 7369 6f6e 3a0a  ) -> Dimension:.
+00004610: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00004620: 6865 6967 6874 2069 7320 6e6f 7420 4e6f  height is not No
+00004630: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00004640: 7265 7475 726e 2074 6f5f 6469 6d65 6e73  return to_dimens
+00004650: 696f 6e28 7365 6c66 2e68 6569 6768 7429  ion(self.height)
+00004660: 0a0a 2020 2020 2020 2020 2320 4174 2074  ..        # At t
+00004670: 6865 2070 6f69 6e74 2077 6865 7265 2077  he point where w
+00004680: 6520 7761 6e74 2074 6f20 6361 6c63 756c  e want to calcul
+00004690: 6174 6520 7468 6520 6865 6967 6874 732c  ate the heights,
+000046a0: 2074 6865 2077 6964 7468 7320 6861 7665   the widths have
+000046b0: 0a20 2020 2020 2020 2023 2061 6c72 6561  .        # alrea
+000046c0: 6479 2062 6565 6e20 6465 6369 6465 642e  dy been decided.
+000046d0: 2053 6f20 7765 2063 616e 2074 7275 7374   So we can trust
+000046e0: 2060 7769 6474 6860 2074 6f20 6265 2074   `width` to be t
+000046f0: 6865 2061 6374 7561 6c0a 2020 2020 2020  he actual.      
+00004700: 2020 2320 6077 6964 7468 6020 7468 6174    # `width` that
+00004710: 2773 2067 6f69 6e67 2074 6f20 6265 2075  's going to be u
+00004720: 7365 6420 666f 7220 7468 6520 7265 6e64  sed for the rend
+00004730: 6572 696e 672e 2053 6f2c 0a20 2020 2020  ering. So,.     
+00004740: 2020 2023 2060 6469 7669 6465 5f77 6964     # `divide_wid
+00004750: 7468 7360 2069 7320 7375 7070 6f73 6564  ths` is supposed
+00004760: 2074 6f20 7573 6520 616c 6c20 6f66 2074   to use all of t
+00004770: 6865 2061 7661 696c 6162 6c65 2077 6964  he available wid
+00004780: 7468 2e0a 2020 2020 2020 2020 2320 5573  th..        # Us
+00004790: 696e 6720 6f6e 6c79 2074 6865 2060 7072  ing only the `pr
+000047a0: 6566 6572 7265 6460 2077 6964 7468 2063  eferred` width c
+000047b0: 6175 7365 6420 6120 6275 6720 7768 6572  aused a bug wher
+000047c0: 6520 7468 6520 7265 706f 7274 6564 0a20  e the reported. 
+000047d0: 2020 2020 2020 2023 2068 6569 6768 7420         # height 
+000047e0: 7761 7320 6d6f 7265 2074 6861 6e20 7265  was more than re
+000047f0: 7175 6972 6564 2e20 2877 6520 6861 6420  quired. (we had 
+00004800: 6120 6042 7566 6665 7243 6f6e 7472 6f6c  a `BufferControl
+00004810: 6020 7768 6963 6820 6469 640a 2020 2020  ` which did.    
+00004820: 2020 2020 2320 7772 6170 206c 696e 6573      # wrap lines
+00004830: 2062 6563 6175 7365 206f 6620 7468 6520   because of the 
+00004840: 736d 616c 6c65 7220 7769 6474 6820 7265  smaller width re
+00004850: 7475 726e 6564 2062 7920 605f 6469 7669  turned by `_divi
+00004860: 6465 5f77 6964 7468 7360 2e0a 0a20 2020  de_widths`...   
+00004870: 2020 2020 2073 697a 6573 203d 2073 656c       sizes = sel
+00004880: 662e 5f64 6976 6964 655f 7769 6474 6873  f._divide_widths
+00004890: 2877 6964 7468 290a 2020 2020 2020 2020  (width).        
+000048a0: 7375 6273 6574 203d 2073 656c 662e 5f61  subset = self._a
+000048b0: 6c6c 5f63 6869 6c64 7265 6e0a 0a20 2020  ll_children..   
+000048c0: 2020 2020 2069 6620 7369 7a65 7320 6973       if sizes is
+000048d0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000048e0: 2020 2072 6574 7572 6e20 4469 6d65 6e73     return Dimens
+000048f0: 696f 6e28 290a 2020 2020 2020 2020 656c  ion().        el
+00004900: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00004910: 6469 6d65 6e73 696f 6e73 203d 205b 0a20  dimensions = [. 
+00004920: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00004930: 2e70 7265 6665 7272 6564 5f68 6569 6768  .preferred_heigh
+00004940: 7428 732c 206d 6178 5f61 7661 696c 6162  t(s, max_availab
+00004950: 6c65 5f68 6569 6768 7429 0a20 2020 2020  le_height).     
+00004960: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+00004970: 2c20 6320 696e 207a 6970 2873 697a 6573  , c in zip(sizes
+00004980: 2c20 7375 6273 6574 290a 2020 2020 2020  , subset).      
+00004990: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+000049a0: 2020 2020 7265 7475 726e 206d 6178 5f6c      return max_l
+000049b0: 6179 6f75 745f 6469 6d65 6e73 696f 6e73  ayout_dimensions
+000049c0: 2864 696d 656e 7369 6f6e 7329 0a0a 2020  (dimensions)..  
+000049d0: 2020 6465 6620 7265 7365 7428 7365 6c66    def reset(self
+000049e0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+000049f0: 2020 2066 6f72 2063 2069 6e20 7365 6c66     for c in self
+00004a00: 2e73 7562 7365 743a 0a20 2020 2020 2020  .subset:.       
+00004a10: 2020 2020 2063 2e72 6573 6574 2829 0a0a       c.reset()..
+00004a20: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+00004a30: 2020 6465 6620 5f61 6c6c 5f63 6869 6c64    def _all_child
+00004a40: 7265 6e28 7365 6c66 2920 2d3e 204c 6973  ren(self) -> Lis
+00004a50: 745b 436f 6e74 6169 6e65 725d 3a0a 2020  t[Container]:.  
+00004a60: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00004a70: 2020 4c69 7374 206f 6620 6368 696c 6420    List of child 
+00004a80: 6f62 6a65 6374 732c 2069 6e63 6c75 6469  objects, includi
+00004a90: 6e67 2070 6164 6469 6e67 2e0a 2020 2020  ng padding..    
+00004aa0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00004ab0: 2064 6566 2067 6574 2829 202d 3e20 4c69   def get() -> Li
+00004ac0: 7374 5b43 6f6e 7461 696e 6572 5d3a 0a20  st[Container]:. 
+00004ad0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00004ae0: 743a 204c 6973 745b 436f 6e74 6169 6e65  t: List[Containe
+00004af0: 725d 203d 205b 5d0a 0a20 2020 2020 2020  r] = []..       
+00004b00: 2020 2020 2023 2050 6164 6469 6e67 206c       # Padding l
+00004b10: 6566 742e 0a20 2020 2020 2020 2020 2020  eft..           
+00004b20: 2063 656e 7465 7220 3d20 486f 7269 7a6f   center = Horizo
+00004b30: 6e74 616c 416c 6967 6e2e 4345 4e54 4552  ntalAlign.CENTER
+00004b40: 0a20 2020 2020 2020 2020 2020 2072 6967  .            rig
+00004b50: 6874 203d 486f 7269 7a6f 6e74 616c 416c  ht =HorizontalAl
+00004b60: 6967 6e2e 5249 4748 540a 2020 2020 2020  ign.RIGHT.      
+00004b70: 2020 2020 2020 6966 2073 656c 662e 616c        if self.al
+00004b80: 6967 6e20 696e 2028 6365 6e74 6572 2c20  ign in (center, 
+00004b90: 7269 6768 7429 3a0a 2020 2020 2020 2020  right):.        
+00004ba0: 2020 2020 2020 2020 7265 7375 6c74 2e61          result.a
+00004bb0: 7070 656e 6428 5769 6e64 6f77 2877 6964  ppend(Window(wid
+00004bc0: 7468 3d44 696d 656e 7369 6f6e 2870 7265  th=Dimension(pre
+00004bd0: 6665 7272 6564 3d30 2929 290a 0a20 2020  ferred=0)))..   
+00004be0: 2020 2020 2020 2020 2023 2054 6865 2073           # The s
+00004bf0: 7562 7365 7473 2077 6974 6820 7061 6464  ubsets with padd
+00004c00: 696e 672e 0a20 2020 2020 2020 2020 2020  ing..           
+00004c10: 2066 6f72 2063 6869 6c64 2069 6e20 7365   for child in se
+00004c20: 6c66 2e73 7562 7365 743a 0a20 2020 2020  lf.subset:.     
+00004c30: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00004c40: 742e 6170 7065 6e64 2863 6869 6c64 290a  t.append(child).
+00004c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c60: 7265 7375 6c74 2e61 7070 656e 6428 0a20  result.append(. 
+00004c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c80: 2020 2057 696e 646f 7728 0a20 2020 2020     Window(.     
+00004c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ca0: 2020 2077 6964 7468 3d73 656c 662e 7061     width=self.pa
+00004cb0: 6464 696e 672c 0a20 2020 2020 2020 2020  dding,.         
+00004cc0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00004cd0: 6861 723d 7365 6c66 2e70 6164 6469 6e67  har=self.padding
+00004ce0: 5f63 6861 722c 0a20 2020 2020 2020 2020  _char,.         
+00004cf0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00004d00: 7479 6c65 3d73 656c 662e 7061 6464 696e  tyle=self.paddin
+00004d10: 675f 7374 796c 652c 0a20 2020 2020 2020  g_style,.       
+00004d20: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00004d30: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00004d40: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00004d50: 7265 7375 6c74 3a0a 2020 2020 2020 2020  result:.        
+00004d60: 2020 2020 2020 2020 7265 7375 6c74 2e70          result.p
+00004d70: 6f70 2829 0a0a 2020 2020 2020 2020 2020  op()..          
+00004d80: 2020 2320 5061 6464 696e 6720 7269 6768    # Padding righ
+00004d90: 742e 0a20 2020 2020 2020 2020 2020 2063  t..            c
+00004da0: 656e 7465 7220 3d20 486f 7269 7a6f 6e74  enter = Horizont
+00004db0: 616c 416c 6967 6e2e 4345 4e54 4552 0a20  alAlign.CENTER. 
+00004dc0: 2020 2020 2020 2020 2020 206c 6566 7420             left 
+00004dd0: 3d20 486f 7269 7a6f 6e74 616c 416c 6967  = HorizontalAlig
+00004de0: 6e2e 4c45 4654 0a20 2020 2020 2020 2020  n.LEFT.         
+00004df0: 2020 2069 6620 7365 6c66 2e61 6c69 676e     if self.align
+00004e00: 2069 6e20 2863 656e 7465 722c 206c 6566   in (center, lef
+00004e10: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+00004e20: 2020 2020 7265 7375 6c74 2e61 7070 656e      result.appen
+00004e30: 6428 5769 6e64 6f77 2877 6964 7468 3d44  d(Window(width=D
+00004e40: 696d 656e 7369 6f6e 2870 7265 6665 7272  imension(preferr
+00004e50: 6564 3d30 2929 290a 0a20 2020 2020 2020  ed=0)))..       
+00004e60: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
+00004e70: 6c74 0a0a 2020 2020 2020 2020 7265 7475  lt..        retu
+00004e80: 726e 2073 656c 662e 5f63 6869 6c64 7265  rn self._childre
+00004e90: 6e5f 6361 6368 652e 6765 7428 7475 706c  n_cache.get(tupl
+00004ea0: 6528 7365 6c66 2e73 7562 7365 7429 2c20  e(self.subset), 
+00004eb0: 6765 7429 0a0a 2020 2020 6465 6620 5f64  get)..    def _d
+00004ec0: 6976 6964 655f 7769 6474 6873 2873 656c  ivide_widths(sel
+00004ed0: 662c 2077 6964 7468 3a20 696e 7429 202d  f, width: int) -
+00004ee0: 3e20 4f70 7469 6f6e 616c 5b4c 6973 745b  > Optional[List[
+00004ef0: 696e 745d 5d3a 0a20 2020 2020 2020 2022  int]]:.        "
+00004f00: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
+00004f10: 6e20 7468 6520 7769 6474 6873 2066 6f72  n the widths for
+00004f20: 2061 6c6c 2063 6f6c 756d 6e73 2e0a 2020   all columns..  
+00004f30: 2020 2020 2020 4f72 204e 6f6e 6520 7768        Or None wh
+00004f40: 656e 2074 6865 7265 2069 7320 6e6f 7420  en there is not 
+00004f50: 656e 6f75 6768 2073 7061 6365 2e0a 2020  enough space..  
+00004f60: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00004f70: 2020 7375 6273 6574 203d 2073 656c 662e    subset = self.
+00004f80: 5f61 6c6c 5f63 6869 6c64 7265 6e0a 0a20  _all_children.. 
+00004f90: 2020 2020 2020 2069 6620 6e6f 7420 7375         if not su
+00004fa0: 6273 6574 3a0a 2020 2020 2020 2020 2020  bset:.          
+00004fb0: 2020 7265 7475 726e 205b 5d0a 0a20 2020    return []..   
+00004fc0: 2020 2020 2023 2043 616c 6375 6c61 7465       # Calculate
+00004fd0: 2077 6964 7468 732e 0a20 2020 2020 2020   widths..       
+00004fe0: 2064 696d 656e 7369 6f6e 7320 3d20 5b63   dimensions = [c
+00004ff0: 2e70 7265 6665 7272 6564 5f77 6964 7468  .preferred_width
+00005000: 2877 6964 7468 2920 666f 7220 6320 696e  (width) for c in
+00005010: 2073 7562 7365 745d 0a20 2020 2020 2020   subset].       
+00005020: 2070 7265 6665 7272 6564 5f64 696d 656e   preferred_dimen
+00005030: 7369 6f6e 7320 3d20 5b64 2e70 7265 6665  sions = [d.prefe
+00005040: 7272 6564 2066 6f72 2064 2069 6e20 6469  rred for d in di
+00005050: 6d65 6e73 696f 6e73 5d0a 0a20 2020 2020  mensions]..     
+00005060: 2020 2023 2053 756d 2064 696d 656e 7369     # Sum dimensi
+00005070: 6f6e 730a 2020 2020 2020 2020 7375 6d5f  ons.        sum_
+00005080: 6469 6d65 6e73 696f 6e73 203d 2073 756d  dimensions = sum
+00005090: 5f6c 6179 6f75 745f 6469 6d65 6e73 696f  _layout_dimensio
+000050a0: 6e73 2864 696d 656e 7369 6f6e 7329 0a0a  ns(dimensions)..
+000050b0: 2020 2020 2020 2020 2320 4966 2074 6865          # If the
+000050c0: 7265 2069 7320 6e6f 7420 656e 6f75 6768  re is not enough
+000050d0: 2073 7061 6365 2066 6f72 2062 6f74 682e   space for both.
+000050e0: 0a20 2020 2020 2020 2023 2044 6f6e 2774  .        # Don't
+000050f0: 2064 6f20 616e 7974 6869 6e67 2e0a 2020   do anything..  
+00005100: 2020 2020 2020 6966 2073 756d 5f64 696d        if sum_dim
+00005110: 656e 7369 6f6e 732e 6d69 6e20 3e20 7769  ensions.min > wi
+00005120: 6474 683a 0a20 2020 2020 2020 2020 2020  dth:.           
+00005130: 2072 6574 7572 6e20 4e6f 6e65 0a0a 2020   return None..  
+00005140: 2020 2020 2020 2320 4669 6e64 206f 7074        # Find opt
+00005150: 696d 616c 2073 697a 6573 2e20 2853 7461  imal sizes. (Sta
+00005160: 7274 2077 6974 6820 6d69 6e69 6d61 6c20  rt with minimal 
+00005170: 7369 7a65 2c20 696e 6372 6561 7365 2075  size, increase u
+00005180: 6e74 696c 2077 6520 636f 7665 720a 2020  ntil we cover.  
+00005190: 2020 2020 2020 2320 7468 6520 7768 6f6c        # the whol
+000051a0: 6520 7769 6474 682e 290a 2020 2020 2020  e width.).      
+000051b0: 2020 7369 7a65 7320 3d20 5b64 2e6d 696e    sizes = [d.min
+000051c0: 2066 6f72 2064 2069 6e20 6469 6d65 6e73   for d in dimens
+000051d0: 696f 6e73 5d0a 0a20 2020 2020 2020 2063  ions]..        c
+000051e0: 6869 6c64 5f67 656e 6572 6174 6f72 203d  hild_generator =
+000051f0: 2074 616b 655f 7573 696e 675f 7765 6967   take_using_weig
+00005200: 6874 7328 0a20 2020 2020 2020 2020 2020  hts(.           
+00005210: 2069 7465 6d73 3d6c 6973 7428 7261 6e67   items=list(rang
+00005220: 6528 6c65 6e28 6469 6d65 6e73 696f 6e73  e(len(dimensions
+00005230: 2929 292c 2077 6569 6768 7473 3d5b 642e  ))), weights=[d.
+00005240: 7765 6967 6874 2066 6f72 2064 2069 6e20  weight for d in 
+00005250: 6469 6d65 6e73 696f 6e73 5d0a 2020 2020  dimensions].    
+00005260: 2020 2020 290a 0a20 2020 2020 2020 2069      )..        i
+00005270: 203d 206e 6578 7428 6368 696c 645f 6765   = next(child_ge
+00005280: 6e65 7261 746f 7229 0a0a 2020 2020 2020  nerator)..      
+00005290: 2020 2320 496e 6372 6561 7365 2075 6e74    # Increase unt
+000052a0: 696c 2077 6520 6d65 6574 2061 7420 6c65  il we meet at le
+000052b0: 6173 7420 7468 6520 2770 7265 6665 7272  ast the 'preferr
+000052c0: 6564 2720 7369 7a65 2e0a 2020 2020 2020  ed' size..      
+000052d0: 2020 7072 6566 6572 7265 645f 7374 6f70    preferred_stop
+000052e0: 203d 206d 696e 2877 6964 7468 2c20 7375   = min(width, su
+000052f0: 6d5f 6469 6d65 6e73 696f 6e73 2e70 7265  m_dimensions.pre
+00005300: 6665 7272 6564 290a 0a20 2020 2020 2020  ferred)..       
+00005310: 2077 6869 6c65 2073 756d 2873 697a 6573   while sum(sizes
+00005320: 2920 3c20 7072 6566 6572 7265 645f 7374  ) < preferred_st
+00005330: 6f70 3a0a 2020 2020 2020 2020 2020 2020  op:.            
+00005340: 6966 2073 697a 6573 5b69 5d20 3c20 7072  if sizes[i] < pr
+00005350: 6566 6572 7265 645f 6469 6d65 6e73 696f  eferred_dimensio
+00005360: 6e73 5b69 5d3a 0a20 2020 2020 2020 2020  ns[i]:.         
+00005370: 2020 2020 2020 2073 697a 6573 5b69 5d20         sizes[i] 
+00005380: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+00005390: 2069 203d 206e 6578 7428 6368 696c 645f   i = next(child_
+000053a0: 6765 6e65 7261 746f 7229 0a0a 2020 2020  generator)..    
+000053b0: 2020 2020 2320 496e 6372 6561 7365 2075      # Increase u
+000053c0: 6e74 696c 2077 6520 7573 6520 616c 6c20  ntil we use all 
+000053d0: 7468 6520 6176 6169 6c61 626c 6520 7370  the available sp
+000053e0: 6163 652e 0a20 2020 2020 2020 206d 6178  ace..        max
+000053f0: 5f64 696d 656e 7369 6f6e 7320 3d20 5b64  _dimensions = [d
+00005400: 2e6d 6178 2066 6f72 2064 2069 6e20 6469  .max for d in di
+00005410: 6d65 6e73 696f 6e73 5d0a 2020 2020 2020  mensions].      
+00005420: 2020 6d61 785f 7374 6f70 203d 206d 696e    max_stop = min
+00005430: 2877 6964 7468 2c20 7375 6d5f 6469 6d65  (width, sum_dime
+00005440: 6e73 696f 6e73 2e6d 6178 290a 0a20 2020  nsions.max)..   
+00005450: 2020 2020 2077 6869 6c65 2073 756d 2873       while sum(s
+00005460: 697a 6573 2920 3c20 6d61 785f 7374 6f70  izes) < max_stop
+00005470: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00005480: 2073 697a 6573 5b69 5d20 3c20 6d61 785f   sizes[i] < max_
+00005490: 6469 6d65 6e73 696f 6e73 5b69 5d3a 0a20  dimensions[i]:. 
+000054a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000054b0: 697a 6573 5b69 5d20 2b3d 2031 0a20 2020  izes[i] += 1.   
+000054c0: 2020 2020 2020 2020 2069 203d 206e 6578           i = nex
+000054d0: 7428 6368 696c 645f 6765 6e65 7261 746f  t(child_generato
+000054e0: 7229 0a0a 2020 2020 2020 2020 7265 7475  r)..        retu
+000054f0: 726e 2073 697a 6573 0a0a 2020 2020 6465  rn sizes..    de
+00005500: 6620 7772 6974 655f 746f 5f73 6372 6565  f write_to_scree
+00005510: 6e28 0a20 2020 2020 2020 2073 656c 662c  n(.        self,
+00005520: 0a20 2020 2020 2020 2073 6372 6565 6e3a  .        screen:
+00005530: 2053 6372 6565 6e2c 0a20 2020 2020 2020   Screen,.       
+00005540: 206d 6f75 7365 5f68 616e 646c 6572 733a   mouse_handlers:
+00005550: 204d 6f75 7365 4861 6e64 6c65 7273 2c0a   MouseHandlers,.
+00005560: 2020 2020 2020 2020 7772 6974 655f 706f          write_po
+00005570: 7369 7469 6f6e 3a20 5772 6974 6550 6f73  sition: WritePos
+00005580: 6974 696f 6e2c 0a20 2020 2020 2020 2070  ition,.        p
+00005590: 6172 656e 745f 7374 796c 653a 2073 7472  arent_style: str
+000055a0: 2c0a 2020 2020 2020 2020 6572 6173 655f  ,.        erase_
+000055b0: 6267 3a20 626f 6f6c 2c0a 2020 2020 2020  bg: bool,.      
+000055c0: 2020 7a5f 696e 6465 783a 204f 7074 696f    z_index: Optio
+000055d0: 6e61 6c5b 696e 745d 2c0a 2020 2020 2920  nal[int],.    ) 
+000055e0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+000055f0: 2022 2222 0a20 2020 2020 2020 2052 656e   """.        Ren
+00005600: 6465 7220 7468 6520 7072 6f6d 7074 2074  der the prompt t
+00005610: 6f20 6120 6053 6372 6565 6e60 2069 6e73  o a `Screen` ins
+00005620: 7461 6e63 652e 0a0a 2020 2020 2020 2020  tance...        
+00005630: 3a70 6172 616d 2073 6372 6565 6e3a 2054  :param screen: T
+00005640: 6865 203a 636c 6173 733a 607e 7175 6f2e  he :class:`~quo.
+00005650: 6c61 796f 7574 2e73 6372 6565 6e2e 5363  layout.screen.Sc
+00005660: 7265 656e 6020 636c 6173 730a 2020 2020  reen` class.    
+00005670: 2020 2020 2020 2020 746f 2077 6869 6368          to which
+00005680: 2074 6865 206f 7574 7075 7420 6861 7320   the output has 
+00005690: 746f 2062 6520 7772 6974 7465 6e2e 0a20  to be written.. 
+000056a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000056b0: 2020 2069 6620 6e6f 7420 7365 6c66 2e73     if not self.s
+000056c0: 7562 7365 743a 0a20 2020 2020 2020 2020  ubset:.         
+000056d0: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
+000056e0: 2020 2073 7562 7365 7420 3d20 7365 6c66     subset = self
+000056f0: 2e5f 616c 6c5f 6368 696c 6472 656e 0a20  ._all_children. 
+00005700: 2020 2020 2020 2073 697a 6573 203d 2073         sizes = s
+00005710: 656c 662e 5f64 6976 6964 655f 7769 6474  elf._divide_widt
+00005720: 6873 2877 7269 7465 5f70 6f73 6974 696f  hs(write_positio
+00005730: 6e2e 7769 6474 6829 0a20 2020 2020 2020  n.width).       
+00005740: 2073 7479 6c65 203d 2070 6172 656e 745f   style = parent_
+00005750: 7374 796c 6520 2b20 2220 2220 2b20 746f  style + " " + to
+00005760: 5f73 7472 2873 656c 662e 7374 796c 6529  _str(self.style)
+00005770: 0a20 2020 2020 2020 207a 5f69 6e64 6578  .        z_index
+00005780: 203d 207a 5f69 6e64 6578 2069 6620 7365   = z_index if se
+00005790: 6c66 2e7a 5f69 6e64 6578 2069 7320 4e6f  lf.z_index is No
+000057a0: 6e65 2065 6c73 6520 7365 6c66 2e7a 5f69  ne else self.z_i
+000057b0: 6e64 6578 0a0a 2020 2020 2020 2020 2320  ndex..        # 
+000057c0: 4966 2074 6865 7265 2069 7320 6e6f 7420  If there is not 
+000057d0: 656e 6f75 6768 2073 7061 6365 2e0a 2020  enough space..  
+000057e0: 2020 2020 2020 6966 2073 697a 6573 2069        if sizes i
+000057f0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00005800: 2020 2020 7365 6c66 2e77 696e 646f 775f      self.window_
+00005810: 746f 6f5f 736d 616c 6c2e 7772 6974 655f  too_small.write_
+00005820: 746f 5f73 6372 6565 6e28 0a20 2020 2020  to_screen(.     
+00005830: 2020 2020 2020 2020 2020 2073 6372 6565             scree
+00005840: 6e2c 206d 6f75 7365 5f68 616e 646c 6572  n, mouse_handler
+00005850: 732c 2077 7269 7465 5f70 6f73 6974 696f  s, write_positio
+00005860: 6e2c 2073 7479 6c65 2c20 6572 6173 655f  n, style, erase_
+00005870: 6267 2c20 7a5f 696e 6465 780a 2020 2020  bg, z_index.    
+00005880: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00005890: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+000058a0: 2020 2020 2020 2320 4361 6c63 756c 6174        # Calculat
+000058b0: 6520 6865 6967 6874 732c 2074 616b 6520  e heights, take 
+000058c0: 7468 6520 6c61 7267 6573 7420 706f 7373  the largest poss
+000058d0: 6962 6c65 2c20 6275 7420 6e6f 7420 6c61  ible, but not la
+000058e0: 7267 6572 2074 6861 6e0a 2020 2020 2020  rger than.      
+000058f0: 2020 2320 7772 6974 655f 706f 7369 7469    # write_positi
+00005900: 6f6e 2e68 6569 6768 742e 0a20 2020 2020  on.height..     
+00005910: 2020 2068 6569 6768 7473 203d 205b 0a20     heights = [. 
+00005920: 2020 2020 2020 2020 2020 2063 6869 6c64             child
+00005930: 2e70 7265 6665 7272 6564 5f68 6569 6768  .preferred_heigh
+00005940: 7428 7769 6474 682c 2077 7269 7465 5f70  t(width, write_p
+00005950: 6f73 6974 696f 6e2e 6865 6967 6874 292e  osition.height).
+00005960: 7072 6566 6572 7265 640a 2020 2020 2020  preferred.      
+00005970: 2020 2020 2020 666f 7220 7769 6474 682c        for width,
+00005980: 2063 6869 6c64 2069 6e20 7a69 7028 7369   child in zip(si
+00005990: 7a65 732c 2073 7562 7365 7429 0a20 2020  zes, subset).   
+000059a0: 2020 2020 205d 0a20 2020 2020 2020 2068       ].        h
+000059b0: 6569 6768 7420 3d20 6d61 7828 7772 6974  eight = max(writ
+000059c0: 655f 706f 7369 7469 6f6e 2e68 6569 6768  e_position.heigh
+000059d0: 742c 206d 696e 2877 7269 7465 5f70 6f73  t, min(write_pos
+000059e0: 6974 696f 6e2e 6865 6967 6874 2c20 6d61  ition.height, ma
+000059f0: 7828 6865 6967 6874 7329 2929 0a0a 2020  x(heights)))..  
+00005a00: 2020 2020 2020 230a 2020 2020 2020 2020        #.        
+00005a10: 7970 6f73 203d 2077 7269 7465 5f70 6f73  ypos = write_pos
+00005a20: 6974 696f 6e2e 7970 6f73 0a20 2020 2020  ition.ypos.     
+00005a30: 2020 2078 706f 7320 3d20 7772 6974 655f     xpos = write_
+00005a40: 706f 7369 7469 6f6e 2e78 706f 730a 0a20  position.xpos.. 
+00005a50: 2020 2020 2020 2023 2044 7261 7720 616c         # Draw al
+00005a60: 6c20 6368 696c 6420 7061 6e65 732e 0a20  l child panes.. 
+00005a70: 2020 2020 2020 2066 6f72 2073 2c20 6320         for s, c 
+00005a80: 696e 207a 6970 2873 697a 6573 2c20 7375  in zip(sizes, su
+00005a90: 6273 6574 293a 0a20 2020 2020 2020 2020  bset):.         
+00005aa0: 2020 2063 2e77 7269 7465 5f74 6f5f 7363     c.write_to_sc
+00005ab0: 7265 656e 280a 2020 2020 2020 2020 2020  reen(.          
+00005ac0: 2020 2020 2020 7363 7265 656e 2c0a 2020        screen,.  
+00005ad0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
+00005ae0: 7573 655f 6861 6e64 6c65 7273 2c0a 2020  use_handlers,.  
+00005af0: 2020 2020 2020 2020 2020 2020 2020 5772                Wr
+00005b00: 6974 6550 6f73 6974 696f 6e28 7870 6f73  itePosition(xpos
+00005b10: 2c20 7970 6f73 2c20 732c 2068 6569 6768  , ypos, s, heigh
+00005b20: 7429 2c0a 2020 2020 2020 2020 2020 2020  t),.            
+00005b30: 2020 2020 7374 796c 652c 0a20 2020 2020      style,.     
+00005b40: 2020 2020 2020 2020 2020 2065 7261 7365             erase
+00005b50: 5f62 672c 0a20 2020 2020 2020 2020 2020  _bg,.           
+00005b60: 2020 2020 207a 5f69 6e64 6578 2c0a 2020       z_index,.  
+00005b70: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00005b80: 2020 2020 2020 2020 7870 6f73 202b 3d20          xpos += 
+00005b90: 730a 0a20 2020 2020 2020 2023 2046 696c  s..        # Fil
+00005ba0: 6c20 696e 2074 6865 2072 656d 6169 6e69  l in the remaini
+00005bb0: 6e67 2073 7061 6365 2e20 5468 6973 2068  ng space. This h
+00005bc0: 6170 7065 6e73 2077 6865 6e20 6120 6368  appens when a ch
+00005bd0: 696c 6420 636f 6e74 726f 6c0a 2020 2020  ild control.    
+00005be0: 2020 2020 2320 7265 6675 7365 7320 746f      # refuses to
+00005bf0: 2074 616b 6520 6d6f 7265 2073 7061 6365   take more space
+00005c00: 2061 6e64 2077 6520 646f 6e27 7420 6861   and we don't ha
+00005c10: 7665 2061 6e79 2070 6164 6469 6e67 2e20  ve any padding. 
+00005c20: 4164 6469 6e67 2061 0a20 2020 2020 2020  Adding a.       
+00005c30: 2023 2064 756d 6d79 2063 6869 6c64 2063   # dummy child c
+00005c40: 6f6e 7472 6f6c 2066 6f72 2074 6869 7320  ontrol for this 
+00005c50: 2869 6e20 6073 656c 662e 5f61 6c6c 5f63  (in `self._all_c
+00005c60: 6869 6c64 7265 6e60 2920 6973 206e 6f74  hildren`) is not
+00005c70: 0a20 2020 2020 2020 2023 2064 6573 6972  .        # desir
+00005c80: 6564 2c20 6265 6361 7573 6520 696e 2073  ed, because in s
+00005c90: 6f6d 6520 7369 7475 6174 696f 6e73 2c20  ome situations, 
+00005ca0: 6974 2077 6f75 6c64 2074 616b 6520 6d6f  it would take mo
+00005cb0: 7265 2073 7061 6365 2c20 6576 656e 0a20  re space, even. 
+00005cc0: 2020 2020 2020 2023 2077 6865 6e20 6974         # when it
+00005cd0: 2773 206e 6f74 2072 6571 7569 7265 642e  's not required.
+00005ce0: 2054 6869 7320 6973 2072 6571 7569 7265   This is require
+00005cf0: 6420 746f 2061 7070 6c79 2074 6865 2073  d to apply the s
+00005d00: 7479 6c69 6e67 2e0a 2020 2020 2020 2020  tyling..        
+00005d10: 7265 6d61 696e 696e 675f 7769 6474 6820  remaining_width 
+00005d20: 3d20 7772 6974 655f 706f 7369 7469 6f6e  = write_position
+00005d30: 2e78 706f 7320 2b20 7772 6974 655f 706f  .xpos + write_po
+00005d40: 7369 7469 6f6e 2e77 6964 7468 202d 2078  sition.width - x
+00005d50: 706f 730a 2020 2020 2020 2020 6966 2072  pos.        if r
+00005d60: 656d 6169 6e69 6e67 5f77 6964 7468 203e  emaining_width >
+00005d70: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00005d80: 7365 6c66 2e5f 7265 6d61 696e 696e 675f  self._remaining_
+00005d90: 7370 6163 655f 7769 6e64 6f77 2e77 7269  space_window.wri
+00005da0: 7465 5f74 6f5f 7363 7265 656e 280a 2020  te_to_screen(.  
+00005db0: 2020 2020 2020 2020 2020 2020 2020 7363                sc
+00005dc0: 7265 656e 2c0a 2020 2020 2020 2020 2020  reen,.          
+00005dd0: 2020 2020 2020 6d6f 7573 655f 6861 6e64        mouse_hand
+00005de0: 6c65 7273 2c0a 2020 2020 2020 2020 2020  lers,.          
+00005df0: 2020 2020 2020 5772 6974 6550 6f73 6974        WritePosit
+00005e00: 696f 6e28 7870 6f73 2c20 7970 6f73 2c20  ion(xpos, ypos, 
+00005e10: 7265 6d61 696e 696e 675f 7769 6474 682c  remaining_width,
+00005e20: 2068 6569 6768 7429 2c0a 2020 2020 2020   height),.      
+00005e30: 2020 2020 2020 2020 2020 7374 796c 652c            style,
+00005e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005e50: 2065 7261 7365 5f62 672c 0a20 2020 2020   erase_bg,.     
+00005e60: 2020 2020 2020 2020 2020 207a 5f69 6e64             z_ind
+00005e70: 6578 2c0a 2020 2020 2020 2020 2020 2020  ex,.            
+00005e80: 290a 0a0a 636c 6173 7320 466c 6f61 7443  )...class FloatC
+00005e90: 6f6e 7461 696e 6572 2843 6f6e 7461 696e  ontainer(Contain
+00005ea0: 6572 293a 0a20 2020 2022 2222 0a20 2020  er):.    """.   
+00005eb0: 2043 6f6e 7461 696e 6572 2077 6869 6368   Container which
+00005ec0: 2063 616e 2063 6f6e 7461 696e 2061 6e6f   can contain ano
+00005ed0: 7468 6572 2063 6f6e 7461 696e 6572 2066  ther container f
+00005ee0: 6f72 2074 6865 2062 6163 6b67 726f 756e  or the backgroun
+00005ef0: 642c 2061 7320 7765 6c6c 0a20 2020 2061  d, as well.    a
+00005f00: 7320 6120 6c69 7374 206f 6620 666c 6f61  s a list of floa
+00005f10: 7469 6e67 2063 6f6e 7461 696e 6572 7320  ting containers 
+00005f20: 6f6e 2074 6f70 206f 6620 6974 2e0a 0a20  on top of it... 
+00005f30: 2020 2045 7861 6d70 6c65 2055 7361 6765     Example Usage
+00005f40: 3a3a 0a0a 2020 2020 2020 2020 466c 6f61  ::..        Floa
+00005f50: 7443 6f6e 7461 696e 6572 2863 6f6e 7465  tContainer(conte
+00005f60: 6e74 3d57 696e 646f 7728 2e2e 2e29 2c0a  nt=Window(...),.
+00005f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f80: 2020 2020 2020 2066 6c6f 6174 733d 5b0a         floats=[.
+00005f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005fa0: 2020 2020 2020 2020 2020 2046 6c6f 6174             Float
+00005fb0: 2878 6375 7273 6f72 3d54 7275 652c 0a20  (xcursor=True,. 
+00005fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005fd0: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+00005fe0: 6375 7273 6f72 3d54 7275 652c 0a20 2020  cursor=True,.   
+00005ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006000: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00006010: 7465 6e74 3d43 6f6d 706c 6574 696f 6e73  tent=Completions
+00006020: 4d65 6e75 282e 2e2e 2929 0a20 2020 2020  Menu(...)).     
 00006030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006040: 7963 7572 736f 723d 5472 7565 2c0a 2020  ycursor=True,.  
-00006050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006060: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00006070: 6e74 656e 743d 436f 6d70 6c65 7469 6f6e  ntent=Completion
-00006080: 734d 656e 7528 2e2e 2e29 290a 2020 2020  sMenu(...)).    
-00006090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000060a0: 2020 205d 290a 0a20 2020 203a 7061 7261     ])..    :para
-000060b0: 6d20 7a5f 696e 6465 783a 2028 696e 7420  m z_index: (int 
-000060c0: 6f72 204e 6f6e 6529 2057 6865 6e20 7370  or None) When sp
-000060d0: 6563 6966 6965 642c 2074 6869 7320 6361  ecified, this ca
-000060e0: 6e20 6265 2075 7365 6420 746f 2062 7269  n be used to bri
-000060f0: 6e67 0a20 2020 2020 2020 2065 6c65 6d65  ng.        eleme
-00006100: 6e74 2069 6e20 6672 6f6e 7420 6f66 2066  nt in front of f
-00006110: 6c6f 6174 696e 6720 656c 656d 656e 7473  loating elements
-00006120: 2e20 2060 4e6f 6e65 6020 6d65 616e 733a  .  `None` means:
-00006130: 2069 6e68 6572 6974 2066 726f 6d20 7061   inherit from pa
-00006140: 7265 6e74 2e0a 2020 2020 2020 2020 5468  rent..        Th
-00006150: 6973 2069 7320 7468 6520 7a5f 696e 6465  is is the z_inde
-00006160: 7820 666f 7220 7468 6520 7768 6f6c 6520  x for the whole 
-00006170: 6046 6c6f 6174 6020 636f 6e74 6169 6e65  `Float` containe
-00006180: 7220 6173 2061 2077 686f 6c65 2e0a 2020  r as a whole..  
-00006190: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
-000061a0: 5f69 6e69 745f 5f28 0a20 2020 2020 2020  _init__(.       
-000061b0: 2073 656c 662c 0a20 2020 2020 2020 2063   self,.        c
-000061c0: 6f6e 7465 6e74 3a20 416e 7943 6f6e 7461  ontent: AnyConta
-000061d0: 696e 6572 2c0a 2020 2020 2020 2020 666c  iner,.        fl
-000061e0: 6f61 7473 3a20 4c69 7374 5b22 466c 6f61  oats: List["Floa
-000061f0: 7422 5d2c 0a20 2020 2020 2020 206d 6f64  t"],.        mod
-00006200: 616c 3a20 626f 6f6c 203d 2046 616c 7365  al: bool = False
-00006210: 2c0a 2020 2020 2020 2020 6269 6e64 3a20  ,.        bind: 
-00006220: 4f70 7469 6f6e 616c 5b4b 6579 4269 6e64  Optional[KeyBind
-00006230: 696e 6773 4261 7365 5d20 3d20 4e6f 6e65  ingsBase] = None
-00006240: 2c0a 2020 2020 2020 2020 7374 796c 653a  ,.        style:
-00006250: 2055 6e69 6f6e 5b73 7472 2c20 4361 6c6c   Union[str, Call
-00006260: 6162 6c65 5b5b 5d2c 2073 7472 5d5d 203d  able[[], str]] =
-00006270: 2022 222c 0a20 2020 2020 2020 207a 5f69   "",.        z_i
-00006280: 6e64 6578 3a20 4f70 7469 6f6e 616c 5b69  ndex: Optional[i
-00006290: 6e74 5d20 3d20 4e6f 6e65 2c0a 2020 2020  nt] = None,.    
-000062a0: 2920 2d3e 204e 6f6e 653a 0a0a 2020 2020  ) -> None:..    
-000062b0: 2020 2020 7365 6c66 2e63 6f6e 7465 6e74      self.content
-000062c0: 203d 2074 6f5f 636f 6e74 6169 6e65 7228   = to_container(
-000062d0: 636f 6e74 656e 7429 0a20 2020 2020 2020  content).       
-000062e0: 2073 656c 662e 666c 6f61 7473 203d 2066   self.floats = f
-000062f0: 6c6f 6174 730a 0a20 2020 2020 2020 2073  loats..        s
-00006300: 656c 662e 6d6f 6461 6c20 3d20 6d6f 6461  elf.modal = moda
-00006310: 6c0a 2020 2020 2020 2020 7365 6c66 2e62  l.        self.b
-00006320: 696e 6420 3d20 6269 6e64 0a20 2020 2020  ind = bind.     
-00006330: 2020 2073 656c 662e 7374 796c 6520 3d20     self.style = 
-00006340: 7374 796c 650a 2020 2020 2020 2020 7365  style.        se
-00006350: 6c66 2e7a 5f69 6e64 6578 203d 207a 5f69  lf.z_index = z_i
-00006360: 6e64 6578 0a0a 2020 2020 6465 6620 7265  ndex..    def re
-00006370: 7365 7428 7365 6c66 2920 2d3e 204e 6f6e  set(self) -> Non
-00006380: 653a 0a20 2020 2020 2020 2073 656c 662e  e:.        self.
-00006390: 636f 6e74 656e 742e 7265 7365 7428 290a  content.reset().
-000063a0: 0a20 2020 2020 2020 2066 6f72 2066 2069  .        for f i
-000063b0: 6e20 7365 6c66 2e66 6c6f 6174 733a 0a20  n self.floats:. 
-000063c0: 2020 2020 2020 2020 2020 2066 2e63 6f6e             f.con
-000063d0: 7465 6e74 2e72 6573 6574 2829 0a0a 2020  tent.reset()..  
-000063e0: 2020 6465 6620 7072 6566 6572 7265 645f    def preferred_
-000063f0: 7769 6474 6828 7365 6c66 2c20 6d61 785f  width(self, max_
-00006400: 6176 6169 6c61 626c 655f 7769 6474 683a  available_width:
-00006410: 2069 6e74 2920 2d3e 2044 696d 656e 7369   int) -> Dimensi
-00006420: 6f6e 3a0a 2020 2020 2020 2020 7265 7475  on:.        retu
-00006430: 726e 2073 656c 662e 636f 6e74 656e 742e  rn self.content.
-00006440: 7072 6566 6572 7265 645f 7769 6474 6828  preferred_width(
-00006450: 6d61 785f 6176 6169 6c61 626c 655f 7769  max_available_wi
-00006460: 6474 6829 0a0a 2020 2020 6465 6620 7072  dth)..    def pr
-00006470: 6566 6572 7265 645f 6865 6967 6874 2873  eferred_height(s
-00006480: 656c 662c 2077 6964 7468 3a20 696e 742c  elf, width: int,
-00006490: 206d 6178 5f61 7661 696c 6162 6c65 5f68   max_available_h
-000064a0: 6569 6768 743a 2069 6e74 2920 2d3e 2044  eight: int) -> D
-000064b0: 696d 656e 7369 6f6e 3a0a 2020 2020 2020  imension:.      
-000064c0: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-000064d0: 7475 726e 2074 6865 2070 7265 6665 7272  turn the preferr
-000064e0: 6564 2068 6569 6768 7420 6f66 2074 6865  ed height of the
-000064f0: 2066 6c6f 6174 2063 6f6e 7461 696e 6572   float container
-00006500: 2e0a 2020 2020 2020 2020 2857 6520 646f  ..        (We do
-00006510: 6e27 7420 6361 7265 2061 626f 7574 2074  n't care about t
-00006520: 6865 2068 6569 6768 7420 6f66 2074 6865  he height of the
-00006530: 2066 6c6f 6174 732c 2074 6865 7920 7368   floats, they sh
-00006540: 6f75 6c64 2061 6c77 6179 7320 6669 740a  ould always fit.
-00006550: 2020 2020 2020 2020 696e 746f 2074 6865          into the
-00006560: 2064 696d 656e 7369 6f6e 7320 7072 6f76   dimensions prov
-00006570: 6964 6564 2062 7920 7468 6520 636f 6e74  ided by the cont
-00006580: 6169 6e65 722e 290a 2020 2020 2020 2020  ainer.).        
-00006590: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-000065a0: 726e 2073 656c 662e 636f 6e74 656e 742e  rn self.content.
-000065b0: 7072 6566 6572 7265 645f 6865 6967 6874  preferred_height
-000065c0: 2877 6964 7468 2c20 6d61 785f 6176 6169  (width, max_avai
-000065d0: 6c61 626c 655f 6865 6967 6874 290a 0a20  lable_height).. 
-000065e0: 2020 2064 6566 2077 7269 7465 5f74 6f5f     def write_to_
-000065f0: 7363 7265 656e 280a 2020 2020 2020 2020  screen(.        
-00006600: 7365 6c66 2c0a 2020 2020 2020 2020 7363  self,.        sc
-00006610: 7265 656e 3a20 5363 7265 656e 2c0a 2020  reen: Screen,.  
-00006620: 2020 2020 2020 6d6f 7573 655f 6861 6e64        mouse_hand
-00006630: 6c65 7273 3a20 4d6f 7573 6548 616e 646c  lers: MouseHandl
-00006640: 6572 732c 0a20 2020 2020 2020 2077 7269  ers,.        wri
-00006650: 7465 5f70 6f73 6974 696f 6e3a 2057 7269  te_position: Wri
-00006660: 7465 506f 7369 7469 6f6e 2c0a 2020 2020  tePosition,.    
-00006670: 2020 2020 7061 7265 6e74 5f73 7479 6c65      parent_style
-00006680: 3a20 7374 722c 0a20 2020 2020 2020 2065  : str,.        e
-00006690: 7261 7365 5f62 673a 2062 6f6f 6c2c 0a20  rase_bg: bool,. 
-000066a0: 2020 2020 2020 207a 5f69 6e64 6578 3a20         z_index: 
-000066b0: 4f70 7469 6f6e 616c 5b69 6e74 5d2c 0a20  Optional[int],. 
-000066c0: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
-000066d0: 2020 2020 2020 7374 796c 6520 3d20 7061        style = pa
-000066e0: 7265 6e74 5f73 7479 6c65 202b 2022 2022  rent_style + " "
-000066f0: 202b 2074 6f5f 7374 7228 7365 6c66 2e73   + to_str(self.s
-00006700: 7479 6c65 290a 2020 2020 2020 2020 7a5f  tyle).        z_
-00006710: 696e 6465 7820 3d20 7a5f 696e 6465 7820  index = z_index 
-00006720: 6966 2073 656c 662e 7a5f 696e 6465 7820  if self.z_index 
-00006730: 6973 204e 6f6e 6520 656c 7365 2073 656c  is None else sel
-00006740: 662e 7a5f 696e 6465 780a 0a20 2020 2020  f.z_index..     
-00006750: 2020 2073 656c 662e 636f 6e74 656e 742e     self.content.
-00006760: 7772 6974 655f 746f 5f73 6372 6565 6e28  write_to_screen(
-00006770: 0a20 2020 2020 2020 2020 2020 2073 6372  .            scr
-00006780: 6565 6e2c 206d 6f75 7365 5f68 616e 646c  een, mouse_handl
-00006790: 6572 732c 2077 7269 7465 5f70 6f73 6974  ers, write_posit
-000067a0: 696f 6e2c 2073 7479 6c65 2c20 6572 6173  ion, style, eras
-000067b0: 655f 6267 2c20 7a5f 696e 6465 780a 2020  e_bg, z_index.  
-000067c0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-000067d0: 2066 6f72 206e 756d 6265 722c 2066 6c20   for number, fl 
-000067e0: 696e 2065 6e75 6d65 7261 7465 2873 656c  in enumerate(sel
-000067f0: 662e 666c 6f61 7473 293a 0a20 2020 2020  f.floats):.     
-00006800: 2020 2020 2020 2023 207a 5f69 6e64 6578         # z_index
-00006810: 206f 6620 6120 466c 6f61 7420 6973 2063   of a Float is c
-00006820: 6f6d 7075 7465 6420 6279 2073 756d 6d69  omputed by summi
-00006830: 6e67 2074 6865 207a 5f69 6e64 6578 206f  ng the z_index o
-00006840: 6620 7468 650a 2020 2020 2020 2020 2020  f the.          
-00006850: 2020 2320 636f 6e74 6169 6e65 7220 616e    # container an
-00006860: 6420 7468 6520 6046 6c6f 6174 602e 0a20  d the `Float`.. 
-00006870: 2020 2020 2020 2020 2020 206e 6577 5f7a             new_z
-00006880: 5f69 6e64 6578 203d 2028 7a5f 696e 6465  _index = (z_inde
-00006890: 7820 6f72 2030 2920 2b20 666c 2e7a 5f69  x or 0) + fl.z_i
-000068a0: 6e64 6578 0a20 2020 2020 2020 2020 2020  ndex.           
-000068b0: 2073 7479 6c65 203d 2070 6172 656e 745f   style = parent_
-000068c0: 7374 796c 6520 2b20 2220 2220 2b20 746f  style + " " + to
-000068d0: 5f73 7472 2873 656c 662e 7374 796c 6529  _str(self.style)
-000068e0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-000068f0: 4966 2074 6865 2066 6c6f 6174 2074 6861  If the float tha
-00006900: 7420 7765 2068 6176 6520 6865 7265 2c20  t we have here, 
-00006910: 6973 2070 6f73 6974 696f 6e65 6420 7265  is positioned re
-00006920: 6c61 7469 7665 2074 6f20 7468 650a 2020  lative to the.  
-00006930: 2020 2020 2020 2020 2020 2320 6375 7273            # curs
-00006940: 6f72 2070 6f73 6974 696f 6e2c 2062 7574  or position, but
-00006950: 2074 6865 2057 696e 646f 7720 7468 6174   the Window that
-00006960: 2073 7065 6369 6669 6573 2074 6865 2063   specifies the c
-00006970: 7572 736f 720a 2020 2020 2020 2020 2020  ursor.          
-00006980: 2020 2320 706f 7369 7469 6f6e 2069 7320    # position is 
-00006990: 6e6f 7420 6472 6177 6e20 7965 742c 2062  not drawn yet, b
-000069a0: 6563 6175 7365 2069 7427 7320 6120 466c  ecause it's a Fl
-000069b0: 6f61 7420 6974 7365 6c66 2c20 7765 2068  oat itself, we h
-000069c0: 6176 650a 2020 2020 2020 2020 2020 2020  ave.            
-000069d0: 2320 746f 2070 6f73 7470 6f6e 6520 7468  # to postpone th
-000069e0: 6973 2063 616c 6375 6c61 7469 6f6e 2e20  is calculation. 
-000069f0: 2854 6869 7320 6973 2061 2077 6f72 6b2d  (This is a work-
-00006a00: 6172 6f75 6e64 2c20 6275 7420 676f 6f64  around, but good
-00006a10: 0a20 2020 2020 2020 2020 2020 2023 2065  .            # e
-00006a20: 6e6f 7567 6820 666f 7220 6e6f 772e 290a  nough for now.).
-00006a30: 2020 2020 2020 2020 2020 2020 706f 7374              post
-00006a40: 706f 6e65 203d 2066 6c2e 7863 7572 736f  pone = fl.xcurso
-00006a50: 7220 6973 206e 6f74 204e 6f6e 6520 6f72  r is not None or
-00006a60: 2066 6c2e 7963 7572 736f 7220 6973 206e   fl.ycursor is n
-00006a70: 6f74 204e 6f6e 650a 0a20 2020 2020 2020  ot None..       
-00006a80: 2020 2020 2069 6620 706f 7374 706f 6e65       if postpone
-00006a90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00006aa0: 2020 6e65 775f 7a5f 696e 6465 7820 3d20    new_z_index = 
-00006ab0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00006ac0: 2020 2020 2020 6e75 6d62 6572 202b 2031        number + 1
-00006ad0: 3020 2a2a 2038 0a20 2020 2020 2020 2020  0 ** 8.         
-00006ae0: 2020 2020 2020 2029 2020 2320 4472 6177         )  # Draw
-00006af0: 2061 7320 6c61 7465 2061 7320 706f 7373   as late as poss
-00006b00: 6962 6c65 2c20 6275 7420 6b65 6570 2074  ible, but keep t
-00006b10: 6865 206f 7264 6572 2e0a 2020 2020 2020  he order..      
-00006b20: 2020 2020 2020 2020 2020 7363 7265 656e            screen
-00006b30: 2e64 7261 775f 7769 7468 5f7a 5f69 6e64  .draw_with_z_ind
-00006b40: 6578 280a 2020 2020 2020 2020 2020 2020  ex(.            
-00006b50: 2020 2020 2020 2020 7a5f 696e 6465 783d          z_index=
-00006b60: 6e65 775f 7a5f 696e 6465 782c 0a20 2020  new_z_index,.   
-00006b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006b80: 2064 7261 775f 6675 6e63 3d70 6172 7469   draw_func=parti
-00006b90: 616c 280a 2020 2020 2020 2020 2020 2020  al(.            
-00006ba0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006bb0: 2e5f 6472 6177 5f66 6c6f 6174 2c0a 2020  ._draw_float,.  
-00006bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006bd0: 2020 2020 2020 666c 2c0a 2020 2020 2020        fl,.      
-00006be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006bf0: 2020 7363 7265 656e 2c0a 2020 2020 2020    screen,.      
-00006c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c10: 2020 6d6f 7573 655f 6861 6e64 6c65 7273    mouse_handlers
-00006c20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00006c30: 2020 2020 2020 2020 2020 7772 6974 655f            write_
-00006c40: 706f 7369 7469 6f6e 2c0a 2020 2020 2020  position,.      
+00006040: 2020 5d29 0a0a 2020 2020 3a70 6172 616d    ])..    :param
+00006050: 207a 5f69 6e64 6578 3a20 2869 6e74 206f   z_index: (int o
+00006060: 7220 4e6f 6e65 2920 5768 656e 2073 7065  r None) When spe
+00006070: 6369 6669 6564 2c20 7468 6973 2063 616e  cified, this can
+00006080: 2062 6520 7573 6564 2074 6f20 6272 696e   be used to brin
+00006090: 670a 2020 2020 2020 2020 656c 656d 656e  g.        elemen
+000060a0: 7420 696e 2066 726f 6e74 206f 6620 666c  t in front of fl
+000060b0: 6f61 7469 6e67 2065 6c65 6d65 6e74 732e  oating elements.
+000060c0: 2020 604e 6f6e 6560 206d 6561 6e73 3a20    `None` means: 
+000060d0: 696e 6865 7269 7420 6672 6f6d 2070 6172  inherit from par
+000060e0: 656e 742e 0a20 2020 2020 2020 2054 6869  ent..        Thi
+000060f0: 7320 6973 2074 6865 207a 5f69 6e64 6578  s is the z_index
+00006100: 2066 6f72 2074 6865 2077 686f 6c65 2060   for the whole `
+00006110: 466c 6f61 7460 2063 6f6e 7461 696e 6572  Float` container
+00006120: 2061 7320 6120 7768 6f6c 652e 0a20 2020   as a whole..   
+00006130: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
+00006140: 696e 6974 5f5f 280a 2020 2020 2020 2020  init__(.        
+00006150: 7365 6c66 2c0a 2020 2020 2020 2020 636f  self,.        co
+00006160: 6e74 656e 743a 2041 6e79 436f 6e74 6169  ntent: AnyContai
+00006170: 6e65 722c 0a20 2020 2020 2020 2066 6c6f  ner,.        flo
+00006180: 6174 733a 204c 6973 745b 2246 6c6f 6174  ats: List["Float
+00006190: 225d 2c0a 2020 2020 2020 2020 6d6f 6461  "],.        moda
+000061a0: 6c3a 2062 6f6f 6c20 3d20 4661 6c73 652c  l: bool = False,
+000061b0: 0a20 2020 2020 2020 2062 696e 643a 204f  .        bind: O
+000061c0: 7074 696f 6e61 6c5b 4b65 7942 696e 6469  ptional[KeyBindi
+000061d0: 6e67 7342 6173 655d 203d 204e 6f6e 652c  ngsBase] = None,
+000061e0: 0a20 2020 2020 2020 2073 7479 6c65 3a20  .        style: 
+000061f0: 556e 696f 6e5b 7374 722c 2043 616c 6c61  Union[str, Calla
+00006200: 626c 655b 5b5d 2c20 7374 725d 5d20 3d20  ble[[], str]] = 
+00006210: 2222 2c0a 2020 2020 2020 2020 7a5f 696e  "",.        z_in
+00006220: 6465 783a 204f 7074 696f 6e61 6c5b 696e  dex: Optional[in
+00006230: 745d 203d 204e 6f6e 652c 0a20 2020 2029  t] = None,.    )
+00006240: 202d 3e20 4e6f 6e65 3a0a 0a20 2020 2020   -> None:..     
+00006250: 2020 2073 656c 662e 636f 6e74 656e 7420     self.content 
+00006260: 3d20 746f 5f63 6f6e 7461 696e 6572 2863  = to_container(c
+00006270: 6f6e 7465 6e74 290a 2020 2020 2020 2020  ontent).        
+00006280: 7365 6c66 2e66 6c6f 6174 7320 3d20 666c  self.floats = fl
+00006290: 6f61 7473 0a0a 2020 2020 2020 2020 7365  oats..        se
+000062a0: 6c66 2e6d 6f64 616c 203d 206d 6f64 616c  lf.modal = modal
+000062b0: 0a20 2020 2020 2020 2073 656c 662e 6269  .        self.bi
+000062c0: 6e64 203d 2062 696e 640a 2020 2020 2020  nd = bind.      
+000062d0: 2020 7365 6c66 2e73 7479 6c65 203d 2073    self.style = s
+000062e0: 7479 6c65 0a20 2020 2020 2020 2073 656c  tyle.        sel
+000062f0: 662e 7a5f 696e 6465 7820 3d20 7a5f 696e  f.z_index = z_in
+00006300: 6465 780a 0a20 2020 2064 6566 2072 6573  dex..    def res
+00006310: 6574 2873 656c 6629 202d 3e20 4e6f 6e65  et(self) -> None
+00006320: 3a0a 2020 2020 2020 2020 7365 6c66 2e63  :.        self.c
+00006330: 6f6e 7465 6e74 2e72 6573 6574 2829 0a0a  ontent.reset()..
+00006340: 2020 2020 2020 2020 666f 7220 6620 696e          for f in
+00006350: 2073 656c 662e 666c 6f61 7473 3a0a 2020   self.floats:.  
+00006360: 2020 2020 2020 2020 2020 662e 636f 6e74            f.cont
+00006370: 656e 742e 7265 7365 7428 290a 0a20 2020  ent.reset()..   
+00006380: 2064 6566 2070 7265 6665 7272 6564 5f77   def preferred_w
+00006390: 6964 7468 2873 656c 662c 206d 6178 5f61  idth(self, max_a
+000063a0: 7661 696c 6162 6c65 5f77 6964 7468 3a20  vailable_width: 
+000063b0: 696e 7429 202d 3e20 4469 6d65 6e73 696f  int) -> Dimensio
+000063c0: 6e3a 0a20 2020 2020 2020 2072 6574 7572  n:.        retur
+000063d0: 6e20 7365 6c66 2e63 6f6e 7465 6e74 2e70  n self.content.p
+000063e0: 7265 6665 7272 6564 5f77 6964 7468 286d  referred_width(m
+000063f0: 6178 5f61 7661 696c 6162 6c65 5f77 6964  ax_available_wid
+00006400: 7468 290a 0a20 2020 2064 6566 2070 7265  th)..    def pre
+00006410: 6665 7272 6564 5f68 6569 6768 7428 7365  ferred_height(se
+00006420: 6c66 2c20 7769 6474 683a 2069 6e74 2c20  lf, width: int, 
+00006430: 6d61 785f 6176 6169 6c61 626c 655f 6865  max_available_he
+00006440: 6967 6874 3a20 696e 7429 202d 3e20 4469  ight: int) -> Di
+00006450: 6d65 6e73 696f 6e3a 0a20 2020 2020 2020  mension:.       
+00006460: 2022 2222 0a20 2020 2020 2020 2052 6574   """.        Ret
+00006470: 7572 6e20 7468 6520 7072 6566 6572 7265  urn the preferre
+00006480: 6420 6865 6967 6874 206f 6620 7468 6520  d height of the 
+00006490: 666c 6f61 7420 636f 6e74 6169 6e65 722e  float container.
+000064a0: 0a20 2020 2020 2020 2028 5765 2064 6f6e  .        (We don
+000064b0: 2774 2063 6172 6520 6162 6f75 7420 7468  't care about th
+000064c0: 6520 6865 6967 6874 206f 6620 7468 6520  e height of the 
+000064d0: 666c 6f61 7473 2c20 7468 6579 2073 686f  floats, they sho
+000064e0: 756c 6420 616c 7761 7973 2066 6974 0a20  uld always fit. 
+000064f0: 2020 2020 2020 2069 6e74 6f20 7468 6520         into the 
+00006500: 6469 6d65 6e73 696f 6e73 2070 726f 7669  dimensions provi
+00006510: 6465 6420 6279 2074 6865 2063 6f6e 7461  ded by the conta
+00006520: 696e 6572 2e29 0a20 2020 2020 2020 2022  iner.).        "
+00006530: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+00006540: 6e20 7365 6c66 2e63 6f6e 7465 6e74 2e70  n self.content.p
+00006550: 7265 6665 7272 6564 5f68 6569 6768 7428  referred_height(
+00006560: 7769 6474 682c 206d 6178 5f61 7661 696c  width, max_avail
+00006570: 6162 6c65 5f68 6569 6768 7429 0a0a 2020  able_height)..  
+00006580: 2020 6465 6620 7772 6974 655f 746f 5f73    def write_to_s
+00006590: 6372 6565 6e28 0a20 2020 2020 2020 2073  creen(.        s
+000065a0: 656c 662c 0a20 2020 2020 2020 2073 6372  elf,.        scr
+000065b0: 6565 6e3a 2053 6372 6565 6e2c 0a20 2020  een: Screen,.   
+000065c0: 2020 2020 206d 6f75 7365 5f68 616e 646c       mouse_handl
+000065d0: 6572 733a 204d 6f75 7365 4861 6e64 6c65  ers: MouseHandle
+000065e0: 7273 2c0a 2020 2020 2020 2020 7772 6974  rs,.        writ
+000065f0: 655f 706f 7369 7469 6f6e 3a20 5772 6974  e_position: Writ
+00006600: 6550 6f73 6974 696f 6e2c 0a20 2020 2020  ePosition,.     
+00006610: 2020 2070 6172 656e 745f 7374 796c 653a     parent_style:
+00006620: 2073 7472 2c0a 2020 2020 2020 2020 6572   str,.        er
+00006630: 6173 655f 6267 3a20 626f 6f6c 2c0a 2020  ase_bg: bool,.  
+00006640: 2020 2020 2020 7a5f 696e 6465 783a 204f        z_index: O
+00006650: 7074 696f 6e61 6c5b 696e 745d 2c0a 2020  ptional[int],.  
+00006660: 2020 2920 2d3e 204e 6f6e 653a 0a20 2020    ) -> None:.   
+00006670: 2020 2020 2073 7479 6c65 203d 2070 6172       style = par
+00006680: 656e 745f 7374 796c 6520 2b20 2220 2220  ent_style + " " 
+00006690: 2b20 746f 5f73 7472 2873 656c 662e 7374  + to_str(self.st
+000066a0: 796c 6529 0a20 2020 2020 2020 207a 5f69  yle).        z_i
+000066b0: 6e64 6578 203d 207a 5f69 6e64 6578 2069  ndex = z_index i
+000066c0: 6620 7365 6c66 2e7a 5f69 6e64 6578 2069  f self.z_index i
+000066d0: 7320 4e6f 6e65 2065 6c73 6520 7365 6c66  s None else self
+000066e0: 2e7a 5f69 6e64 6578 0a0a 2020 2020 2020  .z_index..      
+000066f0: 2020 7365 6c66 2e63 6f6e 7465 6e74 2e77    self.content.w
+00006700: 7269 7465 5f74 6f5f 7363 7265 656e 280a  rite_to_screen(.
+00006710: 2020 2020 2020 2020 2020 2020 7363 7265              scre
+00006720: 656e 2c20 6d6f 7573 655f 6861 6e64 6c65  en, mouse_handle
+00006730: 7273 2c20 7772 6974 655f 706f 7369 7469  rs, write_positi
+00006740: 6f6e 2c20 7374 796c 652c 2065 7261 7365  on, style, erase
+00006750: 5f62 672c 207a 5f69 6e64 6578 0a20 2020  _bg, z_index.   
+00006760: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00006770: 666f 7220 6e75 6d62 6572 2c20 666c 2069  for number, fl i
+00006780: 6e20 656e 756d 6572 6174 6528 7365 6c66  n enumerate(self
+00006790: 2e66 6c6f 6174 7329 3a0a 2020 2020 2020  .floats):.      
+000067a0: 2020 2020 2020 2320 7a5f 696e 6465 7820        # z_index 
+000067b0: 6f66 2061 2046 6c6f 6174 2069 7320 636f  of a Float is co
+000067c0: 6d70 7574 6564 2062 7920 7375 6d6d 696e  mputed by summin
+000067d0: 6720 7468 6520 7a5f 696e 6465 7820 6f66  g the z_index of
+000067e0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+000067f0: 2023 2063 6f6e 7461 696e 6572 2061 6e64   # container and
+00006800: 2074 6865 2060 466c 6f61 7460 2e0a 2020   the `Float`..  
+00006810: 2020 2020 2020 2020 2020 6e65 775f 7a5f            new_z_
+00006820: 696e 6465 7820 3d20 287a 5f69 6e64 6578  index = (z_index
+00006830: 206f 7220 3029 202b 2066 6c2e 7a5f 696e   or 0) + fl.z_in
+00006840: 6465 780a 2020 2020 2020 2020 2020 2020  dex.            
+00006850: 7374 796c 6520 3d20 7061 7265 6e74 5f73  style = parent_s
+00006860: 7479 6c65 202b 2022 2022 202b 2074 6f5f  tyle + " " + to_
+00006870: 7374 7228 7365 6c66 2e73 7479 6c65 290a  str(self.style).
+00006880: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
+00006890: 6620 7468 6520 666c 6f61 7420 7468 6174  f the float that
+000068a0: 2077 6520 6861 7665 2068 6572 652c 2069   we have here, i
+000068b0: 7320 706f 7369 7469 6f6e 6564 2072 656c  s positioned rel
+000068c0: 6174 6976 6520 746f 2074 6865 0a20 2020  ative to the.   
+000068d0: 2020 2020 2020 2020 2023 2063 7572 736f           # curso
+000068e0: 7220 706f 7369 7469 6f6e 2c20 6275 7420  r position, but 
+000068f0: 7468 6520 5769 6e64 6f77 2074 6861 7420  the Window that 
+00006900: 7370 6563 6966 6965 7320 7468 6520 6375  specifies the cu
+00006910: 7273 6f72 0a20 2020 2020 2020 2020 2020  rsor.           
+00006920: 2023 2070 6f73 6974 696f 6e20 6973 206e   # position is n
+00006930: 6f74 2064 7261 776e 2079 6574 2c20 6265  ot drawn yet, be
+00006940: 6361 7573 6520 6974 2773 2061 2046 6c6f  cause it's a Flo
+00006950: 6174 2069 7473 656c 662c 2077 6520 6861  at itself, we ha
+00006960: 7665 0a20 2020 2020 2020 2020 2020 2023  ve.            #
+00006970: 2074 6f20 706f 7374 706f 6e65 2074 6869   to postpone thi
+00006980: 7320 6361 6c63 756c 6174 696f 6e2e 2028  s calculation. (
+00006990: 5468 6973 2069 7320 6120 776f 726b 2d61  This is a work-a
+000069a0: 726f 756e 642c 2062 7574 2067 6f6f 640a  round, but good.
+000069b0: 2020 2020 2020 2020 2020 2020 2320 656e              # en
+000069c0: 6f75 6768 2066 6f72 206e 6f77 2e29 0a20  ough for now.). 
+000069d0: 2020 2020 2020 2020 2020 2070 6f73 7470             postp
+000069e0: 6f6e 6520 3d20 666c 2e78 6375 7273 6f72  one = fl.xcursor
+000069f0: 2069 7320 6e6f 7420 4e6f 6e65 206f 7220   is not None or 
+00006a00: 666c 2e79 6375 7273 6f72 2069 7320 6e6f  fl.ycursor is no
+00006a10: 7420 4e6f 6e65 0a0a 2020 2020 2020 2020  t None..        
+00006a20: 2020 2020 6966 2070 6f73 7470 6f6e 653a      if postpone:
+00006a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006a40: 206e 6577 5f7a 5f69 6e64 6578 203d 2028   new_z_index = (
+00006a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006a60: 2020 2020 206e 756d 6265 7220 2b20 3130       number + 10
+00006a70: 202a 2a20 380a 2020 2020 2020 2020 2020   ** 8.          
+00006a80: 2020 2020 2020 2920 2023 2044 7261 7720        )  # Draw 
+00006a90: 6173 206c 6174 6520 6173 2070 6f73 7369  as late as possi
+00006aa0: 626c 652c 2062 7574 206b 6565 7020 7468  ble, but keep th
+00006ab0: 6520 6f72 6465 722e 0a20 2020 2020 2020  e order..       
+00006ac0: 2020 2020 2020 2020 2073 6372 6565 6e2e           screen.
+00006ad0: 6472 6177 5f77 6974 685f 7a5f 696e 6465  draw_with_z_inde
+00006ae0: 7828 0a20 2020 2020 2020 2020 2020 2020  x(.             
+00006af0: 2020 2020 2020 207a 5f69 6e64 6578 3d6e         z_index=n
+00006b00: 6577 5f7a 5f69 6e64 6578 2c0a 2020 2020  ew_z_index,.    
+00006b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b20: 6472 6177 5f66 756e 633d 7061 7274 6961  draw_func=partia
+00006b30: 6c28 0a20 2020 2020 2020 2020 2020 2020  l(.             
+00006b40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006b50: 5f64 7261 775f 666c 6f61 742c 0a20 2020  _draw_float,.   
+00006b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b70: 2020 2020 2066 6c2c 0a20 2020 2020 2020       fl,.       
+00006b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b90: 2073 6372 6565 6e2c 0a20 2020 2020 2020   screen,.       
+00006ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006bb0: 206d 6f75 7365 5f68 616e 646c 6572 732c   mouse_handlers,
+00006bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006bd0: 2020 2020 2020 2020 2077 7269 7465 5f70           write_p
+00006be0: 6f73 6974 696f 6e2c 0a20 2020 2020 2020  osition,.       
+00006bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c00: 2073 7479 6c65 2c0a 2020 2020 2020 2020   style,.        
+00006c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c20: 6572 6173 655f 6267 2c0a 2020 2020 2020  erase_bg,.      
+00006c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c40: 2020 6e65 775f 7a5f 696e 6465 782c 0a20    new_z_index,. 
 00006c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c60: 2020 7374 796c 652c 0a20 2020 2020 2020    style,.       
-00006c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c80: 2065 7261 7365 5f62 672c 0a20 2020 2020   erase_bg,.     
-00006c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ca0: 2020 206e 6577 5f7a 5f69 6e64 6578 2c0a     new_z_index,.
+00006c60: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
+00006c70: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00006c80: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00006c90: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00006ca0: 6472 6177 5f66 6c6f 6174 280a 2020 2020  draw_float(.    
 00006cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006cc0: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
-00006cd0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00006ce0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00006cf0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00006d00: 5f64 7261 775f 666c 6f61 7428 0a20 2020  _draw_float(.   
-00006d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d20: 2066 6c2c 0a20 2020 2020 2020 2020 2020   fl,.           
-00006d30: 2020 2020 2020 2020 2073 6372 6565 6e2c           screen,
-00006d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006d50: 2020 2020 206d 6f75 7365 5f68 616e 646c       mouse_handl
-00006d60: 6572 732c 0a20 2020 2020 2020 2020 2020  ers,.           
-00006d70: 2020 2020 2020 2020 2077 7269 7465 5f70           write_p
-00006d80: 6f73 6974 696f 6e2c 0a20 2020 2020 2020  osition,.       
-00006d90: 2020 2020 2020 2020 2020 2020 2073 7479               sty
-00006da0: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-00006db0: 2020 2020 2020 2020 6572 6173 655f 6267          erase_bg
-00006dc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00006dd0: 2020 2020 2020 6e65 775f 7a5f 696e 6465        new_z_inde
-00006de0: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
-00006df0: 2020 2029 0a0a 2020 2020 6465 6620 5f64     )..    def _d
-00006e00: 7261 775f 666c 6f61 7428 0a20 2020 2020  raw_float(.     
-00006e10: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00006e20: 2066 6c3a 2022 466c 6f61 7422 2c0a 2020   fl: "Float",.  
-00006e30: 2020 2020 2020 7363 7265 656e 3a20 5363        screen: Sc
-00006e40: 7265 656e 2c0a 2020 2020 2020 2020 6d6f  reen,.        mo
-00006e50: 7573 655f 6861 6e64 6c65 7273 3a20 4d6f  use_handlers: Mo
-00006e60: 7573 6548 616e 646c 6572 732c 0a20 2020  useHandlers,.   
-00006e70: 2020 2020 2077 7269 7465 5f70 6f73 6974       write_posit
-00006e80: 696f 6e3a 2057 7269 7465 506f 7369 7469  ion: WritePositi
-00006e90: 6f6e 2c0a 2020 2020 2020 2020 7374 796c  on,.        styl
-00006ea0: 653a 2073 7472 2c0a 2020 2020 2020 2020  e: str,.        
-00006eb0: 6572 6173 655f 6267 3a20 626f 6f6c 2c0a  erase_bg: bool,.
-00006ec0: 2020 2020 2020 2020 7a5f 696e 6465 783a          z_index:
-00006ed0: 204f 7074 696f 6e61 6c5b 696e 745d 2c0a   Optional[int],.
-00006ee0: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
-00006ef0: 2020 2020 2020 2022 4472 6177 2061 2073         "Draw a s
-00006f00: 696e 676c 6520 466c 6f61 742e 220a 2020  ingle Float.".  
-00006f10: 2020 2020 2020 2320 5768 656e 2061 206d        # When a m
-00006f20: 656e 755f 706f 7369 7469 6f6e 2077 6173  enu_position was
-00006f30: 2067 6976 656e 2c20 7573 6520 7468 6973   given, use this
-00006f40: 2069 6e73 7465 6164 206f 6620 7468 6520   instead of the 
-00006f50: 6375 7273 6f72 0a20 2020 2020 2020 2023  cursor.        #
-00006f60: 2070 6f73 6974 696f 6e2e 2028 5468 6573   position. (Thes
-00006f70: 6520 6375 7273 6f72 2070 6f73 6974 696f  e cursor positio
-00006f80: 6e73 2061 7265 2061 6273 6f6c 7574 652c  ns are absolute,
-00006f90: 2074 7261 6e73 6c61 7465 2061 6761 696e   translate again
-00006fa0: 0a20 2020 2020 2020 2023 2072 656c 6174  .        # relat
-00006fb0: 6976 6520 746f 2074 6865 2077 7269 7465  ive to the write
-00006fc0: 5f70 6f73 6974 696f 6e2e 290a 2020 2020  _position.).    
-00006fd0: 2020 2020 2320 4e6f 7465 3a20 5468 6973      # Note: This
-00006fe0: 2073 686f 756c 6420 6265 2069 6e73 6964   should be insid
-00006ff0: 6520 7468 6520 666f 722d 6c6f 6f70 2c20  e the for-loop, 
-00007000: 6265 6361 7573 6520 6f6e 6520 666c 6f61  because one floa
-00007010: 7420 636f 756c 640a 2020 2020 2020 2020  t could.        
-00007020: 2320 2020 2020 2020 7365 7420 7468 6520  #       set the 
-00007030: 6375 7273 6f72 2070 6f73 6974 696f 6e20  cursor position 
-00007040: 746f 2062 6520 7573 6564 2066 6f72 2074  to be used for t
-00007050: 6865 206e 6578 7420 6f6e 652e 0a20 2020  he next one..   
-00007060: 2020 2020 2063 706f 7320 3d20 7363 7265       cpos = scre
-00007070: 656e 2e67 6574 5f6d 656e 755f 706f 7369  en.get_menu_posi
-00007080: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
-00007090: 2020 666c 2e61 7474 6163 685f 746f 5f77    fl.attach_to_w
-000070a0: 696e 646f 7720 6f72 2067 6574 5f61 7070  indow or get_app
-000070b0: 2829 2e6c 6179 6f75 742e 6375 7272 656e  ().layout.curren
-000070c0: 745f 7769 6e64 6f77 0a20 2020 2020 2020  t_window.       
-000070d0: 2029 0a20 2020 2020 2020 2063 7572 736f   ).        curso
-000070e0: 725f 706f 7369 7469 6f6e 203d 2050 6f69  r_position = Poi
-000070f0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-00007100: 783d 6370 6f73 2e78 202d 2077 7269 7465  x=cpos.x - write
-00007110: 5f70 6f73 6974 696f 6e2e 7870 6f73 2c20  _position.xpos, 
-00007120: 793d 6370 6f73 2e79 202d 2077 7269 7465  y=cpos.y - write
-00007130: 5f70 6f73 6974 696f 6e2e 7970 6f73 0a20  _position.ypos. 
-00007140: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00007150: 2020 666c 5f77 6964 7468 203d 2066 6c2e    fl_width = fl.
-00007160: 6765 745f 7769 6474 6828 290a 2020 2020  get_width().    
-00007170: 2020 2020 666c 5f68 6569 6768 7420 3d20      fl_height = 
-00007180: 666c 2e67 6574 5f68 6569 6768 7428 290a  fl.get_height().
-00007190: 2020 2020 2020 2020 7769 6474 683a 2069          width: i
-000071a0: 6e74 0a20 2020 2020 2020 2068 6569 6768  nt.        heigh
-000071b0: 743a 2069 6e74 0a20 2020 2020 2020 2078  t: int.        x
-000071c0: 706f 733a 2069 6e74 0a20 2020 2020 2020  pos: int.       
-000071d0: 2079 706f 733a 2069 6e74 0a0a 2020 2020   ypos: int..    
-000071e0: 2020 2020 2320 4c65 6674 2026 2077 6964      # Left & wid
-000071f0: 7468 2067 6976 656e 2e0a 2020 2020 2020  th given..      
-00007200: 2020 6966 2066 6c2e 6c65 6674 2069 7320    if fl.left is 
-00007210: 6e6f 7420 4e6f 6e65 2061 6e64 2066 6c5f  not None and fl_
-00007220: 7769 6474 6820 6973 206e 6f74 204e 6f6e  width is not Non
-00007230: 653a 0a20 2020 2020 2020 2020 2020 2078  e:.            x
-00007240: 706f 7320 3d20 666c 2e6c 6566 740a 2020  pos = fl.left.  
-00007250: 2020 2020 2020 2020 2020 7769 6474 6820            width 
-00007260: 3d20 666c 5f77 6964 7468 0a20 2020 2020  = fl_width.     
-00007270: 2020 2023 204c 6566 7420 2620 7269 6768     # Left & righ
-00007280: 7420 6769 7665 6e20 2d3e 2063 616c 6375  t given -> calcu
-00007290: 6c61 7465 2077 6964 7468 2e0a 2020 2020  late width..    
-000072a0: 2020 2020 656c 6966 2066 6c2e 6c65 6674      elif fl.left
-000072b0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-000072c0: 2066 6c2e 7269 6768 7420 6973 206e 6f74   fl.right is not
-000072d0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000072e0: 2020 2078 706f 7320 3d20 666c 2e6c 6566     xpos = fl.lef
-000072f0: 740a 2020 2020 2020 2020 2020 2020 7769  t.            wi
-00007300: 6474 6820 3d20 7772 6974 655f 706f 7369  dth = write_posi
-00007310: 7469 6f6e 2e77 6964 7468 202d 2066 6c2e  tion.width - fl.
-00007320: 6c65 6674 202d 2066 6c2e 7269 6768 740a  left - fl.right.
-00007330: 2020 2020 2020 2020 2320 5769 6474 6820          # Width 
-00007340: 2620 7269 6768 7420 6769 7665 6e20 2d3e  & right given ->
-00007350: 2063 616c 6375 6c61 7465 206c 6566 742e   calculate left.
-00007360: 0a20 2020 2020 2020 2065 6c69 6620 666c  .        elif fl
-00007370: 5f77 6964 7468 2069 7320 6e6f 7420 4e6f  _width is not No
-00007380: 6e65 2061 6e64 2066 6c2e 7269 6768 7420  ne and fl.right 
-00007390: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-000073a0: 2020 2020 2020 2020 2078 706f 7320 3d20           xpos = 
-000073b0: 7772 6974 655f 706f 7369 7469 6f6e 2e77  write_position.w
-000073c0: 6964 7468 202d 2066 6c2e 7269 6768 7420  idth - fl.right 
-000073d0: 2d20 666c 5f77 6964 7468 0a20 2020 2020  - fl_width.     
-000073e0: 2020 2020 2020 2077 6964 7468 203d 2066         width = f
-000073f0: 6c5f 7769 6474 680a 2020 2020 2020 2020  l_width.        
-00007400: 2320 4e65 6172 2078 2070 6f73 6974 696f  # Near x positio
-00007410: 6e20 6f66 2063 7572 736f 722e 0a20 2020  n of cursor..   
-00007420: 2020 2020 2065 6c69 6620 666c 2e78 6375       elif fl.xcu
-00007430: 7273 6f72 3a0a 2020 2020 2020 2020 2020  rsor:.          
-00007440: 2020 6966 2066 6c5f 7769 6474 6820 6973    if fl_width is
-00007450: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00007460: 2020 2020 2020 2077 6964 7468 203d 2066         width = f
-00007470: 6c2e 636f 6e74 656e 742e 7072 6566 6572  l.content.prefer
-00007480: 7265 645f 7769 6474 6828 7772 6974 655f  red_width(write_
-00007490: 706f 7369 7469 6f6e 2e77 6964 7468 292e  position.width).
-000074a0: 7072 6566 6572 7265 640a 2020 2020 2020  preferred.      
-000074b0: 2020 2020 2020 2020 2020 7769 6474 6820            width 
-000074c0: 3d20 6d69 6e28 7772 6974 655f 706f 7369  = min(write_posi
-000074d0: 7469 6f6e 2e77 6964 7468 2c20 7769 6474  tion.width, widt
-000074e0: 6829 0a20 2020 2020 2020 2020 2020 2065  h).            e
-000074f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00007500: 2020 2020 2077 6964 7468 203d 2066 6c5f       width = fl_
-00007510: 7769 6474 680a 0a20 2020 2020 2020 2020  width..         
-00007520: 2020 2078 706f 7320 3d20 6375 7273 6f72     xpos = cursor
-00007530: 5f70 6f73 6974 696f 6e2e 780a 2020 2020  _position.x.    
-00007540: 2020 2020 2020 2020 6966 2078 706f 7320          if xpos 
-00007550: 2b20 7769 6474 6820 3e20 7772 6974 655f  + width > write_
-00007560: 706f 7369 7469 6f6e 2e77 6964 7468 3a0a  position.width:.
-00007570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007580: 7870 6f73 203d 206d 6178 2830 2c20 7772  xpos = max(0, wr
-00007590: 6974 655f 706f 7369 7469 6f6e 2e77 6964  ite_position.wid
-000075a0: 7468 202d 2077 6964 7468 290a 2020 2020  th - width).    
-000075b0: 2020 2020 2320 4f6e 6c79 2077 6964 7468      # Only width
-000075c0: 2067 6976 656e 202d 3e20 6365 6e74 6572   given -> center
-000075d0: 2068 6f72 697a 6f6e 7461 6c6c 792e 0a20   horizontally.. 
-000075e0: 2020 2020 2020 2065 6c69 6620 666c 5f77         elif fl_w
-000075f0: 6964 7468 3a0a 2020 2020 2020 2020 2020  idth:.          
-00007600: 2020 7870 6f73 203d 2069 6e74 2828 7772    xpos = int((wr
-00007610: 6974 655f 706f 7369 7469 6f6e 2e77 6964  ite_position.wid
-00007620: 7468 202d 2066 6c5f 7769 6474 6829 202f  th - fl_width) /
-00007630: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
-00007640: 7769 6474 6820 3d20 666c 5f77 6964 7468  width = fl_width
-00007650: 0a20 2020 2020 2020 2023 204f 7468 6572  .        # Other
-00007660: 7769 7365 2c20 7461 6b65 2070 7265 6665  wise, take prefe
-00007670: 7272 6564 2077 6964 7468 2066 726f 6d20  rred width from 
-00007680: 666c 6f61 7420 636f 6e74 656e 742e 0a20  float content.. 
-00007690: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000076a0: 2020 2020 2020 2020 2077 6964 7468 203d           width =
-000076b0: 2066 6c2e 636f 6e74 656e 742e 7072 6566   fl.content.pref
-000076c0: 6572 7265 645f 7769 6474 6828 7772 6974  erred_width(writ
-000076d0: 655f 706f 7369 7469 6f6e 2e77 6964 7468  e_position.width
-000076e0: 292e 7072 6566 6572 7265 640a 0a20 2020  ).preferred..   
-000076f0: 2020 2020 2020 2020 2069 6620 666c 2e6c           if fl.l
-00007700: 6566 7420 6973 206e 6f74 204e 6f6e 653a  eft is not None:
-00007710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007720: 2078 706f 7320 3d20 666c 2e6c 6566 740a   xpos = fl.left.
-00007730: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00007740: 2066 6c2e 7269 6768 7420 6973 206e 6f74   fl.right is not
-00007750: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00007760: 2020 2020 2020 2078 706f 7320 3d20 6d61         xpos = ma
-00007770: 7828 302c 2077 7269 7465 5f70 6f73 6974  x(0, write_posit
-00007780: 696f 6e2e 7769 6474 6820 2d20 7769 6474  ion.width - widt
-00007790: 6820 2d20 666c 2e72 6967 6874 290a 2020  h - fl.right).  
-000077a0: 2020 2020 2020 2020 2020 656c 7365 3a20            else: 
-000077b0: 2023 2043 656e 7465 7220 686f 7269 7a6f   # Center horizo
-000077c0: 6e74 616c 6c79 2e0a 2020 2020 2020 2020  ntally..        
-000077d0: 2020 2020 2020 2020 7870 6f73 203d 206d          xpos = m
-000077e0: 6178 2830 2c20 696e 7428 2877 7269 7465  ax(0, int((write
-000077f0: 5f70 6f73 6974 696f 6e2e 7769 6474 6820  _position.width 
-00007800: 2d20 7769 6474 6829 202f 2032 2929 0a0a  - width) / 2))..
-00007810: 2020 2020 2020 2020 2020 2020 2320 5472              # Tr
-00007820: 696d 2e0a 2020 2020 2020 2020 2020 2020  im..            
-00007830: 7769 6474 6820 3d20 6d69 6e28 7769 6474  width = min(widt
-00007840: 682c 2077 7269 7465 5f70 6f73 6974 696f  h, write_positio
-00007850: 6e2e 7769 6474 6820 2d20 7870 6f73 290a  n.width - xpos).
-00007860: 0a20 2020 2020 2020 2023 2054 6f70 2026  .        # Top &
-00007870: 2068 6569 6768 7420 6769 7665 6e2e 0a20   height given.. 
-00007880: 2020 2020 2020 2069 6620 666c 2e74 6f70         if fl.top
-00007890: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-000078a0: 2066 6c5f 6865 6967 6874 2069 7320 6e6f   fl_height is no
-000078b0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-000078c0: 2020 2020 7970 6f73 203d 2066 6c2e 746f      ypos = fl.to
-000078d0: 700a 2020 2020 2020 2020 2020 2020 6865  p.            he
-000078e0: 6967 6874 203d 2066 6c5f 6865 6967 6874  ight = fl_height
-000078f0: 0a20 2020 2020 2020 2023 2054 6f70 2026  .        # Top &
-00007900: 2062 6f74 746f 6d20 6769 7665 6e20 2d3e   bottom given ->
-00007910: 2063 616c 6375 6c61 7465 2068 6569 6768   calculate heigh
-00007920: 742e 0a20 2020 2020 2020 2065 6c69 6620  t..        elif 
-00007930: 666c 2e74 6f70 2069 7320 6e6f 7420 4e6f  fl.top is not No
-00007940: 6e65 2061 6e64 2066 6c2e 626f 7474 6f6d  ne and fl.bottom
-00007950: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00007960: 2020 2020 2020 2020 2020 7970 6f73 203d            ypos =
-00007970: 2066 6c2e 746f 700a 2020 2020 2020 2020   fl.top.        
-00007980: 2020 2020 6865 6967 6874 203d 2077 7269      height = wri
-00007990: 7465 5f70 6f73 6974 696f 6e2e 6865 6967  te_position.heig
-000079a0: 6874 202d 2066 6c2e 746f 7020 2d20 666c  ht - fl.top - fl
-000079b0: 2e62 6f74 746f 6d0a 2020 2020 2020 2020  .bottom.        
-000079c0: 2320 4865 6967 6874 2026 2062 6f74 746f  # Height & botto
-000079d0: 6d20 6769 7665 6e20 2d3e 2063 616c 6375  m given -> calcu
-000079e0: 6c61 7465 2074 6f70 2e0a 2020 2020 2020  late top..      
-000079f0: 2020 656c 6966 2066 6c5f 6865 6967 6874    elif fl_height
-00007a00: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-00007a10: 2066 6c2e 626f 7474 6f6d 2069 7320 6e6f   fl.bottom is no
-00007a20: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00007a30: 2020 2020 7970 6f73 203d 2077 7269 7465      ypos = write
-00007a40: 5f70 6f73 6974 696f 6e2e 6865 6967 6874  _position.height
-00007a50: 202d 2066 6c5f 6865 6967 6874 202d 2066   - fl_height - f
-00007a60: 6c2e 626f 7474 6f6d 0a20 2020 2020 2020  l.bottom.       
-00007a70: 2020 2020 2068 6569 6768 7420 3d20 666c       height = fl
-00007a80: 5f68 6569 6768 740a 2020 2020 2020 2020  _height.        
-00007a90: 2320 4e65 6172 2063 7572 736f 722e 0a20  # Near cursor.. 
-00007aa0: 2020 2020 2020 2065 6c69 6620 666c 2e79         elif fl.y
-00007ab0: 6375 7273 6f72 3a0a 2020 2020 2020 2020  cursor:.        
-00007ac0: 2020 2020 7970 6f73 203d 2063 7572 736f      ypos = curso
-00007ad0: 725f 706f 7369 7469 6f6e 2e79 202b 2028  r_position.y + (
-00007ae0: 3020 6966 2066 6c2e 616c 6c6f 775f 636f  0 if fl.allow_co
-00007af0: 7665 725f 6375 7273 6f72 2065 6c73 6520  ver_cursor else 
-00007b00: 3129 0a0a 2020 2020 2020 2020 2020 2020  1)..            
-00007b10: 6966 2066 6c5f 6865 6967 6874 2069 7320  if fl_height is 
-00007b20: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00007b30: 2020 2020 2020 6865 6967 6874 203d 2066        height = f
-00007b40: 6c2e 636f 6e74 656e 742e 7072 6566 6572  l.content.prefer
-00007b50: 7265 645f 6865 6967 6874 280a 2020 2020  red_height(.    
-00007b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007b70: 7769 6474 682c 2077 7269 7465 5f70 6f73  width, write_pos
-00007b80: 6974 696f 6e2e 6865 6967 6874 0a20 2020  ition.height.   
-00007b90: 2020 2020 2020 2020 2020 2020 2029 2e70               ).p
-00007ba0: 7265 6665 7272 6564 0a20 2020 2020 2020  referred.       
-00007bb0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00007bc0: 2020 2020 2020 2020 2020 2068 6569 6768             heigh
-00007bd0: 7420 3d20 666c 5f68 6569 6768 740a 0a20  t = fl_height.. 
-00007be0: 2020 2020 2020 2020 2020 2023 2052 6564             # Red
-00007bf0: 7563 6520 6865 6967 6874 2069 6620 6e6f  uce height if no
-00007c00: 7420 656e 6f75 6768 2073 7061 6365 2e20  t enough space. 
-00007c10: 2857 6520 6361 6e20 7573 6520 7468 6520  (We can use the 
-00007c20: 6865 6967 6874 0a20 2020 2020 2020 2020  height.         
-00007c30: 2020 2023 2077 6865 6e20 7468 6520 636f     # when the co
-00007c40: 6e74 656e 7420 7265 7175 6972 6573 2069  ntent requires i
-00007c50: 742e 290a 2020 2020 2020 2020 2020 2020  t.).            
-00007c60: 6966 2068 6569 6768 7420 3e20 7772 6974  if height > writ
-00007c70: 655f 706f 7369 7469 6f6e 2e68 6569 6768  e_position.heigh
-00007c80: 7420 2d20 7970 6f73 3a0a 2020 2020 2020  t - ypos:.      
-00007c90: 2020 2020 2020 2020 2020 6966 2077 7269            if wri
-00007ca0: 7465 5f70 6f73 6974 696f 6e2e 6865 6967  te_position.heig
-00007cb0: 6874 202d 2079 706f 7320 2b20 3120 3e3d  ht - ypos + 1 >=
-00007cc0: 2079 706f 733a 0a20 2020 2020 2020 2020   ypos:.         
-00007cd0: 2020 2020 2020 2020 2020 2023 2057 6865             # Whe
-00007ce0: 6e20 7468 6520 7370 6163 6520 6265 6c6f  n the space belo
-00007cf0: 7720 7468 6520 6375 7273 6f72 2069 7320  w the cursor is 
-00007d00: 6d6f 7265 2074 6861 6e0a 2020 2020 2020  more than.      
-00007d10: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00007d20: 7468 6520 7370 6163 6520 6162 6f76 652c  the space above,
-00007d30: 206a 7573 7420 7265 6475 6365 2074 6865   just reduce the
-00007d40: 2068 6569 6768 742e 0a20 2020 2020 2020   height..       
-00007d50: 2020 2020 2020 2020 2020 2020 2068 6569               hei
-00007d60: 6768 7420 3d20 7772 6974 655f 706f 7369  ght = write_posi
-00007d70: 7469 6f6e 2e68 6569 6768 7420 2d20 7970  tion.height - yp
-00007d80: 6f73 0a20 2020 2020 2020 2020 2020 2020  os.             
-00007d90: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00007da0: 2020 2020 2020 2020 2020 2020 2023 204f               # O
-00007db0: 7468 6572 7769 7365 2c20 6669 7420 7468  therwise, fit th
-00007dc0: 6520 666c 6f61 7420 6162 6f76 6520 7468  e float above th
-00007dd0: 6520 6375 7273 6f72 2e0a 2020 2020 2020  e cursor..      
-00007de0: 2020 2020 2020 2020 2020 2020 2020 6865                he
-00007df0: 6967 6874 203d 206d 696e 2868 6569 6768  ight = min(heigh
-00007e00: 742c 2063 7572 736f 725f 706f 7369 7469  t, cursor_positi
-00007e10: 6f6e 2e79 290a 2020 2020 2020 2020 2020  on.y).          
-00007e20: 2020 2020 2020 2020 2020 7970 6f73 203d            ypos =
-00007e30: 2063 7572 736f 725f 706f 7369 7469 6f6e   cursor_position
-00007e40: 2e79 202d 2068 6569 6768 740a 0a20 2020  .y - height..   
-00007e50: 2020 2020 2023 204f 6e6c 7920 6865 6967       # Only heig
-00007e60: 6874 2067 6976 656e 202d 3e20 6365 6e74  ht given -> cent
-00007e70: 6572 2076 6572 7469 6361 6c6c 792e 0a20  er vertically.. 
-00007e80: 2020 2020 2020 2065 6c69 6620 666c 5f68         elif fl_h
-00007e90: 6569 6768 743a 0a20 2020 2020 2020 2020  eight:.         
-00007ea0: 2020 2079 706f 7320 3d20 696e 7428 2877     ypos = int((w
-00007eb0: 7269 7465 5f70 6f73 6974 696f 6e2e 6865  rite_position.he
-00007ec0: 6967 6874 202d 2066 6c5f 6865 6967 6874  ight - fl_height
-00007ed0: 2920 2f20 3229 0a20 2020 2020 2020 2020  ) / 2).         
-00007ee0: 2020 2068 6569 6768 7420 3d20 666c 5f68     height = fl_h
-00007ef0: 6569 6768 740a 2020 2020 2020 2020 2320  eight.        # 
-00007f00: 4f74 6865 7277 6973 652c 2074 616b 6520  Otherwise, take 
-00007f10: 7072 6566 6572 7265 6420 6865 6967 6874  preferred height
-00007f20: 2066 726f 6d20 636f 6e74 656e 742e 0a20   from content.. 
-00007f30: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00007f40: 2020 2020 2020 2020 2068 6569 6768 7420           height 
-00007f50: 3d20 666c 2e63 6f6e 7465 6e74 2e70 7265  = fl.content.pre
-00007f60: 6665 7272 6564 5f68 6569 6768 7428 7769  ferred_height(wi
-00007f70: 6474 682c 2077 7269 7465 5f70 6f73 6974  dth, write_posit
-00007f80: 696f 6e2e 6865 6967 6874 292e 7072 6566  ion.height).pref
-00007f90: 6572 7265 640a 0a20 2020 2020 2020 2020  erred..         
-00007fa0: 2020 2069 6620 666c 2e74 6f70 2069 7320     if fl.top is 
-00007fb0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00007fc0: 2020 2020 2020 2020 2020 7970 6f73 203d            ypos =
-00007fd0: 2066 6c2e 746f 700a 2020 2020 2020 2020   fl.top.        
-00007fe0: 2020 2020 656c 6966 2066 6c2e 626f 7474      elif fl.bott
-00007ff0: 6f6d 2069 7320 6e6f 7420 4e6f 6e65 3a0a  om is not None:.
-00008000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008010: 7970 6f73 203d 206d 6178 2830 2c20 7772  ypos = max(0, wr
-00008020: 6974 655f 706f 7369 7469 6f6e 2e68 6569  ite_position.hei
-00008030: 6768 7420 2d20 6865 6967 6874 202d 2066  ght - height - f
-00008040: 6c2e 626f 7474 6f6d 290a 2020 2020 2020  l.bottom).      
-00008050: 2020 2020 2020 656c 7365 3a20 2023 2043        else:  # C
-00008060: 656e 7465 7220 7665 7274 6963 616c 6c79  enter vertically
-00008070: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008080: 2020 7970 6f73 203d 206d 6178 2830 2c20    ypos = max(0, 
-00008090: 696e 7428 2877 7269 7465 5f70 6f73 6974  int((write_posit
-000080a0: 696f 6e2e 6865 6967 6874 202d 2068 6569  ion.height - hei
-000080b0: 6768 7429 202f 2032 2929 0a0a 2020 2020  ght) / 2))..    
-000080c0: 2020 2020 2020 2020 2320 5472 696d 2e0a          # Trim..
-000080d0: 2020 2020 2020 2020 2020 2020 6865 6967              heig
-000080e0: 6874 203d 206d 696e 2868 6569 6768 742c  ht = min(height,
-000080f0: 2077 7269 7465 5f70 6f73 6974 696f 6e2e   write_position.
-00008100: 6865 6967 6874 202d 2079 706f 7329 0a0a  height - ypos)..
-00008110: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
-00008120: 666c 6f61 742e 0a20 2020 2020 2020 2023  float..        #
-00008130: 2028 7870 6f73 2061 6e64 2079 706f 7320   (xpos and ypos 
-00008140: 6361 6e20 6265 206e 6567 6174 6976 653a  can be negative:
-00008150: 2061 2066 6c6f 6174 2063 616e 2062 6520   a float can be 
-00008160: 7061 7274 6961 6c6c 7920 7669 7369 626c  partially visibl
-00008170: 652e 290a 2020 2020 2020 2020 6966 2068  e.).        if h
-00008180: 6569 6768 7420 3e20 3020 616e 6420 7769  eight > 0 and wi
-00008190: 6474 6820 3e20 303a 0a20 2020 2020 2020  dth > 0:.       
-000081a0: 2020 2020 2077 7020 3d20 5772 6974 6550       wp = WriteP
-000081b0: 6f73 6974 696f 6e28 0a20 2020 2020 2020  osition(.       
-000081c0: 2020 2020 2020 2020 2078 706f 733d 7870           xpos=xp
-000081d0: 6f73 202b 2077 7269 7465 5f70 6f73 6974  os + write_posit
-000081e0: 696f 6e2e 7870 6f73 2c0a 2020 2020 2020  ion.xpos,.      
-000081f0: 2020 2020 2020 2020 2020 7970 6f73 3d79            ypos=y
-00008200: 706f 7320 2b20 7772 6974 655f 706f 7369  pos + write_posi
-00008210: 7469 6f6e 2e79 706f 732c 0a20 2020 2020  tion.ypos,.     
-00008220: 2020 2020 2020 2020 2020 2077 6964 7468             width
-00008230: 3d77 6964 7468 2c0a 2020 2020 2020 2020  =width,.        
-00008240: 2020 2020 2020 2020 6865 6967 6874 3d68          height=h
-00008250: 6569 6768 742c 0a20 2020 2020 2020 2020  eight,.         
-00008260: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-00008270: 2020 6966 206e 6f74 2066 6c2e 6869 6465    if not fl.hide
-00008280: 5f77 6865 6e5f 636f 7665 7269 6e67 5f63  _when_covering_c
-00008290: 6f6e 7465 6e74 206f 7220 7365 6c66 2e5f  ontent or self._
-000082a0: 6172 6561 5f69 735f 656d 7074 7928 7363  area_is_empty(sc
-000082b0: 7265 656e 2c20 7770 293a 0a20 2020 2020  reen, wp):.     
-000082c0: 2020 2020 2020 2020 2020 2066 6c2e 636f             fl.co
-000082d0: 6e74 656e 742e 7772 6974 655f 746f 5f73  ntent.write_to_s
-000082e0: 6372 6565 6e28 0a20 2020 2020 2020 2020  creen(.         
-000082f0: 2020 2020 2020 2020 2020 2073 6372 6565             scree
-00008300: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-00008310: 2020 2020 2020 206d 6f75 7365 5f68 616e         mouse_han
-00008320: 646c 6572 732c 0a20 2020 2020 2020 2020  dlers,.         
-00008330: 2020 2020 2020 2020 2020 2077 702c 0a20             wp,. 
-00008340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008350: 2020 2073 7479 6c65 2c0a 2020 2020 2020     style,.      
-00008360: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00008370: 6173 655f 6267 3d6e 6f74 2066 6c2e 7472  ase_bg=not fl.tr
-00008380: 616e 7370 6172 656e 7428 292c 0a20 2020  ansparent(),.   
-00008390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000083a0: 207a 5f69 6e64 6578 3d7a 5f69 6e64 6578   z_index=z_index
-000083b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000083c0: 2020 290a 0a20 2020 2064 6566 205f 6172    )..    def _ar
-000083d0: 6561 5f69 735f 656d 7074 7928 7365 6c66  ea_is_empty(self
-000083e0: 2c20 7363 7265 656e 3a20 5363 7265 656e  , screen: Screen
-000083f0: 2c20 7772 6974 655f 706f 7369 7469 6f6e  , write_position
-00008400: 3a20 5772 6974 6550 6f73 6974 696f 6e29  : WritePosition)
-00008410: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
-00008420: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-00008430: 7475 726e 2054 7275 6520 7768 656e 2074  turn True when t
-00008440: 6865 2061 7265 6120 6265 6c6f 7720 7468  he area below th
-00008450: 6520 7772 6974 6520 706f 7369 7469 6f6e  e write position
-00008460: 2069 7320 7374 696c 6c20 656d 7074 792e   is still empty.
-00008470: 0a20 2020 2020 2020 2028 466f 7220 666c  .        (For fl
-00008480: 6f61 7473 2074 6861 7420 7368 6f75 6c64  oats that should
-00008490: 206e 6f74 2068 6964 6520 636f 6e74 656e   not hide conten
-000084a0: 7420 756e 6465 726e 6561 7468 2e29 0a20  t underneath.). 
-000084b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000084c0: 2020 2077 7020 3d20 7772 6974 655f 706f     wp = write_po
-000084d0: 7369 7469 6f6e 0a0a 2020 2020 2020 2020  sition..        
-000084e0: 666f 7220 7920 696e 2072 616e 6765 2877  for y in range(w
-000084f0: 702e 7970 6f73 2c20 7770 2e79 706f 7320  p.ypos, wp.ypos 
-00008500: 2b20 7770 2e68 6569 6768 7429 3a0a 2020  + wp.height):.  
-00008510: 2020 2020 2020 2020 2020 6966 2079 2069            if y i
-00008520: 6e20 7363 7265 656e 2e64 6174 615f 6275  n screen.data_bu
-00008530: 6666 6572 3a0a 2020 2020 2020 2020 2020  ffer:.          
-00008540: 2020 2020 2020 726f 7720 3d20 7363 7265        row = scre
-00008550: 656e 2e64 6174 615f 6275 6666 6572 5b79  en.data_buffer[y
-00008560: 5d0a 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00008570: 2020 2066 6f72 2078 2069 6e20 7261 6e67     for x in rang
-00008580: 6528 7770 2e78 706f 732c 2077 702e 7870  e(wp.xpos, wp.xp
-00008590: 6f73 202b 2077 702e 7769 6474 6829 3a0a  os + wp.width):.
-000085a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000085b0: 2020 2020 6320 3d20 726f 775b 785d 0a20      c = row[x]. 
-000085c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000085d0: 2020 2069 6620 632e 6368 6172 2021 3d20     if c.char != 
-000085e0: 2220 223a 0a20 2020 2020 2020 2020 2020  " ":.           
-000085f0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00008600: 7572 6e20 4661 6c73 650a 0a20 2020 2020  urn False..     
-00008610: 2020 2072 6574 7572 6e20 5472 7565 0a0a     return True..
-00008620: 2020 2020 6465 6620 6973 5f6d 6f64 616c      def is_modal
-00008630: 2873 656c 6629 202d 3e20 626f 6f6c 3a0a  (self) -> bool:.
-00008640: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00008650: 656c 662e 6d6f 6461 6c0a 0a20 2020 2064  elf.modal..    d
-00008660: 6566 2067 6574 5f6b 6579 5f62 696e 6469  ef get_key_bindi
-00008670: 6e67 7328 7365 6c66 2920 2d3e 204f 7074  ngs(self) -> Opt
-00008680: 696f 6e61 6c5b 4b65 7942 696e 6469 6e67  ional[KeyBinding
-00008690: 7342 6173 655d 3a0a 2020 2020 2020 2020  sBase]:.        
-000086a0: 7265 7475 726e 2073 656c 662e 6269 6e64  return self.bind
-000086b0: 0a0a 2020 2020 6465 6620 6765 745f 6368  ..    def get_ch
-000086c0: 696c 6472 656e 2873 656c 6629 202d 3e20  ildren(self) -> 
-000086d0: 4c69 7374 5b43 6f6e 7461 696e 6572 5d3a  List[Container]:
-000086e0: 0a20 2020 2020 2020 2063 6869 6c64 7265  .        childre
-000086f0: 6e20 3d20 5b73 656c 662e 636f 6e74 656e  n = [self.conten
-00008700: 745d 0a20 2020 2020 2020 2063 6869 6c64  t].        child
-00008710: 7265 6e2e 6578 7465 6e64 2866 2e63 6f6e  ren.extend(f.con
-00008720: 7465 6e74 2066 6f72 2066 2069 6e20 7365  tent for f in se
-00008730: 6c66 2e66 6c6f 6174 7329 0a20 2020 2020  lf.floats).     
-00008740: 2020 2072 6574 7572 6e20 6368 696c 6472     return childr
-00008750: 656e 0a0a 0a63 6c61 7373 2046 6c6f 6174  en...class Float
-00008760: 3a0a 2020 2020 2222 220a 2020 2020 466c  :.    """.    Fl
-00008770: 6f61 7420 666f 7220 7573 6520 696e 2061  oat for use in a
-00008780: 203a 636c 6173 733a 602e 466c 6f61 7443   :class:`.FloatC
-00008790: 6f6e 7461 696e 6572 602e 0a20 2020 2045  ontainer`..    E
-000087a0: 7863 6570 7420 666f 7220 7468 6520 6063  xcept for the `c
-000087b0: 6f6e 7465 6e74 6020 7061 7261 6d65 7465  ontent` paramete
-000087c0: 722c 2061 6c6c 206f 7468 6572 206f 7074  r, all other opt
-000087d0: 696f 6e73 2061 7265 206f 7074 696f 6e61  ions are optiona
-000087e0: 6c2e 0a0a 2020 2020 3a70 6172 616d 2063  l...    :param c
-000087f0: 6f6e 7465 6e74 3a20 3a63 6c61 7373 3a60  ontent: :class:`
-00008800: 2e43 6f6e 7461 696e 6572 6020 696e 7374  .Container` inst
-00008810: 616e 6365 2e0a 0a20 2020 203a 7061 7261  ance...    :para
-00008820: 6d20 7769 6474 683a 203a 636c 6173 733a  m width: :class:
-00008830: 602e 4469 6d65 6e73 696f 6e60 206f 7220  `.Dimension` or 
-00008840: 6361 6c6c 6162 6c65 2077 6869 6368 2072  callable which r
-00008850: 6574 7572 6e73 2061 203a 636c 6173 733a  eturns a :class:
-00008860: 602e 4469 6d65 6e73 696f 6e60 2e0a 2020  `.Dimension`..  
-00008870: 2020 3a70 6172 616d 2068 6569 6768 743a    :param height:
-00008880: 203a 636c 6173 733a 602e 4469 6d65 6e73   :class:`.Dimens
-00008890: 696f 6e60 206f 7220 6361 6c6c 6162 6c65  ion` or callable
-000088a0: 2077 6869 6368 2072 6574 7572 6e73 2061   which returns a
-000088b0: 203a 636c 6173 733a 602e 4469 6d65 6e73   :class:`.Dimens
-000088c0: 696f 6e60 2e0a 0a20 2020 203a 7061 7261  ion`...    :para
-000088d0: 6d20 6c65 6674 3a20 4469 7374 616e 6365  m left: Distance
-000088e0: 2074 6f20 7468 6520 6c65 6674 2065 6467   to the left edg
-000088f0: 6520 6f66 2074 6865 203a 636c 6173 733a  e of the :class:
-00008900: 602e 466c 6f61 7443 6f6e 7461 696e 6572  `.FloatContainer
-00008910: 602e 0a20 2020 203a 7061 7261 6d20 7269  `..    :param ri
-00008920: 6768 743a 2044 6973 7461 6e63 6520 746f  ght: Distance to
-00008930: 2074 6865 2072 6967 6874 2065 6467 6520   the right edge 
-00008940: 6f66 2074 6865 203a 636c 6173 733a 602e  of the :class:`.
-00008950: 466c 6f61 7443 6f6e 7461 696e 6572 602e  FloatContainer`.
-00008960: 0a20 2020 203a 7061 7261 6d20 746f 703a  .    :param top:
-00008970: 2044 6973 7461 6e63 6520 746f 2074 6865   Distance to the
-00008980: 2074 6f70 206f 6620 7468 6520 3a63 6c61   top of the :cla
-00008990: 7373 3a60 2e46 6c6f 6174 436f 6e74 6169  ss:`.FloatContai
-000089a0: 6e65 7260 2e0a 2020 2020 3a70 6172 616d  ner`..    :param
-000089b0: 2062 6f74 746f 6d3a 2044 6973 7461 6e63   bottom: Distanc
-000089c0: 6520 746f 2074 6865 2062 6f74 746f 6d20  e to the bottom 
-000089d0: 6f66 2074 6865 203a 636c 6173 733a 602e  of the :class:`.
-000089e0: 466c 6f61 7443 6f6e 7461 696e 6572 602e  FloatContainer`.
-000089f0: 0a0a 2020 2020 3a70 6172 616d 2061 7474  ..    :param att
-00008a00: 6163 685f 746f 5f77 696e 646f 773a 2041  ach_to_window: A
-00008a10: 7474 6163 6820 746f 2074 6865 2063 7572  ttach to the cur
-00008a20: 736f 7220 6672 6f6d 2074 6869 7320 7769  sor from this wi
-00008a30: 6e64 6f77 2c20 696e 7374 6561 6420 6f66  ndow, instead of
-00008a40: 0a20 2020 2020 2020 2074 6865 2063 7572  .        the cur
-00008a50: 7265 6e74 2077 696e 646f 772e 0a20 2020  rent window..   
-00008a60: 203a 7061 7261 6d20 6869 6465 5f77 6865   :param hide_whe
-00008a70: 6e5f 636f 7665 7269 6e67 5f63 6f6e 7465  n_covering_conte
-00008a80: 6e74 3a20 4869 6465 2074 6865 2066 6c6f  nt: Hide the flo
-00008a90: 6174 2077 6865 6e20 6974 2063 6f76 6572  at when it cover
-00008aa0: 7320 636f 6e74 656e 7420 756e 6465 726e  s content undern
-00008ab0: 6561 7468 2e0a 2020 2020 3a70 6172 616d  eath..    :param
-00008ac0: 2061 6c6c 6f77 5f63 6f76 6572 5f63 7572   allow_cover_cur
-00008ad0: 736f 723a 2057 6865 6e20 6046 616c 7365  sor: When `False
-00008ae0: 602c 206d 616b 6520 7375 7265 2074 6f20  `, make sure to 
-00008af0: 6469 7370 6c61 7920 7468 6520 666c 6f61  display the floa
-00008b00: 740a 2020 2020 2020 2020 6265 6c6f 7720  t.        below 
-00008b10: 7468 6520 6375 7273 6f72 2e20 4e6f 7420  the cursor. Not 
-00008b20: 6f6e 2074 6f70 206f 6620 7468 6520 696e  on top of the in
-00008b30: 6469 6361 7465 6420 706f 7369 7469 6f6e  dicated position
-00008b40: 2e0a 2020 2020 3a70 6172 616d 207a 5f69  ..    :param z_i
-00008b50: 6e64 6578 3a20 5a2d 696e 6465 7820 706f  ndex: Z-index po
-00008b60: 7369 7469 6f6e 2e20 466f 7220 6120 466c  sition. For a Fl
-00008b70: 6f61 742c 2074 6869 7320 6e65 6564 7320  oat, this needs 
-00008b80: 746f 2062 6520 6174 206c 6561 7374 0a20  to be at least. 
-00008b90: 2020 2020 2020 206f 6e65 2e20 4974 2069         one. It i
-00008ba0: 7320 7265 6c61 7469 7665 2074 6f20 7468  s relative to th
-00008bb0: 6520 7a5f 696e 6465 7820 6f66 2074 6865  e z_index of the
-00008bc0: 2070 6172 656e 7420 636f 6e74 6169 6e65   parent containe
-00008bd0: 722e 0a20 2020 203a 7061 7261 6d20 7472  r..    :param tr
-00008be0: 616e 7370 6172 656e 743a 203a 636c 6173  ansparent: :clas
-00008bf0: 733a 602e 4669 6c74 6572 6020 696e 6469  s:`.Filter` indi
-00008c00: 6361 7469 6e67 2077 6865 7468 6572 2074  cating whether t
-00008c10: 6869 7320 666c 6f61 7420 6e65 6564 7320  his float needs 
-00008c20: 746f 2062 650a 2020 2020 2020 2020 6472  to be.        dr
-00008c30: 6177 6e20 7472 616e 7370 6172 656e 746c  awn transparentl
-00008c40: 792e 0a20 2020 2022 2222 0a0a 2020 2020  y..    """..    
-00008c50: 6465 6620 5f5f 696e 6974 5f5f 280a 2020  def __init__(.  
-00008c60: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00008c70: 2020 2020 636f 6e74 656e 743a 2041 6e79      content: Any
-00008c80: 436f 6e74 6169 6e65 722c 0a20 2020 2020  Container,.     
-00008c90: 2020 2074 6f70 3a20 4f70 7469 6f6e 616c     top: Optional
-00008ca0: 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a 2020  [int] = None,.  
-00008cb0: 2020 2020 2020 7269 6768 743a 204f 7074        right: Opt
-00008cc0: 696f 6e61 6c5b 696e 745d 203d 204e 6f6e  ional[int] = Non
-00008cd0: 652c 0a20 2020 2020 2020 2062 6f74 746f  e,.        botto
-00008ce0: 6d3a 204f 7074 696f 6e61 6c5b 696e 745d  m: Optional[int]
-00008cf0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00008d00: 206c 6566 743a 204f 7074 696f 6e61 6c5b   left: Optional[
-00008d10: 696e 745d 203d 204e 6f6e 652c 0a20 2020  int] = None,.   
-00008d20: 2020 2020 2077 6964 7468 3a20 4f70 7469       width: Opti
-00008d30: 6f6e 616c 5b55 6e69 6f6e 5b69 6e74 2c20  onal[Union[int, 
-00008d40: 4361 6c6c 6162 6c65 5b5b 5d2c 2069 6e74  Callable[[], int
-00008d50: 5d5d 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ]]] = None,.    
-00008d60: 2020 2020 6865 6967 6874 3a20 4f70 7469      height: Opti
-00008d70: 6f6e 616c 5b55 6e69 6f6e 5b69 6e74 2c20  onal[Union[int, 
-00008d80: 4361 6c6c 6162 6c65 5b5b 5d2c 2069 6e74  Callable[[], int
-00008d90: 5d5d 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ]]] = None,.    
-00008da0: 2020 2020 7863 7572 736f 723a 2062 6f6f      xcursor: boo
-00008db0: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
-00008dc0: 2020 2079 6375 7273 6f72 3a20 626f 6f6c     ycursor: bool
-00008dd0: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
-00008de0: 2020 6174 7461 6368 5f74 6f5f 7769 6e64    attach_to_wind
-00008df0: 6f77 3a20 4f70 7469 6f6e 616c 5b41 6e79  ow: Optional[Any
-00008e00: 436f 6e74 6169 6e65 725d 203d 204e 6f6e  Container] = Non
-00008e10: 652c 0a20 2020 2020 2020 2068 6964 655f  e,.        hide_
-00008e20: 7768 656e 5f63 6f76 6572 696e 675f 636f  when_covering_co
-00008e30: 6e74 656e 743a 2062 6f6f 6c20 3d20 4661  ntent: bool = Fa
-00008e40: 6c73 652c 0a20 2020 2020 2020 2061 6c6c  lse,.        all
-00008e50: 6f77 5f63 6f76 6572 5f63 7572 736f 723a  ow_cover_cursor:
-00008e60: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
-00008e70: 2020 2020 2020 207a 5f69 6e64 6578 3a20         z_index: 
-00008e80: 696e 7420 3d20 312c 0a20 2020 2020 2020  int = 1,.       
-00008e90: 2074 7261 6e73 7061 7265 6e74 3a20 626f   transparent: bo
-00008ea0: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-00008eb0: 2920 2d3e 204e 6f6e 653a 0a0a 2020 2020  ) -> None:..    
-00008ec0: 2020 2020 6173 7365 7274 207a 5f69 6e64      assert z_ind
-00008ed0: 6578 203e 3d20 310a 0a20 2020 2020 2020  ex >= 1..       
-00008ee0: 2073 656c 662e 6c65 6674 203d 206c 6566   self.left = lef
-00008ef0: 740a 2020 2020 2020 2020 7365 6c66 2e72  t.        self.r
-00008f00: 6967 6874 203d 2072 6967 6874 0a20 2020  ight = right.   
-00008f10: 2020 2020 2073 656c 662e 746f 7020 3d20       self.top = 
-00008f20: 746f 700a 2020 2020 2020 2020 7365 6c66  top.        self
-00008f30: 2e62 6f74 746f 6d20 3d20 626f 7474 6f6d  .bottom = bottom
-00008f40: 0a0a 2020 2020 2020 2020 7365 6c66 2e77  ..        self.w
-00008f50: 6964 7468 203d 2077 6964 7468 0a20 2020  idth = width.   
-00008f60: 2020 2020 2073 656c 662e 6865 6967 6874       self.height
-00008f70: 203d 2068 6569 6768 740a 0a20 2020 2020   = height..     
-00008f80: 2020 2073 656c 662e 7863 7572 736f 7220     self.xcursor 
-00008f90: 3d20 7863 7572 736f 720a 2020 2020 2020  = xcursor.      
-00008fa0: 2020 7365 6c66 2e79 6375 7273 6f72 203d    self.ycursor =
-00008fb0: 2079 6375 7273 6f72 0a0a 2020 2020 2020   ycursor..      
-00008fc0: 2020 7365 6c66 2e61 7474 6163 685f 746f    self.attach_to
-00008fd0: 5f77 696e 646f 7720 3d20 280a 2020 2020  _window = (.    
-00008fe0: 2020 2020 2020 2020 746f 5f77 696e 646f          to_windo
-00008ff0: 7728 6174 7461 6368 5f74 6f5f 7769 6e64  w(attach_to_wind
-00009000: 6f77 2920 6966 2061 7474 6163 685f 746f  ow) if attach_to
-00009010: 5f77 696e 646f 7720 656c 7365 204e 6f6e  _window else Non
-00009020: 650a 2020 2020 2020 2020 290a 0a20 2020  e.        )..   
-00009030: 2020 2020 2073 656c 662e 636f 6e74 656e       self.conten
-00009040: 7420 3d20 746f 5f63 6f6e 7461 696e 6572  t = to_container
-00009050: 2863 6f6e 7465 6e74 290a 2020 2020 2020  (content).      
-00009060: 2020 7365 6c66 2e68 6964 655f 7768 656e    self.hide_when
-00009070: 5f63 6f76 6572 696e 675f 636f 6e74 656e  _covering_conten
-00009080: 7420 3d20 6869 6465 5f77 6865 6e5f 636f  t = hide_when_co
-00009090: 7665 7269 6e67 5f63 6f6e 7465 6e74 0a20  vering_content. 
-000090a0: 2020 2020 2020 2073 656c 662e 616c 6c6f         self.allo
-000090b0: 775f 636f 7665 725f 6375 7273 6f72 203d  w_cover_cursor =
-000090c0: 2061 6c6c 6f77 5f63 6f76 6572 5f63 7572   allow_cover_cur
-000090d0: 736f 720a 2020 2020 2020 2020 7365 6c66  sor.        self
-000090e0: 2e7a 5f69 6e64 6578 203d 207a 5f69 6e64  .z_index = z_ind
-000090f0: 6578 0a20 2020 2020 2020 2073 656c 662e  ex.        self.
-00009100: 7472 616e 7370 6172 656e 7420 3d20 746f  transparent = to
-00009110: 5f66 696c 7465 7228 7472 616e 7370 6172  _filter(transpar
-00009120: 656e 7429 0a0a 2020 2020 6465 6620 6765  ent)..    def ge
-00009130: 745f 7769 6474 6828 7365 6c66 2920 2d3e  t_width(self) ->
-00009140: 204f 7074 696f 6e61 6c5b 696e 745d 3a0a   Optional[int]:.
-00009150: 2020 2020 2020 2020 6966 2063 616c 6c61          if calla
-00009160: 626c 6528 7365 6c66 2e77 6964 7468 293a  ble(self.width):
-00009170: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00009180: 7572 6e20 7365 6c66 2e77 6964 7468 2829  urn self.width()
-00009190: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000091a0: 7365 6c66 2e77 6964 7468 0a0a 2020 2020  self.width..    
-000091b0: 6465 6620 6765 745f 6865 6967 6874 2873  def get_height(s
-000091c0: 656c 6629 202d 3e20 4f70 7469 6f6e 616c  elf) -> Optional
-000091d0: 5b69 6e74 5d3a 0a20 2020 2020 2020 2069  [int]:.        i
-000091e0: 6620 6361 6c6c 6162 6c65 2873 656c 662e  f callable(self.
-000091f0: 6865 6967 6874 293a 0a20 2020 2020 2020  height):.       
-00009200: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00009210: 2e68 6569 6768 7428 290a 2020 2020 2020  .height().      
-00009220: 2020 7265 7475 726e 2073 656c 662e 6865    return self.he
-00009230: 6967 6874 0a0a 2020 2020 6465 6620 5f5f  ight..    def __
-00009240: 7265 7072 5f5f 2873 656c 6629 202d 3e20  repr__(self) -> 
-00009250: 7374 723a 0a20 2020 2020 2020 2072 6574  str:.        ret
-00009260: 7572 6e20 2246 6c6f 6174 2863 6f6e 7465  urn "Float(conte
-00009270: 6e74 3d25 7229 2220 2520 7365 6c66 2e63  nt=%r)" % self.c
-00009280: 6f6e 7465 6e74 0a0a 0a63 6c61 7373 2057  ontent...class W
-00009290: 696e 646f 7752 656e 6465 7249 6e66 6f3a  indowRenderInfo:
-000092a0: 0a20 2020 2022 2222 0a20 2020 2052 656e  .    """.    Ren
-000092b0: 6465 7220 696e 666f 726d 6174 696f 6e20  der information 
-000092c0: 666f 7220 7468 6520 6c61 7374 2072 656e  for the last ren
-000092d0: 6465 7220 7469 6d65 206f 6620 7468 6973  der time of this
-000092e0: 2063 6f6e 7472 6f6c 2e0a 2020 2020 4974   control..    It
-000092f0: 2073 746f 7265 7320 6d61 7070 696e 6720   stores mapping 
-00009300: 696e 666f 726d 6174 696f 6e20 6265 7477  information betw
-00009310: 6565 6e20 7468 6520 696e 7075 7420 6275  een the input bu
-00009320: 6666 6572 7320 2869 6e20 6361 7365 206f  ffers (in case o
-00009330: 6620 610a 2020 2020 3a63 6c61 7373 3a60  f a.    :class:`
-00009340: 7e71 756f 2e6c 6179 6f75 742e 636f 6e74  ~quo.layout.cont
-00009350: 726f 6c73 2e42 7566 6665 7243 6f6e 7472  rols.BufferContr
-00009360: 6f6c 6029 2061 6e64 2074 6865 2061 6374  ol`) and the act
-00009370: 7561 6c0a 2020 2020 7265 6e64 6572 2070  ual.    render p
-00009380: 6f73 6974 696f 6e20 6f6e 2074 6865 206f  osition on the o
-00009390: 7574 7075 7420 7363 7265 656e 2e0a 0a20  utput screen... 
-000093a0: 2020 2028 436f 756c 6420 6265 2075 7365     (Could be use
-000093b0: 6420 666f 7220 696d 706c 656d 656e 7461  d for implementa
-000093c0: 7469 6f6e 206f 6620 7468 6520 5669 2027  tion of the Vi '
-000093d0: 4827 2061 6e64 2027 4c27 206b 6579 2062  H' and 'L' key b
-000093e0: 696e 6469 6e67 7320 6173 0a20 2020 2077  indings as.    w
-000093f0: 656c 6c20 6173 2069 6d70 6c65 6d65 6e74  ell as implement
-00009400: 696e 6720 6d6f 7573 6520 7375 7070 6f72  ing mouse suppor
-00009410: 742e 290a 0a20 2020 203a 7061 7261 6d20  t.)..    :param 
-00009420: 7569 5f63 6f6e 7465 6e74 3a20 5468 6520  ui_content: The 
-00009430: 6f72 6967 696e 616c 203a 636c 6173 733a  original :class:
-00009440: 602e 5549 436f 6e74 656e 7460 2069 6e73  `.UIContent` ins
-00009450: 7461 6e63 6520 7468 6174 2063 6f6e 7461  tance that conta
-00009460: 696e 730a 2020 2020 2020 2020 7468 6520  ins.        the 
-00009470: 7768 6f6c 6520 696e 7075 742c 2077 6974  whole input, wit
-00009480: 686f 7574 2063 6c69 7070 696e 672e 2028  hout clipping. (
-00009490: 7569 5f63 6f6e 7465 6e74 290a 2020 2020  ui_content).    
-000094a0: 3a70 6172 616d 2068 6f72 697a 6f6e 7461  :param horizonta
-000094b0: 6c5f 7363 726f 6c6c 3a20 5468 6520 686f  l_scroll: The ho
-000094c0: 7269 7a6f 6e74 616c 2073 6372 6f6c 6c20  rizontal scroll 
-000094d0: 6f66 2074 6865 203a 636c 6173 733a 602e  of the :class:`.
-000094e0: 5769 6e64 6f77 6020 696e 7374 616e 6365  Window` instance
-000094f0: 2e0a 2020 2020 3a70 6172 616d 2076 6572  ..    :param ver
-00009500: 7469 6361 6c5f 7363 726f 6c6c 3a20 5468  tical_scroll: Th
-00009510: 6520 7665 7274 6963 616c 2073 6372 6f6c  e vertical scrol
-00009520: 6c20 6f66 2074 6865 203a 636c 6173 733a  l of the :class:
-00009530: 602e 5769 6e64 6f77 6020 696e 7374 616e  `.Window` instan
-00009540: 6365 2e0a 2020 2020 3a70 6172 616d 2077  ce..    :param w
-00009550: 696e 646f 775f 7769 6474 683a 2054 6865  indow_width: The
-00009560: 2077 6964 7468 206f 6620 7468 6520 7769   width of the wi
-00009570: 6e64 6f77 2074 6861 7420 6469 7370 6c61  ndow that displa
-00009580: 7973 2074 6865 2063 6f6e 7465 6e74 2c0a  ys the content,.
-00009590: 2020 2020 2020 2020 7769 7468 6f75 7420          without 
-000095a0: 7468 6520 6d61 7267 696e 732e 0a20 2020  the margins..   
-000095b0: 203a 7061 7261 6d20 7769 6e64 6f77 5f68   :param window_h
-000095c0: 6569 6768 743a 2054 6865 2068 6569 6768  eight: The heigh
-000095d0: 7420 6f66 2074 6865 2077 696e 646f 7720  t of the window 
-000095e0: 7468 6174 2064 6973 706c 6179 7320 7468  that displays th
-000095f0: 6520 636f 6e74 656e 742e 0a20 2020 203a  e content..    :
-00009600: 7061 7261 6d20 636f 6e66 6967 7572 6564  param configured
-00009610: 5f73 6372 6f6c 6c5f 6f66 6673 6574 733a  _scroll_offsets:
-00009620: 2054 6865 2073 6372 6f6c 6c20 6f66 6673   The scroll offs
-00009630: 6574 7320 6173 2063 6f6e 6669 6775 7265  ets as configure
-00009640: 6420 666f 7220 7468 650a 2020 2020 2020  d for the.      
-00009650: 2020 3a63 6c61 7373 3a60 5769 6e64 6f77    :class:`Window
-00009660: 6020 696e 7374 616e 6365 2e0a 2020 2020  ` instance..    
-00009670: 3a70 6172 616d 2076 6973 6962 6c65 5f6c  :param visible_l
-00009680: 696e 655f 746f 5f72 6f77 5f63 6f6c 3a20  ine_to_row_col: 
-00009690: 4d61 7070 696e 6720 7468 6174 206d 6170  Mapping that map
-000096a0: 7320 7468 6520 726f 7720 6e75 6d62 6572  s the row number
-000096b0: 7320 6f6e 2074 6865 0a20 2020 2020 2020  s on the.       
-000096c0: 2064 6973 706c 6179 6564 2073 6372 6565   displayed scree
-000096d0: 6e20 2873 7461 7274 696e 6720 6672 6f6d  n (starting from
-000096e0: 207a 6572 6f20 666f 7220 7468 6520 6669   zero for the fi
-000096f0: 7273 7420 7669 7369 626c 6520 6c69 6e65  rst visible line
-00009700: 2920 746f 0a20 2020 2020 2020 2028 726f  ) to.        (ro
-00009710: 772c 2063 6f6c 2920 7475 706c 6573 2070  w, col) tuples p
-00009720: 6f69 6e74 696e 6720 746f 2074 6865 2072  ointing to the r
-00009730: 6f77 2061 6e64 2063 6f6c 756d 6e20 6f66  ow and column of
-00009740: 2074 6865 203a 636c 6173 733a 602e 5549   the :class:`.UI
-00009750: 436f 6e74 656e 7460 2e0a 2020 2020 3a70  Content`..    :p
-00009760: 6172 616d 2072 6f77 636f 6c5f 746f 5f79  aram rowcol_to_y
-00009770: 783a 204d 6170 7069 6e67 2074 6861 7420  x: Mapping that 
-00009780: 6d61 7073 2028 726f 772c 2063 6f6c 756d  maps (row, colum
-00009790: 6e29 2074 7570 6c65 7320 7265 7072 6573  n) tuples repres
-000097a0: 656e 7469 6e67 0a20 2020 2020 2020 2063  enting.        c
-000097b0: 6f6f 7264 696e 6174 6573 206f 6620 7468  oordinates of th
-000097c0: 6520 3a63 6c61 7373 3a60 5549 436f 6e74  e :class:`UICont
-000097d0: 656e 7460 2074 6f20 2879 2c20 7829 2061  ent` to (y, x) a
-000097e0: 6273 6f6c 7574 6520 636f 6f72 6469 6e61  bsolute coordina
-000097f0: 7465 7320 6174 0a20 2020 2020 2020 2074  tes at.        t
-00009800: 6865 2072 656e 6465 7265 6420 7363 7265  he rendered scre
-00009810: 656e 2e0a 2020 2020 2222 220a 0a20 2020  en..    """..   
-00009820: 2064 6566 205f 5f69 6e69 745f 5f28 0a20   def __init__(. 
-00009830: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00009840: 2020 2020 2077 696e 646f 773a 2022 5769       window: "Wi
-00009850: 6e64 6f77 222c 0a20 2020 2020 2020 2075  ndow",.        u
-00009860: 695f 636f 6e74 656e 743a 2055 4943 6f6e  i_content: UICon
-00009870: 7465 6e74 2c0a 2020 2020 2020 2020 686f  tent,.        ho
-00009880: 7269 7a6f 6e74 616c 5f73 6372 6f6c 6c3a  rizontal_scroll:
-00009890: 2069 6e74 2c0a 2020 2020 2020 2020 7665   int,.        ve
-000098a0: 7274 6963 616c 5f73 6372 6f6c 6c3a 2069  rtical_scroll: i
-000098b0: 6e74 2c0a 2020 2020 2020 2020 7769 6e64  nt,.        wind
-000098c0: 6f77 5f77 6964 7468 3a20 696e 742c 0a20  ow_width: int,. 
-000098d0: 2020 2020 2020 2077 696e 646f 775f 6865         window_he
-000098e0: 6967 6874 3a20 696e 742c 0a20 2020 2020  ight: int,.     
-000098f0: 2020 2063 6f6e 6669 6775 7265 645f 7363     configured_sc
-00009900: 726f 6c6c 5f6f 6666 7365 7473 3a20 2253  roll_offsets: "S
-00009910: 6372 6f6c 6c4f 6666 7365 7473 222c 0a20  crollOffsets",. 
-00009920: 2020 2020 2020 2076 6973 6962 6c65 5f6c         visible_l
-00009930: 696e 655f 746f 5f72 6f77 5f63 6f6c 3a20  ine_to_row_col: 
-00009940: 4469 6374 5b69 6e74 2c20 5475 706c 655b  Dict[int, Tuple[
-00009950: 696e 742c 2069 6e74 5d5d 2c0a 2020 2020  int, int]],.    
-00009960: 2020 2020 726f 7763 6f6c 5f74 6f5f 7978      rowcol_to_yx
-00009970: 3a20 4469 6374 5b54 7570 6c65 5b69 6e74  : Dict[Tuple[int
-00009980: 2c20 696e 745d 2c20 5475 706c 655b 696e  , int], Tuple[in
-00009990: 742c 2069 6e74 5d5d 2c0a 2020 2020 2020  t, int]],.      
-000099a0: 2020 785f 6f66 6673 6574 3a20 696e 742c    x_offset: int,
-000099b0: 0a20 2020 2020 2020 2079 5f6f 6666 7365  .        y_offse
-000099c0: 743a 2069 6e74 2c0a 2020 2020 2020 2020  t: int,.        
-000099d0: 7772 6170 5f6c 696e 6573 3a20 626f 6f6c  wrap_lines: bool
-000099e0: 2c0a 2020 2020 2920 2d3e 204e 6f6e 653a  ,.    ) -> None:
-000099f0: 0a0a 2020 2020 2020 2020 7365 6c66 2e77  ..        self.w
-00009a00: 696e 646f 7720 3d20 7769 6e64 6f77 0a20  indow = window. 
-00009a10: 2020 2020 2020 2073 656c 662e 7569 5f63         self.ui_c
-00009a20: 6f6e 7465 6e74 203d 2075 695f 636f 6e74  ontent = ui_cont
-00009a30: 656e 740a 2020 2020 2020 2020 7365 6c66  ent.        self
-00009a40: 2e76 6572 7469 6361 6c5f 7363 726f 6c6c  .vertical_scroll
-00009a50: 203d 2076 6572 7469 6361 6c5f 7363 726f   = vertical_scro
-00009a60: 6c6c 0a20 2020 2020 2020 2073 656c 662e  ll.        self.
-00009a70: 7769 6e64 6f77 5f77 6964 7468 203d 2077  window_width = w
-00009a80: 696e 646f 775f 7769 6474 6820 2023 2057  indow_width  # W
-00009a90: 6964 7468 2077 6974 686f 7574 206d 6172  idth without mar
-00009aa0: 6769 6e73 2e0a 2020 2020 2020 2020 7365  gins..        se
-00009ab0: 6c66 2e77 696e 646f 775f 6865 6967 6874  lf.window_height
-00009ac0: 203d 2077 696e 646f 775f 6865 6967 6874   = window_height
-00009ad0: 0a0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-00009ae0: 6f6e 6669 6775 7265 645f 7363 726f 6c6c  onfigured_scroll
-00009af0: 5f6f 6666 7365 7473 203d 2063 6f6e 6669  _offsets = confi
-00009b00: 6775 7265 645f 7363 726f 6c6c 5f6f 6666  gured_scroll_off
-00009b10: 7365 7473 0a20 2020 2020 2020 2073 656c  sets.        sel
-00009b20: 662e 7669 7369 626c 655f 6c69 6e65 5f74  f.visible_line_t
-00009b30: 6f5f 726f 775f 636f 6c20 3d20 7669 7369  o_row_col = visi
-00009b40: 626c 655f 6c69 6e65 5f74 6f5f 726f 775f  ble_line_to_row_
-00009b50: 636f 6c0a 2020 2020 2020 2020 7365 6c66  col.        self
-00009b60: 2e77 7261 705f 6c69 6e65 7320 3d20 7772  .wrap_lines = wr
-00009b70: 6170 5f6c 696e 6573 0a0a 2020 2020 2020  ap_lines..      
-00009b80: 2020 7365 6c66 2e5f 726f 7763 6f6c 5f74    self._rowcol_t
-00009b90: 6f5f 7978 203d 2072 6f77 636f 6c5f 746f  o_yx = rowcol_to
-00009ba0: 5f79 7820 2023 2072 6f77 2f63 6f6c 2066  _yx  # row/col f
-00009bb0: 726f 6d20 696e 7075 7420 746f 2061 6273  rom input to abs
-00009bc0: 6f6c 7574 6520 792f 780a 2020 2020 2020  olute y/x.      
-00009bd0: 2020 2320 7363 7265 656e 2063 6f6f 7264    # screen coord
-00009be0: 696e 6174 6573 2e0a 2020 2020 2020 2020  inates..        
-00009bf0: 7365 6c66 2e5f 785f 6f66 6673 6574 203d  self._x_offset =
-00009c00: 2078 5f6f 6666 7365 740a 2020 2020 2020   x_offset.      
-00009c10: 2020 7365 6c66 2e5f 795f 6f66 6673 6574    self._y_offset
-00009c20: 203d 2079 5f6f 6666 7365 740a 0a20 2020   = y_offset..   
-00009c30: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-00009c40: 6566 2076 6973 6962 6c65 5f6c 696e 655f  ef visible_line_
-00009c50: 746f 5f69 6e70 7574 5f6c 696e 6528 7365  to_input_line(se
-00009c60: 6c66 2920 2d3e 2044 6963 745b 696e 742c  lf) -> Dict[int,
-00009c70: 2069 6e74 5d3a 0a20 2020 2020 2020 2072   int]:.        r
-00009c80: 6574 7572 6e20 7b0a 2020 2020 2020 2020  eturn {.        
-00009c90: 2020 2020 7669 7369 626c 655f 6c69 6e65      visible_line
-00009ca0: 3a20 726f 7763 6f6c 5b30 5d0a 2020 2020  : rowcol[0].    
-00009cb0: 2020 2020 2020 2020 666f 7220 7669 7369          for visi
-00009cc0: 626c 655f 6c69 6e65 2c20 726f 7763 6f6c  ble_line, rowcol
-00009cd0: 2069 6e20 7365 6c66 2e76 6973 6962 6c65   in self.visible
-00009ce0: 5f6c 696e 655f 746f 5f72 6f77 5f63 6f6c  _line_to_row_col
-00009cf0: 2e69 7465 6d73 2829 0a20 2020 2020 2020  .items().       
-00009d00: 207d 0a0a 2020 2020 4070 726f 7065 7274   }..    @propert
-00009d10: 790a 2020 2020 6465 6620 6375 7273 6f72  y.    def cursor
-00009d20: 5f70 6f73 6974 696f 6e28 7365 6c66 2920  _position(self) 
-00009d30: 2d3e 2050 6f69 6e74 3a0a 2020 2020 2020  -> Point:.      
-00009d40: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-00009d50: 7475 726e 2074 6865 2063 7572 736f 7220  turn the cursor 
-00009d60: 706f 7369 7469 6f6e 2063 6f6f 7264 696e  position coordin
-00009d70: 6174 6573 2c20 7265 6c61 7469 7665 2074  ates, relative t
-00009d80: 6f20 7468 6520 6c65 6674 2f74 6f70 2063  o the left/top c
-00009d90: 6f72 6e65 720a 2020 2020 2020 2020 6f66  orner.        of
-00009da0: 2074 6865 2072 656e 6465 7265 6420 7363   the rendered sc
-00009db0: 7265 656e 2e0a 2020 2020 2020 2020 2222  reen..        ""
-00009dc0: 220a 2020 2020 2020 2020 6370 6f73 203d  ".        cpos =
-00009dd0: 2073 656c 662e 7569 5f63 6f6e 7465 6e74   self.ui_content
-00009de0: 2e63 7572 736f 725f 706f 7369 7469 6f6e  .cursor_position
-00009df0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00009e00: 2020 2020 2020 2020 2020 792c 2078 203d            y, x =
-00009e10: 2073 656c 662e 5f72 6f77 636f 6c5f 746f   self._rowcol_to
-00009e20: 5f79 785b 6370 6f73 2e79 2c20 6370 6f73  _yx[cpos.y, cpos
-00009e30: 2e78 5d0a 2020 2020 2020 2020 6578 6365  .x].        exce
-00009e40: 7074 204b 6579 4572 726f 723a 0a20 2020  pt KeyError:.   
-00009e50: 2020 2020 2020 2020 2023 2046 6f72 2060           # For `
-00009e60: 4475 6d6d 7943 6f6e 7472 6f6c 6020 666f  DummyControl` fo
-00009e70: 7220 696e 7374 616e 6365 2c20 7468 6520  r instance, the 
-00009e80: 636f 6e74 656e 7420 6361 6e20 6265 2065  content can be e
-00009e90: 6d70 7479 2c20 616e 6420 736f 0a20 2020  mpty, and so.   
-00009ea0: 2020 2020 2020 2020 2023 2077 696c 6c20           # will 
-00009eb0: 605f 726f 7763 6f6c 5f74 6f5f 7978 6020  `_rowcol_to_yx` 
-00009ec0: 6265 2e20 5265 7475 726e 2030 2f30 2062  be. Return 0/0 b
-00009ed0: 7920 6465 6661 756c 742e 0a20 2020 2020  y default..     
-00009ee0: 2020 2020 2020 2072 6574 7572 6e20 506f         return Po
-00009ef0: 696e 7428 783d 302c 2079 3d30 290a 2020  int(x=0, y=0).  
-00009f00: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00009f10: 2020 2020 2020 2020 7265 7475 726e 2050          return P
-00009f20: 6f69 6e74 2878 3d78 202d 2073 656c 662e  oint(x=x - self.
-00009f30: 5f78 5f6f 6666 7365 742c 2079 3d79 202d  _x_offset, y=y -
-00009f40: 2073 656c 662e 5f79 5f6f 6666 7365 7429   self._y_offset)
-00009f50: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-00009f60: 2020 2020 6465 6620 6170 706c 6965 645f      def applied_
-00009f70: 7363 726f 6c6c 5f6f 6666 7365 7473 2873  scroll_offsets(s
-00009f80: 656c 6629 202d 3e20 2253 6372 6f6c 6c4f  elf) -> "ScrollO
-00009f90: 6666 7365 7473 223a 0a20 2020 2020 2020  ffsets":.       
-00009fa0: 2022 2222 0a20 2020 2020 2020 2052 6574   """.        Ret
-00009fb0: 7572 6e20 6120 3a63 6c61 7373 3a60 2e53  urn a :class:`.S
-00009fc0: 6372 6f6c 6c4f 6666 7365 7473 6020 696e  crollOffsets` in
-00009fd0: 7374 616e 6365 2074 6861 7420 696e 6469  stance that indi
-00009fe0: 6361 7465 7320 7468 6520 6163 7475 616c  cates the actual
-00009ff0: 0a20 2020 2020 2020 206f 6666 7365 742e  .        offset.
-0000a000: 2054 6869 7320 6361 6e20 6265 206c 6573   This can be les
-0000a010: 7320 7468 616e 206f 7220 6571 7561 6c20  s than or equal 
-0000a020: 746f 2077 6861 7427 7320 636f 6e66 6967  to what's config
-0000a030: 7572 6564 2e20 452e 672c 2077 6865 6e0a  ured. E.g, when.
-0000a040: 2020 2020 2020 2020 7468 6520 6375 7273          the curs
-0000a050: 6f72 2069 7320 636f 6d70 6c65 7465 6c79  or is completely
-0000a060: 2061 7420 7468 6520 746f 702c 2074 6865   at the top, the
-0000a070: 2074 6f70 206f 6666 7365 7420 7769 6c6c   top offset will
-0000a080: 2062 6520 7a65 726f 2072 6174 6865 720a   be zero rather.
-0000a090: 2020 2020 2020 2020 7468 616e 2077 6861          than wha
-0000a0a0: 7427 7320 636f 6e66 6967 7572 6564 2e0a  t's configured..
-0000a0b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000a0c0: 2020 2020 6966 2073 656c 662e 6469 7370      if self.disp
-0000a0d0: 6c61 7965 645f 6c69 6e65 735b 305d 203d  layed_lines[0] =
-0000a0e0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0000a0f0: 2074 6f70 203d 2030 0a20 2020 2020 2020   top = 0.       
-0000a100: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000a110: 2020 2023 2047 6574 2072 6f77 2077 6865     # Get row whe
-0000a120: 7265 2074 6865 2063 7572 736f 7220 6973  re the cursor is
-0000a130: 2064 6973 706c 6179 6564 2e0a 2020 2020   displayed..    
-0000a140: 2020 2020 2020 2020 7920 3d20 7365 6c66          y = self
-0000a150: 2e69 6e70 7574 5f6c 696e 655f 746f 5f76  .input_line_to_v
-0000a160: 6973 6962 6c65 5f6c 696e 655b 7365 6c66  isible_line[self
-0000a170: 2e75 695f 636f 6e74 656e 742e 6375 7273  .ui_content.curs
-0000a180: 6f72 5f70 6f73 6974 696f 6e2e 795d 0a20  or_position.y]. 
-0000a190: 2020 2020 2020 2020 2020 2074 6f70 203d             top =
-0000a1a0: 206d 696e 2879 2c20 7365 6c66 2e63 6f6e   min(y, self.con
-0000a1b0: 6669 6775 7265 645f 7363 726f 6c6c 5f6f  figured_scroll_o
-0000a1c0: 6666 7365 7473 2e74 6f70 290a 0a20 2020  ffsets.top)..   
-0000a1d0: 2020 2020 2072 6574 7572 6e20 5363 726f       return Scro
-0000a1e0: 6c6c 4f66 6673 6574 7328 0a20 2020 2020  llOffsets(.     
-0000a1f0: 2020 2020 2020 2074 6f70 3d74 6f70 2c0a         top=top,.
-0000a200: 2020 2020 2020 2020 2020 2020 626f 7474              bott
-0000a210: 6f6d 3d6d 696e 280a 2020 2020 2020 2020  om=min(.        
-0000a220: 2020 2020 2020 2020 7365 6c66 2e75 695f          self.ui_
-0000a230: 636f 6e74 656e 742e 6c69 6e65 5f63 6f75  content.line_cou
-0000a240: 6e74 202d 2073 656c 662e 6469 7370 6c61  nt - self.displa
-0000a250: 7965 645f 6c69 6e65 735b 2d31 5d20 2d20  yed_lines[-1] - 
-0000a260: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
-0000a270: 2020 2073 656c 662e 636f 6e66 6967 7572     self.configur
-0000a280: 6564 5f73 6372 6f6c 6c5f 6f66 6673 6574  ed_scroll_offset
-0000a290: 732e 626f 7474 6f6d 2c0a 2020 2020 2020  s.bottom,.      
-0000a2a0: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
-0000a2b0: 2020 2020 2023 2046 6f72 206c 6566 742f       # For left/
-0000a2c0: 7269 6768 742c 2069 7420 7072 6f62 6162  right, it probab
-0000a2d0: 6c79 2064 6f65 736e 2774 206d 616b 6520  ly doesn't make 
-0000a2e0: 7365 6e73 6520 746f 2072 6574 7572 6e20  sense to return 
-0000a2f0: 736f 6d65 7468 696e 672e 0a20 2020 2020  something..     
-0000a300: 2020 2020 2020 2023 2028 5765 2077 6f75         # (We wou
-0000a310: 6c64 2068 6176 6520 746f 2063 616c 6375  ld have to calcu
-0000a320: 6c61 7465 2074 6865 2077 6964 7468 7320  late the widths 
-0000a330: 6f66 2061 6c6c 2074 6865 206c 696e 6573  of all the lines
-0000a340: 2061 6e64 206b 6565 700a 2020 2020 2020   and keep.      
-0000a350: 2020 2020 2020 2320 646f 7562 6c65 2077        # double w
-0000a360: 6964 7468 2063 6861 7261 6374 6572 7320  idth characters 
-0000a370: 696e 206d 696e 642e 290a 2020 2020 2020  in mind.).      
-0000a380: 2020 2020 2020 6c65 6674 3d30 2c0a 2020        left=0,.  
-0000a390: 2020 2020 2020 2020 2020 7269 6768 743d            right=
-0000a3a0: 302c 0a20 2020 2020 2020 2029 0a0a 2020  0,.        )..  
-0000a3b0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-0000a3c0: 6465 6620 6469 7370 6c61 7965 645f 6c69  def displayed_li
-0000a3d0: 6e65 7328 7365 6c66 2920 2d3e 204c 6973  nes(self) -> Lis
-0000a3e0: 745b 696e 745d 3a0a 2020 2020 2020 2020  t[int]:.        
-0000a3f0: 2222 220a 2020 2020 2020 2020 4c69 7374  """.        List
-0000a400: 206f 6620 616c 6c20 7468 6520 7669 7369   of all the visi
-0000a410: 626c 6520 726f 7773 2e20 284c 696e 6520  ble rows. (Line 
-0000a420: 6e75 6d62 6572 7320 6f66 2074 6865 2069  numbers of the i
-0000a430: 6e70 7574 2062 7566 6665 722e 290a 2020  nput buffer.).  
-0000a440: 2020 2020 2020 5468 6520 6c61 7374 206c        The last l
-0000a450: 696e 6520 6d61 7920 6e6f 7420 6265 2065  ine may not be e
-0000a460: 6e74 6972 656c 7920 7669 7369 626c 652e  ntirely visible.
-0000a470: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000a480: 2020 2020 2072 6574 7572 6e20 736f 7274       return sort
-0000a490: 6564 2872 6f77 2066 6f72 2072 6f77 2c20  ed(row for row, 
-0000a4a0: 636f 6c20 696e 2073 656c 662e 7669 7369  col in self.visi
-0000a4b0: 626c 655f 6c69 6e65 5f74 6f5f 726f 775f  ble_line_to_row_
-0000a4c0: 636f 6c2e 7661 6c75 6573 2829 290a 0a20  col.values()).. 
-0000a4d0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-0000a4e0: 2064 6566 2069 6e70 7574 5f6c 696e 655f   def input_line_
-0000a4f0: 746f 5f76 6973 6962 6c65 5f6c 696e 6528  to_visible_line(
-0000a500: 7365 6c66 2920 2d3e 2044 6963 745b 696e  self) -> Dict[in
-0000a510: 742c 2069 6e74 5d3a 0a20 2020 2020 2020  t, int]:.       
-0000a520: 2022 2222 0a20 2020 2020 2020 2052 6574   """.        Ret
-0000a530: 7572 6e20 7468 6520 6469 6374 696f 6e61  urn the dictiona
-0000a540: 7279 206d 6170 7069 6e67 2074 6865 206c  ry mapping the l
-0000a550: 696e 6520 6e75 6d62 6572 7320 6f66 2074  ine numbers of t
-0000a560: 6865 2069 6e70 7574 2062 7566 6665 7220  he input buffer 
-0000a570: 746f 0a20 2020 2020 2020 2074 6865 206c  to.        the l
-0000a580: 696e 6573 206f 6620 7468 6520 7363 7265  ines of the scre
-0000a590: 656e 2e20 5768 656e 2061 206c 696e 6520  en. When a line 
-0000a5a0: 7370 616e 7320 7365 7665 7261 6c20 726f  spans several ro
-0000a5b0: 7773 2061 7420 7468 6520 7363 7265 656e  ws at the screen
-0000a5c0: 2c0a 2020 2020 2020 2020 7468 6520 6669  ,.        the fi
-0000a5d0: 7273 7420 726f 7720 6170 7065 6172 7320  rst row appears 
-0000a5e0: 696e 2074 6865 2064 6963 7469 6f6e 6172  in the dictionar
-0000a5f0: 792e 0a20 2020 2020 2020 2022 2222 0a20  y..        """. 
-0000a600: 2020 2020 2020 2072 6573 756c 743a 2044         result: D
-0000a610: 6963 745b 696e 742c 2069 6e74 5d20 3d20  ict[int, int] = 
-0000a620: 7b7d 0a20 2020 2020 2020 2066 6f72 206b  {}.        for k
-0000a630: 2c20 7620 696e 2073 656c 662e 7669 7369  , v in self.visi
-0000a640: 626c 655f 6c69 6e65 5f74 6f5f 696e 7075  ble_line_to_inpu
-0000a650: 745f 6c69 6e65 2e69 7465 6d73 2829 3a0a  t_line.items():.
-0000a660: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-0000a670: 2069 6e20 7265 7375 6c74 3a0a 2020 2020   in result:.    
-0000a680: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-0000a690: 6c74 5b76 5d20 3d20 6d69 6e28 7265 7375  lt[v] = min(resu
-0000a6a0: 6c74 5b76 5d2c 206b 290a 2020 2020 2020  lt[v], k).      
-0000a6b0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000a6c0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-0000a6d0: 6c74 5b76 5d20 3d20 6b0a 2020 2020 2020  lt[v] = k.      
-0000a6e0: 2020 7265 7475 726e 2072 6573 756c 740a    return result.
-0000a6f0: 0a20 2020 2064 6566 2066 6972 7374 5f76  .    def first_v
-0000a700: 6973 6962 6c65 5f6c 696e 6528 7365 6c66  isible_line(self
-0000a710: 2c20 6166 7465 725f 7363 726f 6c6c 5f6f  , after_scroll_o
-0000a720: 6666 7365 743a 2062 6f6f 6c20 3d20 4661  ffset: bool = Fa
-0000a730: 6c73 6529 202d 3e20 696e 743a 0a20 2020  lse) -> int:.   
-0000a740: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000a750: 2052 6574 7572 6e20 7468 6520 6c69 6e65   Return the line
-0000a760: 206e 756d 6265 7220 2830 2062 6173 6564   number (0 based
-0000a770: 2920 6f66 2074 6865 2069 6e70 7574 2064  ) of the input d
-0000a780: 6f63 756d 656e 7420 7468 6174 2063 6f72  ocument that cor
-0000a790: 7265 7370 6f6e 6473 0a20 2020 2020 2020  responds.       
-0000a7a0: 2077 6974 6820 7468 6520 6669 7273 7420   with the first 
-0000a7b0: 7669 7369 626c 6520 6c69 6e65 2e0a 2020  visible line..  
-0000a7c0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000a7d0: 2020 6966 2061 6674 6572 5f73 6372 6f6c    if after_scrol
-0000a7e0: 6c5f 6f66 6673 6574 3a0a 2020 2020 2020  l_offset:.      
-0000a7f0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000a800: 662e 6469 7370 6c61 7965 645f 6c69 6e65  f.displayed_line
-0000a810: 735b 7365 6c66 2e61 7070 6c69 6564 5f73  s[self.applied_s
-0000a820: 6372 6f6c 6c5f 6f66 6673 6574 732e 746f  croll_offsets.to
-0000a830: 705d 0a20 2020 2020 2020 2065 6c73 653a  p].        else:
-0000a840: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000a850: 7572 6e20 7365 6c66 2e64 6973 706c 6179  urn self.display
-0000a860: 6564 5f6c 696e 6573 5b30 5d0a 0a20 2020  ed_lines[0]..   
-0000a870: 2064 6566 206c 6173 745f 7669 7369 626c   def last_visibl
-0000a880: 655f 6c69 6e65 2873 656c 662c 2062 6566  e_line(self, bef
-0000a890: 6f72 655f 7363 726f 6c6c 5f6f 6666 7365  ore_scroll_offse
-0000a8a0: 743a 2062 6f6f 6c20 3d20 4661 6c73 6529  t: bool = False)
-0000a8b0: 202d 3e20 696e 743a 0a20 2020 2020 2020   -> int:.       
-0000a8c0: 2022 2222 0a20 2020 2020 2020 204c 696b   """.        Lik
-0000a8d0: 6520 6066 6972 7374 5f76 6973 6962 6c65  e `first_visible
-0000a8e0: 5f6c 696e 6560 2c20 6275 7420 666f 7220  _line`, but for 
-0000a8f0: 7468 6520 6c61 7374 2076 6973 6962 6c65  the last visible
-0000a900: 206c 696e 652e 0a20 2020 2020 2020 2022   line..        "
-0000a910: 2222 0a20 2020 2020 2020 2069 6620 6265  "".        if be
-0000a920: 666f 7265 5f73 6372 6f6c 6c5f 6f66 6673  fore_scroll_offs
-0000a930: 6574 3a0a 2020 2020 2020 2020 2020 2020  et:.            
-0000a940: 7265 7475 726e 2073 656c 662e 6469 7370  return self.disp
-0000a950: 6c61 7965 645f 6c69 6e65 735b 2d31 202d  layed_lines[-1 -
-0000a960: 2073 656c 662e 6170 706c 6965 645f 7363   self.applied_sc
-0000a970: 726f 6c6c 5f6f 6666 7365 7473 2e62 6f74  roll_offsets.bot
-0000a980: 746f 6d5d 0a20 2020 2020 2020 2065 6c73  tom].        els
-0000a990: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0000a9a0: 6574 7572 6e20 7365 6c66 2e64 6973 706c  eturn self.displ
-0000a9b0: 6179 6564 5f6c 696e 6573 5b2d 315d 0a0a  ayed_lines[-1]..
-0000a9c0: 2020 2020 6465 6620 6365 6e74 6572 5f76      def center_v
-0000a9d0: 6973 6962 6c65 5f6c 696e 6528 0a20 2020  isible_line(.   
-0000a9e0: 2020 2020 2073 656c 662c 2062 6566 6f72       self, befor
-0000a9f0: 655f 7363 726f 6c6c 5f6f 6666 7365 743a  e_scroll_offset:
-0000aa00: 2062 6f6f 6c20 3d20 4661 6c73 652c 2061   bool = False, a
-0000aa10: 6674 6572 5f73 6372 6f6c 6c5f 6f66 6673  fter_scroll_offs
-0000aa20: 6574 3a20 626f 6f6c 203d 2046 616c 7365  et: bool = False
-0000aa30: 0a20 2020 2029 202d 3e20 696e 743a 0a20  .    ) -> int:. 
-0000aa40: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000aa50: 2020 204c 696b 6520 6066 6972 7374 5f76     Like `first_v
-0000aa60: 6973 6962 6c65 5f6c 696e 6560 2c20 6275  isible_line`, bu
-0000aa70: 7420 666f 7220 7468 6520 6365 6e74 6572  t for the center
-0000aa80: 2076 6973 6962 6c65 206c 696e 652e 0a20   visible line.. 
-0000aa90: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000aaa0: 2020 2072 6574 7572 6e20 280a 2020 2020     return (.    
-0000aab0: 2020 2020 2020 2020 7365 6c66 2e66 6972          self.fir
-0000aac0: 7374 5f76 6973 6962 6c65 5f6c 696e 6528  st_visible_line(
-0000aad0: 6166 7465 725f 7363 726f 6c6c 5f6f 6666  after_scroll_off
-0000aae0: 7365 7429 0a20 2020 2020 2020 2020 2020  set).           
-0000aaf0: 202b 2028 0a20 2020 2020 2020 2020 2020   + (.           
-0000ab00: 2020 2020 2073 656c 662e 6c61 7374 5f76       self.last_v
-0000ab10: 6973 6962 6c65 5f6c 696e 6528 6265 666f  isible_line(befo
-0000ab20: 7265 5f73 6372 6f6c 6c5f 6f66 6673 6574  re_scroll_offset
-0000ab30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000ab40: 2020 2d20 7365 6c66 2e66 6972 7374 5f76    - self.first_v
-0000ab50: 6973 6962 6c65 5f6c 696e 6528 6166 7465  isible_line(afte
-0000ab60: 725f 7363 726f 6c6c 5f6f 6666 7365 7429  r_scroll_offset)
-0000ab70: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0000ab80: 2020 2020 2020 2020 2020 202f 2f20 320a             // 2.
-0000ab90: 2020 2020 2020 2020 290a 0a20 2020 2040          )..    @
-0000aba0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-0000abb0: 2063 6f6e 7465 6e74 5f68 6569 6768 7428   content_height(
-0000abc0: 7365 6c66 2920 2d3e 2069 6e74 3a0a 2020  self) -> int:.  
-0000abd0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000abe0: 2020 5468 6520 6675 6c6c 2068 6569 6768    The full heigh
-0000abf0: 7420 6f66 2074 6865 2075 7365 7220 636f  t of the user co
-0000ac00: 6e74 726f 6c2e 0a20 2020 2020 2020 2022  ntrol..        "
-0000ac10: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-0000ac20: 6e20 7365 6c66 2e75 695f 636f 6e74 656e  n self.ui_conten
-0000ac30: 742e 6c69 6e65 5f63 6f75 6e74 0a0a 2020  t.line_count..  
-0000ac40: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-0000ac50: 6465 6620 6675 6c6c 5f68 6569 6768 745f  def full_height_
-0000ac60: 7669 7369 626c 6528 7365 6c66 2920 2d3e  visible(self) ->
-0000ac70: 2062 6f6f 6c3a 0a20 2020 2020 2020 2022   bool:.        "
-0000ac80: 2222 0a20 2020 2020 2020 2054 7275 6520  "".        True 
-0000ac90: 7768 656e 2074 6865 2066 756c 6c20 6865  when the full he
-0000aca0: 6967 6874 2069 7320 7669 7369 626c 6520  ight is visible 
-0000acb0: 2854 6865 7265 2069 7320 6e6f 2076 6572  (There is no ver
-0000acc0: 7469 6361 6c20 7363 726f 6c6c 2e29 0a20  tical scroll.). 
-0000acd0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000ace0: 2020 2072 6574 7572 6e20 280a 2020 2020     return (.    
-0000acf0: 2020 2020 2020 2020 7365 6c66 2e76 6572          self.ver
-0000ad00: 7469 6361 6c5f 7363 726f 6c6c 203d 3d20  tical_scroll == 
-0000ad10: 300a 2020 2020 2020 2020 2020 2020 616e  0.            an
-0000ad20: 6420 7365 6c66 2e6c 6173 745f 7669 7369  d self.last_visi
-0000ad30: 626c 655f 6c69 6e65 2829 203d 3d20 7365  ble_line() == se
-0000ad40: 6c66 2e63 6f6e 7465 6e74 5f68 6569 6768  lf.content_heigh
-0000ad50: 740a 2020 2020 2020 2020 290a 0a20 2020  t.        )..   
-0000ad60: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-0000ad70: 6566 2074 6f70 5f76 6973 6962 6c65 2873  ef top_visible(s
-0000ad80: 656c 6629 202d 3e20 626f 6f6c 3a0a 2020  elf) -> bool:.  
-0000ad90: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000ada0: 2020 5472 7565 2077 6865 6e20 7468 6520    True when the 
-0000adb0: 746f 7020 6f66 2074 6865 2062 7566 6665  top of the buffe
-0000adc0: 7220 6973 2076 6973 6962 6c65 2e0a 2020  r is visible..  
-0000add0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000ade0: 2020 7265 7475 726e 2073 656c 662e 7665    return self.ve
-0000adf0: 7274 6963 616c 5f73 6372 6f6c 6c20 3d3d  rtical_scroll ==
-0000ae00: 2030 0a0a 2020 2020 4070 726f 7065 7274   0..    @propert
-0000ae10: 790a 2020 2020 6465 6620 626f 7474 6f6d  y.    def bottom
-0000ae20: 5f76 6973 6962 6c65 2873 656c 6629 202d  _visible(self) -
-0000ae30: 3e20 626f 6f6c 3a0a 2020 2020 2020 2020  > bool:.        
-0000ae40: 2222 220a 2020 2020 2020 2020 5472 7565  """.        True
-0000ae50: 2077 6865 6e20 7468 6520 626f 7474 6f6d   when the bottom
-0000ae60: 206f 6620 7468 6520 6275 6666 6572 2069   of the buffer i
-0000ae70: 7320 7669 7369 626c 652e 0a20 2020 2020  s visible..     
-0000ae80: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-0000ae90: 6574 7572 6e20 7365 6c66 2e6c 6173 745f  eturn self.last_
-0000aea0: 7669 7369 626c 655f 6c69 6e65 2829 203d  visible_line() =
-0000aeb0: 3d20 7365 6c66 2e63 6f6e 7465 6e74 5f68  = self.content_h
-0000aec0: 6569 6768 7420 2d20 310a 0a20 2020 2040  eight - 1..    @
-0000aed0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-0000aee0: 2076 6572 7469 6361 6c5f 7363 726f 6c6c   vertical_scroll
-0000aef0: 5f70 6572 6365 6e74 6167 6528 7365 6c66  _percentage(self
-0000af00: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
-0000af10: 2020 2222 220a 2020 2020 2020 2020 5665    """.        Ve
-0000af20: 7274 6963 616c 2073 6372 6f6c 6c20 6173  rtical scroll as
-0000af30: 2061 2070 6572 6365 6e74 6167 652e 2028   a percentage. (
-0000af40: 3020 6d65 616e 733a 2074 6865 2074 6f70  0 means: the top
-0000af50: 2069 7320 7669 7369 626c 652c 0a20 2020   is visible,.   
-0000af60: 2020 2020 2031 3030 206d 6561 6e73 3a20       100 means: 
-0000af70: 7468 6520 626f 7474 6f6d 2069 7320 7669  the bottom is vi
-0000af80: 7369 626c 652e 290a 2020 2020 2020 2020  sible.).        
-0000af90: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
-0000afa0: 656c 662e 626f 7474 6f6d 5f76 6973 6962  elf.bottom_visib
-0000afb0: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-0000afc0: 7265 7475 726e 2031 3030 0a20 2020 2020  return 100.     
-0000afd0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000afe0: 2020 2020 2072 6574 7572 6e20 3130 3020       return 100 
-0000aff0: 2a20 7365 6c66 2e76 6572 7469 6361 6c5f  * self.vertical_
-0000b000: 7363 726f 6c6c 202f 2f20 7365 6c66 2e63  scroll // self.c
-0000b010: 6f6e 7465 6e74 5f68 6569 6768 740a 0a20  ontent_height.. 
-0000b020: 2020 2064 6566 2067 6574 5f68 6569 6768     def get_heigh
-0000b030: 745f 666f 725f 6c69 6e65 2873 656c 662c  t_for_line(self,
-0000b040: 206c 696e 656e 6f3a 2069 6e74 2920 2d3e   lineno: int) ->
-0000b050: 2069 6e74 3a0a 2020 2020 2020 2020 2222   int:.        ""
-0000b060: 220a 2020 2020 2020 2020 5265 7475 726e  ".        Return
-0000b070: 2074 6865 2068 6569 6768 7420 6f66 2074   the height of t
-0000b080: 6865 2067 6976 656e 206c 696e 652e 0a20  he given line.. 
-0000b090: 2020 2020 2020 2028 5468 6520 6865 6967         (The heig
-0000b0a0: 6874 2074 6861 7420 6974 2077 6f75 6c64  ht that it would
-0000b0b0: 2074 616b 652c 2069 6620 7468 6973 206c   take, if this l
-0000b0c0: 696e 6520 6265 6361 6d65 2076 6973 6962  ine became visib
-0000b0d0: 6c65 2e29 0a20 2020 2020 2020 2022 2222  le.).        """
-0000b0e0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000b0f0: 2e77 7261 705f 6c69 6e65 733a 0a20 2020  .wrap_lines:.   
-0000b100: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000b110: 7365 6c66 2e75 695f 636f 6e74 656e 742e  self.ui_content.
-0000b120: 6765 745f 6865 6967 6874 5f66 6f72 5f6c  get_height_for_l
-0000b130: 696e 6528 0a20 2020 2020 2020 2020 2020  ine(.           
-0000b140: 2020 2020 206c 696e 656e 6f2c 2073 656c       lineno, sel
-0000b150: 662e 7769 6e64 6f77 5f77 6964 7468 2c20  f.window_width, 
-0000b160: 7365 6c66 2e77 696e 646f 772e 6765 745f  self.window.get_
-0000b170: 6c69 6e65 5f70 7265 6669 780a 2020 2020  line_prefix.    
-0000b180: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000b190: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000b1a0: 2020 2020 7265 7475 726e 2031 0a0a 0a63      return 1...c
-0000b1b0: 6c61 7373 2053 6372 6f6c 6c4f 6666 7365  lass ScrollOffse
-0000b1c0: 7473 3a0a 2020 2020 2222 220a 2020 2020  ts:.    """.    
-0000b1d0: 5363 726f 6c6c 206f 6666 7365 7473 2066  Scroll offsets f
-0000b1e0: 6f72 2074 6865 203a 636c 6173 733a 602e  or the :class:`.
-0000b1f0: 5769 6e64 6f77 6020 636c 6173 732e 0a0a  Window` class...
-0000b200: 2020 2020 4e6f 7465 2074 6861 7420 6c65      Note that le
-0000b210: 6674 2f72 6967 6874 206f 6666 7365 7473  ft/right offsets
-0000b220: 206f 6e6c 7920 6d61 6b65 2073 656e 7365   only make sense
-0000b230: 2069 6620 6c69 6e65 2077 7261 7070 696e   if line wrappin
-0000b240: 6720 6973 2064 6973 6162 6c65 642e 0a20  g is disabled.. 
-0000b250: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
-0000b260: 5f5f 696e 6974 5f5f 280a 2020 2020 2020  __init__(.      
-0000b270: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-0000b280: 746f 703a 2055 6e69 6f6e 5b69 6e74 2c20  top: Union[int, 
-0000b290: 4361 6c6c 6162 6c65 5b5b 5d2c 2069 6e74  Callable[[], int
-0000b2a0: 5d5d 203d 2030 2c0a 2020 2020 2020 2020  ]] = 0,.        
-0000b2b0: 626f 7474 6f6d 3a20 556e 696f 6e5b 696e  bottom: Union[in
-0000b2c0: 742c 2043 616c 6c61 626c 655b 5b5d 2c20  t, Callable[[], 
-0000b2d0: 696e 745d 5d20 3d20 302c 0a20 2020 2020  int]] = 0,.     
-0000b2e0: 2020 206c 6566 743a 2055 6e69 6f6e 5b69     left: Union[i
-0000b2f0: 6e74 2c20 4361 6c6c 6162 6c65 5b5b 5d2c  nt, Callable[[],
-0000b300: 2069 6e74 5d5d 203d 2030 2c0a 2020 2020   int]] = 0,.    
-0000b310: 2020 2020 7269 6768 743a 2055 6e69 6f6e      right: Union
-0000b320: 5b69 6e74 2c20 4361 6c6c 6162 6c65 5b5b  [int, Callable[[
-0000b330: 5d2c 2069 6e74 5d5d 203d 2030 2c0a 2020  ], int]] = 0,.  
-0000b340: 2020 2920 2d3e 204e 6f6e 653a 0a0a 2020    ) -> None:..  
-0000b350: 2020 2020 2020 7365 6c66 2e5f 746f 7020        self._top 
-0000b360: 3d20 746f 700a 2020 2020 2020 2020 7365  = top.        se
-0000b370: 6c66 2e5f 626f 7474 6f6d 203d 2062 6f74  lf._bottom = bot
-0000b380: 746f 6d0a 2020 2020 2020 2020 7365 6c66  tom.        self
-0000b390: 2e5f 6c65 6674 203d 206c 6566 740a 2020  ._left = left.  
-0000b3a0: 2020 2020 2020 7365 6c66 2e5f 7269 6768        self._righ
-0000b3b0: 7420 3d20 7269 6768 740a 0a20 2020 2040  t = right..    @
-0000b3c0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-0000b3d0: 2074 6f70 2873 656c 6629 202d 3e20 696e   top(self) -> in
-0000b3e0: 743a 0a20 2020 2020 2020 2072 6574 7572  t:.        retur
-0000b3f0: 6e20 746f 5f69 6e74 2873 656c 662e 5f74  n to_int(self._t
-0000b400: 6f70 290a 0a20 2020 2040 7072 6f70 6572  op)..    @proper
-0000b410: 7479 0a20 2020 2064 6566 2062 6f74 746f  ty.    def botto
-0000b420: 6d28 7365 6c66 2920 2d3e 2069 6e74 3a0a  m(self) -> int:.
-0000b430: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-0000b440: 6f5f 696e 7428 7365 6c66 2e5f 626f 7474  o_int(self._bott
-0000b450: 6f6d 290a 0a20 2020 2040 7072 6f70 6572  om)..    @proper
-0000b460: 7479 0a20 2020 2064 6566 206c 6566 7428  ty.    def left(
-0000b470: 7365 6c66 2920 2d3e 2069 6e74 3a0a 2020  self) -> int:.  
-0000b480: 2020 2020 2020 7265 7475 726e 2074 6f5f        return to_
-0000b490: 696e 7428 7365 6c66 2e5f 6c65 6674 290a  int(self._left).
-0000b4a0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-0000b4b0: 2020 2064 6566 2072 6967 6874 2873 656c     def right(sel
-0000b4c0: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
-0000b4d0: 2020 2072 6574 7572 6e20 746f 5f69 6e74     return to_int
-0000b4e0: 2873 656c 662e 5f72 6967 6874 290a 0a20  (self._right).. 
-0000b4f0: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
-0000b500: 7365 6c66 2920 2d3e 2073 7472 3a0a 2020  self) -> str:.  
-0000b510: 2020 2020 2020 7265 7475 726e 2022 5363        return "Sc
-0000b520: 726f 6c6c 4f66 6673 6574 7328 746f 703d  rollOffsets(top=
-0000b530: 2572 2c20 626f 7474 6f6d 3d25 722c 206c  %r, bottom=%r, l
-0000b540: 6566 743d 2572 2c20 7269 6768 743d 2572  eft=%r, right=%r
-0000b550: 2922 2025 2028 0a20 2020 2020 2020 2020  )" % (.         
-0000b560: 2020 2073 656c 662e 5f74 6f70 2c0a 2020     self._top,.  
-0000b570: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000b580: 626f 7474 6f6d 2c0a 2020 2020 2020 2020  bottom,.        
-0000b590: 2020 2020 7365 6c66 2e5f 6c65 6674 2c0a      self._left,.
-0000b5a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000b5b0: 2e5f 7269 6768 742c 0a20 2020 2020 2020  ._right,.       
-0000b5c0: 2029 0a0a 0a63 6c61 7373 2043 6f6c 6f72   )...class Color
-0000b5d0: 436f 6c75 6d6e 3a0a 2020 2020 2222 220a  Column:.    """.
-0000b5e0: 2020 2020 436f 6c75 6d6e 2066 6f72 2061      Column for a
-0000b5f0: 203a 636c 6173 733a 602e 5769 6e64 6f77   :class:`.Window
-0000b600: 6020 746f 2062 6520 636f 6c6f 7265 642e  ` to be colored.
-0000b610: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-0000b620: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-0000b630: 2070 6f73 6974 696f 6e3a 2069 6e74 2c20   position: int, 
-0000b640: 7374 796c 653a 2073 7472 203d 2022 636c  style: str = "cl
-0000b650: 6173 733a 636f 6c6f 722d 636f 6c75 6d6e  ass:color-column
-0000b660: 2229 202d 3e20 4e6f 6e65 3a0a 2020 2020  ") -> None:.    
-0000b670: 2020 2020 7365 6c66 2e70 6f73 6974 696f      self.positio
-0000b680: 6e20 3d20 706f 7369 7469 6f6e 0a20 2020  n = position.   
-0000b690: 2020 2020 2073 656c 662e 7374 796c 6520       self.style 
-0000b6a0: 3d20 7374 796c 650a 0a0a 5f69 6e5f 696e  = style..._in_in
-0000b6b0: 7365 7274 5f6d 6f64 6520 3d20 7669 5f69  sert_mode = vi_i
-0000b6c0: 6e73 6572 745f 6d6f 6465 207c 2065 6d61  nsert_mode | ema
-0000b6d0: 6373 5f69 6e73 6572 745f 6d6f 6465 0a0a  cs_insert_mode..
-0000b6e0: 0a63 6c61 7373 2057 696e 646f 7741 6c69  .class WindowAli
-0000b6f0: 676e 2845 6e75 6d29 3a0a 2020 2020 2222  gn(Enum):.    ""
-0000b700: 220a 2020 2020 416c 6967 6e6d 656e 7420  ".    Alignment 
-0000b710: 6f66 2074 6865 2057 696e 646f 7720 636f  of the Window co
-0000b720: 6e74 656e 742e 0a0a 2020 2020 4e6f 7465  ntent...    Note
-0000b730: 2074 6861 7420 7468 6973 2069 7320 6469   that this is di
-0000b740: 6666 6572 656e 7420 6672 6f6d 2060 486f  fferent from `Ho
-0000b750: 7269 7a6f 6e74 616c 416c 6967 6e60 2061  rizontalAlign` a
-0000b760: 6e64 2060 5665 7274 6963 616c 416c 6967  nd `VerticalAlig
-0000b770: 6e60 2c0a 2020 2020 7768 6963 6820 6172  n`,.    which ar
-0000b780: 6520 7573 6564 2066 6f72 2074 6865 2061  e used for the a
-0000b790: 6c69 676e 6d65 6e74 206f 6620 7468 6520  lignment of the 
-0000b7a0: 6368 696c 6420 636f 6e74 6169 6e65 7273  child containers
-0000b7b0: 2069 6e20 7265 7370 6563 7469 7665 6c79   in respectively
-0000b7c0: 0a20 2020 2060 5653 706c 6974 6020 616e  .    `VSplit` an
-0000b7d0: 6420 6048 5370 6c69 7460 2e0a 2020 2020  d `HSplit`..    
-0000b7e0: 2222 220a 0a20 2020 204c 4546 5420 3d20  """..    LEFT = 
-0000b7f0: 224c 4546 5422 0a20 2020 2052 4947 4854  "LEFT".    RIGHT
-0000b800: 203d 2022 5249 4748 5422 0a20 2020 2043   = "RIGHT".    C
-0000b810: 454e 5445 5220 3d20 2243 454e 5445 5222  ENTER = "CENTER"
-0000b820: 0a0a 0a63 6c61 7373 2057 696e 646f 7728  ...class Window(
-0000b830: 436f 6e74 6169 6e65 7229 3a0a 2020 2020  Container):.    
-0000b840: 2222 220a 2020 2020 436f 6e74 6169 6e65  """.    Containe
-0000b850: 7220 7468 6174 2068 6f6c 6473 2061 2063  r that holds a c
-0000b860: 6f6e 7472 6f6c 2e0a 0a20 2020 203a 7061  ontrol...    :pa
-0000b870: 7261 6d20 636f 6e74 656e 743a 203a 636c  ram content: :cl
-0000b880: 6173 733a 602e 5549 436f 6e74 726f 6c60  ass:`.UIControl`
-0000b890: 2069 6e73 7461 6e63 652e 0a20 2020 203a   instance..    :
-0000b8a0: 7061 7261 6d20 7769 6474 683a 203a 636c  param width: :cl
-0000b8b0: 6173 733a 602e 4469 6d65 6e73 696f 6e60  ass:`.Dimension`
-0000b8c0: 2069 6e73 7461 6e63 6520 6f72 2063 616c   instance or cal
-0000b8d0: 6c61 626c 652e 0a20 2020 203a 7061 7261  lable..    :para
-0000b8e0: 6d20 6865 6967 6874 3a20 3a63 6c61 7373  m height: :class
-0000b8f0: 3a60 2e44 696d 656e 7369 6f6e 6020 696e  :`.Dimension` in
-0000b900: 7374 616e 6365 206f 7220 6361 6c6c 6162  stance or callab
-0000b910: 6c65 2e0a 2020 2020 3a70 6172 616d 207a  le..    :param z
-0000b920: 5f69 6e64 6578 3a20 5768 656e 2073 7065  _index: When spe
-0000b930: 6369 6669 6564 2c20 7468 6973 2063 616e  cified, this can
-0000b940: 2062 6520 7573 6564 2074 6f20 6272 696e   be used to brin
-0000b950: 6720 656c 656d 656e 7420 696e 2066 726f  g element in fro
-0000b960: 6e74 0a20 2020 2020 2020 206f 6620 666c  nt.        of fl
-0000b970: 6f61 7469 6e67 2065 6c65 6d65 6e74 732e  oating elements.
-0000b980: 0a20 2020 203a 7061 7261 6d20 646f 6e74  .    :param dont
-0000b990: 5f65 7874 656e 645f 7769 6474 683a 2057  _extend_width: W
-0000b9a0: 6865 6e20 6054 7275 6560 2c20 646f 6e27  hen `True`, don'
-0000b9b0: 7420 7461 6b65 2075 7020 6d6f 7265 2077  t take up more w
-0000b9c0: 6964 7468 2074 6865 6e20 7468 650a 2020  idth then the.  
-0000b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9e0: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-0000b9f0: 6572 7265 6420 7769 6474 6820 7265 706f  erred width repo
-0000ba00: 7274 6564 2062 7920 7468 6520 636f 6e74  rted by the cont
-0000ba10: 726f 6c2e 0a20 2020 203a 7061 7261 6d20  rol..    :param 
-0000ba20: 646f 6e74 5f65 7874 656e 645f 6865 6967  dont_extend_heig
-0000ba30: 6874 3a20 5768 656e 2060 5472 7565 602c  ht: When `True`,
-0000ba40: 2064 6f6e 2774 2074 616b 6520 7570 206d   don't take up m
-0000ba50: 6f72 6520 7769 6474 6820 7468 656e 2074  ore width then t
-0000ba60: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
-0000ba70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba80: 2020 7072 6566 6572 7265 6420 6865 6967    preferred heig
-0000ba90: 6874 2072 6570 6f72 7465 6420 6279 2074  ht reported by t
-0000baa0: 6865 2063 6f6e 7472 6f6c 2e0a 2020 2020  he control..    
-0000bab0: 3a70 6172 616d 2069 676e 6f72 655f 636f  :param ignore_co
-0000bac0: 6e74 656e 745f 7769 6474 683a 2041 2060  ntent_width: A `
-0000bad0: 626f 6f6c 6020 6f72 203a 636c 6173 733a  bool` or :class:
-0000bae0: 602e 4669 6c74 6572 6020 696e 7374 616e  `.Filter` instan
-0000baf0: 6365 2e20 4967 6e6f 7265 0a20 2020 2020  ce. Ignore.     
-0000bb00: 2020 2074 6865 203a 636c 6173 733a 602e     the :class:`.
-0000bb10: 5549 436f 6e74 656e 7460 2077 6964 7468  UIContent` width
-0000bb20: 2077 6865 6e20 6361 6c63 756c 6174 696e   when calculatin
-0000bb30: 6720 7468 6520 6469 6d65 6e73 696f 6e73  g the dimensions
-0000bb40: 2e0a 2020 2020 3a70 6172 616d 2069 676e  ..    :param ign
-0000bb50: 6f72 655f 636f 6e74 656e 745f 6865 6967  ore_content_heig
-0000bb60: 6874 3a20 4120 6062 6f6f 6c60 206f 7220  ht: A `bool` or 
-0000bb70: 3a63 6c61 7373 3a60 2e46 696c 7465 7260  :class:`.Filter`
-0000bb80: 2069 6e73 7461 6e63 652e 2049 676e 6f72   instance. Ignor
-0000bb90: 650a 2020 2020 2020 2020 7468 6520 3a63  e.        the :c
-0000bba0: 6c61 7373 3a60 2e55 4943 6f6e 7465 6e74  lass:`.UIContent
-0000bbb0: 6020 6865 6967 6874 2077 6865 6e20 6361  ` height when ca
-0000bbc0: 6c63 756c 6174 696e 6720 7468 6520 6469  lculating the di
-0000bbd0: 6d65 6e73 696f 6e73 2e0a 2020 2020 3a70  mensions..    :p
-0000bbe0: 6172 616d 206c 6566 745f 6d61 7267 696e  aram left_margin
-0000bbf0: 733a 2041 206c 6973 7420 6f66 203a 636c  s: A list of :cl
-0000bc00: 6173 733a 602e 4d61 7267 696e 6020 696e  ass:`.Margin` in
-0000bc10: 7374 616e 6365 2074 6f20 6265 2064 6973  stance to be dis
-0000bc20: 706c 6179 6564 206f 6e0a 2020 2020 2020  played on.      
-0000bc30: 2020 7468 6520 6c65 6674 2e20 466f 7220    the left. For 
-0000bc40: 696e 7374 616e 6365 3a20 3a63 6c61 7373  instance: :class
-0000bc50: 3a60 7e71 756f 2e6c 6179 6f75 742e 4e75  :`~quo.layout.Nu
-0000bc60: 6d62 6572 6564 4d61 7267 696e 600a 2020  mberedMargin`.  
-0000bc70: 2020 2020 2020 6361 6e20 6265 206f 6e65        can be one
-0000bc80: 206f 6620 7468 656d 2069 6e20 6f72 6465   of them in orde
-0000bc90: 7220 746f 2073 686f 7720 6c69 6e65 206e  r to show line n
-0000bca0: 756d 6265 7273 2e0a 2020 2020 3a70 6172  umbers..    :par
-0000bcb0: 616d 2072 6967 6874 5f6d 6172 6769 6e73  am right_margins
-0000bcc0: 3a20 4c69 6b65 2060 6c65 6674 5f6d 6172  : Like `left_mar
-0000bcd0: 6769 6e73 602c 2062 7574 206f 6e20 7468  gins`, but on th
-0000bce0: 6520 6f74 6865 7220 7369 6465 2e0a 2020  e other side..  
-0000bcf0: 2020 3a70 6172 616d 2073 6372 6f6c 6c5f    :param scroll_
-0000bd00: 6f66 6673 6574 733a 203a 636c 6173 733a  offsets: :class:
-0000bd10: 602e 5363 726f 6c6c 4f66 6673 6574 7360  `.ScrollOffsets`
-0000bd20: 2069 6e73 7461 6e63 652c 2072 6570 7265   instance, repre
-0000bd30: 7365 6e74 696e 6720 7468 650a 2020 2020  senting the.    
-0000bd40: 2020 2020 7072 6566 6572 7265 6420 616d      preferred am
-0000bd50: 6f75 6e74 206f 6620 6c69 6e65 732f 636f  ount of lines/co
-0000bd60: 6c75 6d6e 7320 746f 2062 6520 616c 7761  lumns to be alwa
-0000bd70: 7973 2076 6973 6962 6c65 2062 6566 6f72  ys visible befor
-0000bd80: 652f 6166 7465 7220 7468 650a 2020 2020  e/after the.    
-0000bd90: 2020 2020 6375 7273 6f72 2e20 5768 656e      cursor. When
-0000bda0: 2062 6f74 6820 746f 7020 616e 6420 626f   both top and bo
-0000bdb0: 7474 6f6d 2061 7265 2061 2076 6572 7920  ttom are a very 
-0000bdc0: 6869 6768 206e 756d 6265 722c 2074 6865  high number, the
-0000bdd0: 2063 7572 736f 720a 2020 2020 2020 2020   cursor.        
-0000bde0: 7769 6c6c 2062 6520 6365 6e74 6572 6564  will be centered
-0000bdf0: 2076 6572 7469 6361 6c6c 7920 6d6f 7374   vertically most
-0000be00: 206f 6620 7468 6520 7469 6d65 2e0a 2020   of the time..  
-0000be10: 2020 3a70 6172 616d 2061 6c6c 6f77 5f73    :param allow_s
-0000be20: 6372 6f6c 6c5f 6265 796f 6e64 5f62 6f74  croll_beyond_bot
-0000be30: 746f 6d3a 2041 2060 626f 6f6c 6020 6f72  tom: A `bool` or
-0000be40: 0a20 2020 2020 2020 203a 636c 6173 733a  .        :class:
-0000be50: 602e 4669 6c74 6572 6020 696e 7374 616e  `.Filter` instan
-0000be60: 6365 2e20 5768 656e 2054 7275 652c 2061  ce. When True, a
-0000be70: 6c6c 6f77 2073 6372 6f6c 6c69 6e67 2073  llow scrolling s
-0000be80: 6f20 6661 722c 2074 6861 7420 7468 650a  o far, that the.
-0000be90: 2020 2020 2020 2020 746f 7020 7061 7274          top part
-0000bea0: 206f 6620 7468 6520 636f 6e74 656e 7420   of the content 
-0000beb0: 6973 206e 6f74 2076 6973 6962 6c65 2061  is not visible a
-0000bec0: 6e79 6d6f 7265 2c20 7768 696c 6520 7468  nymore, while th
-0000bed0: 6572 6520 6973 2073 7469 6c6c 0a20 2020  ere is still.   
-0000bee0: 2020 2020 2065 6d70 7479 2073 7061 6365       empty space
-0000bef0: 2061 7661 696c 6162 6c65 2061 7420 7468   available at th
-0000bf00: 6520 626f 7474 6f6d 206f 6620 7468 6520  e bottom of the 
-0000bf10: 7769 6e64 6f77 2e20 496e 2074 6865 2056  window. In the V
-0000bf20: 6920 6564 6974 6f72 2066 6f72 0a20 2020  i editor for.   
-0000bf30: 2020 2020 2069 6e73 7461 6e63 652c 2074       instance, t
-0000bf40: 6869 7320 6973 2070 6f73 7369 626c 652e  his is possible.
-0000bf50: 2059 6f75 2077 696c 6c20 7365 6520 7469   You will see ti
-0000bf60: 6c64 6573 2077 6869 6c65 2074 6865 2074  ldes while the t
-0000bf70: 6f70 2070 6172 7420 6f66 0a20 2020 2020  op part of.     
-0000bf80: 2020 2074 6865 2062 6f64 7920 6973 2068     the body is h
-0000bf90: 6964 6465 6e2e 0a20 2020 203a 7061 7261  idden..    :para
-0000bfa0: 6d20 7772 6170 5f6c 696e 6573 3a20 4120  m wrap_lines: A 
-0000bfb0: 6062 6f6f 6c60 206f 7220 3a63 6c61 7373  `bool` or :class
-0000bfc0: 3a60 2e46 696c 7465 7260 2069 6e73 7461  :`.Filter` insta
-0000bfd0: 6e63 652e 2057 6865 6e20 5472 7565 2c20  nce. When True, 
-0000bfe0: 646f 6e27 740a 2020 2020 2020 2020 7363  don't.        sc
-0000bff0: 726f 6c6c 2068 6f72 697a 6f6e 7461 6c6c  roll horizontall
-0000c000: 792c 2062 7574 2077 7261 7020 6c69 6e65  y, but wrap line
-0000c010: 7320 696e 7374 6561 642e 0a20 2020 203a  s instead..    :
-0000c020: 7061 7261 6d20 6765 745f 7665 7274 6963  param get_vertic
-0000c030: 616c 5f73 6372 6f6c 6c3a 2043 616c 6c61  al_scroll: Calla
-0000c040: 626c 6520 7468 6174 2074 616b 6573 2074  ble that takes t
-0000c050: 6869 7320 7769 6e64 6f77 0a20 2020 2020  his window.     
-0000c060: 2020 2069 6e73 7461 6e63 6520 6173 2069     instance as i
-0000c070: 6e70 7574 2061 6e64 2072 6574 7572 6e73  nput and returns
-0000c080: 2061 2070 7265 6665 7272 6564 2076 6572   a preferred ver
-0000c090: 7469 6361 6c20 7363 726f 6c6c 2e0a 2020  tical scroll..  
-0000c0a0: 2020 2020 2020 2857 6865 6e20 7468 6973        (When this
-0000c0b0: 2069 7320 604e 6f6e 6560 2c20 7468 6520   is `None`, the 
-0000c0c0: 7363 726f 6c6c 2069 7320 6f6e 6c79 2064  scroll is only d
-0000c0d0: 6574 6572 6d69 6e65 6420 6279 2074 6865  etermined by the
-0000c0e0: 206c 6173 7420 616e 640a 2020 2020 2020   last and.      
-0000c0f0: 2020 6375 7272 656e 7420 6375 7273 6f72    current cursor
-0000c100: 2070 6f73 6974 696f 6e2e 290a 2020 2020   position.).    
-0000c110: 3a70 6172 616d 2067 6574 5f68 6f72 697a  :param get_horiz
-0000c120: 6f6e 7461 6c5f 7363 726f 6c6c 3a20 4361  ontal_scroll: Ca
-0000c130: 6c6c 6162 6c65 2074 6861 7420 7461 6b65  llable that take
-0000c140: 7320 7468 6973 2077 696e 646f 770a 2020  s this window.  
-0000c150: 2020 2020 2020 696e 7374 616e 6365 2061        instance a
-0000c160: 7320 696e 7075 7420 616e 6420 7265 7475  s input and retu
-0000c170: 726e 7320 6120 7072 6566 6572 7265 6420  rns a preferred 
-0000c180: 7665 7274 6963 616c 2073 6372 6f6c 6c2e  vertical scroll.
-0000c190: 0a20 2020 203a 7061 7261 6d20 616c 7761  .    :param alwa
-0000c1a0: 7973 5f68 6964 655f 6375 7273 6f72 3a20  ys_hide_cursor: 
-0000c1b0: 4120 6062 6f6f 6c60 206f 720a 2020 2020  A `bool` or.    
-0000c1c0: 2020 2020 3a63 6c61 7373 3a60 2e46 696c      :class:`.Fil
-0000c1d0: 7465 7260 2069 6e73 7461 6e63 652e 2057  ter` instance. W
-0000c1e0: 6865 6e20 5472 7565 2c20 6e65 7665 7220  hen True, never 
-0000c1f0: 6469 7370 6c61 7920 7468 6520 6375 7273  display the curs
-0000c200: 6f72 2c20 6576 656e 0a20 2020 2020 2020  or, even.       
-0000c210: 2077 6865 6e20 7468 6520 7573 6572 2063   when the user c
-0000c220: 6f6e 7472 6f6c 2073 7065 6369 6669 6573  ontrol specifies
-0000c230: 2061 2063 7572 736f 7220 706f 7369 7469   a cursor positi
-0000c240: 6f6e 2e0a 2020 2020 3a70 6172 616d 2063  on..    :param c
-0000c250: 7572 736f 726c 696e 653a 2041 2060 626f  ursorline: A `bo
-0000c260: 6f6c 6020 6f72 203a 636c 6173 733a 602e  ol` or :class:`.
-0000c270: 4669 6c74 6572 6020 696e 7374 616e 6365  Filter` instance
-0000c280: 2e20 5768 656e 2054 7275 652c 0a20 2020  . When True,.   
-0000c290: 2020 2020 2064 6973 706c 6179 2061 2063       display a c
-0000c2a0: 7572 736f 726c 696e 652e 0a20 2020 203a  ursorline..    :
-0000c2b0: 7061 7261 6d20 6375 7273 6f72 636f 6c75  param cursorcolu
-0000c2c0: 6d6e 3a20 4120 6062 6f6f 6c60 206f 7220  mn: A `bool` or 
-0000c2d0: 3a63 6c61 7373 3a60 2e46 696c 7465 7260  :class:`.Filter`
-0000c2e0: 2069 6e73 7461 6e63 652e 2057 6865 6e20   instance. When 
-0000c2f0: 5472 7565 2c0a 2020 2020 2020 2020 6469  True,.        di
-0000c300: 7370 6c61 7920 6120 6375 7273 6f72 636f  splay a cursorco
-0000c310: 6c75 6d6e 2e0a 2020 2020 3a70 6172 616d  lumn..    :param
-0000c320: 2063 6f6c 6f72 636f 6c75 6d6e 733a 2041   colorcolumns: A
-0000c330: 206c 6973 7420 6f66 203a 636c 6173 733a   list of :class:
-0000c340: 602e 436f 6c6f 7243 6f6c 756d 6e60 2069  `.ColorColumn` i
-0000c350: 6e73 7461 6e63 6573 2074 6861 740a 2020  nstances that.  
-0000c360: 2020 2020 2020 6465 7363 7269 6265 2074        describe t
-0000c370: 6865 2063 6f6c 756d 6e73 2074 6f20 6265  he columns to be
-0000c380: 2068 6967 686c 6967 6874 6564 2c20 6f72   highlighted, or
-0000c390: 2061 2063 616c 6c61 626c 6520 7468 6174   a callable that
-0000c3a0: 2072 6574 7572 6e73 2073 7563 680a 2020   returns such.  
-0000c3b0: 2020 2020 2020 6120 6c69 7374 2e0a 2020        a list..  
-0000c3c0: 2020 3a70 6172 616d 2061 6c69 676e 3a20    :param align: 
-0000c3d0: 3a63 6c61 7373 3a60 2e57 696e 646f 7741  :class:`.WindowA
-0000c3e0: 6c69 676e 6020 7661 6c75 6520 6f72 2063  lign` value or c
-0000c3f0: 616c 6c61 626c 6520 7468 6174 2072 6574  allable that ret
-0000c400: 7572 6e73 2061 6e0a 2020 2020 2020 2020  urns an.        
-0000c410: 3a63 6c61 7373 3a60 2e57 696e 646f 7741  :class:`.WindowA
-0000c420: 6c69 676e 6020 7661 6c75 652e 2061 6c69  lign` value. ali
-0000c430: 676e 6d65 6e74 206f 6620 636f 6e74 656e  gnment of conten
-0000c440: 742e 0a20 2020 203a 7061 7261 6d20 7374  t..    :param st
-0000c450: 796c 653a 2041 2073 7479 6c65 2073 7472  yle: A style str
-0000c460: 696e 672e 2053 7479 6c65 2074 6f20 6265  ing. Style to be
-0000c470: 2061 7070 6c69 6564 2074 6f20 616c 6c20   applied to all 
-0000c480: 7468 6520 6365 6c6c 7320 696e 2074 6869  the cells in thi
-0000c490: 730a 2020 2020 2020 2020 7769 6e64 6f77  s.        window
-0000c4a0: 2e20 2854 6869 7320 6361 6e20 6265 2061  . (This can be a
-0000c4b0: 2063 616c 6c61 626c 6520 7468 6174 2072   callable that r
-0000c4c0: 6574 7572 6e73 2061 2073 7472 696e 672e  eturns a string.
-0000c4d0: 290a 2020 2020 3a70 6172 616d 2063 6861  ).    :param cha
-0000c4e0: 723a 2028 7374 7269 6e67 2920 4368 6172  r: (string) Char
-0000c4f0: 6163 7465 7220 746f 2062 6520 7573 6564  acter to be used
-0000c500: 2066 6f72 2066 696c 6c69 6e67 2074 6865   for filling the
-0000c510: 2062 6163 6b67 726f 756e 642e 2054 6869   background. Thi
-0000c520: 730a 2020 2020 2020 2020 6361 6e20 616c  s.        can al
-0000c530: 736f 2062 6520 6120 6361 6c6c 6162 6c65  so be a callable
-0000c540: 2074 6861 7420 7265 7475 726e 7320 6120   that returns a 
-0000c550: 6368 6172 6163 7465 722e 0a20 2020 203a  character..    :
-0000c560: 7061 7261 6d20 6765 745f 6c69 6e65 5f70  param get_line_p
-0000c570: 7265 6669 783a 204e 6f6e 6520 6f72 2061  refix: None or a
-0000c580: 2063 616c 6c61 626c 6520 7468 6174 2072   callable that r
-0000c590: 6574 7572 6e73 2066 6f72 6d61 7474 6564  eturns formatted
-0000c5a0: 2074 6578 7420 746f 0a20 2020 2020 2020   text to.       
-0000c5b0: 2062 6520 696e 7365 7274 6564 2062 6566   be inserted bef
-0000c5c0: 6f72 6520 6120 6c69 6e65 2e20 4974 2074  ore a line. It t
-0000c5d0: 616b 6573 2061 206c 696e 6520 6e75 6d62  akes a line numb
-0000c5e0: 6572 2028 696e 7429 2061 6e64 2061 0a20  er (int) and a. 
-0000c5f0: 2020 2020 2020 2077 7261 705f 636f 756e         wrap_coun
-0000c600: 7420 616e 6420 7265 7475 726e 7320 666f  t and returns fo
-0000c610: 726d 6174 7465 6420 7465 7874 2e20 5468  rmatted text. Th
-0000c620: 6973 2063 616e 2062 6520 7573 6564 2066  is can be used f
-0000c630: 6f72 0a20 2020 2020 2020 2069 6d70 6c65  or.        imple
-0000c640: 6d65 6e74 6174 696f 6e20 6f66 206c 696e  mentation of lin
-0000c650: 6520 636f 6e74 696e 7561 7469 6f6e 732c  e continuations,
-0000c660: 2074 6869 6e67 7320 6c69 6b65 2056 696d   things like Vim
-0000c670: 2022 6272 6561 6b69 6e64 656e 7422 2061   "breakindent" a
-0000c680: 6e64 0a20 2020 2020 2020 2073 6f20 6f6e  nd.        so on
-0000c690: 2e0a 2020 2020 2222 220a 2020 2020 6c65  ..    """.    le
-0000c6a0: 6674 203d 2057 696e 646f 7741 6c69 676e  ft = WindowAlign
-0000c6b0: 2e4c 4546 540a 2020 2020 6365 6e74 6572  .LEFT.    center
-0000c6c0: 203d 2057 696e 646f 7741 6c69 676e 2e43   = WindowAlign.C
-0000c6d0: 454e 5445 520a 2020 2020 7269 6768 7420  ENTER.    right 
-0000c6e0: 3d20 5769 6e64 6f77 416c 6967 6e2e 5249  = WindowAlign.RI
-0000c6f0: 4748 540a 0a20 2020 2064 6566 205f 5f69  GHT..    def __i
-0000c700: 6e69 745f 5f28 0a20 2020 2020 2020 2073  nit__(.        s
-0000c710: 656c 662c 0a20 2020 2020 2020 2063 6f6e  elf,.        con
-0000c720: 7465 6e74 3a20 4f70 7469 6f6e 616c 5b46  tent: Optional[F
-0000c730: 6f72 6d61 7474 6564 5465 7874 436f 6e74  ormattedTextCont
-0000c740: 726f 6c5d 203d 204e 6f6e 652c 0a20 2020  rol] = None,.   
-0000c750: 2020 2020 2077 6964 7468 3a20 416e 7944       width: AnyD
-0000c760: 696d 656e 7369 6f6e 203d 204e 6f6e 652c  imension = None,
-0000c770: 0a20 2020 2020 2020 2068 6569 6768 743a  .        height:
-0000c780: 2041 6e79 4469 6d65 6e73 696f 6e20 3d20   AnyDimension = 
-0000c790: 4e6f 6e65 2c0a 2020 2020 2020 2020 7a5f  None,.        z_
-0000c7a0: 696e 6465 783a 204f 7074 696f 6e61 6c5b  index: Optional[
-0000c7b0: 696e 745d 203d 204e 6f6e 652c 0a20 2020  int] = None,.   
-0000c7c0: 2020 2020 2064 6f6e 745f 6578 7465 6e64       dont_extend
-0000c7d0: 5f77 6964 7468 3a20 4669 6c74 6572 4f72  _width: FilterOr
-0000c7e0: 426f 6f6c 203d 2046 616c 7365 2c0a 2020  Bool = False,.  
-0000c7f0: 2020 2020 2020 646f 6e74 5f65 7874 656e        dont_exten
-0000c800: 645f 6865 6967 6874 3a20 4669 6c74 6572  d_height: Filter
-0000c810: 4f72 426f 6f6c 203d 2046 616c 7365 2c0a  OrBool = False,.
-0000c820: 2020 2020 2020 2020 6967 6e6f 7265 5f63          ignore_c
-0000c830: 6f6e 7465 6e74 5f77 6964 7468 3a20 4669  ontent_width: Fi
-0000c840: 6c74 6572 4f72 426f 6f6c 203d 2046 616c  lterOrBool = Fal
-0000c850: 7365 2c0a 2020 2020 2020 2020 6967 6e6f  se,.        igno
-0000c860: 7265 5f63 6f6e 7465 6e74 5f68 6569 6768  re_content_heigh
-0000c870: 743a 2046 696c 7465 724f 7242 6f6f 6c20  t: FilterOrBool 
-0000c880: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-0000c890: 206c 6566 745f 6d61 7267 696e 733a 204f   left_margins: O
-0000c8a0: 7074 696f 6e61 6c5b 5365 7175 656e 6365  ptional[Sequence
-0000c8b0: 5b4d 6172 6769 6e5d 5d20 3d20 4e6f 6e65  [Margin]] = None
-0000c8c0: 2c0a 2020 2020 2020 2020 7269 6768 745f  ,.        right_
-0000c8d0: 6d61 7267 696e 733a 204f 7074 696f 6e61  margins: Optiona
-0000c8e0: 6c5b 5365 7175 656e 6365 5b4d 6172 6769  l[Sequence[Margi
-0000c8f0: 6e5d 5d20 3d20 4e6f 6e65 2c0a 2020 2020  n]] = None,.    
-0000c900: 2020 2020 7363 726f 6c6c 5f6f 6666 7365      scroll_offse
-0000c910: 7473 3a20 4f70 7469 6f6e 616c 5b53 6372  ts: Optional[Scr
-0000c920: 6f6c 6c4f 6666 7365 7473 5d20 3d20 4e6f  ollOffsets] = No
-0000c930: 6e65 2c0a 2020 2020 2020 2020 616c 6c6f  ne,.        allo
-0000c940: 775f 7363 726f 6c6c 5f62 6579 6f6e 645f  w_scroll_beyond_
-0000c950: 626f 7474 6f6d 3a20 4669 6c74 6572 4f72  bottom: FilterOr
-0000c960: 426f 6f6c 203d 2046 616c 7365 2c0a 2020  Bool = False,.  
-0000c970: 2020 2020 2020 7772 6170 5f6c 696e 6573        wrap_lines
-0000c980: 3a20 4669 6c74 6572 4f72 426f 6f6c 203d  : FilterOrBool =
-0000c990: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-0000c9a0: 6765 745f 7665 7274 6963 616c 5f73 6372  get_vertical_scr
-0000c9b0: 6f6c 6c3a 204f 7074 696f 6e61 6c5b 4361  oll: Optional[Ca
-0000c9c0: 6c6c 6162 6c65 5b5b 2257 696e 646f 7722  llable[["Window"
-0000c9d0: 5d2c 2069 6e74 5d5d 203d 204e 6f6e 652c  ], int]] = None,
-0000c9e0: 0a20 2020 2020 2020 2067 6574 5f68 6f72  .        get_hor
-0000c9f0: 697a 6f6e 7461 6c5f 7363 726f 6c6c 3a20  izontal_scroll: 
-0000ca00: 4f70 7469 6f6e 616c 5b43 616c 6c61 626c  Optional[Callabl
-0000ca10: 655b 5b22 5769 6e64 6f77 225d 2c20 696e  e[["Window"], in
-0000ca20: 745d 5d20 3d20 4e6f 6e65 2c0a 2020 2020  t]] = None,.    
-0000ca30: 2020 2020 616c 7761 7973 5f68 6964 655f      always_hide_
-0000ca40: 6375 7273 6f72 3a20 4669 6c74 6572 4f72  cursor: FilterOr
-0000ca50: 426f 6f6c 203d 2046 616c 7365 2c0a 2020  Bool = False,.  
-0000ca60: 2020 2020 2020 6375 7273 6f72 6c69 6e65        cursorline
-0000ca70: 3a20 4669 6c74 6572 4f72 426f 6f6c 203d  : FilterOrBool =
-0000ca80: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-0000ca90: 6375 7273 6f72 636f 6c75 6d6e 3a20 4669  cursorcolumn: Fi
-0000caa0: 6c74 6572 4f72 426f 6f6c 203d 2046 616c  lterOrBool = Fal
-0000cab0: 7365 2c0a 2020 2020 2020 2020 636f 6c6f  se,.        colo
-0000cac0: 7263 6f6c 756d 6e73 3a20 556e 696f 6e5b  rcolumns: Union[
-0000cad0: 0a20 2020 2020 2020 2020 2020 204e 6f6e  .            Non
-0000cae0: 652c 204c 6973 745b 436f 6c6f 7243 6f6c  e, List[ColorCol
-0000caf0: 756d 6e5d 2c20 4361 6c6c 6162 6c65 5b5b  umn], Callable[[
-0000cb00: 5d2c 204c 6973 745b 436f 6c6f 7243 6f6c  ], List[ColorCol
-0000cb10: 756d 6e5d 5d0a 2020 2020 2020 2020 5d20  umn]].        ] 
-0000cb20: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-0000cb30: 616c 6967 6e3a 2055 6e69 6f6e 5b57 696e  align: Union[Win
-0000cb40: 646f 7741 6c69 676e 2c20 4361 6c6c 6162  dowAlign, Callab
-0000cb50: 6c65 5b5b 5d2c 2057 696e 646f 7741 6c69  le[[], WindowAli
-0000cb60: 676e 5d5d 203d 2022 6c65 6674 222c 0a20  gn]] = "left",. 
-0000cb70: 2020 2020 2020 2073 7479 6c65 3a20 556e         style: Un
-0000cb80: 696f 6e5b 7374 722c 2043 616c 6c61 626c  ion[str, Callabl
-0000cb90: 655b 5b5d 2c20 7374 725d 5d20 3d20 2222  e[[], str]] = ""
-0000cba0: 2c0a 2020 2020 2020 2020 6368 6172 3a20  ,.        char: 
-0000cbb0: 556e 696f 6e5b 4e6f 6e65 2c20 7374 722c  Union[None, str,
-0000cbc0: 2043 616c 6c61 626c 655b 5b5d 2c20 7374   Callable[[], st
-0000cbd0: 725d 5d20 3d20 4e6f 6e65 2c0a 2020 2020  r]] = None,.    
-0000cbe0: 2020 2020 6765 745f 6c69 6e65 5f70 7265      get_line_pre
-0000cbf0: 6669 783a 204f 7074 696f 6e61 6c5b 4765  fix: Optional[Ge
-0000cc00: 744c 696e 6550 7265 6669 7843 616c 6c61  tLinePrefixCalla
-0000cc10: 626c 655d 203d 204e 6f6e 652c 0a20 2020  ble] = None,.   
-0000cc20: 2029 202d 3e20 4e6f 6e65 3a0a 0a20 2020   ) -> None:..   
-0000cc30: 2020 2020 2073 656c 662e 616c 6c6f 775f       self.allow_
-0000cc40: 7363 726f 6c6c 5f62 6579 6f6e 645f 626f  scroll_beyond_bo
-0000cc50: 7474 6f6d 203d 2074 6f5f 6669 6c74 6572  ttom = to_filter
-0000cc60: 2861 6c6c 6f77 5f73 6372 6f6c 6c5f 6265  (allow_scroll_be
-0000cc70: 796f 6e64 5f62 6f74 746f 6d29 0a20 2020  yond_bottom).   
-0000cc80: 2020 2020 2073 656c 662e 616c 7761 7973       self.always
-0000cc90: 5f68 6964 655f 6375 7273 6f72 203d 2074  _hide_cursor = t
-0000cca0: 6f5f 6669 6c74 6572 2861 6c77 6179 735f  o_filter(always_
-0000ccb0: 6869 6465 5f63 7572 736f 7229 0a20 2020  hide_cursor).   
-0000ccc0: 2020 2020 2073 656c 662e 7772 6170 5f6c       self.wrap_l
-0000ccd0: 696e 6573 203d 2074 6f5f 6669 6c74 6572  ines = to_filter
-0000cce0: 2877 7261 705f 6c69 6e65 7329 0a20 2020  (wrap_lines).   
-0000ccf0: 2020 2020 2073 656c 662e 6375 7273 6f72       self.cursor
-0000cd00: 6c69 6e65 203d 2074 6f5f 6669 6c74 6572  line = to_filter
-0000cd10: 2863 7572 736f 726c 696e 6529 0a20 2020  (cursorline).   
-0000cd20: 2020 2020 2073 656c 662e 6375 7273 6f72       self.cursor
-0000cd30: 636f 6c75 6d6e 203d 2074 6f5f 6669 6c74  column = to_filt
-0000cd40: 6572 2863 7572 736f 7263 6f6c 756d 6e29  er(cursorcolumn)
-0000cd50: 0a0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-0000cd60: 6f6e 7465 6e74 203d 2063 6f6e 7465 6e74  ontent = content
-0000cd70: 206f 7220 4475 6d6d 7943 6f6e 7472 6f6c   or DummyControl
-0000cd80: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-0000cd90: 646f 6e74 5f65 7874 656e 645f 7769 6474  dont_extend_widt
-0000cda0: 6820 3d20 746f 5f66 696c 7465 7228 646f  h = to_filter(do
-0000cdb0: 6e74 5f65 7874 656e 645f 7769 6474 6829  nt_extend_width)
-0000cdc0: 0a20 2020 2020 2020 2073 656c 662e 646f  .        self.do
-0000cdd0: 6e74 5f65 7874 656e 645f 6865 6967 6874  nt_extend_height
-0000cde0: 203d 2074 6f5f 6669 6c74 6572 2864 6f6e   = to_filter(don
-0000cdf0: 745f 6578 7465 6e64 5f68 6569 6768 7429  t_extend_height)
-0000ce00: 0a20 2020 2020 2020 2073 656c 662e 6967  .        self.ig
-0000ce10: 6e6f 7265 5f63 6f6e 7465 6e74 5f77 6964  nore_content_wid
-0000ce20: 7468 203d 2074 6f5f 6669 6c74 6572 2869  th = to_filter(i
-0000ce30: 676e 6f72 655f 636f 6e74 656e 745f 7769  gnore_content_wi
-0000ce40: 6474 6829 0a20 2020 2020 2020 2073 656c  dth).        sel
-0000ce50: 662e 6967 6e6f 7265 5f63 6f6e 7465 6e74  f.ignore_content
-0000ce60: 5f68 6569 6768 7420 3d20 746f 5f66 696c  _height = to_fil
-0000ce70: 7465 7228 6967 6e6f 7265 5f63 6f6e 7465  ter(ignore_conte
-0000ce80: 6e74 5f68 6569 6768 7429 0a20 2020 2020  nt_height).     
-0000ce90: 2020 2073 656c 662e 6c65 6674 5f6d 6172     self.left_mar
-0000cea0: 6769 6e73 203d 206c 6566 745f 6d61 7267  gins = left_marg
-0000ceb0: 696e 7320 6f72 205b 5d0a 2020 2020 2020  ins or [].      
-0000cec0: 2020 7365 6c66 2e72 6967 6874 5f6d 6172    self.right_mar
-0000ced0: 6769 6e73 203d 2072 6967 6874 5f6d 6172  gins = right_mar
-0000cee0: 6769 6e73 206f 7220 5b5d 0a20 2020 2020  gins or [].     
-0000cef0: 2020 2073 656c 662e 7363 726f 6c6c 5f6f     self.scroll_o
-0000cf00: 6666 7365 7473 203d 2073 6372 6f6c 6c5f  ffsets = scroll_
-0000cf10: 6f66 6673 6574 7320 6f72 2053 6372 6f6c  offsets or Scrol
-0000cf20: 6c4f 6666 7365 7473 2829 0a20 2020 2020  lOffsets().     
-0000cf30: 2020 2073 656c 662e 6765 745f 7665 7274     self.get_vert
-0000cf40: 6963 616c 5f73 6372 6f6c 6c20 3d20 6765  ical_scroll = ge
-0000cf50: 745f 7665 7274 6963 616c 5f73 6372 6f6c  t_vertical_scrol
-0000cf60: 6c0a 2020 2020 2020 2020 7365 6c66 2e67  l.        self.g
-0000cf70: 6574 5f68 6f72 697a 6f6e 7461 6c5f 7363  et_horizontal_sc
-0000cf80: 726f 6c6c 203d 2067 6574 5f68 6f72 697a  roll = get_horiz
-0000cf90: 6f6e 7461 6c5f 7363 726f 6c6c 0a20 2020  ontal_scroll.   
-0000cfa0: 2020 2020 2073 656c 662e 636f 6c6f 7263       self.colorc
-0000cfb0: 6f6c 756d 6e73 203d 2063 6f6c 6f72 636f  olumns = colorco
-0000cfc0: 6c75 6d6e 7320 6f72 205b 5d0a 2020 2020  lumns or [].    
-0000cfd0: 2020 2020 7365 6c66 2e61 6c69 676e 203d      self.align =
-0000cfe0: 2061 6c69 676e 0a20 2020 2020 2020 2073   align.        s
-0000cff0: 656c 662e 7374 796c 6520 3d20 7374 796c  elf.style = styl
-0000d000: 650a 2020 2020 2020 2020 7365 6c66 2e63  e.        self.c
-0000d010: 6861 7220 3d20 6368 6172 0a20 2020 2020  har = char.     
-0000d020: 2020 2073 656c 662e 6765 745f 6c69 6e65     self.get_line
-0000d030: 5f70 7265 6669 7820 3d20 6765 745f 6c69  _prefix = get_li
-0000d040: 6e65 5f70 7265 6669 780a 0a20 2020 2020  ne_prefix..     
-0000d050: 2020 2073 656c 662e 7769 6474 6820 3d20     self.width = 
-0000d060: 7769 6474 680a 2020 2020 2020 2020 7365  width.        se
-0000d070: 6c66 2e68 6569 6768 7420 3d20 6865 6967  lf.height = heig
-0000d080: 6874 0a20 2020 2020 2020 2073 656c 662e  ht.        self.
-0000d090: 7a5f 696e 6465 7820 3d20 7a5f 696e 6465  z_index = z_inde
-0000d0a0: 780a 0a20 2020 2020 2020 2023 2043 6163  x..        # Cac
-0000d0b0: 6865 2066 6f72 2074 6865 2073 6372 6565  he for the scree
-0000d0c0: 6e73 2067 656e 6572 6174 6564 2062 7920  ns generated by 
-0000d0d0: 7468 6520 6d61 7267 696e 2e0a 2020 2020  the margin..    
-0000d0e0: 2020 2020 7365 6c66 2e5f 7569 5f63 6f6e      self._ui_con
-0000d0f0: 7465 6e74 5f63 6163 6865 3a20 5369 6d70  tent_cache: Simp
-0000d100: 6c65 4361 6368 655b 0a20 2020 2020 2020  leCache[.       
-0000d110: 2020 2020 2054 7570 6c65 5b69 6e74 2c20       Tuple[int, 
-0000d120: 696e 742c 2069 6e74 5d2c 2055 4943 6f6e  int, int], UICon
-0000d130: 7465 6e74 0a20 2020 2020 2020 205d 203d  tent.        ] =
-0000d140: 2053 696d 706c 6543 6163 6865 286d 6178   SimpleCache(max
-0000d150: 7369 7a65 3d38 290a 2020 2020 2020 2020  size=8).        
-0000d160: 7365 6c66 2e5f 6d61 7267 696e 5f77 6964  self._margin_wid
-0000d170: 7468 5f63 6163 6865 3a20 5369 6d70 6c65  th_cache: Simple
-0000d180: 4361 6368 655b 5475 706c 655b 4d61 7267  Cache[Tuple[Marg
-0000d190: 696e 2c20 696e 745d 2c20 696e 745d 203d  in, int], int] =
-0000d1a0: 2053 696d 706c 6543 6163 6865 280a 2020   SimpleCache(.  
-0000d1b0: 2020 2020 2020 2020 2020 6d61 7873 697a            maxsiz
-0000d1c0: 653d 310a 2020 2020 2020 2020 290a 0a20  e=1.        ).. 
-0000d1d0: 2020 2020 2020 2073 656c 662e 7265 7365         self.rese
-0000d1e0: 7428 290a 0a20 2020 2064 6566 205f 5f72  t()..    def __r
-0000d1f0: 6570 725f 5f28 7365 6c66 2920 2d3e 2073  epr__(self) -> s
-0000d200: 7472 3a0a 2020 2020 2020 2020 7265 7475  tr:.        retu
-0000d210: 726e 2022 5769 6e64 6f77 2863 6f6e 7465  rn "Window(conte
-0000d220: 6e74 3d25 7229 2220 2520 7365 6c66 2e63  nt=%r)" % self.c
-0000d230: 6f6e 7465 6e74 0a0a 2020 2020 6465 6620  ontent..    def 
-0000d240: 7265 7365 7428 7365 6c66 2920 2d3e 204e  reset(self) -> N
-0000d250: 6f6e 653a 0a20 2020 2020 2020 2073 656c  one:.        sel
-0000d260: 662e 636f 6e74 656e 742e 7265 7365 7428  f.content.reset(
-0000d270: 290a 0a20 2020 2020 2020 2023 3a20 5363  )..        #: Sc
-0000d280: 726f 6c6c 696e 6720 706f 7369 7469 6f6e  rolling position
-0000d290: 206f 6620 7468 6520 6d61 696e 2063 6f6e   of the main con
-0000d2a0: 7465 6e74 2e0a 2020 2020 2020 2020 7365  tent..        se
-0000d2b0: 6c66 2e76 6572 7469 6361 6c5f 7363 726f  lf.vertical_scro
-0000d2c0: 6c6c 203d 2030 0a20 2020 2020 2020 2073  ll = 0.        s
-0000d2d0: 656c 662e 686f 7269 7a6f 6e74 616c 5f73  elf.horizontal_s
-0000d2e0: 6372 6f6c 6c20 3d20 300a 0a20 2020 2020  croll = 0..     
-0000d2f0: 2020 2023 2056 6572 7469 6361 6c20 7363     # Vertical sc
-0000d300: 726f 6c6c 2032 3a20 7468 6973 2069 7320  roll 2: this is 
-0000d310: 7468 6520 7665 7274 6963 616c 206f 6666  the vertical off
-0000d320: 7365 7420 7468 6174 2061 206c 696e 6520  set that a line 
-0000d330: 6973 0a20 2020 2020 2020 2023 2073 6372  is.        # scr
-0000d340: 6f6c 6c65 6420 6966 2061 2073 696e 676c  olled if a singl
-0000d350: 6520 6c69 6e65 2028 7468 6520 6f6e 6520  e line (the one 
-0000d360: 7468 6174 2063 6f6e 7461 696e 7320 7468  that contains th
-0000d370: 6520 6375 7273 6f72 2920 636f 6e73 756d  e cursor) consum
-0000d380: 6573 0a20 2020 2020 2020 2023 2061 6c6c  es.        # all
-0000d390: 206f 6620 7468 6520 7665 7274 6963 616c   of the vertical
-0000d3a0: 2073 7061 6365 2e0a 2020 2020 2020 2020   space..        
-0000d3b0: 7365 6c66 2e76 6572 7469 6361 6c5f 7363  self.vertical_sc
-0000d3c0: 726f 6c6c 5f32 203d 2030 0a0a 2020 2020  roll_2 = 0..    
-0000d3d0: 2020 2020 233a 204b 6565 7020 7265 6e64      #: Keep rend
-0000d3e0: 6572 2069 6e66 6f72 6d61 7469 6f6e 2028  er information (
-0000d3f0: 6d61 7070 696e 6773 2062 6574 7765 656e  mappings between
-0000d400: 2062 7566 6665 7220 696e 7075 7420 616e   buffer input an
-0000d410: 6420 7265 6e64 6572 0a20 2020 2020 2020  d render.       
-0000d420: 2023 3a20 6f75 7470 7574 2e29 0a20 2020   #: output.).   
-0000d430: 2020 2020 2073 656c 662e 7265 6e64 6572       self.render
-0000d440: 5f69 6e66 6f3a 204f 7074 696f 6e61 6c5b  _info: Optional[
-0000d450: 5769 6e64 6f77 5265 6e64 6572 496e 666f  WindowRenderInfo
-0000d460: 5d20 3d20 4e6f 6e65 0a0a 2020 2020 6465  ] = None..    de
-0000d470: 6620 5f67 6574 5f6d 6172 6769 6e5f 7769  f _get_margin_wi
-0000d480: 6474 6828 7365 6c66 2c20 6d61 7267 696e  dth(self, margin
-0000d490: 3a20 4d61 7267 696e 2920 2d3e 2069 6e74  : Margin) -> int
-0000d4a0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0000d4b0: 2020 2020 2020 5265 7475 726e 2074 6865        Return the
-0000d4c0: 2077 6964 7468 2066 6f72 2074 6869 7320   width for this 
-0000d4d0: 6d61 7267 696e 2e0a 2020 2020 2020 2020  margin..        
-0000d4e0: 2843 616c 6375 6c61 7465 206f 6e6c 7920  (Calculate only 
-0000d4f0: 6f6e 6365 2070 6572 2072 656e 6465 7220  once per render 
-0000d500: 7469 6d65 2e29 0a20 2020 2020 2020 2022  time.).        "
-0000d510: 2222 0a20 2020 2020 2020 2023 204d 6172  "".        # Mar
-0000d520: 6769 6e2e 6765 745f 7769 6474 682c 206e  gin.get_width, n
-0000d530: 6565 6473 2074 6f20 6861 7665 2061 2055  eeds to have a U
-0000d540: 4943 6f6e 7465 6e74 2069 6e73 7461 6e63  IContent instanc
-0000d550: 652e 0a20 2020 2020 2020 2064 6566 2067  e..        def g
-0000d560: 6574 5f75 695f 636f 6e74 656e 7428 2920  et_ui_content() 
-0000d570: 2d3e 2055 4943 6f6e 7465 6e74 3a0a 2020  -> UIContent:.  
-0000d580: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000d590: 2073 656c 662e 5f67 6574 5f75 695f 636f   self._get_ui_co
-0000d5a0: 6e74 656e 7428 7769 6474 683d 302c 2068  ntent(width=0, h
-0000d5b0: 6569 6768 743d 3029 0a0a 2020 2020 2020  eight=0)..      
-0000d5c0: 2020 6465 6620 6765 745f 7769 6474 6828    def get_width(
-0000d5d0: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
-0000d5e0: 2020 2020 2020 7265 7475 726e 206d 6172        return mar
-0000d5f0: 6769 6e2e 6765 745f 7769 6474 6828 6765  gin.get_width(ge
-0000d600: 745f 7569 5f63 6f6e 7465 6e74 290a 0a20  t_ui_content).. 
-0000d610: 2020 2020 2020 206b 6579 203d 2028 6d61         key = (ma
-0000d620: 7267 696e 2c20 6765 745f 6170 7028 292e  rgin, get_app().
-0000d630: 7265 6e64 6572 5f63 6f75 6e74 6572 290a  render_counter).
-0000d640: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000d650: 656c 662e 5f6d 6172 6769 6e5f 7769 6474  elf._margin_widt
-0000d660: 685f 6361 6368 652e 6765 7428 6b65 792c  h_cache.get(key,
-0000d670: 2067 6574 5f77 6964 7468 290a 0a20 2020   get_width)..   
-0000d680: 2064 6566 205f 6765 745f 746f 7461 6c5f   def _get_total_
-0000d690: 6d61 7267 696e 5f77 6964 7468 2873 656c  margin_width(sel
-0000d6a0: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
-0000d6b0: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
-0000d6c0: 616c 6375 6c61 7465 2061 6e64 2072 6574  alculate and ret
-0000d6d0: 7572 6e20 7468 6520 7769 6474 6820 6f66  urn the width of
-0000d6e0: 2074 6865 206d 6172 6769 6e20 286c 6566   the margin (lef
-0000d6f0: 7420 2b20 7269 6768 7429 2e0a 2020 2020  t + right)..    
-0000d700: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000d710: 7265 7475 726e 2073 756d 2873 656c 662e  return sum(self.
-0000d720: 5f67 6574 5f6d 6172 6769 6e5f 7769 6474  _get_margin_widt
-0000d730: 6828 6d29 2066 6f72 206d 2069 6e20 7365  h(m) for m in se
-0000d740: 6c66 2e6c 6566 745f 6d61 7267 696e 7329  lf.left_margins)
-0000d750: 202b 2073 756d 280a 2020 2020 2020 2020   + sum(.        
-0000d760: 2020 2020 7365 6c66 2e5f 6765 745f 6d61      self._get_ma
-0000d770: 7267 696e 5f77 6964 7468 286d 2920 666f  rgin_width(m) fo
-0000d780: 7220 6d20 696e 2073 656c 662e 7269 6768  r m in self.righ
-0000d790: 745f 6d61 7267 696e 730a 2020 2020 2020  t_margins.      
-0000d7a0: 2020 290a 0a20 2020 2064 6566 2070 7265    )..    def pre
-0000d7b0: 6665 7272 6564 5f77 6964 7468 2873 656c  ferred_width(sel
-0000d7c0: 662c 206d 6178 5f61 7661 696c 6162 6c65  f, max_available
-0000d7d0: 5f77 6964 7468 3a20 696e 7429 202d 3e20  _width: int) -> 
-0000d7e0: 4469 6d65 6e73 696f 6e3a 0a20 2020 2020  Dimension:.     
-0000d7f0: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
-0000d800: 616c 6375 6c61 7465 2074 6865 2070 7265  alculate the pre
-0000d810: 6665 7272 6564 2077 6964 7468 2066 6f72  ferred width for
-0000d820: 2074 6869 7320 7769 6e64 6f77 2e0a 2020   this window..  
-0000d830: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-0000d840: 2020 2064 6566 2070 7265 6665 7272 6564     def preferred
-0000d850: 5f63 6f6e 7465 6e74 5f77 6964 7468 2829  _content_width()
-0000d860: 202d 3e20 4f70 7469 6f6e 616c 5b69 6e74   -> Optional[int
-0000d870: 5d3a 0a20 2020 2020 2020 2020 2020 2022  ]:.            "
-0000d880: 2222 436f 6e74 656e 7420 7769 6474 683a  ""Content width:
-0000d890: 2069 7320 6f6e 6c79 2063 616c 6375 6c61   is only calcula
-0000d8a0: 7465 6420 6966 206e 6f20 6578 6163 7420  ted if no exact 
-0000d8b0: 7769 6474 6820 666f 7220 7468 650a 2020  width for the.  
-0000d8c0: 2020 2020 2020 2020 2020 7769 6e64 6f77            window
-0000d8d0: 2077 6173 2067 6976 656e 2e22 2222 0a20   was given.""". 
-0000d8e0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0000d8f0: 6c66 2e69 676e 6f72 655f 636f 6e74 656e  lf.ignore_conten
-0000d900: 745f 7769 6474 6828 293a 0a20 2020 2020  t_width():.     
-0000d910: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000d920: 6e20 4e6f 6e65 0a0a 2020 2020 2020 2020  n None..        
-0000d930: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
-0000d940: 7468 6520 7769 6474 6820 6f66 2074 6865  the width of the
-0000d950: 206d 6172 6769 6e2e 0a20 2020 2020 2020   margin..       
-0000d960: 2020 2020 2074 6f74 616c 5f6d 6172 6769       total_margi
-0000d970: 6e5f 7769 6474 6820 3d20 7365 6c66 2e5f  n_width = self._
-0000d980: 6765 745f 746f 7461 6c5f 6d61 7267 696e  get_total_margin
-0000d990: 5f77 6964 7468 2829 0a0a 2020 2020 2020  _width()..      
-0000d9a0: 2020 2020 2020 2320 5769 6e64 6f77 206f        # Window o
-0000d9b0: 6620 7468 6520 636f 6e74 656e 742e 2028  f the content. (
-0000d9c0: 4361 6e20 6265 2060 4e6f 6e65 602e 290a  Can be `None`.).
-0000d9d0: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-0000d9e0: 6572 7265 645f 7769 6474 6820 3d20 7365  erred_width = se
-0000d9f0: 6c66 2e63 6f6e 7465 6e74 2e70 7265 6665  lf.content.prefe
-0000da00: 7272 6564 5f77 6964 7468 280a 2020 2020  rred_width(.    
-0000da10: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
-0000da20: 6176 6169 6c61 626c 655f 7769 6474 6820  available_width 
-0000da30: 2d20 746f 7461 6c5f 6d61 7267 696e 5f77  - total_margin_w
-0000da40: 6964 7468 0a20 2020 2020 2020 2020 2020  idth.           
-0000da50: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-0000da60: 6966 2070 7265 6665 7272 6564 5f77 6964  if preferred_wid
-0000da70: 7468 2069 7320 6e6f 7420 4e6f 6e65 3a0a  th is not None:.
-0000da80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da90: 2320 496e 636c 7564 6520 7769 6474 6820  # Include width 
-0000daa0: 6f66 2074 6865 206d 6172 6769 6e73 2e0a  of the margins..
-0000dab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dac0: 7072 6566 6572 7265 645f 7769 6474 6820  preferred_width 
-0000dad0: 2b3d 2074 6f74 616c 5f6d 6172 6769 6e5f  += total_margin_
-0000dae0: 7769 6474 680a 2020 2020 2020 2020 2020  width.          
-0000daf0: 2020 7265 7475 726e 2070 7265 6665 7272    return preferr
-0000db00: 6564 5f77 6964 7468 0a0a 2020 2020 2020  ed_width..      
-0000db10: 2020 2320 4d65 7267 652e 0a20 2020 2020    # Merge..     
-0000db20: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0000db30: 6d65 7267 655f 6469 6d65 6e73 696f 6e73  merge_dimensions
-0000db40: 280a 2020 2020 2020 2020 2020 2020 6469  (.            di
-0000db50: 6d65 6e73 696f 6e3d 746f 5f64 696d 656e  mension=to_dimen
-0000db60: 7369 6f6e 2873 656c 662e 7769 6474 6829  sion(self.width)
-0000db70: 2c0a 2020 2020 2020 2020 2020 2020 6765  ,.            ge
-0000db80: 745f 7072 6566 6572 7265 643d 7072 6566  t_preferred=pref
-0000db90: 6572 7265 645f 636f 6e74 656e 745f 7769  erred_content_wi
-0000dba0: 6474 682c 0a20 2020 2020 2020 2020 2020  dth,.           
-0000dbb0: 2064 6f6e 745f 6578 7465 6e64 3d73 656c   dont_extend=sel
-0000dbc0: 662e 646f 6e74 5f65 7874 656e 645f 7769  f.dont_extend_wi
-0000dbd0: 6474 6828 292c 0a20 2020 2020 2020 2029  dth(),.        )
-0000dbe0: 0a0a 2020 2020 6465 6620 7072 6566 6572  ..    def prefer
-0000dbf0: 7265 645f 6865 6967 6874 2873 656c 662c  red_height(self,
-0000dc00: 2077 6964 7468 3a20 696e 742c 206d 6178   width: int, max
-0000dc10: 5f61 7661 696c 6162 6c65 5f68 6569 6768  _available_heigh
-0000dc20: 743a 2069 6e74 2920 2d3e 2044 696d 656e  t: int) -> Dimen
-0000dc30: 7369 6f6e 3a0a 2020 2020 2020 2020 2222  sion:.        ""
-0000dc40: 220a 2020 2020 2020 2020 4361 6c63 756c  ".        Calcul
-0000dc50: 6174 6520 7468 6520 7072 6566 6572 7265  ate the preferre
-0000dc60: 6420 6865 6967 6874 2066 6f72 2074 6869  d height for thi
-0000dc70: 7320 7769 6e64 6f77 2e0a 2020 2020 2020  s window..      
-0000dc80: 2020 2222 220a 0a20 2020 2020 2020 2064    """..        d
-0000dc90: 6566 2070 7265 6665 7272 6564 5f63 6f6e  ef preferred_con
-0000dca0: 7465 6e74 5f68 6569 6768 7428 2920 2d3e  tent_height() ->
-0000dcb0: 204f 7074 696f 6e61 6c5b 696e 745d 3a0a   Optional[int]:.
-0000dcc0: 2020 2020 2020 2020 2020 2020 2222 2243              """C
-0000dcd0: 6f6e 7465 6e74 2068 6569 6768 743a 2069  ontent height: i
-0000dce0: 7320 6f6e 6c79 2063 616c 6375 6c61 7465  s only calculate
-0000dcf0: 6420 6966 206e 6f20 6578 6163 7420 6865  d if no exact he
-0000dd00: 6967 6874 2066 6f72 2074 6865 0a20 2020  ight for the.   
-0000dd10: 2020 2020 2020 2020 2077 696e 646f 7720           window 
-0000dd20: 7761 7320 6769 7665 6e2e 2222 220a 2020  was given.""".  
-0000dd30: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-0000dd40: 662e 6967 6e6f 7265 5f63 6f6e 7465 6e74  f.ignore_content
-0000dd50: 5f68 6569 6768 7428 293a 0a20 2020 2020  _height():.     
-0000dd60: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000dd70: 6e20 4e6f 6e65 0a0a 2020 2020 2020 2020  n None..        
-0000dd80: 2020 2020 746f 7461 6c5f 6d61 7267 696e      total_margin
-0000dd90: 5f77 6964 7468 203d 2073 656c 662e 5f67  _width = self._g
-0000dda0: 6574 5f74 6f74 616c 5f6d 6172 6769 6e5f  et_total_margin_
-0000ddb0: 7769 6474 6828 290a 2020 2020 2020 2020  width().        
-0000ddc0: 2020 2020 7772 6170 5f6c 696e 6573 203d      wrap_lines =
-0000ddd0: 2073 656c 662e 7772 6170 5f6c 696e 6573   self.wrap_lines
-0000dde0: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-0000ddf0: 7265 7475 726e 2073 656c 662e 636f 6e74  return self.cont
-0000de00: 656e 742e 7072 6566 6572 7265 645f 6865  ent.preferred_he
-0000de10: 6967 6874 280a 2020 2020 2020 2020 2020  ight(.          
-0000de20: 2020 2020 2020 7769 6474 6820 2d20 746f        width - to
-0000de30: 7461 6c5f 6d61 7267 696e 5f77 6964 7468  tal_margin_width
-0000de40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000de50: 2020 6d61 785f 6176 6169 6c61 626c 655f    max_available_
-0000de60: 6865 6967 6874 2c0a 2020 2020 2020 2020  height,.        
-0000de70: 2020 2020 2020 2020 7772 6170 5f6c 696e          wrap_lin
-0000de80: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-0000de90: 2020 2020 7365 6c66 2e67 6574 5f6c 696e      self.get_lin
-0000dea0: 655f 7072 6566 6978 2c0a 2020 2020 2020  e_prefix,.      
-0000deb0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0000dec0: 2072 6574 7572 6e20 7365 6c66 2e5f 6d65   return self._me
-0000ded0: 7267 655f 6469 6d65 6e73 696f 6e73 280a  rge_dimensions(.
-0000dee0: 2020 2020 2020 2020 2020 2020 6469 6d65              dime
-0000def0: 6e73 696f 6e3d 746f 5f64 696d 656e 7369  nsion=to_dimensi
-0000df00: 6f6e 2873 656c 662e 6865 6967 6874 292c  on(self.height),
-0000df10: 0a20 2020 2020 2020 2020 2020 2067 6574  .            get
-0000df20: 5f70 7265 6665 7272 6564 3d70 7265 6665  _preferred=prefe
-0000df30: 7272 6564 5f63 6f6e 7465 6e74 5f68 6569  rred_content_hei
-0000df40: 6768 742c 0a20 2020 2020 2020 2020 2020  ght,.           
-0000df50: 2064 6f6e 745f 6578 7465 6e64 3d73 656c   dont_extend=sel
-0000df60: 662e 646f 6e74 5f65 7874 656e 645f 6865  f.dont_extend_he
-0000df70: 6967 6874 2829 2c0a 2020 2020 2020 2020  ight(),.        
-0000df80: 290a 0a20 2020 2040 7374 6174 6963 6d65  )..    @staticme
-0000df90: 7468 6f64 0a20 2020 2064 6566 205f 6d65  thod.    def _me
-0000dfa0: 7267 655f 6469 6d65 6e73 696f 6e73 280a  rge_dimensions(.
-0000dfb0: 2020 2020 2020 2020 6469 6d65 6e73 696f          dimensio
-0000dfc0: 6e3a 204f 7074 696f 6e61 6c5b 4469 6d65  n: Optional[Dime
-0000dfd0: 6e73 696f 6e5d 2c0a 2020 2020 2020 2020  nsion],.        
-0000dfe0: 6765 745f 7072 6566 6572 7265 643a 2043  get_preferred: C
-0000dff0: 616c 6c61 626c 655b 5b5d 2c20 4f70 7469  allable[[], Opti
-0000e000: 6f6e 616c 5b69 6e74 5d5d 2c0a 2020 2020  onal[int]],.    
-0000e010: 2020 2020 646f 6e74 5f65 7874 656e 643a      dont_extend:
-0000e020: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
-0000e030: 2020 2029 202d 3e20 4469 6d65 6e73 696f     ) -> Dimensio
-0000e040: 6e3a 0a20 2020 2020 2020 2022 2222 0a20  n:.        """. 
-0000e050: 2020 2020 2020 2054 616b 6520 7468 6520         Take the 
-0000e060: 4469 6d65 6e73 696f 6e20 6672 6f6d 2074  Dimension from t
-0000e070: 6869 7320 6057 696e 646f 7760 2063 6c61  his `Window` cla
-0000e080: 7373 2061 6e64 2074 6865 2072 6563 6569  ss and the recei
-0000e090: 7665 6420 7072 6566 6572 7265 640a 2020  ved preferred.  
-0000e0a0: 2020 2020 2020 7369 7a65 2066 726f 6d20        size from 
-0000e0b0: 7468 6520 6055 4943 6f6e 7472 6f6c 6020  the `UIControl` 
-0000e0c0: 616e 6420 7265 7475 726e 2061 2060 4469  and return a `Di
-0000e0d0: 6d65 6e73 696f 6e60 2074 6f20 7265 706f  mension` to repo
-0000e0e0: 7274 2074 6f20 7468 650a 2020 2020 2020  rt to the.      
-0000e0f0: 2020 7061 7265 6e74 2063 6f6e 7461 696e    parent contain
-0000e100: 6572 2e0a 2020 2020 2020 2020 2222 220a  er..        """.
-0000e110: 2020 2020 2020 2020 6469 6d65 6e73 696f          dimensio
-0000e120: 6e20 3d20 6469 6d65 6e73 696f 6e20 6f72  n = dimension or
-0000e130: 2044 696d 656e 7369 6f6e 2829 0a0a 2020   Dimension()..  
-0000e140: 2020 2020 2020 2320 5768 656e 2061 2070        # When a p
-0000e150: 7265 6665 7272 6564 2064 696d 656e 7369  referred dimensi
-0000e160: 6f6e 2077 6173 2065 7870 6c69 6369 746c  on was explicitl
-0000e170: 7920 6769 7665 6e20 746f 2074 6865 2057  y given to the W
-0000e180: 696e 646f 772c 0a20 2020 2020 2020 2023  indow,.        #
-0000e190: 2069 676e 6f72 6520 7468 6520 5549 436f   ignore the UICo
-0000e1a0: 6e74 726f 6c2e 0a20 2020 2020 2020 2070  ntrol..        p
-0000e1b0: 7265 6665 7272 6564 3a20 4f70 7469 6f6e  referred: Option
-0000e1c0: 616c 5b69 6e74 5d0a 0a20 2020 2020 2020  al[int]..       
-0000e1d0: 2069 6620 6469 6d65 6e73 696f 6e2e 7072   if dimension.pr
-0000e1e0: 6566 6572 7265 645f 7370 6563 6966 6965  eferred_specifie
-0000e1f0: 643a 0a20 2020 2020 2020 2020 2020 2070  d:.            p
-0000e200: 7265 6665 7272 6564 203d 2064 696d 656e  referred = dimen
-0000e210: 7369 6f6e 2e70 7265 6665 7272 6564 0a20  sion.preferred. 
-0000e220: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000e230: 2020 2020 2020 2020 2023 204f 7468 6572           # Other
-0000e240: 7769 7365 2c20 6361 6c63 756c 6174 6520  wise, calculate 
-0000e250: 7468 6520 7072 6566 6572 7265 6420 6469  the preferred di
-0000e260: 6d65 6e73 696f 6e20 6672 6f6d 2074 6865  mension from the
-0000e270: 2055 4920 636f 6e74 726f 6c0a 2020 2020   UI control.    
-0000e280: 2020 2020 2020 2020 2320 636f 6e74 656e          # conten
-0000e290: 742e 0a20 2020 2020 2020 2020 2020 2070  t..            p
-0000e2a0: 7265 6665 7272 6564 203d 2067 6574 5f70  referred = get_p
-0000e2b0: 7265 6665 7272 6564 2829 0a0a 2020 2020  referred()..    
-0000e2c0: 2020 2020 2320 5768 656e 2061 2027 7072      # When a 'pr
-0000e2d0: 6566 6572 7265 6427 2064 696d 656e 7369  eferred' dimensi
-0000e2e0: 6f6e 2069 7320 6769 7665 6e20 6279 2074  on is given by t
-0000e2f0: 6865 2055 4943 6f6e 7472 6f6c 2c20 6d61  he UIControl, ma
-0000e300: 6b65 2073 7572 650a 2020 2020 2020 2020  ke sure.        
-0000e310: 2320 7468 6174 2069 7420 7374 6179 7320  # that it stays 
-0000e320: 7769 7468 696e 2074 6865 2062 6f75 6e64  within the bound
-0000e330: 7320 6f66 2074 6865 2057 696e 646f 772e  s of the Window.
-0000e340: 0a20 2020 2020 2020 2069 6620 7072 6566  .        if pref
-0000e350: 6572 7265 6420 6973 206e 6f74 204e 6f6e  erred is not Non
-0000e360: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-0000e370: 6620 6469 6d65 6e73 696f 6e2e 6d61 785f  f dimension.max_
-0000e380: 7370 6563 6966 6965 643a 0a20 2020 2020  specified:.     
-0000e390: 2020 2020 2020 2020 2020 2070 7265 6665             prefe
-0000e3a0: 7272 6564 203d 206d 696e 2870 7265 6665  rred = min(prefe
-0000e3b0: 7272 6564 2c20 6469 6d65 6e73 696f 6e2e  rred, dimension.
-0000e3c0: 6d61 7829 0a0a 2020 2020 2020 2020 2020  max)..          
-0000e3d0: 2020 6966 2064 696d 656e 7369 6f6e 2e6d    if dimension.m
-0000e3e0: 696e 5f73 7065 6369 6669 6564 3a0a 2020  in_specified:.  
-0000e3f0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0000e400: 6566 6572 7265 6420 3d20 6d61 7828 7072  eferred = max(pr
-0000e410: 6566 6572 7265 642c 2064 696d 656e 7369  eferred, dimensi
-0000e420: 6f6e 2e6d 696e 290a 0a20 2020 2020 2020  on.min)..       
-0000e430: 2023 2057 6865 6e20 6120 6064 6f6e 745f   # When a `dont_
-0000e440: 6578 7465 6e64 6020 666c 6167 2068 6173  extend` flag has
-0000e450: 2062 6565 6e20 6769 7665 6e2c 2075 7365   been given, use
-0000e460: 2074 6865 2070 7265 6665 7272 6564 2064   the preferred d
-0000e470: 696d 656e 7369 6f6e 0a20 2020 2020 2020  imension.       
-0000e480: 2023 2061 6c73 6f20 6173 2074 6865 206d   # also as the m
-0000e490: 6178 2064 696d 656e 7369 6f6e 2e0a 2020  ax dimension..  
-0000e4a0: 2020 2020 2020 6d61 785f 3a20 4f70 7469        max_: Opti
-0000e4b0: 6f6e 616c 5b69 6e74 5d0a 2020 2020 2020  onal[int].      
-0000e4c0: 2020 6d69 6e5f 3a20 4f70 7469 6f6e 616c    min_: Optional
-0000e4d0: 5b69 6e74 5d0a 0a20 2020 2020 2020 2069  [int]..        i
-0000e4e0: 6620 646f 6e74 5f65 7874 656e 6420 616e  f dont_extend an
-0000e4f0: 6420 7072 6566 6572 7265 6420 6973 206e  d preferred is n
-0000e500: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000e510: 2020 2020 206d 6178 5f20 3d20 6d69 6e28       max_ = min(
-0000e520: 6469 6d65 6e73 696f 6e2e 6d61 782c 2070  dimension.max, p
-0000e530: 7265 6665 7272 6564 290a 2020 2020 2020  referred).      
-0000e540: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000e550: 2020 2020 6d61 785f 203d 2064 696d 656e      max_ = dimen
-0000e560: 7369 6f6e 2e6d 6178 2069 6620 6469 6d65  sion.max if dime
-0000e570: 6e73 696f 6e2e 6d61 785f 7370 6563 6966  nsion.max_specif
-0000e580: 6965 6420 656c 7365 204e 6f6e 650a 0a20  ied else None.. 
-0000e590: 2020 2020 2020 206d 696e 5f20 3d20 6469         min_ = di
-0000e5a0: 6d65 6e73 696f 6e2e 6d69 6e20 6966 2064  mension.min if d
-0000e5b0: 696d 656e 7369 6f6e 2e6d 696e 5f73 7065  imension.min_spe
-0000e5c0: 6369 6669 6564 2065 6c73 6520 4e6f 6e65  cified else None
-0000e5d0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000e5e0: 2044 696d 656e 7369 6f6e 280a 2020 2020   Dimension(.    
-0000e5f0: 2020 2020 2020 2020 6d69 6e3d 6d69 6e5f          min=min_
-0000e600: 2c20 6d61 783d 6d61 785f 2c20 7072 6566  , max=max_, pref
-0000e610: 6572 7265 643d 7072 6566 6572 7265 642c  erred=preferred,
-0000e620: 2077 6569 6768 743d 6469 6d65 6e73 696f   weight=dimensio
-0000e630: 6e2e 7765 6967 6874 0a20 2020 2020 2020  n.weight.       
-0000e640: 2029 0a0a 2020 2020 6465 6620 5f67 6574   )..    def _get
-0000e650: 5f75 695f 636f 6e74 656e 7428 7365 6c66  _ui_content(self
-0000e660: 2c20 7769 6474 683a 2069 6e74 2c20 6865  , width: int, he
-0000e670: 6967 6874 3a20 696e 7429 202d 3e20 5549  ight: int) -> UI
-0000e680: 436f 6e74 656e 743a 0a20 2020 2020 2020  Content:.       
-0000e690: 2022 2222 0a20 2020 2020 2020 2043 7265   """.        Cre
-0000e6a0: 6174 6520 6120 6055 4943 6f6e 7465 6e74  ate a `UIContent
-0000e6b0: 6020 696e 7374 616e 6365 2e0a 2020 2020  ` instance..    
-0000e6c0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-0000e6d0: 2064 6566 2067 6574 5f63 6f6e 7465 6e74   def get_content
-0000e6e0: 2829 202d 3e20 5549 436f 6e74 656e 743a  () -> UIContent:
-0000e6f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000e700: 7572 6e20 7365 6c66 2e63 6f6e 7465 6e74  urn self.content
-0000e710: 2e63 7265 6174 655f 636f 6e74 656e 7428  .create_content(
-0000e720: 7769 6474 683d 7769 6474 682c 2068 6569  width=width, hei
-0000e730: 6768 743d 6865 6967 6874 290a 0a20 2020  ght=height)..   
-0000e740: 2020 2020 206b 6579 203d 2028 6765 745f       key = (get_
-0000e750: 6170 7028 292e 7265 6e64 6572 5f63 6f75  app().render_cou
-0000e760: 6e74 6572 2c20 7769 6474 682c 2068 6569  nter, width, hei
-0000e770: 6768 7429 0a20 2020 2020 2020 2072 6574  ght).        ret
-0000e780: 7572 6e20 7365 6c66 2e5f 7569 5f63 6f6e  urn self._ui_con
-0000e790: 7465 6e74 5f63 6163 6865 2e67 6574 286b  tent_cache.get(k
-0000e7a0: 6579 2c20 6765 745f 636f 6e74 656e 7429  ey, get_content)
-0000e7b0: 0a0a 2020 2020 6465 6620 5f67 6574 5f64  ..    def _get_d
-0000e7c0: 6967 7261 7068 5f63 6861 7228 7365 6c66  igraph_char(self
-0000e7d0: 2920 2d3e 204f 7074 696f 6e61 6c5b 7374  ) -> Optional[st
-0000e7e0: 725d 3a0a 2020 2020 2020 2020 2252 6574  r]:.        "Ret
-0000e7f0: 7572 6e20 6046 616c 7365 602c 206f 7220  urn `False`, or 
-0000e800: 7468 6520 4469 6772 6170 6820 7379 6d62  the Digraph symb
-0000e810: 6f6c 2074 6f20 6265 2075 7365 642e 220a  ol to be used.".
-0000e820: 2020 2020 2020 2020 6170 7020 3d20 6765          app = ge
-0000e830: 745f 6170 7028 290a 2020 2020 2020 2020  t_app().        
-0000e840: 6966 2061 7070 2e71 756f 7465 645f 696e  if app.quoted_in
-0000e850: 7365 7274 3a0a 2020 2020 2020 2020 2020  sert:.          
-0000e860: 2020 7265 7475 726e 2022 5e22 0a20 2020    return "^".   
-0000e870: 2020 2020 2069 6620 6170 702e 7669 5f73       if app.vi_s
-0000e880: 7461 7465 2e77 6169 7469 6e67 5f66 6f72  tate.waiting_for
-0000e890: 5f64 6967 7261 7068 3a0a 2020 2020 2020  _digraph:.      
-0000e8a0: 2020 2020 2020 6966 2061 7070 2e76 695f        if app.vi_
-0000e8b0: 7374 6174 652e 6469 6772 6170 685f 7379  state.digraph_sy
-0000e8c0: 6d62 6f6c 313a 0a20 2020 2020 2020 2020  mbol1:.         
-0000e8d0: 2020 2020 2020 2072 6574 7572 6e20 6170         return ap
-0000e8e0: 702e 7669 5f73 7461 7465 2e64 6967 7261  p.vi_state.digra
-0000e8f0: 7068 5f73 796d 626f 6c31 0a20 2020 2020  ph_symbol1.     
-0000e900: 2020 2020 2020 2072 6574 7572 6e20 223f         return "?
-0000e910: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-0000e920: 204e 6f6e 650a 0a20 2020 2064 6566 2077   None..    def w
-0000e930: 7269 7465 5f74 6f5f 7363 7265 656e 280a  rite_to_screen(.
-0000e940: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0000e950: 2020 2020 2020 7363 7265 656e 3a20 5363        screen: Sc
-0000e960: 7265 656e 2c0a 2020 2020 2020 2020 6d6f  reen,.        mo
-0000e970: 7573 655f 6861 6e64 6c65 7273 3a20 4d6f  use_handlers: Mo
-0000e980: 7573 6548 616e 646c 6572 732c 0a20 2020  useHandlers,.   
-0000e990: 2020 2020 2077 7269 7465 5f70 6f73 6974       write_posit
-0000e9a0: 696f 6e3a 2057 7269 7465 506f 7369 7469  ion: WritePositi
-0000e9b0: 6f6e 2c0a 2020 2020 2020 2020 7061 7265  on,.        pare
-0000e9c0: 6e74 5f73 7479 6c65 3a20 7374 722c 0a20  nt_style: str,. 
-0000e9d0: 2020 2020 2020 2065 7261 7365 5f62 673a         erase_bg:
-0000e9e0: 2062 6f6f 6c2c 0a20 2020 2020 2020 207a   bool,.        z
-0000e9f0: 5f69 6e64 6578 3a20 4f70 7469 6f6e 616c  _index: Optional
-0000ea00: 5b69 6e74 5d2c 0a20 2020 2029 202d 3e20  [int],.    ) -> 
-0000ea10: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-0000ea20: 220a 2020 2020 2020 2020 5772 6974 6520  ".        Write 
-0000ea30: 7769 6e64 6f77 2074 6f20 7363 7265 656e  window to screen
-0000ea40: 2e20 5468 6973 2072 656e 6465 7273 2074  . This renders t
-0000ea50: 6865 2075 7365 7220 636f 6e74 726f 6c2c  he user control,
-0000ea60: 2074 6865 206d 6172 6769 6e73 2061 6e64   the margins and
-0000ea70: 0a20 2020 2020 2020 2063 6f70 6965 7320  .        copies 
-0000ea80: 6576 6572 7974 6869 6e67 206f 7665 7220  everything over 
-0000ea90: 746f 2074 6865 2061 6273 6f6c 7574 6520  to the absolute 
-0000eaa0: 706f 7369 7469 6f6e 2061 7420 7468 6520  position at the 
-0000eab0: 6769 7665 6e20 7363 7265 656e 2e0a 2020  given screen..  
-0000eac0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000ead0: 2020 2320 4966 2064 6f6e 745f 6578 7465    # If dont_exte
-0000eae0: 6e64 5f77 6964 7468 2f68 6569 6768 7420  nd_width/height 
-0000eaf0: 7761 7320 6769 7665 6e2e 2054 6865 6e20  was given. Then 
-0000eb00: 7265 6475 6365 2077 6964 7468 2f68 6569  reduce width/hei
-0000eb10: 6768 7420 696e 0a20 2020 2020 2020 2023  ght in.        #
-0000eb20: 2057 7269 7465 506f 7369 7469 6f6e 2069   WritePosition i
-0000eb30: 6620 7468 6520 7061 7265 6e74 2077 616e  f the parent wan
-0000eb40: 7465 6420 7573 2074 6f20 7061 696e 7420  ted us to paint 
-0000eb50: 696e 2061 2062 6967 6765 7220 6172 6561  in a bigger area
-0000eb60: 2e0a 2020 2020 2020 2020 2320 2854 6869  ..        # (Thi
-0000eb70: 7320 6861 7070 656e 7320 6966 2074 6869  s happens if thi
-0000eb80: 7320 7769 6e64 6f77 2069 7320 6275 6e64  s window is bund
-0000eb90: 6c65 6420 7769 7468 2061 6e6f 7468 6572  led with another
-0000eba0: 2077 696e 646f 7720 696e 2061 0a20 2020   window in a.   
-0000ebb0: 2020 2020 2023 2048 5370 6c69 742f 5653       # HSplit/VS
-0000ebc0: 706c 6974 2c20 6275 7420 7769 7468 2064  plit, but with d
-0000ebd0: 6966 6665 7265 6e74 2073 697a 6520 7265  ifferent size re
-0000ebe0: 7175 6972 656d 656e 7473 2e29 0a20 2020  quirements.).   
-0000ebf0: 2020 2020 2077 7269 7465 5f70 6f73 6974       write_posit
-0000ec00: 696f 6e20 3d20 5772 6974 6550 6f73 6974  ion = WritePosit
-0000ec10: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
-0000ec20: 2078 706f 733d 7772 6974 655f 706f 7369   xpos=write_posi
-0000ec30: 7469 6f6e 2e78 706f 732c 0a20 2020 2020  tion.xpos,.     
-0000ec40: 2020 2020 2020 2079 706f 733d 7772 6974         ypos=writ
-0000ec50: 655f 706f 7369 7469 6f6e 2e79 706f 732c  e_position.ypos,
-0000ec60: 0a20 2020 2020 2020 2020 2020 2077 6964  .            wid
-0000ec70: 7468 3d77 7269 7465 5f70 6f73 6974 696f  th=write_positio
-0000ec80: 6e2e 7769 6474 682c 0a20 2020 2020 2020  n.width,.       
-0000ec90: 2020 2020 2068 6569 6768 743d 7772 6974       height=writ
-0000eca0: 655f 706f 7369 7469 6f6e 2e68 6569 6768  e_position.heigh
-0000ecb0: 742c 0a20 2020 2020 2020 2029 0a0a 2020  t,.        )..  
-0000ecc0: 2020 2020 2020 6966 2073 656c 662e 646f        if self.do
-0000ecd0: 6e74 5f65 7874 656e 645f 7769 6474 6828  nt_extend_width(
-0000ece0: 293a 0a20 2020 2020 2020 2020 2020 2077  ):.            w
-0000ecf0: 7269 7465 5f70 6f73 6974 696f 6e2e 7769  rite_position.wi
-0000ed00: 6474 6820 3d20 6d69 6e28 0a20 2020 2020  dth = min(.     
-0000ed10: 2020 2020 2020 2020 2020 2077 7269 7465             write
-0000ed20: 5f70 6f73 6974 696f 6e2e 7769 6474 682c  _position.width,
-0000ed30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ed40: 2073 656c 662e 7072 6566 6572 7265 645f   self.preferred_
-0000ed50: 7769 6474 6828 7772 6974 655f 706f 7369  width(write_posi
-0000ed60: 7469 6f6e 2e77 6964 7468 292e 7072 6566  tion.width).pref
-0000ed70: 6572 7265 642c 0a20 2020 2020 2020 2020  erred,.         
-0000ed80: 2020 2029 0a0a 2020 2020 2020 2020 6966     )..        if
-0000ed90: 2073 656c 662e 646f 6e74 5f65 7874 656e   self.dont_exten
-0000eda0: 645f 6865 6967 6874 2829 3a0a 2020 2020  d_height():.    
-0000edb0: 2020 2020 2020 2020 7772 6974 655f 706f          write_po
-0000edc0: 7369 7469 6f6e 2e68 6569 6768 7420 3d20  sition.height = 
-0000edd0: 6d69 6e28 0a20 2020 2020 2020 2020 2020  min(.           
-0000ede0: 2020 2020 2077 7269 7465 5f70 6f73 6974       write_posit
-0000edf0: 696f 6e2e 6865 6967 6874 2c0a 2020 2020  ion.height,.    
-0000ee00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000ee10: 2e70 7265 6665 7272 6564 5f68 6569 6768  .preferred_heigh
-0000ee20: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-0000ee30: 2020 2020 2020 2077 7269 7465 5f70 6f73         write_pos
-0000ee40: 6974 696f 6e2e 7769 6474 682c 2077 7269  ition.width, wri
-0000ee50: 7465 5f70 6f73 6974 696f 6e2e 6865 6967  te_position.heig
-0000ee60: 6874 0a20 2020 2020 2020 2020 2020 2020  ht.             
-0000ee70: 2020 2029 2e70 7265 6665 7272 6564 2c0a     ).preferred,.
-0000ee80: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-0000ee90: 2020 2020 2020 2023 2044 7261 770a 2020         # Draw.  
-0000eea0: 2020 2020 2020 7a5f 696e 6465 7820 3d20        z_index = 
-0000eeb0: 7a5f 696e 6465 7820 6966 2073 656c 662e  z_index if self.
-0000eec0: 7a5f 696e 6465 7820 6973 204e 6f6e 6520  z_index is None 
-0000eed0: 656c 7365 2073 656c 662e 7a5f 696e 6465  else self.z_inde
-0000eee0: 780a 0a20 2020 2020 2020 2064 7261 775f  x..        draw_
-0000eef0: 6675 6e63 203d 2070 6172 7469 616c 280a  func = partial(.
-0000ef00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000ef10: 2e5f 7772 6974 655f 746f 5f73 6372 6565  ._write_to_scree
-0000ef20: 6e5f 6174 5f69 6e64 6578 2c0a 2020 2020  n_at_index,.    
-0000ef30: 2020 2020 2020 2020 7363 7265 656e 2c0a          screen,.
-0000ef40: 2020 2020 2020 2020 2020 2020 6d6f 7573              mous
-0000ef50: 655f 6861 6e64 6c65 7273 2c0a 2020 2020  e_handlers,.    
-0000ef60: 2020 2020 2020 2020 7772 6974 655f 706f          write_po
-0000ef70: 7369 7469 6f6e 2c0a 2020 2020 2020 2020  sition,.        
-0000ef80: 2020 2020 7061 7265 6e74 5f73 7479 6c65      parent_style
-0000ef90: 2c0a 2020 2020 2020 2020 2020 2020 6572  ,.            er
-0000efa0: 6173 655f 6267 2c0a 2020 2020 2020 2020  ase_bg,.        
-0000efb0: 290a 0a20 2020 2020 2020 2069 6620 7a5f  )..        if z_
-0000efc0: 696e 6465 7820 6973 204e 6f6e 6520 6f72  index is None or
-0000efd0: 207a 5f69 6e64 6578 203c 3d20 303a 0a20   z_index <= 0:. 
-0000efe0: 2020 2020 2020 2020 2020 2023 2057 6865             # Whe
-0000eff0: 6e20 6e6f 207a 5f69 6e64 6578 2069 7320  n no z_index is 
-0000f000: 6769 7665 6e2c 2064 7261 7720 7269 6768  given, draw righ
-0000f010: 7420 6177 6179 2e0a 2020 2020 2020 2020  t away..        
-0000f020: 2020 2020 6472 6177 5f66 756e 6328 290a      draw_func().
-0000f030: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000f040: 2020 2020 2020 2020 2020 2320 4f74 6865            # Othe
-0000f050: 7277 6973 652c 2070 6f73 7470 6f6e 652e  rwise, postpone.
-0000f060: 0a20 2020 2020 2020 2020 2020 2073 6372  .            scr
-0000f070: 6565 6e2e 6472 6177 5f77 6974 685f 7a5f  een.draw_with_z_
-0000f080: 696e 6465 7828 7a5f 696e 6465 783d 7a5f  index(z_index=z_
-0000f090: 696e 6465 782c 2064 7261 775f 6675 6e63  index, draw_func
-0000f0a0: 3d64 7261 775f 6675 6e63 290a 0a20 2020  =draw_func)..   
-0000f0b0: 2064 6566 205f 7772 6974 655f 746f 5f73   def _write_to_s
-0000f0c0: 6372 6565 6e5f 6174 5f69 6e64 6578 280a  creen_at_index(.
-0000f0d0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0000f0e0: 2020 2020 2020 7363 7265 656e 3a20 5363        screen: Sc
-0000f0f0: 7265 656e 2c0a 2020 2020 2020 2020 6d6f  reen,.        mo
-0000f100: 7573 655f 6861 6e64 6c65 7273 3a20 4d6f  use_handlers: Mo
-0000f110: 7573 6548 616e 646c 6572 732c 0a20 2020  useHandlers,.   
-0000f120: 2020 2020 2077 7269 7465 5f70 6f73 6974       write_posit
-0000f130: 696f 6e3a 2057 7269 7465 506f 7369 7469  ion: WritePositi
-0000f140: 6f6e 2c0a 2020 2020 2020 2020 7061 7265  on,.        pare
-0000f150: 6e74 5f73 7479 6c65 3a20 7374 722c 0a20  nt_style: str,. 
-0000f160: 2020 2020 2020 2065 7261 7365 5f62 673a         erase_bg:
-0000f170: 2062 6f6f 6c2c 0a20 2020 2029 202d 3e20   bool,.    ) -> 
-0000f180: 4e6f 6e65 3a0a 2020 2020 2020 2020 2320  None:.        # 
-0000f190: 446f 6e27 7420 626f 7468 6572 2077 7269  Don't bother wri
-0000f1a0: 7469 6e67 2069 6e76 6973 6962 6c65 2077  ting invisible w
-0000f1b0: 696e 646f 7773 2e0a 2020 2020 2020 2020  indows..        
-0000f1c0: 2320 2857 6520 7361 7665 2073 6f6d 6520  # (We save some 
-0000f1d0: 7469 6d65 2c20 6275 7420 616c 736f 2061  time, but also a
-0000f1e0: 766f 6964 2061 7070 6c79 696e 6720 6c61  void applying la
-0000f1f0: 7374 2d6c 696e 6520 7374 796c 696e 672e  st-line styling.
-0000f200: 290a 2020 2020 2020 2020 6966 2077 7269  ).        if wri
-0000f210: 7465 5f70 6f73 6974 696f 6e2e 6865 6967  te_position.heig
-0000f220: 6874 203c 3d20 3020 6f72 2077 7269 7465  ht <= 0 or write
-0000f230: 5f70 6f73 6974 696f 6e2e 7769 6474 6820  _position.width 
-0000f240: 3c3d 2030 3a0a 2020 2020 2020 2020 2020  <= 0:.          
-0000f250: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
-0000f260: 2020 2320 4361 6c63 756c 6174 6520 6d61    # Calculate ma
-0000f270: 7267 696e 2073 697a 6573 2e0a 2020 2020  rgin sizes..    
-0000f280: 2020 2020 6c65 6674 5f6d 6172 6769 6e5f      left_margin_
-0000f290: 7769 6474 6873 203d 205b 7365 6c66 2e5f  widths = [self._
-0000f2a0: 6765 745f 6d61 7267 696e 5f77 6964 7468  get_margin_width
-0000f2b0: 286d 2920 666f 7220 6d20 696e 2073 656c  (m) for m in sel
-0000f2c0: 662e 6c65 6674 5f6d 6172 6769 6e73 5d0a  f.left_margins].
-0000f2d0: 2020 2020 2020 2020 7269 6768 745f 6d61          right_ma
-0000f2e0: 7267 696e 5f77 6964 7468 7320 3d20 5b73  rgin_widths = [s
-0000f2f0: 656c 662e 5f67 6574 5f6d 6172 6769 6e5f  elf._get_margin_
-0000f300: 7769 6474 6828 6d29 2066 6f72 206d 2069  width(m) for m i
-0000f310: 6e20 7365 6c66 2e72 6967 6874 5f6d 6172  n self.right_mar
-0000f320: 6769 6e73 5d0a 2020 2020 2020 2020 746f  gins].        to
-0000f330: 7461 6c5f 6d61 7267 696e 5f77 6964 7468  tal_margin_width
-0000f340: 203d 2073 756d 286c 6566 745f 6d61 7267   = sum(left_marg
-0000f350: 696e 5f77 6964 7468 7320 2b20 7269 6768  in_widths + righ
-0000f360: 745f 6d61 7267 696e 5f77 6964 7468 7329  t_margin_widths)
-0000f370: 0a0a 2020 2020 2020 2020 2320 5265 6e64  ..        # Rend
-0000f380: 6572 2055 7365 7243 6f6e 7472 6f6c 2e0a  er UserControl..
-0000f390: 2020 2020 2020 2020 7569 5f63 6f6e 7465          ui_conte
-0000f3a0: 6e74 203d 2073 656c 662e 636f 6e74 656e  nt = self.conten
-0000f3b0: 742e 6372 6561 7465 5f63 6f6e 7465 6e74  t.create_content
-0000f3c0: 280a 2020 2020 2020 2020 2020 2020 7772  (.            wr
-0000f3d0: 6974 655f 706f 7369 7469 6f6e 2e77 6964  ite_position.wid
-0000f3e0: 7468 202d 2074 6f74 616c 5f6d 6172 6769  th - total_margi
-0000f3f0: 6e5f 7769 6474 682c 2077 7269 7465 5f70  n_width, write_p
-0000f400: 6f73 6974 696f 6e2e 6865 6967 6874 0a20  osition.height. 
-0000f410: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000f420: 2061 7373 6572 7420 6973 696e 7374 616e   assert isinstan
-0000f430: 6365 2875 695f 636f 6e74 656e 742c 2055  ce(ui_content, U
-0000f440: 4943 6f6e 7465 6e74 290a 0a20 2020 2020  IContent)..     
-0000f450: 2020 2023 2053 6372 6f6c 6c20 636f 6e74     # Scroll cont
-0000f460: 656e 742e 0a20 2020 2020 2020 2077 7261  ent..        wra
-0000f470: 705f 6c69 6e65 7320 3d20 7365 6c66 2e77  p_lines = self.w
-0000f480: 7261 705f 6c69 6e65 7328 290a 2020 2020  rap_lines().    
-0000f490: 2020 2020 7365 6c66 2e5f 7363 726f 6c6c      self._scroll
-0000f4a0: 280a 2020 2020 2020 2020 2020 2020 7569  (.            ui
-0000f4b0: 5f63 6f6e 7465 6e74 2c20 7772 6974 655f  _content, write_
-0000f4c0: 706f 7369 7469 6f6e 2e77 6964 7468 202d  position.width -
-0000f4d0: 2074 6f74 616c 5f6d 6172 6769 6e5f 7769   total_margin_wi
-0000f4e0: 6474 682c 2077 7269 7465 5f70 6f73 6974  dth, write_posit
-0000f4f0: 696f 6e2e 6865 6967 6874 0a20 2020 2020  ion.height.     
-0000f500: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-0000f510: 4572 6173 6520 6261 636b 6772 6f75 6e64  Erase background
-0000f520: 2061 6e64 2066 696c 6c20 7769 7468 2060   and fill with `
-0000f530: 6368 6172 602e 0a20 2020 2020 2020 2073  char`..        s
-0000f540: 656c 662e 5f66 696c 6c5f 6267 2873 6372  elf._fill_bg(scr
-0000f550: 6565 6e2c 2077 7269 7465 5f70 6f73 6974  een, write_posit
-0000f560: 696f 6e2c 2065 7261 7365 5f62 6729 0a0a  ion, erase_bg)..
-0000f570: 2020 2020 2020 2020 2320 5265 736f 6c76          # Resolv
-0000f580: 6520 6061 6c69 676e 6020 6174 7472 6962  e `align` attrib
-0000f590: 7574 652e 0a20 2020 2020 2020 2061 6c69  ute..        ali
-0000f5a0: 676e 203d 2073 656c 662e 616c 6967 6e28  gn = self.align(
-0000f5b0: 2920 6966 2063 616c 6c61 626c 6528 7365  ) if callable(se
-0000f5c0: 6c66 2e61 6c69 676e 2920 656c 7365 2073  lf.align) else s
-0000f5d0: 656c 662e 616c 6967 6e0a 0a20 2020 2020  elf.align..     
-0000f5e0: 2020 2023 2057 7269 7465 2062 6f64 790a     # Write body.
-0000f5f0: 2020 2020 2020 2020 7669 7369 626c 655f          visible_
-0000f600: 6c69 6e65 5f74 6f5f 726f 775f 636f 6c2c  line_to_row_col,
-0000f610: 2072 6f77 636f 6c5f 746f 5f79 7820 3d20   rowcol_to_yx = 
-0000f620: 7365 6c66 2e5f 636f 7079 5f62 6f64 7928  self._copy_body(
-0000f630: 0a20 2020 2020 2020 2020 2020 2075 695f  .            ui_
-0000f640: 636f 6e74 656e 742c 0a20 2020 2020 2020  content,.       
-0000f650: 2020 2020 2073 6372 6565 6e2c 0a20 2020       screen,.   
-0000f660: 2020 2020 2020 2020 2077 7269 7465 5f70           write_p
-0000f670: 6f73 6974 696f 6e2c 0a20 2020 2020 2020  osition,.       
-0000f680: 2020 2020 2073 756d 286c 6566 745f 6d61       sum(left_ma
-0000f690: 7267 696e 5f77 6964 7468 7329 2c0a 2020  rgin_widths),.  
-0000f6a0: 2020 2020 2020 2020 2020 7772 6974 655f            write_
-0000f6b0: 706f 7369 7469 6f6e 2e77 6964 7468 202d  position.width -
-0000f6c0: 2074 6f74 616c 5f6d 6172 6769 6e5f 7769   total_margin_wi
-0000f6d0: 6474 682c 0a20 2020 2020 2020 2020 2020  dth,.           
-0000f6e0: 2073 656c 662e 7665 7274 6963 616c 5f73   self.vertical_s
-0000f6f0: 6372 6f6c 6c2c 0a20 2020 2020 2020 2020  croll,.         
-0000f700: 2020 2073 656c 662e 686f 7269 7a6f 6e74     self.horizont
-0000f710: 616c 5f73 6372 6f6c 6c2c 0a20 2020 2020  al_scroll,.     
-0000f720: 2020 2020 2020 2077 7261 705f 6c69 6e65         wrap_line
-0000f730: 733d 7772 6170 5f6c 696e 6573 2c0a 2020  s=wrap_lines,.  
-0000f740: 2020 2020 2020 2020 2020 6869 6768 6c69            highli
-0000f750: 6768 745f 6c69 6e65 733d 5472 7565 2c0a  ght_lines=True,.
-0000f760: 2020 2020 2020 2020 2020 2020 7665 7274              vert
-0000f770: 6963 616c 5f73 6372 6f6c 6c5f 323d 7365  ical_scroll_2=se
-0000f780: 6c66 2e76 6572 7469 6361 6c5f 7363 726f  lf.vertical_scro
-0000f790: 6c6c 5f32 2c0a 2020 2020 2020 2020 2020  ll_2,.          
-0000f7a0: 2020 616c 7761 7973 5f68 6964 655f 6375    always_hide_cu
-0000f7b0: 7273 6f72 3d73 656c 662e 616c 7761 7973  rsor=self.always
-0000f7c0: 5f68 6964 655f 6375 7273 6f72 2829 2c0a  _hide_cursor(),.
-0000f7d0: 2020 2020 2020 2020 2020 2020 6861 735f              has_
-0000f7e0: 666f 6375 733d 6765 745f 6170 7028 292e  focus=get_app().
-0000f7f0: 6c61 796f 7574 2e63 7572 7265 6e74 5f63  layout.current_c
-0000f800: 6f6e 7472 6f6c 203d 3d20 7365 6c66 2e63  ontrol == self.c
-0000f810: 6f6e 7465 6e74 2c0a 2020 2020 2020 2020  ontent,.        
-0000f820: 2020 2020 616c 6967 6e3d 616c 6967 6e2c      align=align,
-0000f830: 0a20 2020 2020 2020 2020 2020 2067 6574  .            get
-0000f840: 5f6c 696e 655f 7072 6566 6978 3d73 656c  _line_prefix=sel
-0000f850: 662e 6765 745f 6c69 6e65 5f70 7265 6669  f.get_line_prefi
-0000f860: 782c 0a20 2020 2020 2020 2029 0a0a 2020  x,.        )..  
-0000f870: 2020 2020 2020 2320 5265 6d65 6d62 6572        # Remember
-0000f880: 2072 656e 6465 7220 696e 666f 2e20 2853   render info. (S
-0000f890: 6574 2062 6566 6f72 6520 6765 6e65 7261  et before genera
-0000f8a0: 7469 6e67 2074 6865 206d 6172 6769 6e73  ting the margins
-0000f8b0: 2e20 5468 6579 206e 6565 6420 7468 6973  . They need this
-0000f8c0: 2e29 0a20 2020 2020 2020 2078 5f6f 6666  .).        x_off
-0000f8d0: 7365 7420 3d20 7772 6974 655f 706f 7369  set = write_posi
-0000f8e0: 7469 6f6e 2e78 706f 7320 2b20 7375 6d28  tion.xpos + sum(
-0000f8f0: 6c65 6674 5f6d 6172 6769 6e5f 7769 6474  left_margin_widt
-0000f900: 6873 290a 2020 2020 2020 2020 795f 6f66  hs).        y_of
-0000f910: 6673 6574 203d 2077 7269 7465 5f70 6f73  fset = write_pos
-0000f920: 6974 696f 6e2e 7970 6f73 0a0a 2020 2020  ition.ypos..    
-0000f930: 2020 2020 7265 6e64 6572 5f69 6e66 6f20      render_info 
-0000f940: 3d20 5769 6e64 6f77 5265 6e64 6572 496e  = WindowRenderIn
-0000f950: 666f 280a 2020 2020 2020 2020 2020 2020  fo(.            
-0000f960: 7769 6e64 6f77 3d73 656c 662c 0a20 2020  window=self,.   
-0000f970: 2020 2020 2020 2020 2075 695f 636f 6e74           ui_cont
-0000f980: 656e 743d 7569 5f63 6f6e 7465 6e74 2c0a  ent=ui_content,.
-0000f990: 2020 2020 2020 2020 2020 2020 686f 7269              hori
-0000f9a0: 7a6f 6e74 616c 5f73 6372 6f6c 6c3d 7365  zontal_scroll=se
-0000f9b0: 6c66 2e68 6f72 697a 6f6e 7461 6c5f 7363  lf.horizontal_sc
-0000f9c0: 726f 6c6c 2c0a 2020 2020 2020 2020 2020  roll,.          
-0000f9d0: 2020 7665 7274 6963 616c 5f73 6372 6f6c    vertical_scrol
-0000f9e0: 6c3d 7365 6c66 2e76 6572 7469 6361 6c5f  l=self.vertical_
-0000f9f0: 7363 726f 6c6c 2c0a 2020 2020 2020 2020  scroll,.        
-0000fa00: 2020 2020 7769 6e64 6f77 5f77 6964 7468      window_width
-0000fa10: 3d77 7269 7465 5f70 6f73 6974 696f 6e2e  =write_position.
-0000fa20: 7769 6474 6820 2d20 746f 7461 6c5f 6d61  width - total_ma
-0000fa30: 7267 696e 5f77 6964 7468 2c0a 2020 2020  rgin_width,.    
-0000fa40: 2020 2020 2020 2020 7769 6e64 6f77 5f68          window_h
-0000fa50: 6569 6768 743d 7772 6974 655f 706f 7369  eight=write_posi
-0000fa60: 7469 6f6e 2e68 6569 6768 742c 0a20 2020  tion.height,.   
-0000fa70: 2020 2020 2020 2020 2063 6f6e 6669 6775           configu
-0000fa80: 7265 645f 7363 726f 6c6c 5f6f 6666 7365  red_scroll_offse
-0000fa90: 7473 3d73 656c 662e 7363 726f 6c6c 5f6f  ts=self.scroll_o
-0000faa0: 6666 7365 7473 2c0a 2020 2020 2020 2020  ffsets,.        
-0000fab0: 2020 2020 7669 7369 626c 655f 6c69 6e65      visible_line
-0000fac0: 5f74 6f5f 726f 775f 636f 6c3d 7669 7369  _to_row_col=visi
-0000fad0: 626c 655f 6c69 6e65 5f74 6f5f 726f 775f  ble_line_to_row_
-0000fae0: 636f 6c2c 0a20 2020 2020 2020 2020 2020  col,.           
-0000faf0: 2072 6f77 636f 6c5f 746f 5f79 783d 726f   rowcol_to_yx=ro
-0000fb00: 7763 6f6c 5f74 6f5f 7978 2c0a 2020 2020  wcol_to_yx,.    
-0000fb10: 2020 2020 2020 2020 785f 6f66 6673 6574          x_offset
-0000fb20: 3d78 5f6f 6666 7365 742c 0a20 2020 2020  =x_offset,.     
-0000fb30: 2020 2020 2020 2079 5f6f 6666 7365 743d         y_offset=
-0000fb40: 795f 6f66 6673 6574 2c0a 2020 2020 2020  y_offset,.      
-0000fb50: 2020 2020 2020 7772 6170 5f6c 696e 6573        wrap_lines
-0000fb60: 3d77 7261 705f 6c69 6e65 732c 0a20 2020  =wrap_lines,.   
-0000fb70: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
-0000fb80: 656c 662e 7265 6e64 6572 5f69 6e66 6f20  elf.render_info 
-0000fb90: 3d20 7265 6e64 6572 5f69 6e66 6f0a 0a20  = render_info.. 
-0000fba0: 2020 2020 2020 2023 2053 6574 206d 6f75         # Set mou
-0000fbb0: 7365 2068 616e 646c 6572 732e 0a20 2020  se handlers..   
-0000fbc0: 2020 2020 2064 6566 206d 6f75 7365 5f68       def mouse_h
-0000fbd0: 616e 646c 6572 286d 6f75 7365 5f65 7665  andler(mouse_eve
-0000fbe0: 6e74 3a20 4d6f 7573 6545 7665 6e74 2920  nt: MouseEvent) 
-0000fbf0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000fc00: 2020 2020 2022 2222 5772 6170 7065 7220       """Wrapper 
-0000fc10: 6172 6f75 6e64 2074 6865 206d 6f75 7365  around the mouse
-0000fc20: 5f68 616e 646c 6572 206f 6620 7468 6520  _handler of the 
-0000fc30: 6055 4943 6f6e 7472 6f6c 6020 7468 6174  `UIControl` that
-0000fc40: 2074 7572 6e73 0a20 2020 2020 2020 2020   turns.         
-0000fc50: 2020 2073 6372 6565 6e20 636f 6f72 6469     screen coordi
-0000fc60: 6e61 7465 7320 696e 746f 206c 696e 6520  nates into line 
-0000fc70: 636f 6f72 6469 6e61 7465 732e 2222 220a  coordinates.""".
-0000fc80: 2020 2020 2020 2020 2020 2020 2320 446f              # Do
-0000fc90: 6e27 7420 6861 6e64 6c65 206d 6f75 7365  n't handle mouse
-0000fca0: 2065 7665 6e74 7320 6f75 7473 6964 6520   events outside 
-0000fcb0: 6f66 2074 6865 2063 7572 7265 6e74 206d  of the current m
-0000fcc0: 6f64 616c 2070 6172 7420 6f66 0a20 2020  odal part of.   
-0000fcd0: 2020 2020 2020 2020 2023 2074 6865 2055           # the U
-0000fce0: 492e 0a20 2020 2020 2020 2020 2020 2069  I..            i
-0000fcf0: 6620 7365 6c66 206e 6f74 2069 6e20 6765  f self not in ge
-0000fd00: 745f 6170 7028 292e 6c61 796f 7574 2e77  t_app().layout.w
-0000fd10: 616c 6b5f 7468 726f 7567 685f 6d6f 6461  alk_through_moda
-0000fd20: 6c5f 6172 6561 2829 3a0a 2020 2020 2020  l_area():.      
-0000fd30: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000fd40: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0000fd50: 4669 6e64 2072 6f77 2f63 6f6c 2070 6f73  Find row/col pos
-0000fd60: 6974 696f 6e20 6669 7273 742e 0a20 2020  ition first..   
-0000fd70: 2020 2020 2020 2020 2079 785f 746f 5f72           yx_to_r
-0000fd80: 6f77 636f 6c20 3d20 7b76 3a20 6b20 666f  owcol = {v: k fo
-0000fd90: 7220 6b2c 2076 2069 6e20 726f 7763 6f6c  r k, v in rowcol
-0000fda0: 5f74 6f5f 7978 2e69 7465 6d73 2829 7d0a  _to_yx.items()}.
-0000fdb0: 2020 2020 2020 2020 2020 2020 7920 3d20              y = 
-0000fdc0: 6d6f 7573 655f 6576 656e 742e 706f 7369  mouse_event.posi
-0000fdd0: 7469 6f6e 2e79 0a20 2020 2020 2020 2020  tion.y.         
-0000fde0: 2020 2078 203d 206d 6f75 7365 5f65 7665     x = mouse_eve
-0000fdf0: 6e74 2e70 6f73 6974 696f 6e2e 780a 0a20  nt.position.x.. 
-0000fe00: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-0000fe10: 636c 6963 6b65 6420 6265 6c6f 7720 7468  clicked below th
-0000fe20: 6520 636f 6e74 656e 7420 6172 6561 2c20  e content area, 
-0000fe30: 6c6f 6f6b 2066 6f72 2061 2070 6f73 6974  look for a posit
-0000fe40: 696f 6e20 696e 2074 6865 0a20 2020 2020  ion in the.     
-0000fe50: 2020 2020 2020 2023 206c 6173 7420 6c69         # last li
-0000fe60: 6e65 2069 6e73 7465 6164 2e0a 2020 2020  ne instead..    
-0000fe70: 2020 2020 2020 2020 6d61 785f 7920 3d20          max_y = 
-0000fe80: 7772 6974 655f 706f 7369 7469 6f6e 2e79  write_position.y
-0000fe90: 706f 7320 2b20 6c65 6e28 7669 7369 626c  pos + len(visibl
-0000fea0: 655f 6c69 6e65 5f74 6f5f 726f 775f 636f  e_line_to_row_co
-0000feb0: 6c29 202d 2031 0a20 2020 2020 2020 2020  l) - 1.         
-0000fec0: 2020 2079 203d 206d 696e 286d 6178 5f79     y = min(max_y
-0000fed0: 2c20 7929 0a20 2020 2020 2020 2020 2020  , y).           
-0000fee0: 2072 6573 756c 743a 204e 6f74 496d 706c   result: NotImpl
-0000fef0: 656d 656e 7465 644f 724e 6f6e 650a 0a20  ementedOrNone.. 
-0000ff00: 2020 2020 2020 2020 2020 2077 6869 6c65             while
-0000ff10: 2078 203e 3d20 303a 0a20 2020 2020 2020   x >= 0:.       
-0000ff20: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-0000ff30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff40: 2020 726f 772c 2063 6f6c 203d 2079 785f    row, col = yx_
-0000ff50: 746f 5f72 6f77 636f 6c5b 792c 2078 5d0a  to_rowcol[y, x].
+00006cc0: 666c 2c0a 2020 2020 2020 2020 2020 2020  fl,.            
+00006cd0: 2020 2020 2020 2020 7363 7265 656e 2c0a          screen,.
+00006ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006cf0: 2020 2020 6d6f 7573 655f 6861 6e64 6c65      mouse_handle
+00006d00: 7273 2c0a 2020 2020 2020 2020 2020 2020  rs,.            
+00006d10: 2020 2020 2020 2020 7772 6974 655f 706f          write_po
+00006d20: 7369 7469 6f6e 2c0a 2020 2020 2020 2020  sition,.        
+00006d30: 2020 2020 2020 2020 2020 2020 7374 796c              styl
+00006d40: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00006d50: 2020 2020 2020 2065 7261 7365 5f62 672c         erase_bg,
+00006d60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006d70: 2020 2020 206e 6577 5f7a 5f69 6e64 6578       new_z_index
+00006d80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006d90: 2020 290a 0a20 2020 2064 6566 205f 6472    )..    def _dr
+00006da0: 6177 5f66 6c6f 6174 280a 2020 2020 2020  aw_float(.      
+00006db0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00006dc0: 666c 3a20 2246 6c6f 6174 222c 0a20 2020  fl: "Float",.   
+00006dd0: 2020 2020 2073 6372 6565 6e3a 2053 6372       screen: Scr
+00006de0: 6565 6e2c 0a20 2020 2020 2020 206d 6f75  een,.        mou
+00006df0: 7365 5f68 616e 646c 6572 733a 204d 6f75  se_handlers: Mou
+00006e00: 7365 4861 6e64 6c65 7273 2c0a 2020 2020  seHandlers,.    
+00006e10: 2020 2020 7772 6974 655f 706f 7369 7469      write_positi
+00006e20: 6f6e 3a20 5772 6974 6550 6f73 6974 696f  on: WritePositio
+00006e30: 6e2c 0a20 2020 2020 2020 2073 7479 6c65  n,.        style
+00006e40: 3a20 7374 722c 0a20 2020 2020 2020 2065  : str,.        e
+00006e50: 7261 7365 5f62 673a 2062 6f6f 6c2c 0a20  rase_bg: bool,. 
+00006e60: 2020 2020 2020 207a 5f69 6e64 6578 3a20         z_index: 
+00006e70: 4f70 7469 6f6e 616c 5b69 6e74 5d2c 0a20  Optional[int],. 
+00006e80: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
+00006e90: 2020 2020 2020 2244 7261 7720 6120 7369        "Draw a si
+00006ea0: 6e67 6c65 2046 6c6f 6174 2e22 0a20 2020  ngle Float.".   
+00006eb0: 2020 2020 2023 2057 6865 6e20 6120 6d65       # When a me
+00006ec0: 6e75 5f70 6f73 6974 696f 6e20 7761 7320  nu_position was 
+00006ed0: 6769 7665 6e2c 2075 7365 2074 6869 7320  given, use this 
+00006ee0: 696e 7374 6561 6420 6f66 2074 6865 2063  instead of the c
+00006ef0: 7572 736f 720a 2020 2020 2020 2020 2320  ursor.        # 
+00006f00: 706f 7369 7469 6f6e 2e20 2854 6865 7365  position. (These
+00006f10: 2063 7572 736f 7220 706f 7369 7469 6f6e   cursor position
+00006f20: 7320 6172 6520 6162 736f 6c75 7465 2c20  s are absolute, 
+00006f30: 7472 616e 736c 6174 6520 6167 6169 6e0a  translate again.
+00006f40: 2020 2020 2020 2020 2320 7265 6c61 7469          # relati
+00006f50: 7665 2074 6f20 7468 6520 7772 6974 655f  ve to the write_
+00006f60: 706f 7369 7469 6f6e 2e29 0a20 2020 2020  position.).     
+00006f70: 2020 2023 204e 6f74 653a 2054 6869 7320     # Note: This 
+00006f80: 7368 6f75 6c64 2062 6520 696e 7369 6465  should be inside
+00006f90: 2074 6865 2066 6f72 2d6c 6f6f 702c 2062   the for-loop, b
+00006fa0: 6563 6175 7365 206f 6e65 2066 6c6f 6174  ecause one float
+00006fb0: 2063 6f75 6c64 0a20 2020 2020 2020 2023   could.        #
+00006fc0: 2020 2020 2020 2073 6574 2074 6865 2063         set the c
+00006fd0: 7572 736f 7220 706f 7369 7469 6f6e 2074  ursor position t
+00006fe0: 6f20 6265 2075 7365 6420 666f 7220 7468  o be used for th
+00006ff0: 6520 6e65 7874 206f 6e65 2e0a 2020 2020  e next one..    
+00007000: 2020 2020 6370 6f73 203d 2073 6372 6565      cpos = scree
+00007010: 6e2e 6765 745f 6d65 6e75 5f70 6f73 6974  n.get_menu_posit
+00007020: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+00007030: 2066 6c2e 6174 7461 6368 5f74 6f5f 7769   fl.attach_to_wi
+00007040: 6e64 6f77 206f 7220 6765 745f 6170 7028  ndow or get_app(
+00007050: 292e 6c61 796f 7574 2e63 7572 7265 6e74  ).layout.current
+00007060: 5f77 696e 646f 770a 2020 2020 2020 2020  _window.        
+00007070: 290a 2020 2020 2020 2020 6375 7273 6f72  ).        cursor
+00007080: 5f70 6f73 6974 696f 6e20 3d20 506f 696e  _position = Poin
+00007090: 7428 0a20 2020 2020 2020 2020 2020 2078  t(.            x
+000070a0: 3d63 706f 732e 7820 2d20 7772 6974 655f  =cpos.x - write_
+000070b0: 706f 7369 7469 6f6e 2e78 706f 732c 2079  position.xpos, y
+000070c0: 3d63 706f 732e 7920 2d20 7772 6974 655f  =cpos.y - write_
+000070d0: 706f 7369 7469 6f6e 2e79 706f 730a 2020  position.ypos.  
+000070e0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+000070f0: 2066 6c5f 7769 6474 6820 3d20 666c 2e67   fl_width = fl.g
+00007100: 6574 5f77 6964 7468 2829 0a20 2020 2020  et_width().     
+00007110: 2020 2066 6c5f 6865 6967 6874 203d 2066     fl_height = f
+00007120: 6c2e 6765 745f 6865 6967 6874 2829 0a20  l.get_height(). 
+00007130: 2020 2020 2020 2077 6964 7468 3a20 696e         width: in
+00007140: 740a 2020 2020 2020 2020 6865 6967 6874  t.        height
+00007150: 3a20 696e 740a 2020 2020 2020 2020 7870  : int.        xp
+00007160: 6f73 3a20 696e 740a 2020 2020 2020 2020  os: int.        
+00007170: 7970 6f73 3a20 696e 740a 0a20 2020 2020  ypos: int..     
+00007180: 2020 2023 204c 6566 7420 2620 7769 6474     # Left & widt
+00007190: 6820 6769 7665 6e2e 0a20 2020 2020 2020  h given..       
+000071a0: 2069 6620 666c 2e6c 6566 7420 6973 206e   if fl.left is n
+000071b0: 6f74 204e 6f6e 6520 616e 6420 666c 5f77  ot None and fl_w
+000071c0: 6964 7468 2069 7320 6e6f 7420 4e6f 6e65  idth is not None
+000071d0: 3a0a 2020 2020 2020 2020 2020 2020 7870  :.            xp
+000071e0: 6f73 203d 2066 6c2e 6c65 6674 0a20 2020  os = fl.left.   
+000071f0: 2020 2020 2020 2020 2077 6964 7468 203d           width =
+00007200: 2066 6c5f 7769 6474 680a 2020 2020 2020   fl_width.      
+00007210: 2020 2320 4c65 6674 2026 2072 6967 6874    # Left & right
+00007220: 2067 6976 656e 202d 3e20 6361 6c63 756c   given -> calcul
+00007230: 6174 6520 7769 6474 682e 0a20 2020 2020  ate width..     
+00007240: 2020 2065 6c69 6620 666c 2e6c 6566 7420     elif fl.left 
+00007250: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00007260: 666c 2e72 6967 6874 2069 7320 6e6f 7420  fl.right is not 
+00007270: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00007280: 2020 7870 6f73 203d 2066 6c2e 6c65 6674    xpos = fl.left
+00007290: 0a20 2020 2020 2020 2020 2020 2077 6964  .            wid
+000072a0: 7468 203d 2077 7269 7465 5f70 6f73 6974  th = write_posit
+000072b0: 696f 6e2e 7769 6474 6820 2d20 666c 2e6c  ion.width - fl.l
+000072c0: 6566 7420 2d20 666c 2e72 6967 6874 0a20  eft - fl.right. 
+000072d0: 2020 2020 2020 2023 2057 6964 7468 2026         # Width &
+000072e0: 2072 6967 6874 2067 6976 656e 202d 3e20   right given -> 
+000072f0: 6361 6c63 756c 6174 6520 6c65 6674 2e0a  calculate left..
+00007300: 2020 2020 2020 2020 656c 6966 2066 6c5f          elif fl_
+00007310: 7769 6474 6820 6973 206e 6f74 204e 6f6e  width is not Non
+00007320: 6520 616e 6420 666c 2e72 6967 6874 2069  e and fl.right i
+00007330: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00007340: 2020 2020 2020 2020 7870 6f73 203d 2077          xpos = w
+00007350: 7269 7465 5f70 6f73 6974 696f 6e2e 7769  rite_position.wi
+00007360: 6474 6820 2d20 666c 2e72 6967 6874 202d  dth - fl.right -
+00007370: 2066 6c5f 7769 6474 680a 2020 2020 2020   fl_width.      
+00007380: 2020 2020 2020 7769 6474 6820 3d20 666c        width = fl
+00007390: 5f77 6964 7468 0a20 2020 2020 2020 2023  _width.        #
+000073a0: 204e 6561 7220 7820 706f 7369 7469 6f6e   Near x position
+000073b0: 206f 6620 6375 7273 6f72 2e0a 2020 2020   of cursor..    
+000073c0: 2020 2020 656c 6966 2066 6c2e 7863 7572      elif fl.xcur
+000073d0: 736f 723a 0a20 2020 2020 2020 2020 2020  sor:.           
+000073e0: 2069 6620 666c 5f77 6964 7468 2069 7320   if fl_width is 
+000073f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00007400: 2020 2020 2020 7769 6474 6820 3d20 666c        width = fl
+00007410: 2e63 6f6e 7465 6e74 2e70 7265 6665 7272  .content.preferr
+00007420: 6564 5f77 6964 7468 2877 7269 7465 5f70  ed_width(write_p
+00007430: 6f73 6974 696f 6e2e 7769 6474 6829 2e70  osition.width).p
+00007440: 7265 6665 7272 6564 0a20 2020 2020 2020  referred.       
+00007450: 2020 2020 2020 2020 2077 6964 7468 203d           width =
+00007460: 206d 696e 2877 7269 7465 5f70 6f73 6974   min(write_posit
+00007470: 696f 6e2e 7769 6474 682c 2077 6964 7468  ion.width, width
+00007480: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00007490: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000074a0: 2020 2020 7769 6474 6820 3d20 666c 5f77      width = fl_w
+000074b0: 6964 7468 0a0a 2020 2020 2020 2020 2020  idth..          
+000074c0: 2020 7870 6f73 203d 2063 7572 736f 725f    xpos = cursor_
+000074d0: 706f 7369 7469 6f6e 2e78 0a20 2020 2020  position.x.     
+000074e0: 2020 2020 2020 2069 6620 7870 6f73 202b         if xpos +
+000074f0: 2077 6964 7468 203e 2077 7269 7465 5f70   width > write_p
+00007500: 6f73 6974 696f 6e2e 7769 6474 683a 0a20  osition.width:. 
+00007510: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+00007520: 706f 7320 3d20 6d61 7828 302c 2077 7269  pos = max(0, wri
+00007530: 7465 5f70 6f73 6974 696f 6e2e 7769 6474  te_position.widt
+00007540: 6820 2d20 7769 6474 6829 0a20 2020 2020  h - width).     
+00007550: 2020 2023 204f 6e6c 7920 7769 6474 6820     # Only width 
+00007560: 6769 7665 6e20 2d3e 2063 656e 7465 7220  given -> center 
+00007570: 686f 7269 7a6f 6e74 616c 6c79 2e0a 2020  horizontally..  
+00007580: 2020 2020 2020 656c 6966 2066 6c5f 7769        elif fl_wi
+00007590: 6474 683a 0a20 2020 2020 2020 2020 2020  dth:.           
+000075a0: 2078 706f 7320 3d20 696e 7428 2877 7269   xpos = int((wri
+000075b0: 7465 5f70 6f73 6974 696f 6e2e 7769 6474  te_position.widt
+000075c0: 6820 2d20 666c 5f77 6964 7468 2920 2f20  h - fl_width) / 
+000075d0: 3229 0a20 2020 2020 2020 2020 2020 2077  2).            w
+000075e0: 6964 7468 203d 2066 6c5f 7769 6474 680a  idth = fl_width.
+000075f0: 2020 2020 2020 2020 2320 4f74 6865 7277          # Otherw
+00007600: 6973 652c 2074 616b 6520 7072 6566 6572  ise, take prefer
+00007610: 7265 6420 7769 6474 6820 6672 6f6d 2066  red width from f
+00007620: 6c6f 6174 2063 6f6e 7465 6e74 2e0a 2020  loat content..  
+00007630: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00007640: 2020 2020 2020 2020 7769 6474 6820 3d20          width = 
+00007650: 666c 2e63 6f6e 7465 6e74 2e70 7265 6665  fl.content.prefe
+00007660: 7272 6564 5f77 6964 7468 2877 7269 7465  rred_width(write
+00007670: 5f70 6f73 6974 696f 6e2e 7769 6474 6829  _position.width)
+00007680: 2e70 7265 6665 7272 6564 0a0a 2020 2020  .preferred..    
+00007690: 2020 2020 2020 2020 6966 2066 6c2e 6c65          if fl.le
+000076a0: 6674 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ft is not None:.
+000076b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000076c0: 7870 6f73 203d 2066 6c2e 6c65 6674 0a20  xpos = fl.left. 
+000076d0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+000076e0: 666c 2e72 6967 6874 2069 7320 6e6f 7420  fl.right is not 
+000076f0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00007700: 2020 2020 2020 7870 6f73 203d 206d 6178        xpos = max
+00007710: 2830 2c20 7772 6974 655f 706f 7369 7469  (0, write_positi
+00007720: 6f6e 2e77 6964 7468 202d 2077 6964 7468  on.width - width
+00007730: 202d 2066 6c2e 7269 6768 7429 0a20 2020   - fl.right).   
+00007740: 2020 2020 2020 2020 2065 6c73 653a 2020           else:  
+00007750: 2320 4365 6e74 6572 2068 6f72 697a 6f6e  # Center horizon
+00007760: 7461 6c6c 792e 0a20 2020 2020 2020 2020  tally..         
+00007770: 2020 2020 2020 2078 706f 7320 3d20 6d61         xpos = ma
+00007780: 7828 302c 2069 6e74 2828 7772 6974 655f  x(0, int((write_
+00007790: 706f 7369 7469 6f6e 2e77 6964 7468 202d  position.width -
+000077a0: 2077 6964 7468 2920 2f20 3229 290a 0a20   width) / 2)).. 
+000077b0: 2020 2020 2020 2020 2020 2023 2054 7269             # Tri
+000077c0: 6d2e 0a20 2020 2020 2020 2020 2020 2077  m..            w
+000077d0: 6964 7468 203d 206d 696e 2877 6964 7468  idth = min(width
+000077e0: 2c20 7772 6974 655f 706f 7369 7469 6f6e  , write_position
+000077f0: 2e77 6964 7468 202d 2078 706f 7329 0a0a  .width - xpos)..
+00007800: 2020 2020 2020 2020 2320 546f 7020 2620          # Top & 
+00007810: 6865 6967 6874 2067 6976 656e 2e0a 2020  height given..  
+00007820: 2020 2020 2020 6966 2066 6c2e 746f 7020        if fl.top 
+00007830: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00007840: 666c 5f68 6569 6768 7420 6973 206e 6f74  fl_height is not
+00007850: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00007860: 2020 2079 706f 7320 3d20 666c 2e74 6f70     ypos = fl.top
+00007870: 0a20 2020 2020 2020 2020 2020 2068 6569  .            hei
+00007880: 6768 7420 3d20 666c 5f68 6569 6768 740a  ght = fl_height.
+00007890: 2020 2020 2020 2020 2320 546f 7020 2620          # Top & 
+000078a0: 626f 7474 6f6d 2067 6976 656e 202d 3e20  bottom given -> 
+000078b0: 6361 6c63 756c 6174 6520 6865 6967 6874  calculate height
+000078c0: 2e0a 2020 2020 2020 2020 656c 6966 2066  ..        elif f
+000078d0: 6c2e 746f 7020 6973 206e 6f74 204e 6f6e  l.top is not Non
+000078e0: 6520 616e 6420 666c 2e62 6f74 746f 6d20  e and fl.bottom 
+000078f0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00007900: 2020 2020 2020 2020 2079 706f 7320 3d20           ypos = 
+00007910: 666c 2e74 6f70 0a20 2020 2020 2020 2020  fl.top.         
+00007920: 2020 2068 6569 6768 7420 3d20 7772 6974     height = writ
+00007930: 655f 706f 7369 7469 6f6e 2e68 6569 6768  e_position.heigh
+00007940: 7420 2d20 666c 2e74 6f70 202d 2066 6c2e  t - fl.top - fl.
+00007950: 626f 7474 6f6d 0a20 2020 2020 2020 2023  bottom.        #
+00007960: 2048 6569 6768 7420 2620 626f 7474 6f6d   Height & bottom
+00007970: 2067 6976 656e 202d 3e20 6361 6c63 756c   given -> calcul
+00007980: 6174 6520 746f 702e 0a20 2020 2020 2020  ate top..       
+00007990: 2065 6c69 6620 666c 5f68 6569 6768 7420   elif fl_height 
+000079a0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+000079b0: 666c 2e62 6f74 746f 6d20 6973 206e 6f74  fl.bottom is not
+000079c0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000079d0: 2020 2079 706f 7320 3d20 7772 6974 655f     ypos = write_
+000079e0: 706f 7369 7469 6f6e 2e68 6569 6768 7420  position.height 
+000079f0: 2d20 666c 5f68 6569 6768 7420 2d20 666c  - fl_height - fl
+00007a00: 2e62 6f74 746f 6d0a 2020 2020 2020 2020  .bottom.        
+00007a10: 2020 2020 6865 6967 6874 203d 2066 6c5f      height = fl_
+00007a20: 6865 6967 6874 0a20 2020 2020 2020 2023  height.        #
+00007a30: 204e 6561 7220 6375 7273 6f72 2e0a 2020   Near cursor..  
+00007a40: 2020 2020 2020 656c 6966 2066 6c2e 7963        elif fl.yc
+00007a50: 7572 736f 723a 0a20 2020 2020 2020 2020  ursor:.         
+00007a60: 2020 2079 706f 7320 3d20 6375 7273 6f72     ypos = cursor
+00007a70: 5f70 6f73 6974 696f 6e2e 7920 2b20 2830  _position.y + (0
+00007a80: 2069 6620 666c 2e61 6c6c 6f77 5f63 6f76   if fl.allow_cov
+00007a90: 6572 5f63 7572 736f 7220 656c 7365 2031  er_cursor else 1
+00007aa0: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00007ab0: 6620 666c 5f68 6569 6768 7420 6973 204e  f fl_height is N
+00007ac0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00007ad0: 2020 2020 2068 6569 6768 7420 3d20 666c       height = fl
+00007ae0: 2e63 6f6e 7465 6e74 2e70 7265 6665 7272  .content.preferr
+00007af0: 6564 5f68 6569 6768 7428 0a20 2020 2020  ed_height(.     
+00007b00: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00007b10: 6964 7468 2c20 7772 6974 655f 706f 7369  idth, write_posi
+00007b20: 7469 6f6e 2e68 6569 6768 740a 2020 2020  tion.height.    
+00007b30: 2020 2020 2020 2020 2020 2020 292e 7072              ).pr
+00007b40: 6566 6572 7265 640a 2020 2020 2020 2020  eferred.        
+00007b50: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00007b60: 2020 2020 2020 2020 2020 6865 6967 6874            height
+00007b70: 203d 2066 6c5f 6865 6967 6874 0a0a 2020   = fl_height..  
+00007b80: 2020 2020 2020 2020 2020 2320 5265 6475            # Redu
+00007b90: 6365 2068 6569 6768 7420 6966 206e 6f74  ce height if not
+00007ba0: 2065 6e6f 7567 6820 7370 6163 652e 2028   enough space. (
+00007bb0: 5765 2063 616e 2075 7365 2074 6865 2068  We can use the h
+00007bc0: 6569 6768 740a 2020 2020 2020 2020 2020  eight.          
+00007bd0: 2020 2320 7768 656e 2074 6865 2063 6f6e    # when the con
+00007be0: 7465 6e74 2072 6571 7569 7265 7320 6974  tent requires it
+00007bf0: 2e29 0a20 2020 2020 2020 2020 2020 2069  .).            i
+00007c00: 6620 6865 6967 6874 203e 2077 7269 7465  f height > write
+00007c10: 5f70 6f73 6974 696f 6e2e 6865 6967 6874  _position.height
+00007c20: 202d 2079 706f 733a 0a20 2020 2020 2020   - ypos:.       
+00007c30: 2020 2020 2020 2020 2069 6620 7772 6974           if writ
+00007c40: 655f 706f 7369 7469 6f6e 2e68 6569 6768  e_position.heigh
+00007c50: 7420 2d20 7970 6f73 202b 2031 203e 3d20  t - ypos + 1 >= 
+00007c60: 7970 6f73 3a0a 2020 2020 2020 2020 2020  ypos:.          
+00007c70: 2020 2020 2020 2020 2020 2320 5768 656e            # When
+00007c80: 2074 6865 2073 7061 6365 2062 656c 6f77   the space below
+00007c90: 2074 6865 2063 7572 736f 7220 6973 206d   the cursor is m
+00007ca0: 6f72 6520 7468 616e 0a20 2020 2020 2020  ore than.       
+00007cb0: 2020 2020 2020 2020 2020 2020 2023 2074               # t
+00007cc0: 6865 2073 7061 6365 2061 626f 7665 2c20  he space above, 
+00007cd0: 6a75 7374 2072 6564 7563 6520 7468 6520  just reduce the 
+00007ce0: 6865 6967 6874 2e0a 2020 2020 2020 2020  height..        
+00007cf0: 2020 2020 2020 2020 2020 2020 6865 6967              heig
+00007d00: 6874 203d 2077 7269 7465 5f70 6f73 6974  ht = write_posit
+00007d10: 696f 6e2e 6865 6967 6874 202d 2079 706f  ion.height - ypo
+00007d20: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00007d30: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00007d40: 2020 2020 2020 2020 2020 2020 2320 4f74              # Ot
+00007d50: 6865 7277 6973 652c 2066 6974 2074 6865  herwise, fit the
+00007d60: 2066 6c6f 6174 2061 626f 7665 2074 6865   float above the
+00007d70: 2063 7572 736f 722e 0a20 2020 2020 2020   cursor..       
+00007d80: 2020 2020 2020 2020 2020 2020 2068 6569               hei
+00007d90: 6768 7420 3d20 6d69 6e28 6865 6967 6874  ght = min(height
+00007da0: 2c20 6375 7273 6f72 5f70 6f73 6974 696f  , cursor_positio
+00007db0: 6e2e 7929 0a20 2020 2020 2020 2020 2020  n.y).           
+00007dc0: 2020 2020 2020 2020 2079 706f 7320 3d20           ypos = 
+00007dd0: 6375 7273 6f72 5f70 6f73 6974 696f 6e2e  cursor_position.
+00007de0: 7920 2d20 6865 6967 6874 0a0a 2020 2020  y - height..    
+00007df0: 2020 2020 2320 4f6e 6c79 2068 6569 6768      # Only heigh
+00007e00: 7420 6769 7665 6e20 2d3e 2063 656e 7465  t given -> cente
+00007e10: 7220 7665 7274 6963 616c 6c79 2e0a 2020  r vertically..  
+00007e20: 2020 2020 2020 656c 6966 2066 6c5f 6865        elif fl_he
+00007e30: 6967 6874 3a0a 2020 2020 2020 2020 2020  ight:.          
+00007e40: 2020 7970 6f73 203d 2069 6e74 2828 7772    ypos = int((wr
+00007e50: 6974 655f 706f 7369 7469 6f6e 2e68 6569  ite_position.hei
+00007e60: 6768 7420 2d20 666c 5f68 6569 6768 7429  ght - fl_height)
+00007e70: 202f 2032 290a 2020 2020 2020 2020 2020   / 2).          
+00007e80: 2020 6865 6967 6874 203d 2066 6c5f 6865    height = fl_he
+00007e90: 6967 6874 0a20 2020 2020 2020 2023 204f  ight.        # O
+00007ea0: 7468 6572 7769 7365 2c20 7461 6b65 2070  therwise, take p
+00007eb0: 7265 6665 7272 6564 2068 6569 6768 7420  referred height 
+00007ec0: 6672 6f6d 2063 6f6e 7465 6e74 2e0a 2020  from content..  
+00007ed0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00007ee0: 2020 2020 2020 2020 6865 6967 6874 203d          height =
+00007ef0: 2066 6c2e 636f 6e74 656e 742e 7072 6566   fl.content.pref
+00007f00: 6572 7265 645f 6865 6967 6874 2877 6964  erred_height(wid
+00007f10: 7468 2c20 7772 6974 655f 706f 7369 7469  th, write_positi
+00007f20: 6f6e 2e68 6569 6768 7429 2e70 7265 6665  on.height).prefe
+00007f30: 7272 6564 0a0a 2020 2020 2020 2020 2020  rred..          
+00007f40: 2020 6966 2066 6c2e 746f 7020 6973 206e    if fl.top is n
+00007f50: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00007f60: 2020 2020 2020 2020 2079 706f 7320 3d20           ypos = 
+00007f70: 666c 2e74 6f70 0a20 2020 2020 2020 2020  fl.top.         
+00007f80: 2020 2065 6c69 6620 666c 2e62 6f74 746f     elif fl.botto
+00007f90: 6d20 6973 206e 6f74 204e 6f6e 653a 0a20  m is not None:. 
+00007fa0: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+00007fb0: 706f 7320 3d20 6d61 7828 302c 2077 7269  pos = max(0, wri
+00007fc0: 7465 5f70 6f73 6974 696f 6e2e 6865 6967  te_position.heig
+00007fd0: 6874 202d 2068 6569 6768 7420 2d20 666c  ht - height - fl
+00007fe0: 2e62 6f74 746f 6d29 0a20 2020 2020 2020  .bottom).       
+00007ff0: 2020 2020 2065 6c73 653a 2020 2320 4365       else:  # Ce
+00008000: 6e74 6572 2076 6572 7469 6361 6c6c 792e  nter vertically.
+00008010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008020: 2079 706f 7320 3d20 6d61 7828 302c 2069   ypos = max(0, i
+00008030: 6e74 2828 7772 6974 655f 706f 7369 7469  nt((write_positi
+00008040: 6f6e 2e68 6569 6768 7420 2d20 6865 6967  on.height - heig
+00008050: 6874 2920 2f20 3229 290a 0a20 2020 2020  ht) / 2))..     
+00008060: 2020 2020 2020 2023 2054 7269 6d2e 0a20         # Trim.. 
+00008070: 2020 2020 2020 2020 2020 2068 6569 6768             heigh
+00008080: 7420 3d20 6d69 6e28 6865 6967 6874 2c20  t = min(height, 
+00008090: 7772 6974 655f 706f 7369 7469 6f6e 2e68  write_position.h
+000080a0: 6569 6768 7420 2d20 7970 6f73 290a 0a20  eight - ypos).. 
+000080b0: 2020 2020 2020 2023 2057 7269 7465 2066         # Write f
+000080c0: 6c6f 6174 2e0a 2020 2020 2020 2020 2320  loat..        # 
+000080d0: 2878 706f 7320 616e 6420 7970 6f73 2063  (xpos and ypos c
+000080e0: 616e 2062 6520 6e65 6761 7469 7665 3a20  an be negative: 
+000080f0: 6120 666c 6f61 7420 6361 6e20 6265 2070  a float can be p
+00008100: 6172 7469 616c 6c79 2076 6973 6962 6c65  artially visible
+00008110: 2e29 0a20 2020 2020 2020 2069 6620 6865  .).        if he
+00008120: 6967 6874 203e 2030 2061 6e64 2077 6964  ight > 0 and wid
+00008130: 7468 203e 2030 3a0a 2020 2020 2020 2020  th > 0:.        
+00008140: 2020 2020 7770 203d 2057 7269 7465 506f      wp = WritePo
+00008150: 7369 7469 6f6e 280a 2020 2020 2020 2020  sition(.        
+00008160: 2020 2020 2020 2020 7870 6f73 3d78 706f          xpos=xpo
+00008170: 7320 2b20 7772 6974 655f 706f 7369 7469  s + write_positi
+00008180: 6f6e 2e78 706f 732c 0a20 2020 2020 2020  on.xpos,.       
+00008190: 2020 2020 2020 2020 2079 706f 733d 7970           ypos=yp
+000081a0: 6f73 202b 2077 7269 7465 5f70 6f73 6974  os + write_posit
+000081b0: 696f 6e2e 7970 6f73 2c0a 2020 2020 2020  ion.ypos,.      
+000081c0: 2020 2020 2020 2020 2020 7769 6474 683d            width=
+000081d0: 7769 6474 682c 0a20 2020 2020 2020 2020  width,.         
+000081e0: 2020 2020 2020 2068 6569 6768 743d 6865         height=he
+000081f0: 6967 6874 2c0a 2020 2020 2020 2020 2020  ight,.          
+00008200: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
+00008210: 2069 6620 6e6f 7420 666c 2e68 6964 655f   if not fl.hide_
+00008220: 7768 656e 5f63 6f76 6572 696e 675f 636f  when_covering_co
+00008230: 6e74 656e 7420 6f72 2073 656c 662e 5f61  ntent or self._a
+00008240: 7265 615f 6973 5f65 6d70 7479 2873 6372  rea_is_empty(scr
+00008250: 6565 6e2c 2077 7029 3a0a 2020 2020 2020  een, wp):.      
+00008260: 2020 2020 2020 2020 2020 666c 2e63 6f6e            fl.con
+00008270: 7465 6e74 2e77 7269 7465 5f74 6f5f 7363  tent.write_to_sc
+00008280: 7265 656e 280a 2020 2020 2020 2020 2020  reen(.          
+00008290: 2020 2020 2020 2020 2020 7363 7265 656e            screen
+000082a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000082b0: 2020 2020 2020 6d6f 7573 655f 6861 6e64        mouse_hand
+000082c0: 6c65 7273 2c0a 2020 2020 2020 2020 2020  lers,.          
+000082d0: 2020 2020 2020 2020 2020 7770 2c0a 2020            wp,.  
+000082e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000082f0: 2020 7374 796c 652c 0a20 2020 2020 2020    style,.       
+00008300: 2020 2020 2020 2020 2020 2020 2065 7261               era
+00008310: 7365 5f62 673d 6e6f 7420 666c 2e74 7261  se_bg=not fl.tra
+00008320: 6e73 7061 7265 6e74 2829 2c0a 2020 2020  nsparent(),.    
+00008330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008340: 7a5f 696e 6465 783d 7a5f 696e 6465 782c  z_index=z_index,
+00008350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008360: 2029 0a0a 2020 2020 6465 6620 5f61 7265   )..    def _are
+00008370: 615f 6973 5f65 6d70 7479 2873 656c 662c  a_is_empty(self,
+00008380: 2073 6372 6565 6e3a 2053 6372 6565 6e2c   screen: Screen,
+00008390: 2077 7269 7465 5f70 6f73 6974 696f 6e3a   write_position:
+000083a0: 2057 7269 7465 506f 7369 7469 6f6e 2920   WritePosition) 
+000083b0: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
+000083c0: 2022 2222 0a20 2020 2020 2020 2052 6574   """.        Ret
+000083d0: 7572 6e20 5472 7565 2077 6865 6e20 7468  urn True when th
+000083e0: 6520 6172 6561 2062 656c 6f77 2074 6865  e area below the
+000083f0: 2077 7269 7465 2070 6f73 6974 696f 6e20   write position 
+00008400: 6973 2073 7469 6c6c 2065 6d70 7479 2e0a  is still empty..
+00008410: 2020 2020 2020 2020 2846 6f72 2066 6c6f          (For flo
+00008420: 6174 7320 7468 6174 2073 686f 756c 6420  ats that should 
+00008430: 6e6f 7420 6869 6465 2063 6f6e 7465 6e74  not hide content
+00008440: 2075 6e64 6572 6e65 6174 682e 290a 2020   underneath.).  
+00008450: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00008460: 2020 7770 203d 2077 7269 7465 5f70 6f73    wp = write_pos
+00008470: 6974 696f 6e0a 0a20 2020 2020 2020 2066  ition..        f
+00008480: 6f72 2079 2069 6e20 7261 6e67 6528 7770  or y in range(wp
+00008490: 2e79 706f 732c 2077 702e 7970 6f73 202b  .ypos, wp.ypos +
+000084a0: 2077 702e 6865 6967 6874 293a 0a20 2020   wp.height):.   
+000084b0: 2020 2020 2020 2020 2069 6620 7920 696e           if y in
+000084c0: 2073 6372 6565 6e2e 6461 7461 5f62 7566   screen.data_buf
+000084d0: 6665 723a 0a20 2020 2020 2020 2020 2020  fer:.           
+000084e0: 2020 2020 2072 6f77 203d 2073 6372 6565       row = scree
+000084f0: 6e2e 6461 7461 5f62 7566 6665 725b 795d  n.data_buffer[y]
+00008500: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00008510: 2020 666f 7220 7820 696e 2072 616e 6765    for x in range
+00008520: 2877 702e 7870 6f73 2c20 7770 2e78 706f  (wp.xpos, wp.xpo
+00008530: 7320 2b20 7770 2e77 6964 7468 293a 0a20  s + wp.width):. 
+00008540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008550: 2020 2063 203d 2072 6f77 5b78 5d0a 2020     c = row[x].  
+00008560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008570: 2020 6966 2063 2e63 6861 7220 213d 2022    if c.char != "
+00008580: 2022 3a0a 2020 2020 2020 2020 2020 2020   ":.            
+00008590: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000085a0: 726e 2046 616c 7365 0a0a 2020 2020 2020  rn False..      
+000085b0: 2020 7265 7475 726e 2054 7275 650a 0a20    return True.. 
+000085c0: 2020 2064 6566 2069 735f 6d6f 6461 6c28     def is_modal(
+000085d0: 7365 6c66 2920 2d3e 2062 6f6f 6c3a 0a20  self) -> bool:. 
+000085e0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000085f0: 6c66 2e6d 6f64 616c 0a0a 2020 2020 6465  lf.modal..    de
+00008600: 6620 6765 745f 6b65 795f 6269 6e64 696e  f get_key_bindin
+00008610: 6773 2873 656c 6629 202d 3e20 4f70 7469  gs(self) -> Opti
+00008620: 6f6e 616c 5b4b 6579 4269 6e64 696e 6773  onal[KeyBindings
+00008630: 4261 7365 5d3a 0a20 2020 2020 2020 2072  Base]:.        r
+00008640: 6574 7572 6e20 7365 6c66 2e62 696e 640a  eturn self.bind.
+00008650: 0a20 2020 2064 6566 2067 6574 5f63 6869  .    def get_chi
+00008660: 6c64 7265 6e28 7365 6c66 2920 2d3e 204c  ldren(self) -> L
+00008670: 6973 745b 436f 6e74 6169 6e65 725d 3a0a  ist[Container]:.
+00008680: 2020 2020 2020 2020 6368 696c 6472 656e          children
+00008690: 203d 205b 7365 6c66 2e63 6f6e 7465 6e74   = [self.content
+000086a0: 5d0a 2020 2020 2020 2020 6368 696c 6472  ].        childr
+000086b0: 656e 2e65 7874 656e 6428 662e 636f 6e74  en.extend(f.cont
+000086c0: 656e 7420 666f 7220 6620 696e 2073 656c  ent for f in sel
+000086d0: 662e 666c 6f61 7473 290a 2020 2020 2020  f.floats).      
+000086e0: 2020 7265 7475 726e 2063 6869 6c64 7265    return childre
+000086f0: 6e0a 0a0a 636c 6173 7320 466c 6f61 743a  n...class Float:
+00008700: 0a20 2020 2022 2222 0a20 2020 2046 6c6f  .    """.    Flo
+00008710: 6174 2066 6f72 2075 7365 2069 6e20 6120  at for use in a 
+00008720: 3a63 6c61 7373 3a60 2e46 6c6f 6174 436f  :class:`.FloatCo
+00008730: 6e74 6169 6e65 7260 2e0a 2020 2020 4578  ntainer`..    Ex
+00008740: 6365 7074 2066 6f72 2074 6865 2060 636f  cept for the `co
+00008750: 6e74 656e 7460 2070 6172 616d 6574 6572  ntent` parameter
+00008760: 2c20 616c 6c20 6f74 6865 7220 6f70 7469  , all other opti
+00008770: 6f6e 7320 6172 6520 6f70 7469 6f6e 616c  ons are optional
+00008780: 2e0a 0a20 2020 203a 7061 7261 6d20 636f  ...    :param co
+00008790: 6e74 656e 743a 203a 636c 6173 733a 602e  ntent: :class:`.
+000087a0: 436f 6e74 6169 6e65 7260 2069 6e73 7461  Container` insta
+000087b0: 6e63 652e 0a0a 2020 2020 3a70 6172 616d  nce...    :param
+000087c0: 2077 6964 7468 3a20 3a63 6c61 7373 3a60   width: :class:`
+000087d0: 2e44 696d 656e 7369 6f6e 6020 6f72 2063  .Dimension` or c
+000087e0: 616c 6c61 626c 6520 7768 6963 6820 7265  allable which re
+000087f0: 7475 726e 7320 6120 3a63 6c61 7373 3a60  turns a :class:`
+00008800: 2e44 696d 656e 7369 6f6e 602e 0a20 2020  .Dimension`..   
+00008810: 203a 7061 7261 6d20 6865 6967 6874 3a20   :param height: 
+00008820: 3a63 6c61 7373 3a60 2e44 696d 656e 7369  :class:`.Dimensi
+00008830: 6f6e 6020 6f72 2063 616c 6c61 626c 6520  on` or callable 
+00008840: 7768 6963 6820 7265 7475 726e 7320 6120  which returns a 
+00008850: 3a63 6c61 7373 3a60 2e44 696d 656e 7369  :class:`.Dimensi
+00008860: 6f6e 602e 0a0a 2020 2020 3a70 6172 616d  on`...    :param
+00008870: 206c 6566 743a 2044 6973 7461 6e63 6520   left: Distance 
+00008880: 746f 2074 6865 206c 6566 7420 6564 6765  to the left edge
+00008890: 206f 6620 7468 6520 3a63 6c61 7373 3a60   of the :class:`
+000088a0: 2e46 6c6f 6174 436f 6e74 6169 6e65 7260  .FloatContainer`
+000088b0: 2e0a 2020 2020 3a70 6172 616d 2072 6967  ..    :param rig
+000088c0: 6874 3a20 4469 7374 616e 6365 2074 6f20  ht: Distance to 
+000088d0: 7468 6520 7269 6768 7420 6564 6765 206f  the right edge o
+000088e0: 6620 7468 6520 3a63 6c61 7373 3a60 2e46  f the :class:`.F
+000088f0: 6c6f 6174 436f 6e74 6169 6e65 7260 2e0a  loatContainer`..
+00008900: 2020 2020 3a70 6172 616d 2074 6f70 3a20      :param top: 
+00008910: 4469 7374 616e 6365 2074 6f20 7468 6520  Distance to the 
+00008920: 746f 7020 6f66 2074 6865 203a 636c 6173  top of the :clas
+00008930: 733a 602e 466c 6f61 7443 6f6e 7461 696e  s:`.FloatContain
+00008940: 6572 602e 0a20 2020 203a 7061 7261 6d20  er`..    :param 
+00008950: 626f 7474 6f6d 3a20 4469 7374 616e 6365  bottom: Distance
+00008960: 2074 6f20 7468 6520 626f 7474 6f6d 206f   to the bottom o
+00008970: 6620 7468 6520 3a63 6c61 7373 3a60 2e46  f the :class:`.F
+00008980: 6c6f 6174 436f 6e74 6169 6e65 7260 2e0a  loatContainer`..
+00008990: 0a20 2020 203a 7061 7261 6d20 6174 7461  .    :param atta
+000089a0: 6368 5f74 6f5f 7769 6e64 6f77 3a20 4174  ch_to_window: At
+000089b0: 7461 6368 2074 6f20 7468 6520 6375 7273  tach to the curs
+000089c0: 6f72 2066 726f 6d20 7468 6973 2077 696e  or from this win
+000089d0: 646f 772c 2069 6e73 7465 6164 206f 660a  dow, instead of.
+000089e0: 2020 2020 2020 2020 7468 6520 6375 7272          the curr
+000089f0: 656e 7420 7769 6e64 6f77 2e0a 2020 2020  ent window..    
+00008a00: 3a70 6172 616d 2068 6964 655f 7768 656e  :param hide_when
+00008a10: 5f63 6f76 6572 696e 675f 636f 6e74 656e  _covering_conten
+00008a20: 743a 2048 6964 6520 7468 6520 666c 6f61  t: Hide the floa
+00008a30: 7420 7768 656e 2069 7420 636f 7665 7273  t when it covers
+00008a40: 2063 6f6e 7465 6e74 2075 6e64 6572 6e65   content underne
+00008a50: 6174 682e 0a20 2020 203a 7061 7261 6d20  ath..    :param 
+00008a60: 616c 6c6f 775f 636f 7665 725f 6375 7273  allow_cover_curs
+00008a70: 6f72 3a20 5768 656e 2060 4661 6c73 6560  or: When `False`
+00008a80: 2c20 6d61 6b65 2073 7572 6520 746f 2064  , make sure to d
+00008a90: 6973 706c 6179 2074 6865 2066 6c6f 6174  isplay the float
+00008aa0: 0a20 2020 2020 2020 2062 656c 6f77 2074  .        below t
+00008ab0: 6865 2063 7572 736f 722e 204e 6f74 206f  he cursor. Not o
+00008ac0: 6e20 746f 7020 6f66 2074 6865 2069 6e64  n top of the ind
+00008ad0: 6963 6174 6564 2070 6f73 6974 696f 6e2e  icated position.
+00008ae0: 0a20 2020 203a 7061 7261 6d20 7a5f 696e  .    :param z_in
+00008af0: 6465 783a 205a 2d69 6e64 6578 2070 6f73  dex: Z-index pos
+00008b00: 6974 696f 6e2e 2046 6f72 2061 2046 6c6f  ition. For a Flo
+00008b10: 6174 2c20 7468 6973 206e 6565 6473 2074  at, this needs t
+00008b20: 6f20 6265 2061 7420 6c65 6173 740a 2020  o be at least.  
+00008b30: 2020 2020 2020 6f6e 652e 2049 7420 6973        one. It is
+00008b40: 2072 656c 6174 6976 6520 746f 2074 6865   relative to the
+00008b50: 207a 5f69 6e64 6578 206f 6620 7468 6520   z_index of the 
+00008b60: 7061 7265 6e74 2063 6f6e 7461 696e 6572  parent container
+00008b70: 2e0a 2020 2020 3a70 6172 616d 2074 7261  ..    :param tra
+00008b80: 6e73 7061 7265 6e74 3a20 3a63 6c61 7373  nsparent: :class
+00008b90: 3a60 2e46 696c 7465 7260 2069 6e64 6963  :`.Filter` indic
+00008ba0: 6174 696e 6720 7768 6574 6865 7220 7468  ating whether th
+00008bb0: 6973 2066 6c6f 6174 206e 6565 6473 2074  is float needs t
+00008bc0: 6f20 6265 0a20 2020 2020 2020 2064 7261  o be.        dra
+00008bd0: 776e 2074 7261 6e73 7061 7265 6e74 6c79  wn transparently
+00008be0: 2e0a 2020 2020 2222 220a 0a20 2020 2064  ..    """..    d
+00008bf0: 6566 205f 5f69 6e69 745f 5f28 0a20 2020  ef __init__(.   
+00008c00: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00008c10: 2020 2063 6f6e 7465 6e74 3a20 416e 7943     content: AnyC
+00008c20: 6f6e 7461 696e 6572 2c0a 2020 2020 2020  ontainer,.      
+00008c30: 2020 746f 703a 204f 7074 696f 6e61 6c5b    top: Optional[
+00008c40: 696e 745d 203d 204e 6f6e 652c 0a20 2020  int] = None,.   
+00008c50: 2020 2020 2072 6967 6874 3a20 4f70 7469       right: Opti
+00008c60: 6f6e 616c 5b69 6e74 5d20 3d20 4e6f 6e65  onal[int] = None
+00008c70: 2c0a 2020 2020 2020 2020 626f 7474 6f6d  ,.        bottom
+00008c80: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
+00008c90: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00008ca0: 6c65 6674 3a20 4f70 7469 6f6e 616c 5b69  left: Optional[i
+00008cb0: 6e74 5d20 3d20 4e6f 6e65 2c0a 2020 2020  nt] = None,.    
+00008cc0: 2020 2020 7769 6474 683a 204f 7074 696f      width: Optio
+00008cd0: 6e61 6c5b 556e 696f 6e5b 696e 742c 2043  nal[Union[int, C
+00008ce0: 616c 6c61 626c 655b 5b5d 2c20 696e 745d  allable[[], int]
+00008cf0: 5d5d 203d 204e 6f6e 652c 0a20 2020 2020  ]] = None,.     
+00008d00: 2020 2068 6569 6768 743a 204f 7074 696f     height: Optio
+00008d10: 6e61 6c5b 556e 696f 6e5b 696e 742c 2043  nal[Union[int, C
+00008d20: 616c 6c61 626c 655b 5b5d 2c20 696e 745d  allable[[], int]
+00008d30: 5d5d 203d 204e 6f6e 652c 0a20 2020 2020  ]] = None,.     
+00008d40: 2020 2078 6375 7273 6f72 3a20 626f 6f6c     xcursor: bool
+00008d50: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
+00008d60: 2020 7963 7572 736f 723a 2062 6f6f 6c20    ycursor: bool 
+00008d70: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+00008d80: 2061 7474 6163 685f 746f 5f77 696e 646f   attach_to_windo
+00008d90: 773a 204f 7074 696f 6e61 6c5b 416e 7943  w: Optional[AnyC
+00008da0: 6f6e 7461 696e 6572 5d20 3d20 4e6f 6e65  ontainer] = None
+00008db0: 2c0a 2020 2020 2020 2020 6869 6465 5f77  ,.        hide_w
+00008dc0: 6865 6e5f 636f 7665 7269 6e67 5f63 6f6e  hen_covering_con
+00008dd0: 7465 6e74 3a20 626f 6f6c 203d 2046 616c  tent: bool = Fal
+00008de0: 7365 2c0a 2020 2020 2020 2020 616c 6c6f  se,.        allo
+00008df0: 775f 636f 7665 725f 6375 7273 6f72 3a20  w_cover_cursor: 
+00008e00: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
+00008e10: 2020 2020 2020 7a5f 696e 6465 783a 2069        z_index: i
+00008e20: 6e74 203d 2031 2c0a 2020 2020 2020 2020  nt = 1,.        
+00008e30: 7472 616e 7370 6172 656e 743a 2062 6f6f  transparent: boo
+00008e40: 6c20 3d20 4661 6c73 652c 0a20 2020 2029  l = False,.    )
+00008e50: 202d 3e20 4e6f 6e65 3a0a 0a20 2020 2020   -> None:..     
+00008e60: 2020 2061 7373 6572 7420 7a5f 696e 6465     assert z_inde
+00008e70: 7820 3e3d 2031 0a0a 2020 2020 2020 2020  x >= 1..        
+00008e80: 7365 6c66 2e6c 6566 7420 3d20 6c65 6674  self.left = left
+00008e90: 0a20 2020 2020 2020 2073 656c 662e 7269  .        self.ri
+00008ea0: 6768 7420 3d20 7269 6768 740a 2020 2020  ght = right.    
+00008eb0: 2020 2020 7365 6c66 2e74 6f70 203d 2074      self.top = t
+00008ec0: 6f70 0a20 2020 2020 2020 2073 656c 662e  op.        self.
+00008ed0: 626f 7474 6f6d 203d 2062 6f74 746f 6d0a  bottom = bottom.
+00008ee0: 0a20 2020 2020 2020 2073 656c 662e 7769  .        self.wi
+00008ef0: 6474 6820 3d20 7769 6474 680a 2020 2020  dth = width.    
+00008f00: 2020 2020 7365 6c66 2e68 6569 6768 7420      self.height 
+00008f10: 3d20 6865 6967 6874 0a0a 2020 2020 2020  = height..      
+00008f20: 2020 7365 6c66 2e78 6375 7273 6f72 203d    self.xcursor =
+00008f30: 2078 6375 7273 6f72 0a20 2020 2020 2020   xcursor.       
+00008f40: 2073 656c 662e 7963 7572 736f 7220 3d20   self.ycursor = 
+00008f50: 7963 7572 736f 720a 0a20 2020 2020 2020  ycursor..       
+00008f60: 2073 656c 662e 6174 7461 6368 5f74 6f5f   self.attach_to_
+00008f70: 7769 6e64 6f77 203d 2028 0a20 2020 2020  window = (.     
+00008f80: 2020 2020 2020 2074 6f5f 7769 6e64 6f77         to_window
+00008f90: 2861 7474 6163 685f 746f 5f77 696e 646f  (attach_to_windo
+00008fa0: 7729 2069 6620 6174 7461 6368 5f74 6f5f  w) if attach_to_
+00008fb0: 7769 6e64 6f77 2065 6c73 6520 4e6f 6e65  window else None
+00008fc0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00008fd0: 2020 2020 7365 6c66 2e63 6f6e 7465 6e74      self.content
+00008fe0: 203d 2074 6f5f 636f 6e74 6169 6e65 7228   = to_container(
+00008ff0: 636f 6e74 656e 7429 0a20 2020 2020 2020  content).       
+00009000: 2073 656c 662e 6869 6465 5f77 6865 6e5f   self.hide_when_
+00009010: 636f 7665 7269 6e67 5f63 6f6e 7465 6e74  covering_content
+00009020: 203d 2068 6964 655f 7768 656e 5f63 6f76   = hide_when_cov
+00009030: 6572 696e 675f 636f 6e74 656e 740a 2020  ering_content.  
+00009040: 2020 2020 2020 7365 6c66 2e61 6c6c 6f77        self.allow
+00009050: 5f63 6f76 6572 5f63 7572 736f 7220 3d20  _cover_cursor = 
+00009060: 616c 6c6f 775f 636f 7665 725f 6375 7273  allow_cover_curs
+00009070: 6f72 0a20 2020 2020 2020 2073 656c 662e  or.        self.
+00009080: 7a5f 696e 6465 7820 3d20 7a5f 696e 6465  z_index = z_inde
+00009090: 780a 2020 2020 2020 2020 7365 6c66 2e74  x.        self.t
+000090a0: 7261 6e73 7061 7265 6e74 203d 2074 6f5f  ransparent = to_
+000090b0: 6669 6c74 6572 2874 7261 6e73 7061 7265  filter(transpare
+000090c0: 6e74 290a 0a20 2020 2064 6566 2067 6574  nt)..    def get
+000090d0: 5f77 6964 7468 2873 656c 6629 202d 3e20  _width(self) -> 
+000090e0: 4f70 7469 6f6e 616c 5b69 6e74 5d3a 0a20  Optional[int]:. 
+000090f0: 2020 2020 2020 2069 6620 6361 6c6c 6162         if callab
+00009100: 6c65 2873 656c 662e 7769 6474 6829 3a0a  le(self.width):.
+00009110: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00009120: 726e 2073 656c 662e 7769 6474 6828 290a  rn self.width().
+00009130: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00009140: 656c 662e 7769 6474 680a 0a20 2020 2064  elf.width..    d
+00009150: 6566 2067 6574 5f68 6569 6768 7428 7365  ef get_height(se
+00009160: 6c66 2920 2d3e 204f 7074 696f 6e61 6c5b  lf) -> Optional[
+00009170: 696e 745d 3a0a 2020 2020 2020 2020 6966  int]:.        if
+00009180: 2063 616c 6c61 626c 6528 7365 6c66 2e68   callable(self.h
+00009190: 6569 6768 7429 3a0a 2020 2020 2020 2020  eight):.        
+000091a0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000091b0: 6865 6967 6874 2829 0a20 2020 2020 2020  height().       
+000091c0: 2072 6574 7572 6e20 7365 6c66 2e68 6569   return self.hei
+000091d0: 6768 740a 0a20 2020 2064 6566 205f 5f72  ght..    def __r
+000091e0: 6570 725f 5f28 7365 6c66 2920 2d3e 2073  epr__(self) -> s
+000091f0: 7472 3a0a 2020 2020 2020 2020 7265 7475  tr:.        retu
+00009200: 726e 2022 466c 6f61 7428 636f 6e74 656e  rn "Float(conten
+00009210: 743d 2572 2922 2025 2073 656c 662e 636f  t=%r)" % self.co
+00009220: 6e74 656e 740a 0a0a 636c 6173 7320 5769  ntent...class Wi
+00009230: 6e64 6f77 5265 6e64 6572 496e 666f 3a0a  ndowRenderInfo:.
+00009240: 2020 2020 2222 220a 2020 2020 5265 6e64      """.    Rend
+00009250: 6572 2069 6e66 6f72 6d61 7469 6f6e 2066  er information f
+00009260: 6f72 2074 6865 206c 6173 7420 7265 6e64  or the last rend
+00009270: 6572 2074 696d 6520 6f66 2074 6869 7320  er time of this 
+00009280: 636f 6e74 726f 6c2e 0a20 2020 2049 7420  control..    It 
+00009290: 7374 6f72 6573 206d 6170 7069 6e67 2069  stores mapping i
+000092a0: 6e66 6f72 6d61 7469 6f6e 2062 6574 7765  nformation betwe
+000092b0: 656e 2074 6865 2069 6e70 7574 2062 7566  en the input buf
+000092c0: 6665 7273 2028 696e 2063 6173 6520 6f66  fers (in case of
+000092d0: 2061 0a20 2020 203a 636c 6173 733a 607e   a.    :class:`~
+000092e0: 7175 6f2e 6c61 796f 7574 2e63 6f6e 7472  quo.layout.contr
+000092f0: 6f6c 732e 4275 6666 6572 436f 6e74 726f  ols.BufferContro
+00009300: 6c60 2920 616e 6420 7468 6520 6163 7475  l`) and the actu
+00009310: 616c 0a20 2020 2072 656e 6465 7220 706f  al.    render po
+00009320: 7369 7469 6f6e 206f 6e20 7468 6520 6f75  sition on the ou
+00009330: 7470 7574 2073 6372 6565 6e2e 0a0a 2020  tput screen...  
+00009340: 2020 2843 6f75 6c64 2062 6520 7573 6564    (Could be used
+00009350: 2066 6f72 2069 6d70 6c65 6d65 6e74 6174   for implementat
+00009360: 696f 6e20 6f66 2074 6865 2056 6920 2748  ion of the Vi 'H
+00009370: 2720 616e 6420 274c 2720 6b65 7920 6269  ' and 'L' key bi
+00009380: 6e64 696e 6773 2061 730a 2020 2020 7765  ndings as.    we
+00009390: 6c6c 2061 7320 696d 706c 656d 656e 7469  ll as implementi
+000093a0: 6e67 206d 6f75 7365 2073 7570 706f 7274  ng mouse support
+000093b0: 2e29 0a0a 2020 2020 3a70 6172 616d 2075  .)..    :param u
+000093c0: 695f 636f 6e74 656e 743a 2054 6865 206f  i_content: The o
+000093d0: 7269 6769 6e61 6c20 3a63 6c61 7373 3a60  riginal :class:`
+000093e0: 2e55 4943 6f6e 7465 6e74 6020 696e 7374  .UIContent` inst
+000093f0: 616e 6365 2074 6861 7420 636f 6e74 6169  ance that contai
+00009400: 6e73 0a20 2020 2020 2020 2074 6865 2077  ns.        the w
+00009410: 686f 6c65 2069 6e70 7574 2c20 7769 7468  hole input, with
+00009420: 6f75 7420 636c 6970 7069 6e67 2e20 2875  out clipping. (u
+00009430: 695f 636f 6e74 656e 7429 0a20 2020 203a  i_content).    :
+00009440: 7061 7261 6d20 686f 7269 7a6f 6e74 616c  param horizontal
+00009450: 5f73 6372 6f6c 6c3a 2054 6865 2068 6f72  _scroll: The hor
+00009460: 697a 6f6e 7461 6c20 7363 726f 6c6c 206f  izontal scroll o
+00009470: 6620 7468 6520 3a63 6c61 7373 3a60 2e57  f the :class:`.W
+00009480: 696e 646f 7760 2069 6e73 7461 6e63 652e  indow` instance.
+00009490: 0a20 2020 203a 7061 7261 6d20 7665 7274  .    :param vert
+000094a0: 6963 616c 5f73 6372 6f6c 6c3a 2054 6865  ical_scroll: The
+000094b0: 2076 6572 7469 6361 6c20 7363 726f 6c6c   vertical scroll
+000094c0: 206f 6620 7468 6520 3a63 6c61 7373 3a60   of the :class:`
+000094d0: 2e57 696e 646f 7760 2069 6e73 7461 6e63  .Window` instanc
+000094e0: 652e 0a20 2020 203a 7061 7261 6d20 7769  e..    :param wi
+000094f0: 6e64 6f77 5f77 6964 7468 3a20 5468 6520  ndow_width: The 
+00009500: 7769 6474 6820 6f66 2074 6865 2077 696e  width of the win
+00009510: 646f 7720 7468 6174 2064 6973 706c 6179  dow that display
+00009520: 7320 7468 6520 636f 6e74 656e 742c 0a20  s the content,. 
+00009530: 2020 2020 2020 2077 6974 686f 7574 2074         without t
+00009540: 6865 206d 6172 6769 6e73 2e0a 2020 2020  he margins..    
+00009550: 3a70 6172 616d 2077 696e 646f 775f 6865  :param window_he
+00009560: 6967 6874 3a20 5468 6520 6865 6967 6874  ight: The height
+00009570: 206f 6620 7468 6520 7769 6e64 6f77 2074   of the window t
+00009580: 6861 7420 6469 7370 6c61 7973 2074 6865  hat displays the
+00009590: 2063 6f6e 7465 6e74 2e0a 2020 2020 3a70   content..    :p
+000095a0: 6172 616d 2063 6f6e 6669 6775 7265 645f  aram configured_
+000095b0: 7363 726f 6c6c 5f6f 6666 7365 7473 3a20  scroll_offsets: 
+000095c0: 5468 6520 7363 726f 6c6c 206f 6666 7365  The scroll offse
+000095d0: 7473 2061 7320 636f 6e66 6967 7572 6564  ts as configured
+000095e0: 2066 6f72 2074 6865 0a20 2020 2020 2020   for the.       
+000095f0: 203a 636c 6173 733a 6057 696e 646f 7760   :class:`Window`
+00009600: 2069 6e73 7461 6e63 652e 0a20 2020 203a   instance..    :
+00009610: 7061 7261 6d20 7669 7369 626c 655f 6c69  param visible_li
+00009620: 6e65 5f74 6f5f 726f 775f 636f 6c3a 204d  ne_to_row_col: M
+00009630: 6170 7069 6e67 2074 6861 7420 6d61 7073  apping that maps
+00009640: 2074 6865 2072 6f77 206e 756d 6265 7273   the row numbers
+00009650: 206f 6e20 7468 650a 2020 2020 2020 2020   on the.        
+00009660: 6469 7370 6c61 7965 6420 7363 7265 656e  displayed screen
+00009670: 2028 7374 6172 7469 6e67 2066 726f 6d20   (starting from 
+00009680: 7a65 726f 2066 6f72 2074 6865 2066 6972  zero for the fir
+00009690: 7374 2076 6973 6962 6c65 206c 696e 6529  st visible line)
+000096a0: 2074 6f0a 2020 2020 2020 2020 2872 6f77   to.        (row
+000096b0: 2c20 636f 6c29 2074 7570 6c65 7320 706f  , col) tuples po
+000096c0: 696e 7469 6e67 2074 6f20 7468 6520 726f  inting to the ro
+000096d0: 7720 616e 6420 636f 6c75 6d6e 206f 6620  w and column of 
+000096e0: 7468 6520 3a63 6c61 7373 3a60 2e55 4943  the :class:`.UIC
+000096f0: 6f6e 7465 6e74 602e 0a20 2020 203a 7061  ontent`..    :pa
+00009700: 7261 6d20 726f 7763 6f6c 5f74 6f5f 7978  ram rowcol_to_yx
+00009710: 3a20 4d61 7070 696e 6720 7468 6174 206d  : Mapping that m
+00009720: 6170 7320 2872 6f77 2c20 636f 6c75 6d6e  aps (row, column
+00009730: 2920 7475 706c 6573 2072 6570 7265 7365  ) tuples represe
+00009740: 6e74 696e 670a 2020 2020 2020 2020 636f  nting.        co
+00009750: 6f72 6469 6e61 7465 7320 6f66 2074 6865  ordinates of the
+00009760: 203a 636c 6173 733a 6055 4943 6f6e 7465   :class:`UIConte
+00009770: 6e74 6020 746f 2028 792c 2078 2920 6162  nt` to (y, x) ab
+00009780: 736f 6c75 7465 2063 6f6f 7264 696e 6174  solute coordinat
+00009790: 6573 2061 740a 2020 2020 2020 2020 7468  es at.        th
+000097a0: 6520 7265 6e64 6572 6564 2073 6372 6565  e rendered scree
+000097b0: 6e2e 0a20 2020 2022 2222 0a0a 2020 2020  n..    """..    
+000097c0: 6465 6620 5f5f 696e 6974 5f5f 280a 2020  def __init__(.  
+000097d0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+000097e0: 2020 2020 7769 6e64 6f77 3a20 2257 696e      window: "Win
+000097f0: 646f 7722 2c0a 2020 2020 2020 2020 7569  dow",.        ui
+00009800: 5f63 6f6e 7465 6e74 3a20 5549 436f 6e74  _content: UICont
+00009810: 656e 742c 0a20 2020 2020 2020 2068 6f72  ent,.        hor
+00009820: 697a 6f6e 7461 6c5f 7363 726f 6c6c 3a20  izontal_scroll: 
+00009830: 696e 742c 0a20 2020 2020 2020 2076 6572  int,.        ver
+00009840: 7469 6361 6c5f 7363 726f 6c6c 3a20 696e  tical_scroll: in
+00009850: 742c 0a20 2020 2020 2020 2077 696e 646f  t,.        windo
+00009860: 775f 7769 6474 683a 2069 6e74 2c0a 2020  w_width: int,.  
+00009870: 2020 2020 2020 7769 6e64 6f77 5f68 6569        window_hei
+00009880: 6768 743a 2069 6e74 2c0a 2020 2020 2020  ght: int,.      
+00009890: 2020 636f 6e66 6967 7572 6564 5f73 6372    configured_scr
+000098a0: 6f6c 6c5f 6f66 6673 6574 733a 2022 5363  oll_offsets: "Sc
+000098b0: 726f 6c6c 4f66 6673 6574 7322 2c0a 2020  rollOffsets",.  
+000098c0: 2020 2020 2020 7669 7369 626c 655f 6c69        visible_li
+000098d0: 6e65 5f74 6f5f 726f 775f 636f 6c3a 2044  ne_to_row_col: D
+000098e0: 6963 745b 696e 742c 2054 7570 6c65 5b69  ict[int, Tuple[i
+000098f0: 6e74 2c20 696e 745d 5d2c 0a20 2020 2020  nt, int]],.     
+00009900: 2020 2072 6f77 636f 6c5f 746f 5f79 783a     rowcol_to_yx:
+00009910: 2044 6963 745b 5475 706c 655b 696e 742c   Dict[Tuple[int,
+00009920: 2069 6e74 5d2c 2054 7570 6c65 5b69 6e74   int], Tuple[int
+00009930: 2c20 696e 745d 5d2c 0a20 2020 2020 2020  , int]],.       
+00009940: 2078 5f6f 6666 7365 743a 2069 6e74 2c0a   x_offset: int,.
+00009950: 2020 2020 2020 2020 795f 6f66 6673 6574          y_offset
+00009960: 3a20 696e 742c 0a20 2020 2020 2020 2077  : int,.        w
+00009970: 7261 705f 6c69 6e65 733a 2062 6f6f 6c2c  rap_lines: bool,
+00009980: 0a20 2020 2029 202d 3e20 4e6f 6e65 3a0a  .    ) -> None:.
+00009990: 0a20 2020 2020 2020 2073 656c 662e 7769  .        self.wi
+000099a0: 6e64 6f77 203d 2077 696e 646f 770a 2020  ndow = window.  
+000099b0: 2020 2020 2020 7365 6c66 2e75 695f 636f        self.ui_co
+000099c0: 6e74 656e 7420 3d20 7569 5f63 6f6e 7465  ntent = ui_conte
+000099d0: 6e74 0a20 2020 2020 2020 2073 656c 662e  nt.        self.
+000099e0: 7665 7274 6963 616c 5f73 6372 6f6c 6c20  vertical_scroll 
+000099f0: 3d20 7665 7274 6963 616c 5f73 6372 6f6c  = vertical_scrol
+00009a00: 6c0a 2020 2020 2020 2020 7365 6c66 2e77  l.        self.w
+00009a10: 696e 646f 775f 7769 6474 6820 3d20 7769  indow_width = wi
+00009a20: 6e64 6f77 5f77 6964 7468 2020 2320 5769  ndow_width  # Wi
+00009a30: 6474 6820 7769 7468 6f75 7420 6d61 7267  dth without marg
+00009a40: 696e 732e 0a20 2020 2020 2020 2073 656c  ins..        sel
+00009a50: 662e 7769 6e64 6f77 5f68 6569 6768 7420  f.window_height 
+00009a60: 3d20 7769 6e64 6f77 5f68 6569 6768 740a  = window_height.
+00009a70: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
+00009a80: 6e66 6967 7572 6564 5f73 6372 6f6c 6c5f  nfigured_scroll_
+00009a90: 6f66 6673 6574 7320 3d20 636f 6e66 6967  offsets = config
+00009aa0: 7572 6564 5f73 6372 6f6c 6c5f 6f66 6673  ured_scroll_offs
+00009ab0: 6574 730a 2020 2020 2020 2020 7365 6c66  ets.        self
+00009ac0: 2e76 6973 6962 6c65 5f6c 696e 655f 746f  .visible_line_to
+00009ad0: 5f72 6f77 5f63 6f6c 203d 2076 6973 6962  _row_col = visib
+00009ae0: 6c65 5f6c 696e 655f 746f 5f72 6f77 5f63  le_line_to_row_c
+00009af0: 6f6c 0a20 2020 2020 2020 2073 656c 662e  ol.        self.
+00009b00: 7772 6170 5f6c 696e 6573 203d 2077 7261  wrap_lines = wra
+00009b10: 705f 6c69 6e65 730a 0a20 2020 2020 2020  p_lines..       
+00009b20: 2073 656c 662e 5f72 6f77 636f 6c5f 746f   self._rowcol_to
+00009b30: 5f79 7820 3d20 726f 7763 6f6c 5f74 6f5f  _yx = rowcol_to_
+00009b40: 7978 2020 2320 726f 772f 636f 6c20 6672  yx  # row/col fr
+00009b50: 6f6d 2069 6e70 7574 2074 6f20 6162 736f  om input to abso
+00009b60: 6c75 7465 2079 2f78 0a20 2020 2020 2020  lute y/x.       
+00009b70: 2023 2073 6372 6565 6e20 636f 6f72 6469   # screen coordi
+00009b80: 6e61 7465 732e 0a20 2020 2020 2020 2073  nates..        s
+00009b90: 656c 662e 5f78 5f6f 6666 7365 7420 3d20  elf._x_offset = 
+00009ba0: 785f 6f66 6673 6574 0a20 2020 2020 2020  x_offset.       
+00009bb0: 2073 656c 662e 5f79 5f6f 6666 7365 7420   self._y_offset 
+00009bc0: 3d20 795f 6f66 6673 6574 0a0a 2020 2020  = y_offset..    
+00009bd0: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+00009be0: 6620 7669 7369 626c 655f 6c69 6e65 5f74  f visible_line_t
+00009bf0: 6f5f 696e 7075 745f 6c69 6e65 2873 656c  o_input_line(sel
+00009c00: 6629 202d 3e20 4469 6374 5b69 6e74 2c20  f) -> Dict[int, 
+00009c10: 696e 745d 3a0a 2020 2020 2020 2020 7265  int]:.        re
+00009c20: 7475 726e 207b 0a20 2020 2020 2020 2020  turn {.         
+00009c30: 2020 2076 6973 6962 6c65 5f6c 696e 653a     visible_line:
+00009c40: 2072 6f77 636f 6c5b 305d 0a20 2020 2020   rowcol[0].     
+00009c50: 2020 2020 2020 2066 6f72 2076 6973 6962         for visib
+00009c60: 6c65 5f6c 696e 652c 2072 6f77 636f 6c20  le_line, rowcol 
+00009c70: 696e 2073 656c 662e 7669 7369 626c 655f  in self.visible_
+00009c80: 6c69 6e65 5f74 6f5f 726f 775f 636f 6c2e  line_to_row_col.
+00009c90: 6974 656d 7328 290a 2020 2020 2020 2020  items().        
+00009ca0: 7d0a 0a20 2020 2040 7072 6f70 6572 7479  }..    @property
+00009cb0: 0a20 2020 2064 6566 2063 7572 736f 725f  .    def cursor_
+00009cc0: 706f 7369 7469 6f6e 2873 656c 6629 202d  position(self) -
+00009cd0: 3e20 506f 696e 743a 0a20 2020 2020 2020  > Point:.       
+00009ce0: 2022 2222 0a20 2020 2020 2020 2052 6574   """.        Ret
+00009cf0: 7572 6e20 7468 6520 6375 7273 6f72 2070  urn the cursor p
+00009d00: 6f73 6974 696f 6e20 636f 6f72 6469 6e61  osition coordina
+00009d10: 7465 732c 2072 656c 6174 6976 6520 746f  tes, relative to
+00009d20: 2074 6865 206c 6566 742f 746f 7020 636f   the left/top co
+00009d30: 726e 6572 0a20 2020 2020 2020 206f 6620  rner.        of 
+00009d40: 7468 6520 7265 6e64 6572 6564 2073 6372  the rendered scr
+00009d50: 6565 6e2e 0a20 2020 2020 2020 2022 2222  een..        """
+00009d60: 0a20 2020 2020 2020 2063 706f 7320 3d20  .        cpos = 
+00009d70: 7365 6c66 2e75 695f 636f 6e74 656e 742e  self.ui_content.
+00009d80: 6375 7273 6f72 5f70 6f73 6974 696f 6e0a  cursor_position.
+00009d90: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00009da0: 2020 2020 2020 2020 2079 2c20 7820 3d20           y, x = 
+00009db0: 7365 6c66 2e5f 726f 7763 6f6c 5f74 6f5f  self._rowcol_to_
+00009dc0: 7978 5b63 706f 732e 792c 2063 706f 732e  yx[cpos.y, cpos.
+00009dd0: 785d 0a20 2020 2020 2020 2065 7863 6570  x].        excep
+00009de0: 7420 4b65 7945 7272 6f72 3a0a 2020 2020  t KeyError:.    
+00009df0: 2020 2020 2020 2020 2320 466f 7220 6044          # For `D
+00009e00: 756d 6d79 436f 6e74 726f 6c60 2066 6f72  ummyControl` for
+00009e10: 2069 6e73 7461 6e63 652c 2074 6865 2063   instance, the c
+00009e20: 6f6e 7465 6e74 2063 616e 2062 6520 656d  ontent can be em
+00009e30: 7074 792c 2061 6e64 2073 6f0a 2020 2020  pty, and so.    
+00009e40: 2020 2020 2020 2020 2320 7769 6c6c 2060          # will `
+00009e50: 5f72 6f77 636f 6c5f 746f 5f79 7860 2062  _rowcol_to_yx` b
+00009e60: 652e 2052 6574 7572 6e20 302f 3020 6279  e. Return 0/0 by
+00009e70: 2064 6566 6175 6c74 2e0a 2020 2020 2020   default..      
+00009e80: 2020 2020 2020 7265 7475 726e 2050 6f69        return Poi
+00009e90: 6e74 2878 3d30 2c20 793d 3029 0a20 2020  nt(x=0, y=0).   
+00009ea0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00009eb0: 2020 2020 2020 2072 6574 7572 6e20 506f         return Po
+00009ec0: 696e 7428 783d 7820 2d20 7365 6c66 2e5f  int(x=x - self._
+00009ed0: 785f 6f66 6673 6574 2c20 793d 7920 2d20  x_offset, y=y - 
+00009ee0: 7365 6c66 2e5f 795f 6f66 6673 6574 290a  self._y_offset).
+00009ef0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+00009f00: 2020 2064 6566 2061 7070 6c69 6564 5f73     def applied_s
+00009f10: 6372 6f6c 6c5f 6f66 6673 6574 7328 7365  croll_offsets(se
+00009f20: 6c66 2920 2d3e 2022 5363 726f 6c6c 4f66  lf) -> "ScrollOf
+00009f30: 6673 6574 7322 3a0a 2020 2020 2020 2020  fsets":.        
+00009f40: 2222 220a 2020 2020 2020 2020 5265 7475  """.        Retu
+00009f50: 726e 2061 203a 636c 6173 733a 602e 5363  rn a :class:`.Sc
+00009f60: 726f 6c6c 4f66 6673 6574 7360 2069 6e73  rollOffsets` ins
+00009f70: 7461 6e63 6520 7468 6174 2069 6e64 6963  tance that indic
+00009f80: 6174 6573 2074 6865 2061 6374 7561 6c0a  ates the actual.
+00009f90: 2020 2020 2020 2020 6f66 6673 6574 2e20          offset. 
+00009fa0: 5468 6973 2063 616e 2062 6520 6c65 7373  This can be less
+00009fb0: 2074 6861 6e20 6f72 2065 7175 616c 2074   than or equal t
+00009fc0: 6f20 7768 6174 2773 2063 6f6e 6669 6775  o what's configu
+00009fd0: 7265 642e 2045 2e67 2c20 7768 656e 0a20  red. E.g, when. 
+00009fe0: 2020 2020 2020 2074 6865 2063 7572 736f         the curso
+00009ff0: 7220 6973 2063 6f6d 706c 6574 656c 7920  r is completely 
+0000a000: 6174 2074 6865 2074 6f70 2c20 7468 6520  at the top, the 
+0000a010: 746f 7020 6f66 6673 6574 2077 696c 6c20  top offset will 
+0000a020: 6265 207a 6572 6f20 7261 7468 6572 0a20  be zero rather. 
+0000a030: 2020 2020 2020 2074 6861 6e20 7768 6174         than what
+0000a040: 2773 2063 6f6e 6669 6775 7265 642e 0a20  's configured.. 
+0000a050: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000a060: 2020 2069 6620 7365 6c66 2e64 6973 706c     if self.displ
+0000a070: 6179 6564 5f6c 696e 6573 5b30 5d20 3d3d  ayed_lines[0] ==
+0000a080: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0000a090: 746f 7020 3d20 300a 2020 2020 2020 2020  top = 0.        
+0000a0a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000a0b0: 2020 2320 4765 7420 726f 7720 7768 6572    # Get row wher
+0000a0c0: 6520 7468 6520 6375 7273 6f72 2069 7320  e the cursor is 
+0000a0d0: 6469 7370 6c61 7965 642e 0a20 2020 2020  displayed..     
+0000a0e0: 2020 2020 2020 2079 203d 2073 656c 662e         y = self.
+0000a0f0: 696e 7075 745f 6c69 6e65 5f74 6f5f 7669  input_line_to_vi
+0000a100: 7369 626c 655f 6c69 6e65 5b73 656c 662e  sible_line[self.
+0000a110: 7569 5f63 6f6e 7465 6e74 2e63 7572 736f  ui_content.curso
+0000a120: 725f 706f 7369 7469 6f6e 2e79 5d0a 2020  r_position.y].  
+0000a130: 2020 2020 2020 2020 2020 746f 7020 3d20            top = 
+0000a140: 6d69 6e28 792c 2073 656c 662e 636f 6e66  min(y, self.conf
+0000a150: 6967 7572 6564 5f73 6372 6f6c 6c5f 6f66  igured_scroll_of
+0000a160: 6673 6574 732e 746f 7029 0a0a 2020 2020  fsets.top)..    
+0000a170: 2020 2020 7265 7475 726e 2053 6372 6f6c      return Scrol
+0000a180: 6c4f 6666 7365 7473 280a 2020 2020 2020  lOffsets(.      
+0000a190: 2020 2020 2020 746f 703d 746f 702c 0a20        top=top,. 
+0000a1a0: 2020 2020 2020 2020 2020 2062 6f74 746f             botto
+0000a1b0: 6d3d 6d69 6e28 0a20 2020 2020 2020 2020  m=min(.         
+0000a1c0: 2020 2020 2020 2073 656c 662e 7569 5f63         self.ui_c
+0000a1d0: 6f6e 7465 6e74 2e6c 696e 655f 636f 756e  ontent.line_coun
+0000a1e0: 7420 2d20 7365 6c66 2e64 6973 706c 6179  t - self.display
+0000a1f0: 6564 5f6c 696e 6573 5b2d 315d 202d 2031  ed_lines[-1] - 1
+0000a200: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000a210: 2020 7365 6c66 2e63 6f6e 6669 6775 7265    self.configure
+0000a220: 645f 7363 726f 6c6c 5f6f 6666 7365 7473  d_scroll_offsets
+0000a230: 2e62 6f74 746f 6d2c 0a20 2020 2020 2020  .bottom,.       
+0000a240: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
+0000a250: 2020 2020 2320 466f 7220 6c65 6674 2f72      # For left/r
+0000a260: 6967 6874 2c20 6974 2070 726f 6261 626c  ight, it probabl
+0000a270: 7920 646f 6573 6e27 7420 6d61 6b65 2073  y doesn't make s
+0000a280: 656e 7365 2074 6f20 7265 7475 726e 2073  ense to return s
+0000a290: 6f6d 6574 6869 6e67 2e0a 2020 2020 2020  omething..      
+0000a2a0: 2020 2020 2020 2320 2857 6520 776f 756c        # (We woul
+0000a2b0: 6420 6861 7665 2074 6f20 6361 6c63 756c  d have to calcul
+0000a2c0: 6174 6520 7468 6520 7769 6474 6873 206f  ate the widths o
+0000a2d0: 6620 616c 6c20 7468 6520 6c69 6e65 7320  f all the lines 
+0000a2e0: 616e 6420 6b65 6570 0a20 2020 2020 2020  and keep.       
+0000a2f0: 2020 2020 2023 2064 6f75 626c 6520 7769       # double wi
+0000a300: 6474 6820 6368 6172 6163 7465 7273 2069  dth characters i
+0000a310: 6e20 6d69 6e64 2e29 0a20 2020 2020 2020  n mind.).       
+0000a320: 2020 2020 206c 6566 743d 302c 0a20 2020       left=0,.   
+0000a330: 2020 2020 2020 2020 2072 6967 6874 3d30           right=0
+0000a340: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+0000a350: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+0000a360: 6566 2064 6973 706c 6179 6564 5f6c 696e  ef displayed_lin
+0000a370: 6573 2873 656c 6629 202d 3e20 4c69 7374  es(self) -> List
+0000a380: 5b69 6e74 5d3a 0a20 2020 2020 2020 2022  [int]:.        "
+0000a390: 2222 0a20 2020 2020 2020 204c 6973 7420  "".        List 
+0000a3a0: 6f66 2061 6c6c 2074 6865 2076 6973 6962  of all the visib
+0000a3b0: 6c65 2072 6f77 732e 2028 4c69 6e65 206e  le rows. (Line n
+0000a3c0: 756d 6265 7273 206f 6620 7468 6520 696e  umbers of the in
+0000a3d0: 7075 7420 6275 6666 6572 2e29 0a20 2020  put buffer.).   
+0000a3e0: 2020 2020 2054 6865 206c 6173 7420 6c69       The last li
+0000a3f0: 6e65 206d 6179 206e 6f74 2062 6520 656e  ne may not be en
+0000a400: 7469 7265 6c79 2076 6973 6962 6c65 2e0a  tirely visible..
+0000a410: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000a420: 2020 2020 7265 7475 726e 2073 6f72 7465      return sorte
+0000a430: 6428 726f 7720 666f 7220 726f 772c 2063  d(row for row, c
+0000a440: 6f6c 2069 6e20 7365 6c66 2e76 6973 6962  ol in self.visib
+0000a450: 6c65 5f6c 696e 655f 746f 5f72 6f77 5f63  le_line_to_row_c
+0000a460: 6f6c 2e76 616c 7565 7328 2929 0a0a 2020  ol.values())..  
+0000a470: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+0000a480: 6465 6620 696e 7075 745f 6c69 6e65 5f74  def input_line_t
+0000a490: 6f5f 7669 7369 626c 655f 6c69 6e65 2873  o_visible_line(s
+0000a4a0: 656c 6629 202d 3e20 4469 6374 5b69 6e74  elf) -> Dict[int
+0000a4b0: 2c20 696e 745d 3a0a 2020 2020 2020 2020  , int]:.        
+0000a4c0: 2222 220a 2020 2020 2020 2020 5265 7475  """.        Retu
+0000a4d0: 726e 2074 6865 2064 6963 7469 6f6e 6172  rn the dictionar
+0000a4e0: 7920 6d61 7070 696e 6720 7468 6520 6c69  y mapping the li
+0000a4f0: 6e65 206e 756d 6265 7273 206f 6620 7468  ne numbers of th
+0000a500: 6520 696e 7075 7420 6275 6666 6572 2074  e input buffer t
+0000a510: 6f0a 2020 2020 2020 2020 7468 6520 6c69  o.        the li
+0000a520: 6e65 7320 6f66 2074 6865 2073 6372 6565  nes of the scree
+0000a530: 6e2e 2057 6865 6e20 6120 6c69 6e65 2073  n. When a line s
+0000a540: 7061 6e73 2073 6576 6572 616c 2072 6f77  pans several row
+0000a550: 7320 6174 2074 6865 2073 6372 6565 6e2c  s at the screen,
+0000a560: 0a20 2020 2020 2020 2074 6865 2066 6972  .        the fir
+0000a570: 7374 2072 6f77 2061 7070 6561 7273 2069  st row appears i
+0000a580: 6e20 7468 6520 6469 6374 696f 6e61 7279  n the dictionary
+0000a590: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0000a5a0: 2020 2020 2020 7265 7375 6c74 3a20 4469        result: Di
+0000a5b0: 6374 5b69 6e74 2c20 696e 745d 203d 207b  ct[int, int] = {
+0000a5c0: 7d0a 2020 2020 2020 2020 666f 7220 6b2c  }.        for k,
+0000a5d0: 2076 2069 6e20 7365 6c66 2e76 6973 6962   v in self.visib
+0000a5e0: 6c65 5f6c 696e 655f 746f 5f69 6e70 7574  le_line_to_input
+0000a5f0: 5f6c 696e 652e 6974 656d 7328 293a 0a20  _line.items():. 
+0000a600: 2020 2020 2020 2020 2020 2069 6620 7620             if v 
+0000a610: 696e 2072 6573 756c 743a 0a20 2020 2020  in result:.     
+0000a620: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+0000a630: 745b 765d 203d 206d 696e 2872 6573 756c  t[v] = min(resul
+0000a640: 745b 765d 2c20 6b29 0a20 2020 2020 2020  t[v], k).       
+0000a650: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000a660: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+0000a670: 745b 765d 203d 206b 0a20 2020 2020 2020  t[v] = k.       
+0000a680: 2072 6574 7572 6e20 7265 7375 6c74 0a0a   return result..
+0000a690: 2020 2020 6465 6620 6669 7273 745f 7669      def first_vi
+0000a6a0: 7369 626c 655f 6c69 6e65 2873 656c 662c  sible_line(self,
+0000a6b0: 2061 6674 6572 5f73 6372 6f6c 6c5f 6f66   after_scroll_of
+0000a6c0: 6673 6574 3a20 626f 6f6c 203d 2046 616c  fset: bool = Fal
+0000a6d0: 7365 2920 2d3e 2069 6e74 3a0a 2020 2020  se) -> int:.    
+0000a6e0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000a6f0: 5265 7475 726e 2074 6865 206c 696e 6520  Return the line 
+0000a700: 6e75 6d62 6572 2028 3020 6261 7365 6429  number (0 based)
+0000a710: 206f 6620 7468 6520 696e 7075 7420 646f   of the input do
+0000a720: 6375 6d65 6e74 2074 6861 7420 636f 7272  cument that corr
+0000a730: 6573 706f 6e64 730a 2020 2020 2020 2020  esponds.        
+0000a740: 7769 7468 2074 6865 2066 6972 7374 2076  with the first v
+0000a750: 6973 6962 6c65 206c 696e 652e 0a20 2020  isible line..   
+0000a760: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000a770: 2069 6620 6166 7465 725f 7363 726f 6c6c   if after_scroll
+0000a780: 5f6f 6666 7365 743a 0a20 2020 2020 2020  _offset:.       
+0000a790: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000a7a0: 2e64 6973 706c 6179 6564 5f6c 696e 6573  .displayed_lines
+0000a7b0: 5b73 656c 662e 6170 706c 6965 645f 7363  [self.applied_sc
+0000a7c0: 726f 6c6c 5f6f 6666 7365 7473 2e74 6f70  roll_offsets.top
+0000a7d0: 5d0a 2020 2020 2020 2020 656c 7365 3a0a  ].        else:.
+0000a7e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000a7f0: 726e 2073 656c 662e 6469 7370 6c61 7965  rn self.displaye
+0000a800: 645f 6c69 6e65 735b 305d 0a0a 2020 2020  d_lines[0]..    
+0000a810: 6465 6620 6c61 7374 5f76 6973 6962 6c65  def last_visible
+0000a820: 5f6c 696e 6528 7365 6c66 2c20 6265 666f  _line(self, befo
+0000a830: 7265 5f73 6372 6f6c 6c5f 6f66 6673 6574  re_scroll_offset
+0000a840: 3a20 626f 6f6c 203d 2046 616c 7365 2920  : bool = False) 
+0000a850: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
+0000a860: 2222 220a 2020 2020 2020 2020 4c69 6b65  """.        Like
+0000a870: 2060 6669 7273 745f 7669 7369 626c 655f   `first_visible_
+0000a880: 6c69 6e65 602c 2062 7574 2066 6f72 2074  line`, but for t
+0000a890: 6865 206c 6173 7420 7669 7369 626c 6520  he last visible 
+0000a8a0: 6c69 6e65 2e0a 2020 2020 2020 2020 2222  line..        ""
+0000a8b0: 220a 2020 2020 2020 2020 6966 2062 6566  ".        if bef
+0000a8c0: 6f72 655f 7363 726f 6c6c 5f6f 6666 7365  ore_scroll_offse
+0000a8d0: 743a 0a20 2020 2020 2020 2020 2020 2072  t:.            r
+0000a8e0: 6574 7572 6e20 7365 6c66 2e64 6973 706c  eturn self.displ
+0000a8f0: 6179 6564 5f6c 696e 6573 5b2d 3120 2d20  ayed_lines[-1 - 
+0000a900: 7365 6c66 2e61 7070 6c69 6564 5f73 6372  self.applied_scr
+0000a910: 6f6c 6c5f 6f66 6673 6574 732e 626f 7474  oll_offsets.bott
+0000a920: 6f6d 5d0a 2020 2020 2020 2020 656c 7365  om].        else
+0000a930: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000a940: 7475 726e 2073 656c 662e 6469 7370 6c61  turn self.displa
+0000a950: 7965 645f 6c69 6e65 735b 2d31 5d0a 0a20  yed_lines[-1].. 
+0000a960: 2020 2064 6566 2063 656e 7465 725f 7669     def center_vi
+0000a970: 7369 626c 655f 6c69 6e65 280a 2020 2020  sible_line(.    
+0000a980: 2020 2020 7365 6c66 2c20 6265 666f 7265      self, before
+0000a990: 5f73 6372 6f6c 6c5f 6f66 6673 6574 3a20  _scroll_offset: 
+0000a9a0: 626f 6f6c 203d 2046 616c 7365 2c20 6166  bool = False, af
+0000a9b0: 7465 725f 7363 726f 6c6c 5f6f 6666 7365  ter_scroll_offse
+0000a9c0: 743a 2062 6f6f 6c20 3d20 4661 6c73 650a  t: bool = False.
+0000a9d0: 2020 2020 2920 2d3e 2069 6e74 3a0a 2020      ) -> int:.  
+0000a9e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000a9f0: 2020 4c69 6b65 2060 6669 7273 745f 7669    Like `first_vi
+0000aa00: 7369 626c 655f 6c69 6e65 602c 2062 7574  sible_line`, but
+0000aa10: 2066 6f72 2074 6865 2063 656e 7465 7220   for the center 
+0000aa20: 7669 7369 626c 6520 6c69 6e65 2e0a 2020  visible line..  
+0000aa30: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000aa40: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
+0000aa50: 2020 2020 2020 2073 656c 662e 6669 7273         self.firs
+0000aa60: 745f 7669 7369 626c 655f 6c69 6e65 2861  t_visible_line(a
+0000aa70: 6674 6572 5f73 6372 6f6c 6c5f 6f66 6673  fter_scroll_offs
+0000aa80: 6574 290a 2020 2020 2020 2020 2020 2020  et).            
+0000aa90: 2b20 280a 2020 2020 2020 2020 2020 2020  + (.            
+0000aaa0: 2020 2020 7365 6c66 2e6c 6173 745f 7669      self.last_vi
+0000aab0: 7369 626c 655f 6c69 6e65 2862 6566 6f72  sible_line(befor
+0000aac0: 655f 7363 726f 6c6c 5f6f 6666 7365 7429  e_scroll_offset)
+0000aad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000aae0: 202d 2073 656c 662e 6669 7273 745f 7669   - self.first_vi
+0000aaf0: 7369 626c 655f 6c69 6e65 2861 6674 6572  sible_line(after
+0000ab00: 5f73 6372 6f6c 6c5f 6f66 6673 6574 290a  _scroll_offset).
+0000ab10: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000ab20: 2020 2020 2020 2020 2020 2f2f 2032 0a20            // 2. 
+0000ab30: 2020 2020 2020 2029 0a0a 2020 2020 4070         )..    @p
+0000ab40: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+0000ab50: 636f 6e74 656e 745f 6865 6967 6874 2873  content_height(s
+0000ab60: 656c 6629 202d 3e20 696e 743a 0a20 2020  elf) -> int:.   
+0000ab70: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000ab80: 2054 6865 2066 756c 6c20 6865 6967 6874   The full height
+0000ab90: 206f 6620 7468 6520 7573 6572 2063 6f6e   of the user con
+0000aba0: 7472 6f6c 2e0a 2020 2020 2020 2020 2222  trol..        ""
+0000abb0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+0000abc0: 2073 656c 662e 7569 5f63 6f6e 7465 6e74   self.ui_content
+0000abd0: 2e6c 696e 655f 636f 756e 740a 0a20 2020  .line_count..   
+0000abe0: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+0000abf0: 6566 2066 756c 6c5f 6865 6967 6874 5f76  ef full_height_v
+0000ac00: 6973 6962 6c65 2873 656c 6629 202d 3e20  isible(self) -> 
+0000ac10: 626f 6f6c 3a0a 2020 2020 2020 2020 2222  bool:.        ""
+0000ac20: 220a 2020 2020 2020 2020 5472 7565 2077  ".        True w
+0000ac30: 6865 6e20 7468 6520 6675 6c6c 2068 6569  hen the full hei
+0000ac40: 6768 7420 6973 2076 6973 6962 6c65 2028  ght is visible (
+0000ac50: 5468 6572 6520 6973 206e 6f20 7665 7274  There is no vert
+0000ac60: 6963 616c 2073 6372 6f6c 6c2e 290a 2020  ical scroll.).  
+0000ac70: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000ac80: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
+0000ac90: 2020 2020 2020 2073 656c 662e 7665 7274         self.vert
+0000aca0: 6963 616c 5f73 6372 6f6c 6c20 3d3d 2030  ical_scroll == 0
+0000acb0: 0a20 2020 2020 2020 2020 2020 2061 6e64  .            and
+0000acc0: 2073 656c 662e 6c61 7374 5f76 6973 6962   self.last_visib
+0000acd0: 6c65 5f6c 696e 6528 2920 3d3d 2073 656c  le_line() == sel
+0000ace0: 662e 636f 6e74 656e 745f 6865 6967 6874  f.content_height
+0000acf0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0000ad00: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+0000ad10: 6620 746f 705f 7669 7369 626c 6528 7365  f top_visible(se
+0000ad20: 6c66 2920 2d3e 2062 6f6f 6c3a 0a20 2020  lf) -> bool:.   
+0000ad30: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000ad40: 2054 7275 6520 7768 656e 2074 6865 2074   True when the t
+0000ad50: 6f70 206f 6620 7468 6520 6275 6666 6572  op of the buffer
+0000ad60: 2069 7320 7669 7369 626c 652e 0a20 2020   is visible..   
+0000ad70: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000ad80: 2072 6574 7572 6e20 7365 6c66 2e76 6572   return self.ver
+0000ad90: 7469 6361 6c5f 7363 726f 6c6c 203d 3d20  tical_scroll == 
+0000ada0: 300a 0a20 2020 2040 7072 6f70 6572 7479  0..    @property
+0000adb0: 0a20 2020 2064 6566 2062 6f74 746f 6d5f  .    def bottom_
+0000adc0: 7669 7369 626c 6528 7365 6c66 2920 2d3e  visible(self) ->
+0000add0: 2062 6f6f 6c3a 0a20 2020 2020 2020 2022   bool:.        "
+0000ade0: 2222 0a20 2020 2020 2020 2054 7275 6520  "".        True 
+0000adf0: 7768 656e 2074 6865 2062 6f74 746f 6d20  when the bottom 
+0000ae00: 6f66 2074 6865 2062 7566 6665 7220 6973  of the buffer is
+0000ae10: 2076 6973 6962 6c65 2e0a 2020 2020 2020   visible..      
+0000ae20: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+0000ae30: 7475 726e 2073 656c 662e 6c61 7374 5f76  turn self.last_v
+0000ae40: 6973 6962 6c65 5f6c 696e 6528 2920 3d3d  isible_line() ==
+0000ae50: 2073 656c 662e 636f 6e74 656e 745f 6865   self.content_he
+0000ae60: 6967 6874 202d 2031 0a0a 2020 2020 4070  ight - 1..    @p
+0000ae70: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+0000ae80: 7665 7274 6963 616c 5f73 6372 6f6c 6c5f  vertical_scroll_
+0000ae90: 7065 7263 656e 7461 6765 2873 656c 6629  percentage(self)
+0000aea0: 202d 3e20 696e 743a 0a20 2020 2020 2020   -> int:.       
+0000aeb0: 2022 2222 0a20 2020 2020 2020 2056 6572   """.        Ver
+0000aec0: 7469 6361 6c20 7363 726f 6c6c 2061 7320  tical scroll as 
+0000aed0: 6120 7065 7263 656e 7461 6765 2e20 2830  a percentage. (0
+0000aee0: 206d 6561 6e73 3a20 7468 6520 746f 7020   means: the top 
+0000aef0: 6973 2076 6973 6962 6c65 2c0a 2020 2020  is visible,.    
+0000af00: 2020 2020 3130 3020 6d65 616e 733a 2074      100 means: t
+0000af10: 6865 2062 6f74 746f 6d20 6973 2076 6973  he bottom is vis
+0000af20: 6962 6c65 2e29 0a20 2020 2020 2020 2022  ible.).        "
+0000af30: 2222 0a20 2020 2020 2020 2069 6620 7365  "".        if se
+0000af40: 6c66 2e62 6f74 746f 6d5f 7669 7369 626c  lf.bottom_visibl
+0000af50: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000af60: 6574 7572 6e20 3130 300a 2020 2020 2020  eturn 100.      
+0000af70: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000af80: 2020 2020 7265 7475 726e 2031 3030 202a      return 100 *
+0000af90: 2073 656c 662e 7665 7274 6963 616c 5f73   self.vertical_s
+0000afa0: 6372 6f6c 6c20 2f2f 2073 656c 662e 636f  croll // self.co
+0000afb0: 6e74 656e 745f 6865 6967 6874 0a0a 2020  ntent_height..  
+0000afc0: 2020 6465 6620 6765 745f 6865 6967 6874    def get_height
+0000afd0: 5f66 6f72 5f6c 696e 6528 7365 6c66 2c20  _for_line(self, 
+0000afe0: 6c69 6e65 6e6f 3a20 696e 7429 202d 3e20  lineno: int) -> 
+0000aff0: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
+0000b000: 0a20 2020 2020 2020 2052 6574 7572 6e20  .        Return 
+0000b010: 7468 6520 6865 6967 6874 206f 6620 7468  the height of th
+0000b020: 6520 6769 7665 6e20 6c69 6e65 2e0a 2020  e given line..  
+0000b030: 2020 2020 2020 2854 6865 2068 6569 6768        (The heigh
+0000b040: 7420 7468 6174 2069 7420 776f 756c 6420  t that it would 
+0000b050: 7461 6b65 2c20 6966 2074 6869 7320 6c69  take, if this li
+0000b060: 6e65 2062 6563 616d 6520 7669 7369 626c  ne became visibl
+0000b070: 652e 290a 2020 2020 2020 2020 2222 220a  e.).        """.
+0000b080: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000b090: 7772 6170 5f6c 696e 6573 3a0a 2020 2020  wrap_lines:.    
+0000b0a0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000b0b0: 656c 662e 7569 5f63 6f6e 7465 6e74 2e67  elf.ui_content.g
+0000b0c0: 6574 5f68 6569 6768 745f 666f 725f 6c69  et_height_for_li
+0000b0d0: 6e65 280a 2020 2020 2020 2020 2020 2020  ne(.            
+0000b0e0: 2020 2020 6c69 6e65 6e6f 2c20 7365 6c66      lineno, self
+0000b0f0: 2e77 696e 646f 775f 7769 6474 682c 2073  .window_width, s
+0000b100: 656c 662e 7769 6e64 6f77 2e67 6574 5f6c  elf.window.get_l
+0000b110: 696e 655f 7072 6566 6978 0a20 2020 2020  ine_prefix.     
+0000b120: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000b130: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000b140: 2020 2072 6574 7572 6e20 310a 0a0a 636c     return 1...cl
+0000b150: 6173 7320 5363 726f 6c6c 4f66 6673 6574  ass ScrollOffset
+0000b160: 733a 0a20 2020 2022 2222 0a20 2020 2053  s:.    """.    S
+0000b170: 6372 6f6c 6c20 6f66 6673 6574 7320 666f  croll offsets fo
+0000b180: 7220 7468 6520 3a63 6c61 7373 3a60 2e57  r the :class:`.W
+0000b190: 696e 646f 7760 2063 6c61 7373 2e0a 0a20  indow` class... 
+0000b1a0: 2020 204e 6f74 6520 7468 6174 206c 6566     Note that lef
+0000b1b0: 742f 7269 6768 7420 6f66 6673 6574 7320  t/right offsets 
+0000b1c0: 6f6e 6c79 206d 616b 6520 7365 6e73 6520  only make sense 
+0000b1d0: 6966 206c 696e 6520 7772 6170 7069 6e67  if line wrapping
+0000b1e0: 2069 7320 6469 7361 626c 6564 2e0a 2020   is disabled..  
+0000b1f0: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+0000b200: 5f69 6e69 745f 5f28 0a20 2020 2020 2020  _init__(.       
+0000b210: 2073 656c 662c 0a20 2020 2020 2020 2074   self,.        t
+0000b220: 6f70 3a20 556e 696f 6e5b 696e 742c 2043  op: Union[int, C
+0000b230: 616c 6c61 626c 655b 5b5d 2c20 696e 745d  allable[[], int]
+0000b240: 5d20 3d20 302c 0a20 2020 2020 2020 2062  ] = 0,.        b
+0000b250: 6f74 746f 6d3a 2055 6e69 6f6e 5b69 6e74  ottom: Union[int
+0000b260: 2c20 4361 6c6c 6162 6c65 5b5b 5d2c 2069  , Callable[[], i
+0000b270: 6e74 5d5d 203d 2030 2c0a 2020 2020 2020  nt]] = 0,.      
+0000b280: 2020 6c65 6674 3a20 556e 696f 6e5b 696e    left: Union[in
+0000b290: 742c 2043 616c 6c61 626c 655b 5b5d 2c20  t, Callable[[], 
+0000b2a0: 696e 745d 5d20 3d20 302c 0a20 2020 2020  int]] = 0,.     
+0000b2b0: 2020 2072 6967 6874 3a20 556e 696f 6e5b     right: Union[
+0000b2c0: 696e 742c 2043 616c 6c61 626c 655b 5b5d  int, Callable[[]
+0000b2d0: 2c20 696e 745d 5d20 3d20 302c 0a20 2020  , int]] = 0,.   
+0000b2e0: 2029 202d 3e20 4e6f 6e65 3a0a 0a20 2020   ) -> None:..   
+0000b2f0: 2020 2020 2073 656c 662e 5f74 6f70 203d       self._top =
+0000b300: 2074 6f70 0a20 2020 2020 2020 2073 656c   top.        sel
+0000b310: 662e 5f62 6f74 746f 6d20 3d20 626f 7474  f._bottom = bott
+0000b320: 6f6d 0a20 2020 2020 2020 2073 656c 662e  om.        self.
+0000b330: 5f6c 6566 7420 3d20 6c65 6674 0a20 2020  _left = left.   
+0000b340: 2020 2020 2073 656c 662e 5f72 6967 6874       self._right
+0000b350: 203d 2072 6967 6874 0a0a 2020 2020 4070   = right..    @p
+0000b360: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+0000b370: 746f 7028 7365 6c66 2920 2d3e 2069 6e74  top(self) -> int
+0000b380: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000b390: 2074 6f5f 696e 7428 7365 6c66 2e5f 746f   to_int(self._to
+0000b3a0: 7029 0a0a 2020 2020 4070 726f 7065 7274  p)..    @propert
+0000b3b0: 790a 2020 2020 6465 6620 626f 7474 6f6d  y.    def bottom
+0000b3c0: 2873 656c 6629 202d 3e20 696e 743a 0a20  (self) -> int:. 
+0000b3d0: 2020 2020 2020 2072 6574 7572 6e20 746f         return to
+0000b3e0: 5f69 6e74 2873 656c 662e 5f62 6f74 746f  _int(self._botto
+0000b3f0: 6d29 0a0a 2020 2020 4070 726f 7065 7274  m)..    @propert
+0000b400: 790a 2020 2020 6465 6620 6c65 6674 2873  y.    def left(s
+0000b410: 656c 6629 202d 3e20 696e 743a 0a20 2020  elf) -> int:.   
+0000b420: 2020 2020 2072 6574 7572 6e20 746f 5f69       return to_i
+0000b430: 6e74 2873 656c 662e 5f6c 6566 7429 0a0a  nt(self._left)..
+0000b440: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+0000b450: 2020 6465 6620 7269 6768 7428 7365 6c66    def right(self
+0000b460: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
+0000b470: 2020 7265 7475 726e 2074 6f5f 696e 7428    return to_int(
+0000b480: 7365 6c66 2e5f 7269 6768 7429 0a0a 2020  self._right)..  
+0000b490: 2020 6465 6620 5f5f 7265 7072 5f5f 2873    def __repr__(s
+0000b4a0: 656c 6629 202d 3e20 7374 723a 0a20 2020  elf) -> str:.   
+0000b4b0: 2020 2020 2072 6574 7572 6e20 2253 6372       return "Scr
+0000b4c0: 6f6c 6c4f 6666 7365 7473 2874 6f70 3d25  ollOffsets(top=%
+0000b4d0: 722c 2062 6f74 746f 6d3d 2572 2c20 6c65  r, bottom=%r, le
+0000b4e0: 6674 3d25 722c 2072 6967 6874 3d25 7229  ft=%r, right=%r)
+0000b4f0: 2220 2520 280a 2020 2020 2020 2020 2020  " % (.          
+0000b500: 2020 7365 6c66 2e5f 746f 702c 0a20 2020    self._top,.   
+0000b510: 2020 2020 2020 2020 2073 656c 662e 5f62           self._b
+0000b520: 6f74 746f 6d2c 0a20 2020 2020 2020 2020  ottom,.         
+0000b530: 2020 2073 656c 662e 5f6c 6566 742c 0a20     self._left,. 
+0000b540: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000b550: 5f72 6967 6874 2c0a 2020 2020 2020 2020  _right,.        
+0000b560: 290a 0a0a 636c 6173 7320 436f 6c6f 7243  )...class ColorC
+0000b570: 6f6c 756d 6e3a 0a20 2020 2022 2222 0a20  olumn:.    """. 
+0000b580: 2020 2043 6f6c 756d 6e20 666f 7220 6120     Column for a 
+0000b590: 3a63 6c61 7373 3a60 2e57 696e 646f 7760  :class:`.Window`
+0000b5a0: 2074 6f20 6265 2063 6f6c 6f72 6564 2e0a   to be colored..
+0000b5b0: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
+0000b5c0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+0000b5d0: 706f 7369 7469 6f6e 3a20 696e 742c 2073  position: int, s
+0000b5e0: 7479 6c65 3a20 7374 7220 3d20 2263 6c61  tyle: str = "cla
+0000b5f0: 7373 3a63 6f6c 6f72 2d63 6f6c 756d 6e22  ss:color-column"
+0000b600: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000b610: 2020 2073 656c 662e 706f 7369 7469 6f6e     self.position
+0000b620: 203d 2070 6f73 6974 696f 6e0a 2020 2020   = position.    
+0000b630: 2020 2020 7365 6c66 2e73 7479 6c65 203d      self.style =
+0000b640: 2073 7479 6c65 0a0a 0a5f 696e 5f69 6e73   style..._in_ins
+0000b650: 6572 745f 6d6f 6465 203d 2076 695f 696e  ert_mode = vi_in
+0000b660: 7365 7274 5f6d 6f64 6520 7c20 656d 6163  sert_mode | emac
+0000b670: 735f 696e 7365 7274 5f6d 6f64 650a 0a0a  s_insert_mode...
+0000b680: 636c 6173 7320 5769 6e64 6f77 416c 6967  class WindowAlig
+0000b690: 6e28 456e 756d 293a 0a20 2020 2022 2222  n(Enum):.    """
+0000b6a0: 0a20 2020 2041 6c69 676e 6d65 6e74 206f  .    Alignment o
+0000b6b0: 6620 7468 6520 5769 6e64 6f77 2063 6f6e  f the Window con
+0000b6c0: 7465 6e74 2e0a 0a20 2020 204e 6f74 6520  tent...    Note 
+0000b6d0: 7468 6174 2074 6869 7320 6973 2064 6966  that this is dif
+0000b6e0: 6665 7265 6e74 2066 726f 6d20 6048 6f72  ferent from `Hor
+0000b6f0: 697a 6f6e 7461 6c41 6c69 676e 6020 616e  izontalAlign` an
+0000b700: 6420 6056 6572 7469 6361 6c41 6c69 676e  d `VerticalAlign
+0000b710: 602c 0a20 2020 2077 6869 6368 2061 7265  `,.    which are
+0000b720: 2075 7365 6420 666f 7220 7468 6520 616c   used for the al
+0000b730: 6967 6e6d 656e 7420 6f66 2074 6865 2063  ignment of the c
+0000b740: 6869 6c64 2063 6f6e 7461 696e 6572 7320  hild containers 
+0000b750: 696e 2072 6573 7065 6374 6976 656c 790a  in respectively.
+0000b760: 2020 2020 6056 5370 6c69 7460 2061 6e64      `VSplit` and
+0000b770: 2060 4853 706c 6974 602e 0a20 2020 2022   `HSplit`..    "
+0000b780: 2222 0a0a 2020 2020 4c45 4654 203d 2022  ""..    LEFT = "
+0000b790: 4c45 4654 220a 2020 2020 5249 4748 5420  LEFT".    RIGHT 
+0000b7a0: 3d20 2252 4947 4854 220a 2020 2020 4345  = "RIGHT".    CE
+0000b7b0: 4e54 4552 203d 2022 4345 4e54 4552 220a  NTER = "CENTER".
+0000b7c0: 0a0a 636c 6173 7320 5769 6e64 6f77 2843  ..class Window(C
+0000b7d0: 6f6e 7461 696e 6572 293a 0a20 2020 2022  ontainer):.    "
+0000b7e0: 2222 0a20 2020 2043 6f6e 7461 696e 6572  "".    Container
+0000b7f0: 2074 6861 7420 686f 6c64 7320 6120 636f   that holds a co
+0000b800: 6e74 726f 6c2e 0a0a 2020 2020 3a70 6172  ntrol...    :par
+0000b810: 616d 2063 6f6e 7465 6e74 3a20 3a63 6c61  am content: :cla
+0000b820: 7373 3a60 2e55 4943 6f6e 7472 6f6c 6020  ss:`.UIControl` 
+0000b830: 696e 7374 616e 6365 2e0a 2020 2020 3a70  instance..    :p
+0000b840: 6172 616d 2077 6964 7468 3a20 3a63 6c61  aram width: :cla
+0000b850: 7373 3a60 2e44 696d 656e 7369 6f6e 6020  ss:`.Dimension` 
+0000b860: 696e 7374 616e 6365 206f 7220 6361 6c6c  instance or call
+0000b870: 6162 6c65 2e0a 2020 2020 3a70 6172 616d  able..    :param
+0000b880: 2068 6569 6768 743a 203a 636c 6173 733a   height: :class:
+0000b890: 602e 4469 6d65 6e73 696f 6e60 2069 6e73  `.Dimension` ins
+0000b8a0: 7461 6e63 6520 6f72 2063 616c 6c61 626c  tance or callabl
+0000b8b0: 652e 0a20 2020 203a 7061 7261 6d20 7a5f  e..    :param z_
+0000b8c0: 696e 6465 783a 2057 6865 6e20 7370 6563  index: When spec
+0000b8d0: 6966 6965 642c 2074 6869 7320 6361 6e20  ified, this can 
+0000b8e0: 6265 2075 7365 6420 746f 2062 7269 6e67  be used to bring
+0000b8f0: 2065 6c65 6d65 6e74 2069 6e20 6672 6f6e   element in fron
+0000b900: 740a 2020 2020 2020 2020 6f66 2066 6c6f  t.        of flo
+0000b910: 6174 696e 6720 656c 656d 656e 7473 2e0a  ating elements..
+0000b920: 2020 2020 3a70 6172 616d 2066 6978 6564      :param fixed
+0000b930: 5f77 6964 7468 3a20 5768 656e 2060 5472  _width: When `Tr
+0000b940: 7565 602c 2064 6f6e 2774 2074 616b 6520  ue`, don't take 
+0000b950: 7570 206d 6f72 6520 7769 6474 6820 7468  up more width th
+0000b960: 656e 2074 6865 0a20 2020 2020 2020 2020  en the.         
+0000b970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b980: 2020 2020 2070 7265 6665 7272 6564 2077       preferred w
+0000b990: 6964 7468 2072 6570 6f72 7465 6420 6279  idth reported by
+0000b9a0: 2074 6865 2063 6f6e 7472 6f6c 2e0a 2020   the control..  
+0000b9b0: 2020 3a70 6172 616d 2066 6978 6564 5f68    :param fixed_h
+0000b9c0: 6569 6768 743a 2057 6865 6e20 6054 7275  eight: When `Tru
+0000b9d0: 6560 2c20 646f 6e27 7420 7461 6b65 2075  e`, don't take u
+0000b9e0: 7020 6d6f 7265 2077 6964 7468 2074 6865  p more width the
+0000b9f0: 6e20 7468 650a 2020 2020 2020 2020 2020  n the.          
+0000ba00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba10: 2020 2020 2070 7265 6665 7272 6564 2068       preferred h
+0000ba20: 6569 6768 7420 7265 706f 7274 6564 2062  eight reported b
+0000ba30: 7920 7468 6520 636f 6e74 726f 6c2e 0a20  y the control.. 
+0000ba40: 2020 203a 7061 7261 6d20 6967 6e6f 7265     :param ignore
+0000ba50: 5f63 6f6e 7465 6e74 5f77 6964 7468 3a20  _content_width: 
+0000ba60: 4120 6062 6f6f 6c60 206f 7220 3a63 6c61  A `bool` or :cla
+0000ba70: 7373 3a60 2e46 696c 7465 7260 2069 6e73  ss:`.Filter` ins
+0000ba80: 7461 6e63 652e 2049 676e 6f72 650a 2020  tance. Ignore.  
+0000ba90: 2020 2020 2020 7468 6520 3a63 6c61 7373        the :class
+0000baa0: 3a60 2e55 4943 6f6e 7465 6e74 6020 7769  :`.UIContent` wi
+0000bab0: 6474 6820 7768 656e 2063 616c 6375 6c61  dth when calcula
+0000bac0: 7469 6e67 2074 6865 2064 696d 656e 7369  ting the dimensi
+0000bad0: 6f6e 732e 0a20 2020 203a 7061 7261 6d20  ons..    :param 
+0000bae0: 6967 6e6f 7265 5f63 6f6e 7465 6e74 5f68  ignore_content_h
+0000baf0: 6569 6768 743a 2041 2060 626f 6f6c 6020  eight: A `bool` 
+0000bb00: 6f72 203a 636c 6173 733a 602e 4669 6c74  or :class:`.Filt
+0000bb10: 6572 6020 696e 7374 616e 6365 2e20 4967  er` instance. Ig
+0000bb20: 6e6f 7265 0a20 2020 2020 2020 2074 6865  nore.        the
+0000bb30: 203a 636c 6173 733a 602e 5549 436f 6e74   :class:`.UICont
+0000bb40: 656e 7460 2068 6569 6768 7420 7768 656e  ent` height when
+0000bb50: 2063 616c 6375 6c61 7469 6e67 2074 6865   calculating the
+0000bb60: 2064 696d 656e 7369 6f6e 732e 0a20 2020   dimensions..   
+0000bb70: 203a 7061 7261 6d20 6c65 6674 5f6d 6172   :param left_mar
+0000bb80: 6769 6e73 3a20 4120 6c69 7374 206f 6620  gins: A list of 
+0000bb90: 3a63 6c61 7373 3a60 2e4d 6172 6769 6e60  :class:`.Margin`
+0000bba0: 2069 6e73 7461 6e63 6520 746f 2062 6520   instance to be 
+0000bbb0: 6469 7370 6c61 7965 6420 6f6e 0a20 2020  displayed on.   
+0000bbc0: 2020 2020 2074 6865 206c 6566 742e 2046       the left. F
+0000bbd0: 6f72 2069 6e73 7461 6e63 653a 203a 636c  or instance: :cl
+0000bbe0: 6173 733a 607e 7175 6f2e 6c61 796f 7574  ass:`~quo.layout
+0000bbf0: 2e4e 756d 6265 7265 644d 6172 6769 6e60  .NumberedMargin`
+0000bc00: 0a20 2020 2020 2020 2063 616e 2062 6520  .        can be 
+0000bc10: 6f6e 6520 6f66 2074 6865 6d20 696e 206f  one of them in o
+0000bc20: 7264 6572 2074 6f20 7368 6f77 206c 696e  rder to show lin
+0000bc30: 6520 6e75 6d62 6572 732e 0a20 2020 203a  e numbers..    :
+0000bc40: 7061 7261 6d20 7269 6768 745f 6d61 7267  param right_marg
+0000bc50: 696e 733a 204c 696b 6520 606c 6566 745f  ins: Like `left_
+0000bc60: 6d61 7267 696e 7360 2c20 6275 7420 6f6e  margins`, but on
+0000bc70: 2074 6865 206f 7468 6572 2073 6964 652e   the other side.
+0000bc80: 0a20 2020 203a 7061 7261 6d20 7363 726f  .    :param scro
+0000bc90: 6c6c 5f6f 6666 7365 7473 3a20 3a63 6c61  ll_offsets: :cla
+0000bca0: 7373 3a60 2e53 6372 6f6c 6c4f 6666 7365  ss:`.ScrollOffse
+0000bcb0: 7473 6020 696e 7374 616e 6365 2c20 7265  ts` instance, re
+0000bcc0: 7072 6573 656e 7469 6e67 2074 6865 0a20  presenting the. 
+0000bcd0: 2020 2020 2020 2070 7265 6665 7272 6564         preferred
+0000bce0: 2061 6d6f 756e 7420 6f66 206c 696e 6573   amount of lines
+0000bcf0: 2f63 6f6c 756d 6e73 2074 6f20 6265 2061  /columns to be a
+0000bd00: 6c77 6179 7320 7669 7369 626c 6520 6265  lways visible be
+0000bd10: 666f 7265 2f61 6674 6572 2074 6865 0a20  fore/after the. 
+0000bd20: 2020 2020 2020 2063 7572 736f 722e 2057         cursor. W
+0000bd30: 6865 6e20 626f 7468 2074 6f70 2061 6e64  hen both top and
+0000bd40: 2062 6f74 746f 6d20 6172 6520 6120 7665   bottom are a ve
+0000bd50: 7279 2068 6967 6820 6e75 6d62 6572 2c20  ry high number, 
+0000bd60: 7468 6520 6375 7273 6f72 0a20 2020 2020  the cursor.     
+0000bd70: 2020 2077 696c 6c20 6265 2063 656e 7465     will be cente
+0000bd80: 7265 6420 7665 7274 6963 616c 6c79 206d  red vertically m
+0000bd90: 6f73 7420 6f66 2074 6865 2074 696d 652e  ost of the time.
+0000bda0: 0a20 2020 203a 7061 7261 6d20 616c 6c6f  .    :param allo
+0000bdb0: 775f 7363 726f 6c6c 5f62 6579 6f6e 645f  w_scroll_beyond_
+0000bdc0: 626f 7474 6f6d 3a20 4120 6062 6f6f 6c60  bottom: A `bool`
+0000bdd0: 206f 720a 2020 2020 2020 2020 3a63 6c61   or.        :cla
+0000bde0: 7373 3a60 2e46 696c 7465 7260 2069 6e73  ss:`.Filter` ins
+0000bdf0: 7461 6e63 652e 2057 6865 6e20 5472 7565  tance. When True
+0000be00: 2c20 616c 6c6f 7720 7363 726f 6c6c 696e  , allow scrollin
+0000be10: 6720 736f 2066 6172 2c20 7468 6174 2074  g so far, that t
+0000be20: 6865 0a20 2020 2020 2020 2074 6f70 2070  he.        top p
+0000be30: 6172 7420 6f66 2074 6865 2063 6f6e 7465  art of the conte
+0000be40: 6e74 2069 7320 6e6f 7420 7669 7369 626c  nt is not visibl
+0000be50: 6520 616e 796d 6f72 652c 2077 6869 6c65  e anymore, while
+0000be60: 2074 6865 7265 2069 7320 7374 696c 6c0a   there is still.
+0000be70: 2020 2020 2020 2020 656d 7074 7920 7370          empty sp
+0000be80: 6163 6520 6176 6169 6c61 626c 6520 6174  ace available at
+0000be90: 2074 6865 2062 6f74 746f 6d20 6f66 2074   the bottom of t
+0000bea0: 6865 2077 696e 646f 772e 2049 6e20 7468  he window. In th
+0000beb0: 6520 5669 2065 6469 746f 7220 666f 720a  e Vi editor for.
+0000bec0: 2020 2020 2020 2020 696e 7374 616e 6365          instance
+0000bed0: 2c20 7468 6973 2069 7320 706f 7373 6962  , this is possib
+0000bee0: 6c65 2e20 596f 7520 7769 6c6c 2073 6565  le. You will see
+0000bef0: 2074 696c 6465 7320 7768 696c 6520 7468   tildes while th
+0000bf00: 6520 746f 7020 7061 7274 206f 660a 2020  e top part of.  
+0000bf10: 2020 2020 2020 7468 6520 626f 6479 2069        the body i
+0000bf20: 7320 6869 6464 656e 2e0a 2020 2020 3a70  s hidden..    :p
+0000bf30: 6172 616d 2077 7261 705f 6c69 6e65 733a  aram wrap_lines:
+0000bf40: 2041 2060 626f 6f6c 6020 6f72 203a 636c   A `bool` or :cl
+0000bf50: 6173 733a 602e 4669 6c74 6572 6020 696e  ass:`.Filter` in
+0000bf60: 7374 616e 6365 2e20 5768 656e 2054 7275  stance. When Tru
+0000bf70: 652c 2064 6f6e 2774 0a20 2020 2020 2020  e, don't.       
+0000bf80: 2073 6372 6f6c 6c20 686f 7269 7a6f 6e74   scroll horizont
+0000bf90: 616c 6c79 2c20 6275 7420 7772 6170 206c  ally, but wrap l
+0000bfa0: 696e 6573 2069 6e73 7465 6164 2e0a 2020  ines instead..  
+0000bfb0: 2020 3a70 6172 616d 2067 6574 5f76 6572    :param get_ver
+0000bfc0: 7469 6361 6c5f 7363 726f 6c6c 3a20 4361  tical_scroll: Ca
+0000bfd0: 6c6c 6162 6c65 2074 6861 7420 7461 6b65  llable that take
+0000bfe0: 7320 7468 6973 2077 696e 646f 770a 2020  s this window.  
+0000bff0: 2020 2020 2020 696e 7374 616e 6365 2061        instance a
+0000c000: 7320 696e 7075 7420 616e 6420 7265 7475  s input and retu
+0000c010: 726e 7320 6120 7072 6566 6572 7265 6420  rns a preferred 
+0000c020: 7665 7274 6963 616c 2073 6372 6f6c 6c2e  vertical scroll.
+0000c030: 0a20 2020 2020 2020 2028 5768 656e 2074  .        (When t
+0000c040: 6869 7320 6973 2060 4e6f 6e65 602c 2074  his is `None`, t
+0000c050: 6865 2073 6372 6f6c 6c20 6973 206f 6e6c  he scroll is onl
+0000c060: 7920 6465 7465 726d 696e 6564 2062 7920  y determined by 
+0000c070: 7468 6520 6c61 7374 2061 6e64 0a20 2020  the last and.   
+0000c080: 2020 2020 2063 7572 7265 6e74 2063 7572       current cur
+0000c090: 736f 7220 706f 7369 7469 6f6e 2e29 0a20  sor position.). 
+0000c0a0: 2020 203a 7061 7261 6d20 6765 745f 686f     :param get_ho
+0000c0b0: 7269 7a6f 6e74 616c 5f73 6372 6f6c 6c3a  rizontal_scroll:
+0000c0c0: 2043 616c 6c61 626c 6520 7468 6174 2074   Callable that t
+0000c0d0: 616b 6573 2074 6869 7320 7769 6e64 6f77  akes this window
+0000c0e0: 0a20 2020 2020 2020 2069 6e73 7461 6e63  .        instanc
+0000c0f0: 6520 6173 2069 6e70 7574 2061 6e64 2072  e as input and r
+0000c100: 6574 7572 6e73 2061 2070 7265 6665 7272  eturns a preferr
+0000c110: 6564 2076 6572 7469 6361 6c20 7363 726f  ed vertical scro
+0000c120: 6c6c 2e0a 2020 2020 3a70 6172 616d 2061  ll..    :param a
+0000c130: 6c77 6179 735f 6869 6465 5f63 7572 736f  lways_hide_curso
+0000c140: 723a 2041 2060 626f 6f6c 6020 6f72 0a20  r: A `bool` or. 
+0000c150: 2020 2020 2020 203a 636c 6173 733a 602e         :class:`.
+0000c160: 4669 6c74 6572 6020 696e 7374 616e 6365  Filter` instance
+0000c170: 2e20 5768 656e 2054 7275 652c 206e 6576  . When True, nev
+0000c180: 6572 2064 6973 706c 6179 2074 6865 2063  er display the c
+0000c190: 7572 736f 722c 2065 7665 6e0a 2020 2020  ursor, even.    
+0000c1a0: 2020 2020 7768 656e 2074 6865 2075 7365      when the use
+0000c1b0: 7220 636f 6e74 726f 6c20 7370 6563 6966  r control specif
+0000c1c0: 6965 7320 6120 6375 7273 6f72 2070 6f73  ies a cursor pos
+0000c1d0: 6974 696f 6e2e 0a20 2020 203a 7061 7261  ition..    :para
+0000c1e0: 6d20 6375 7273 6f72 6c69 6e65 3a20 4120  m cursorline: A 
+0000c1f0: 6062 6f6f 6c60 206f 7220 3a63 6c61 7373  `bool` or :class
+0000c200: 3a60 2e46 696c 7465 7260 2069 6e73 7461  :`.Filter` insta
+0000c210: 6e63 652e 2057 6865 6e20 5472 7565 2c0a  nce. When True,.
+0000c220: 2020 2020 2020 2020 6469 7370 6c61 7920          display 
+0000c230: 6120 6375 7273 6f72 6c69 6e65 2e0a 2020  a cursorline..  
+0000c240: 2020 3a70 6172 616d 2063 7572 736f 7263    :param cursorc
+0000c250: 6f6c 756d 6e3a 2041 2060 626f 6f6c 6020  olumn: A `bool` 
+0000c260: 6f72 203a 636c 6173 733a 602e 4669 6c74  or :class:`.Filt
+0000c270: 6572 6020 696e 7374 616e 6365 2e20 5768  er` instance. Wh
+0000c280: 656e 2054 7275 652c 0a20 2020 2020 2020  en True,.       
+0000c290: 2064 6973 706c 6179 2061 2063 7572 736f   display a curso
+0000c2a0: 7263 6f6c 756d 6e2e 0a20 2020 203a 7061  rcolumn..    :pa
+0000c2b0: 7261 6d20 636f 6c6f 7263 6f6c 756d 6e73  ram colorcolumns
+0000c2c0: 3a20 4120 6c69 7374 206f 6620 3a63 6c61  : A list of :cla
+0000c2d0: 7373 3a60 2e43 6f6c 6f72 436f 6c75 6d6e  ss:`.ColorColumn
+0000c2e0: 6020 696e 7374 616e 6365 7320 7468 6174  ` instances that
+0000c2f0: 0a20 2020 2020 2020 2064 6573 6372 6962  .        describ
+0000c300: 6520 7468 6520 636f 6c75 6d6e 7320 746f  e the columns to
+0000c310: 2062 6520 6869 6768 6c69 6768 7465 642c   be highlighted,
+0000c320: 206f 7220 6120 6361 6c6c 6162 6c65 2074   or a callable t
+0000c330: 6861 7420 7265 7475 726e 7320 7375 6368  hat returns such
+0000c340: 0a20 2020 2020 2020 2061 206c 6973 742e  .        a list.
+0000c350: 0a20 2020 203a 7061 7261 6d20 616c 6967  .    :param alig
+0000c360: 6e3a 203a 636c 6173 733a 602e 5769 6e64  n: :class:`.Wind
+0000c370: 6f77 416c 6967 6e60 2076 616c 7565 206f  owAlign` value o
+0000c380: 7220 6361 6c6c 6162 6c65 2074 6861 7420  r callable that 
+0000c390: 7265 7475 726e 7320 616e 0a20 2020 2020  returns an.     
+0000c3a0: 2020 203a 636c 6173 733a 602e 5769 6e64     :class:`.Wind
+0000c3b0: 6f77 416c 6967 6e60 2076 616c 7565 2e20  owAlign` value. 
+0000c3c0: 616c 6967 6e6d 656e 7420 6f66 2063 6f6e  alignment of con
+0000c3d0: 7465 6e74 2e0a 2020 2020 3a70 6172 616d  tent..    :param
+0000c3e0: 2073 7479 6c65 3a20 4120 7374 796c 6520   style: A style 
+0000c3f0: 7374 7269 6e67 2e20 5374 796c 6520 746f  string. Style to
+0000c400: 2062 6520 6170 706c 6965 6420 746f 2061   be applied to a
+0000c410: 6c6c 2074 6865 2063 656c 6c73 2069 6e20  ll the cells in 
+0000c420: 7468 6973 0a20 2020 2020 2020 2077 696e  this.        win
+0000c430: 646f 772e 2028 5468 6973 2063 616e 2062  dow. (This can b
+0000c440: 6520 6120 6361 6c6c 6162 6c65 2074 6861  e a callable tha
+0000c450: 7420 7265 7475 726e 7320 6120 7374 7269  t returns a stri
+0000c460: 6e67 2e29 0a20 2020 203a 7061 7261 6d20  ng.).    :param 
+0000c470: 6368 6172 3a20 2873 7472 696e 6729 2043  char: (string) C
+0000c480: 6861 7261 6374 6572 2074 6f20 6265 2075  haracter to be u
+0000c490: 7365 6420 666f 7220 6669 6c6c 696e 6720  sed for filling 
+0000c4a0: 7468 6520 6261 636b 6772 6f75 6e64 2e20  the background. 
+0000c4b0: 5468 6973 0a20 2020 2020 2020 2063 616e  This.        can
+0000c4c0: 2061 6c73 6f20 6265 2061 2063 616c 6c61   also be a calla
+0000c4d0: 626c 6520 7468 6174 2072 6574 7572 6e73  ble that returns
+0000c4e0: 2061 2063 6861 7261 6374 6572 2e0a 2020   a character..  
+0000c4f0: 2020 3a70 6172 616d 2067 6574 5f6c 696e    :param get_lin
+0000c500: 655f 7072 6566 6978 3a20 4e6f 6e65 206f  e_prefix: None o
+0000c510: 7220 6120 6361 6c6c 6162 6c65 2074 6861  r a callable tha
+0000c520: 7420 7265 7475 726e 7320 666f 726d 6174  t returns format
+0000c530: 7465 6420 7465 7874 2074 6f0a 2020 2020  ted text to.    
+0000c540: 2020 2020 6265 2069 6e73 6572 7465 6420      be inserted 
+0000c550: 6265 666f 7265 2061 206c 696e 652e 2049  before a line. I
+0000c560: 7420 7461 6b65 7320 6120 6c69 6e65 206e  t takes a line n
+0000c570: 756d 6265 7220 2869 6e74 2920 616e 6420  umber (int) and 
+0000c580: 610a 2020 2020 2020 2020 7772 6170 5f63  a.        wrap_c
+0000c590: 6f75 6e74 2061 6e64 2072 6574 7572 6e73  ount and returns
+0000c5a0: 2066 6f72 6d61 7474 6564 2074 6578 742e   formatted text.
+0000c5b0: 2054 6869 7320 6361 6e20 6265 2075 7365   This can be use
+0000c5c0: 6420 666f 720a 2020 2020 2020 2020 696d  d for.        im
+0000c5d0: 706c 656d 656e 7461 7469 6f6e 206f 6620  plementation of 
+0000c5e0: 6c69 6e65 2063 6f6e 7469 6e75 6174 696f  line continuatio
+0000c5f0: 6e73 2c20 7468 696e 6773 206c 696b 6520  ns, things like 
+0000c600: 5669 6d20 2262 7265 616b 696e 6465 6e74  Vim "breakindent
+0000c610: 2220 616e 640a 2020 2020 2020 2020 736f  " and.        so
+0000c620: 206f 6e2e 0a20 2020 2022 2222 0a20 2020   on..    """.   
+0000c630: 206c 6566 7420 3d20 5769 6e64 6f77 416c   left = WindowAl
+0000c640: 6967 6e2e 4c45 4654 0a20 2020 2063 656e  ign.LEFT.    cen
+0000c650: 7465 7220 3d20 5769 6e64 6f77 416c 6967  ter = WindowAlig
+0000c660: 6e2e 4345 4e54 4552 0a20 2020 2072 6967  n.CENTER.    rig
+0000c670: 6874 203d 2057 696e 646f 7741 6c69 676e  ht = WindowAlign
+0000c680: 2e52 4947 4854 0a0a 2020 2020 6465 6620  .RIGHT..    def 
+0000c690: 5f5f 696e 6974 5f5f 280a 2020 2020 2020  __init__(.      
+0000c6a0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+0000c6b0: 636f 6e74 656e 743a 204f 7074 696f 6e61  content: Optiona
+0000c6c0: 6c5b 5549 436f 6e74 726f 6c5d 203d 204e  l[UIControl] = N
+0000c6d0: 6f6e 652c 0a20 2020 2020 2020 2077 6964  one,.        wid
+0000c6e0: 7468 3a20 416e 7944 696d 656e 7369 6f6e  th: AnyDimension
+0000c6f0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0000c700: 2068 6569 6768 743a 2041 6e79 4469 6d65   height: AnyDime
+0000c710: 6e73 696f 6e20 3d20 4e6f 6e65 2c0a 2020  nsion = None,.  
+0000c720: 2020 2020 2020 7a5f 696e 6465 783a 204f        z_index: O
+0000c730: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
+0000c740: 6f6e 652c 0a20 2020 2020 2020 2066 6978  one,.        fix
+0000c750: 6564 5f77 6964 7468 3a20 4669 6c74 6572  ed_width: Filter
+0000c760: 4f72 426f 6f6c 203d 2046 616c 7365 2c0a  OrBool = False,.
+0000c770: 2020 2020 2020 2020 6669 7865 645f 6865          fixed_he
+0000c780: 6967 6874 3a20 4669 6c74 6572 4f72 426f  ight: FilterOrBo
+0000c790: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+0000c7a0: 2020 2020 6967 6e6f 7265 5f63 6f6e 7465      ignore_conte
+0000c7b0: 6e74 5f77 6964 7468 3a20 4669 6c74 6572  nt_width: Filter
+0000c7c0: 4f72 426f 6f6c 203d 2046 616c 7365 2c0a  OrBool = False,.
+0000c7d0: 2020 2020 2020 2020 6967 6e6f 7265 5f63          ignore_c
+0000c7e0: 6f6e 7465 6e74 5f68 6569 6768 743a 2046  ontent_height: F
+0000c7f0: 696c 7465 724f 7242 6f6f 6c20 3d20 4661  ilterOrBool = Fa
+0000c800: 6c73 652c 0a20 2020 2020 2020 206c 6566  lse,.        lef
+0000c810: 745f 6d61 7267 696e 733a 204f 7074 696f  t_margins: Optio
+0000c820: 6e61 6c5b 5365 7175 656e 6365 5b4d 6172  nal[Sequence[Mar
+0000c830: 6769 6e5d 5d20 3d20 4e6f 6e65 2c0a 2020  gin]] = None,.  
+0000c840: 2020 2020 2020 7269 6768 745f 6d61 7267        right_marg
+0000c850: 696e 733a 204f 7074 696f 6e61 6c5b 5365  ins: Optional[Se
+0000c860: 7175 656e 6365 5b4d 6172 6769 6e5d 5d20  quence[Margin]] 
+0000c870: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0000c880: 7363 726f 6c6c 5f6f 6666 7365 7473 3a20  scroll_offsets: 
+0000c890: 4f70 7469 6f6e 616c 5b53 6372 6f6c 6c4f  Optional[ScrollO
+0000c8a0: 6666 7365 7473 5d20 3d20 4e6f 6e65 2c0a  ffsets] = None,.
+0000c8b0: 2020 2020 2020 2020 616c 6c6f 775f 7363          allow_sc
+0000c8c0: 726f 6c6c 5f62 6579 6f6e 645f 626f 7474  roll_beyond_bott
+0000c8d0: 6f6d 3a20 4669 6c74 6572 4f72 426f 6f6c  om: FilterOrBool
+0000c8e0: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
+0000c8f0: 2020 7772 6170 5f6c 696e 6573 3a20 4669    wrap_lines: Fi
+0000c900: 6c74 6572 4f72 426f 6f6c 203d 2046 616c  lterOrBool = Fal
+0000c910: 7365 2c0a 2020 2020 2020 2020 6765 745f  se,.        get_
+0000c920: 7665 7274 6963 616c 5f73 6372 6f6c 6c3a  vertical_scroll:
+0000c930: 204f 7074 696f 6e61 6c5b 4361 6c6c 6162   Optional[Callab
+0000c940: 6c65 5b5b 2257 696e 646f 7722 5d2c 2069  le[["Window"], i
+0000c950: 6e74 5d5d 203d 204e 6f6e 652c 0a20 2020  nt]] = None,.   
+0000c960: 2020 2020 2067 6574 5f68 6f72 697a 6f6e       get_horizon
+0000c970: 7461 6c5f 7363 726f 6c6c 3a20 4f70 7469  tal_scroll: Opti
+0000c980: 6f6e 616c 5b43 616c 6c61 626c 655b 5b22  onal[Callable[["
+0000c990: 5769 6e64 6f77 225d 2c20 696e 745d 5d20  Window"], int]] 
+0000c9a0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0000c9b0: 616c 7761 7973 5f68 6964 655f 6375 7273  always_hide_curs
+0000c9c0: 6f72 3a20 4669 6c74 6572 4f72 426f 6f6c  or: FilterOrBool
+0000c9d0: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
+0000c9e0: 2020 6375 7273 6f72 6c69 6e65 3a20 4669    cursorline: Fi
+0000c9f0: 6c74 6572 4f72 426f 6f6c 203d 2046 616c  lterOrBool = Fal
+0000ca00: 7365 2c0a 2020 2020 2020 2020 6375 7273  se,.        curs
+0000ca10: 6f72 636f 6c75 6d6e 3a20 4669 6c74 6572  orcolumn: Filter
+0000ca20: 4f72 426f 6f6c 203d 2046 616c 7365 2c0a  OrBool = False,.
+0000ca30: 2020 2020 2020 2020 636f 6c6f 7263 6f6c          colorcol
+0000ca40: 756d 6e73 3a20 556e 696f 6e5b 0a20 2020  umns: Union[.   
+0000ca50: 2020 2020 2020 2020 204e 6f6e 652c 204c           None, L
+0000ca60: 6973 745b 436f 6c6f 7243 6f6c 756d 6e5d  ist[ColorColumn]
+0000ca70: 2c20 4361 6c6c 6162 6c65 5b5b 5d2c 204c  , Callable[[], L
+0000ca80: 6973 745b 436f 6c6f 7243 6f6c 756d 6e5d  ist[ColorColumn]
+0000ca90: 5d0a 2020 2020 2020 2020 5d20 3d20 4e6f  ].        ] = No
+0000caa0: 6e65 2c0a 2020 2020 2020 2020 616c 6967  ne,.        alig
+0000cab0: 6e3a 2055 6e69 6f6e 5b57 696e 646f 7741  n: Union[WindowA
+0000cac0: 6c69 676e 2c20 4361 6c6c 6162 6c65 5b5b  lign, Callable[[
+0000cad0: 5d2c 2057 696e 646f 7741 6c69 676e 5d5d  ], WindowAlign]]
+0000cae0: 203d 2022 6c65 6674 222c 0a20 2020 2020   = "left",.     
+0000caf0: 2020 2073 7479 6c65 3a20 556e 696f 6e5b     style: Union[
+0000cb00: 7374 722c 2043 616c 6c61 626c 655b 5b5d  str, Callable[[]
+0000cb10: 2c20 7374 725d 5d20 3d20 2222 2c0a 2020  , str]] = "",.  
+0000cb20: 2020 2020 2020 6368 6172 3a20 556e 696f        char: Unio
+0000cb30: 6e5b 4e6f 6e65 2c20 7374 722c 2043 616c  n[None, str, Cal
+0000cb40: 6c61 626c 655b 5b5d 2c20 7374 725d 5d20  lable[[], str]] 
+0000cb50: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+0000cb60: 6765 745f 6c69 6e65 5f70 7265 6669 783a  get_line_prefix:
+0000cb70: 204f 7074 696f 6e61 6c5b 4765 744c 696e   Optional[GetLin
+0000cb80: 6550 7265 6669 7843 616c 6c61 626c 655d  ePrefixCallable]
+0000cb90: 203d 204e 6f6e 652c 0a20 2020 2029 202d   = None,.    ) -
+0000cba0: 3e20 4e6f 6e65 3a0a 0a20 2020 2020 2020  > None:..       
+0000cbb0: 2073 656c 662e 616c 6c6f 775f 7363 726f   self.allow_scro
+0000cbc0: 6c6c 5f62 6579 6f6e 645f 626f 7474 6f6d  ll_beyond_bottom
+0000cbd0: 203d 2074 6f5f 6669 6c74 6572 2861 6c6c   = to_filter(all
+0000cbe0: 6f77 5f73 6372 6f6c 6c5f 6265 796f 6e64  ow_scroll_beyond
+0000cbf0: 5f62 6f74 746f 6d29 0a20 2020 2020 2020  _bottom).       
+0000cc00: 2073 656c 662e 616c 7761 7973 5f68 6964   self.always_hid
+0000cc10: 655f 6375 7273 6f72 203d 2074 6f5f 6669  e_cursor = to_fi
+0000cc20: 6c74 6572 2861 6c77 6179 735f 6869 6465  lter(always_hide
+0000cc30: 5f63 7572 736f 7229 0a20 2020 2020 2020  _cursor).       
+0000cc40: 2073 656c 662e 7772 6170 5f6c 696e 6573   self.wrap_lines
+0000cc50: 203d 2074 6f5f 6669 6c74 6572 2877 7261   = to_filter(wra
+0000cc60: 705f 6c69 6e65 7329 0a20 2020 2020 2020  p_lines).       
+0000cc70: 2073 656c 662e 6375 7273 6f72 6c69 6e65   self.cursorline
+0000cc80: 203d 2074 6f5f 6669 6c74 6572 2863 7572   = to_filter(cur
+0000cc90: 736f 726c 696e 6529 0a20 2020 2020 2020  sorline).       
+0000cca0: 2073 656c 662e 6375 7273 6f72 636f 6c75   self.cursorcolu
+0000ccb0: 6d6e 203d 2074 6f5f 6669 6c74 6572 2863  mn = to_filter(c
+0000ccc0: 7572 736f 7263 6f6c 756d 6e29 0a0a 2020  ursorcolumn)..  
+0000ccd0: 2020 2020 2020 7365 6c66 2e63 6f6e 7465        self.conte
+0000cce0: 6e74 203d 2063 6f6e 7465 6e74 206f 7220  nt = content or 
+0000ccf0: 4475 6d6d 7943 6f6e 7472 6f6c 2829 0a20  DummyControl(). 
+0000cd00: 2020 2020 2020 2073 656c 662e 6669 7865         self.fixe
+0000cd10: 645f 7769 6474 6820 3d20 746f 5f66 696c  d_width = to_fil
+0000cd20: 7465 7228 6669 7865 645f 7769 6474 6829  ter(fixed_width)
+0000cd30: 0a20 2020 2020 2020 2073 656c 662e 6669  .        self.fi
+0000cd40: 7865 645f 6865 6967 6874 203d 2074 6f5f  xed_height = to_
+0000cd50: 6669 6c74 6572 2866 6978 6564 5f68 6569  filter(fixed_hei
+0000cd60: 6768 7429 0a20 2020 2020 2020 2073 656c  ght).        sel
+0000cd70: 662e 6967 6e6f 7265 5f63 6f6e 7465 6e74  f.ignore_content
+0000cd80: 5f77 6964 7468 203d 2074 6f5f 6669 6c74  _width = to_filt
+0000cd90: 6572 2869 676e 6f72 655f 636f 6e74 656e  er(ignore_conten
+0000cda0: 745f 7769 6474 6829 0a20 2020 2020 2020  t_width).       
+0000cdb0: 2073 656c 662e 6967 6e6f 7265 5f63 6f6e   self.ignore_con
+0000cdc0: 7465 6e74 5f68 6569 6768 7420 3d20 746f  tent_height = to
+0000cdd0: 5f66 696c 7465 7228 6967 6e6f 7265 5f63  _filter(ignore_c
+0000cde0: 6f6e 7465 6e74 5f68 6569 6768 7429 0a20  ontent_height). 
+0000cdf0: 2020 2020 2020 2073 656c 662e 6c65 6674         self.left
+0000ce00: 5f6d 6172 6769 6e73 203d 206c 6566 745f  _margins = left_
+0000ce10: 6d61 7267 696e 7320 6f72 205b 5d0a 2020  margins or [].  
+0000ce20: 2020 2020 2020 7365 6c66 2e72 6967 6874        self.right
+0000ce30: 5f6d 6172 6769 6e73 203d 2072 6967 6874  _margins = right
+0000ce40: 5f6d 6172 6769 6e73 206f 7220 5b5d 0a20  _margins or []. 
+0000ce50: 2020 2020 2020 2073 656c 662e 7363 726f         self.scro
+0000ce60: 6c6c 5f6f 6666 7365 7473 203d 2073 6372  ll_offsets = scr
+0000ce70: 6f6c 6c5f 6f66 6673 6574 7320 6f72 2053  oll_offsets or S
+0000ce80: 6372 6f6c 6c4f 6666 7365 7473 2829 0a20  crollOffsets(). 
+0000ce90: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
+0000cea0: 7665 7274 6963 616c 5f73 6372 6f6c 6c20  vertical_scroll 
+0000ceb0: 3d20 6765 745f 7665 7274 6963 616c 5f73  = get_vertical_s
+0000cec0: 6372 6f6c 6c0a 2020 2020 2020 2020 7365  croll.        se
+0000ced0: 6c66 2e67 6574 5f68 6f72 697a 6f6e 7461  lf.get_horizonta
+0000cee0: 6c5f 7363 726f 6c6c 203d 2067 6574 5f68  l_scroll = get_h
+0000cef0: 6f72 697a 6f6e 7461 6c5f 7363 726f 6c6c  orizontal_scroll
+0000cf00: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
+0000cf10: 6c6f 7263 6f6c 756d 6e73 203d 2063 6f6c  lorcolumns = col
+0000cf20: 6f72 636f 6c75 6d6e 7320 6f72 205b 5d0a  orcolumns or [].
+0000cf30: 2020 2020 2020 2020 7365 6c66 2e61 6c69          self.ali
+0000cf40: 676e 203d 2061 6c69 676e 0a20 2020 2020  gn = align.     
+0000cf50: 2020 2073 656c 662e 7374 796c 6520 3d20     self.style = 
+0000cf60: 7374 796c 650a 2020 2020 2020 2020 7365  style.        se
+0000cf70: 6c66 2e63 6861 7220 3d20 6368 6172 0a20  lf.char = char. 
+0000cf80: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
+0000cf90: 6c69 6e65 5f70 7265 6669 7820 3d20 6765  line_prefix = ge
+0000cfa0: 745f 6c69 6e65 5f70 7265 6669 780a 0a20  t_line_prefix.. 
+0000cfb0: 2020 2020 2020 2073 656c 662e 7769 6474         self.widt
+0000cfc0: 6820 3d20 7769 6474 680a 2020 2020 2020  h = width.      
+0000cfd0: 2020 7365 6c66 2e68 6569 6768 7420 3d20    self.height = 
+0000cfe0: 6865 6967 6874 0a20 2020 2020 2020 2073  height.        s
+0000cff0: 656c 662e 7a5f 696e 6465 7820 3d20 7a5f  elf.z_index = z_
+0000d000: 696e 6465 780a 0a20 2020 2020 2020 2023  index..        #
+0000d010: 2043 6163 6865 2066 6f72 2074 6865 2073   Cache for the s
+0000d020: 6372 6565 6e73 2067 656e 6572 6174 6564  creens generated
+0000d030: 2062 7920 7468 6520 6d61 7267 696e 2e0a   by the margin..
+0000d040: 2020 2020 2020 2020 7365 6c66 2e5f 7569          self._ui
+0000d050: 5f63 6f6e 7465 6e74 5f63 6163 6865 3a20  _content_cache: 
+0000d060: 5369 6d70 6c65 4361 6368 655b 0a20 2020  SimpleCache[.   
+0000d070: 2020 2020 2020 2020 2054 7570 6c65 5b69           Tuple[i
+0000d080: 6e74 2c20 696e 742c 2069 6e74 5d2c 2055  nt, int, int], U
+0000d090: 4943 6f6e 7465 6e74 0a20 2020 2020 2020  IContent.       
+0000d0a0: 205d 203d 2053 696d 706c 6543 6163 6865   ] = SimpleCache
+0000d0b0: 286d 6178 7369 7a65 3d38 290a 2020 2020  (maxsize=8).    
+0000d0c0: 2020 2020 7365 6c66 2e5f 6d61 7267 696e      self._margin
+0000d0d0: 5f77 6964 7468 5f63 6163 6865 3a20 5369  _width_cache: Si
+0000d0e0: 6d70 6c65 4361 6368 655b 5475 706c 655b  mpleCache[Tuple[
+0000d0f0: 4d61 7267 696e 2c20 696e 745d 2c20 696e  Margin, int], in
+0000d100: 745d 203d 2053 696d 706c 6543 6163 6865  t] = SimpleCache
+0000d110: 280a 2020 2020 2020 2020 2020 2020 6d61  (.            ma
+0000d120: 7873 697a 653d 310a 2020 2020 2020 2020  xsize=1.        
+0000d130: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0000d140: 7265 7365 7428 290a 0a20 2020 2064 6566  reset()..    def
+0000d150: 205f 5f72 6570 725f 5f28 7365 6c66 2920   __repr__(self) 
+0000d160: 2d3e 2073 7472 3a0a 2020 2020 2020 2020  -> str:.        
+0000d170: 7265 7475 726e 2022 5769 6e64 6f77 2863  return "Window(c
+0000d180: 6f6e 7465 6e74 3d25 7229 2220 2520 7365  ontent=%r)" % se
+0000d190: 6c66 2e63 6f6e 7465 6e74 0a0a 2020 2020  lf.content..    
+0000d1a0: 6465 6620 7265 7365 7428 7365 6c66 2920  def reset(self) 
+0000d1b0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000d1c0: 2073 656c 662e 636f 6e74 656e 742e 7265   self.content.re
+0000d1d0: 7365 7428 290a 0a20 2020 2020 2020 2023  set()..        #
+0000d1e0: 3a20 5363 726f 6c6c 696e 6720 706f 7369  : Scrolling posi
+0000d1f0: 7469 6f6e 206f 6620 7468 6520 6d61 696e  tion of the main
+0000d200: 2063 6f6e 7465 6e74 2e0a 2020 2020 2020   content..      
+0000d210: 2020 7365 6c66 2e76 6572 7469 6361 6c5f    self.vertical_
+0000d220: 7363 726f 6c6c 203d 2030 0a20 2020 2020  scroll = 0.     
+0000d230: 2020 2073 656c 662e 686f 7269 7a6f 6e74     self.horizont
+0000d240: 616c 5f73 6372 6f6c 6c20 3d20 300a 0a20  al_scroll = 0.. 
+0000d250: 2020 2020 2020 2023 2056 6572 7469 6361         # Vertica
+0000d260: 6c20 7363 726f 6c6c 2032 3a20 7468 6973  l scroll 2: this
+0000d270: 2069 7320 7468 6520 7665 7274 6963 616c   is the vertical
+0000d280: 206f 6666 7365 7420 7468 6174 2061 206c   offset that a l
+0000d290: 696e 6520 6973 0a20 2020 2020 2020 2023  ine is.        #
+0000d2a0: 2073 6372 6f6c 6c65 6420 6966 2061 2073   scrolled if a s
+0000d2b0: 696e 676c 6520 6c69 6e65 2028 7468 6520  ingle line (the 
+0000d2c0: 6f6e 6520 7468 6174 2063 6f6e 7461 696e  one that contain
+0000d2d0: 7320 7468 6520 6375 7273 6f72 2920 636f  s the cursor) co
+0000d2e0: 6e73 756d 6573 0a20 2020 2020 2020 2023  nsumes.        #
+0000d2f0: 2061 6c6c 206f 6620 7468 6520 7665 7274   all of the vert
+0000d300: 6963 616c 2073 7061 6365 2e0a 2020 2020  ical space..    
+0000d310: 2020 2020 7365 6c66 2e76 6572 7469 6361      self.vertica
+0000d320: 6c5f 7363 726f 6c6c 5f32 203d 2030 0a0a  l_scroll_2 = 0..
+0000d330: 2020 2020 2020 2020 233a 204b 6565 7020          #: Keep 
+0000d340: 7265 6e64 6572 2069 6e66 6f72 6d61 7469  render informati
+0000d350: 6f6e 2028 6d61 7070 696e 6773 2062 6574  on (mappings bet
+0000d360: 7765 656e 2062 7566 6665 7220 696e 7075  ween buffer inpu
+0000d370: 7420 616e 6420 7265 6e64 6572 0a20 2020  t and render.   
+0000d380: 2020 2020 2023 3a20 6f75 7470 7574 2e29       #: output.)
+0000d390: 0a20 2020 2020 2020 2073 656c 662e 7265  .        self.re
+0000d3a0: 6e64 6572 5f69 6e66 6f3a 204f 7074 696f  nder_info: Optio
+0000d3b0: 6e61 6c5b 5769 6e64 6f77 5265 6e64 6572  nal[WindowRender
+0000d3c0: 496e 666f 5d20 3d20 4e6f 6e65 0a0a 2020  Info] = None..  
+0000d3d0: 2020 6465 6620 5f67 6574 5f6d 6172 6769    def _get_margi
+0000d3e0: 6e5f 7769 6474 6828 7365 6c66 2c20 6d61  n_width(self, ma
+0000d3f0: 7267 696e 3a20 4d61 7267 696e 2920 2d3e  rgin: Margin) ->
+0000d400: 2069 6e74 3a0a 2020 2020 2020 2020 2222   int:.        ""
+0000d410: 220a 2020 2020 2020 2020 5265 7475 726e  ".        Return
+0000d420: 2074 6865 2077 6964 7468 2066 6f72 2074   the width for t
+0000d430: 6869 7320 6d61 7267 696e 2e0a 2020 2020  his margin..    
+0000d440: 2020 2020 2843 616c 6375 6c61 7465 206f      (Calculate o
+0000d450: 6e6c 7920 6f6e 6365 2070 6572 2072 656e  nly once per ren
+0000d460: 6465 7220 7469 6d65 2e29 0a20 2020 2020  der time.).     
+0000d470: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
+0000d480: 204d 6172 6769 6e2e 6765 745f 7769 6474   Margin.get_widt
+0000d490: 682c 206e 6565 6473 2074 6f20 6861 7665  h, needs to have
+0000d4a0: 2061 2055 4943 6f6e 7465 6e74 2069 6e73   a UIContent ins
+0000d4b0: 7461 6e63 652e 0a20 2020 2020 2020 2064  tance..        d
+0000d4c0: 6566 2067 6574 5f75 695f 636f 6e74 656e  ef get_ui_conten
+0000d4d0: 7428 2920 2d3e 2055 4943 6f6e 7465 6e74  t() -> UIContent
+0000d4e0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000d4f0: 7475 726e 2073 656c 662e 5f67 6574 5f75  turn self._get_u
+0000d500: 695f 636f 6e74 656e 7428 7769 6474 683d  i_content(width=
+0000d510: 302c 2068 6569 6768 743d 3029 0a0a 2020  0, height=0)..  
+0000d520: 2020 2020 2020 6465 6620 6765 745f 7769        def get_wi
+0000d530: 6474 6828 2920 2d3e 2069 6e74 3a0a 2020  dth() -> int:.  
+0000d540: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000d550: 206d 6172 6769 6e2e 6765 745f 7769 6474   margin.get_widt
+0000d560: 6828 6765 745f 7569 5f63 6f6e 7465 6e74  h(get_ui_content
+0000d570: 290a 0a20 2020 2020 2020 206b 6579 203d  )..        key =
+0000d580: 2028 6d61 7267 696e 2c20 6765 745f 6170   (margin, get_ap
+0000d590: 7028 292e 7265 6e64 6572 5f63 6f75 6e74  p().render_count
+0000d5a0: 6572 290a 2020 2020 2020 2020 7265 7475  er).        retu
+0000d5b0: 726e 2073 656c 662e 5f6d 6172 6769 6e5f  rn self._margin_
+0000d5c0: 7769 6474 685f 6361 6368 652e 6765 7428  width_cache.get(
+0000d5d0: 6b65 792c 2067 6574 5f77 6964 7468 290a  key, get_width).
+0000d5e0: 0a20 2020 2064 6566 205f 6765 745f 746f  .    def _get_to
+0000d5f0: 7461 6c5f 6d61 7267 696e 5f77 6964 7468  tal_margin_width
+0000d600: 2873 656c 6629 202d 3e20 696e 743a 0a20  (self) -> int:. 
+0000d610: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000d620: 2020 2043 616c 6375 6c61 7465 2061 6e64     Calculate and
+0000d630: 2072 6574 7572 6e20 7468 6520 7769 6474   return the widt
+0000d640: 6820 6f66 2074 6865 206d 6172 6769 6e20  h of the margin 
+0000d650: 286c 6566 7420 2b20 7269 6768 7429 2e0a  (left + right)..
+0000d660: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000d670: 2020 2020 7265 7475 726e 2073 756d 2873      return sum(s
+0000d680: 656c 662e 5f67 6574 5f6d 6172 6769 6e5f  elf._get_margin_
+0000d690: 7769 6474 6828 6d29 2066 6f72 206d 2069  width(m) for m i
+0000d6a0: 6e20 7365 6c66 2e6c 6566 745f 6d61 7267  n self.left_marg
+0000d6b0: 696e 7329 202b 2073 756d 280a 2020 2020  ins) + sum(.    
+0000d6c0: 2020 2020 2020 2020 7365 6c66 2e5f 6765          self._ge
+0000d6d0: 745f 6d61 7267 696e 5f77 6964 7468 286d  t_margin_width(m
+0000d6e0: 2920 666f 7220 6d20 696e 2073 656c 662e  ) for m in self.
+0000d6f0: 7269 6768 745f 6d61 7267 696e 730a 2020  right_margins.  
+0000d700: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+0000d710: 2070 7265 6665 7272 6564 5f77 6964 7468   preferred_width
+0000d720: 2873 656c 662c 206d 6178 5f61 7661 696c  (self, max_avail
+0000d730: 6162 6c65 5f77 6964 7468 3a20 696e 7429  able_width: int)
+0000d740: 202d 3e20 4469 6d65 6e73 696f 6e3a 0a20   -> Dimension:. 
+0000d750: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000d760: 2020 2043 616c 6375 6c61 7465 2074 6865     Calculate the
+0000d770: 2070 7265 6665 7272 6564 2077 6964 7468   preferred width
+0000d780: 2066 6f72 2074 6869 7320 7769 6e64 6f77   for this window
+0000d790: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+0000d7a0: 2020 2020 2020 2064 6566 2070 7265 6665         def prefe
+0000d7b0: 7272 6564 5f63 6f6e 7465 6e74 5f77 6964  rred_content_wid
+0000d7c0: 7468 2829 202d 3e20 4f70 7469 6f6e 616c  th() -> Optional
+0000d7d0: 5b69 6e74 5d3a 0a20 2020 2020 2020 2020  [int]:.         
+0000d7e0: 2020 2022 2222 436f 6e74 656e 7420 7769     """Content wi
+0000d7f0: 6474 683a 2069 7320 6f6e 6c79 2063 616c  dth: is only cal
+0000d800: 6375 6c61 7465 6420 6966 206e 6f20 6578  culated if no ex
+0000d810: 6163 7420 7769 6474 6820 666f 7220 7468  act width for th
+0000d820: 650a 2020 2020 2020 2020 2020 2020 7769  e.            wi
+0000d830: 6e64 6f77 2077 6173 2067 6976 656e 2e22  ndow was given."
+0000d840: 2222 0a20 2020 2020 2020 2020 2020 2069  "".            i
+0000d850: 6620 7365 6c66 2e69 676e 6f72 655f 636f  f self.ignore_co
+0000d860: 6e74 656e 745f 7769 6474 6828 293a 0a20  ntent_width():. 
+0000d870: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000d880: 6574 7572 6e20 4e6f 6e65 0a0a 2020 2020  eturn None..    
+0000d890: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
+0000d8a0: 6174 6520 7468 6520 7769 6474 6820 6f66  ate the width of
+0000d8b0: 2074 6865 206d 6172 6769 6e2e 0a20 2020   the margin..   
+0000d8c0: 2020 2020 2020 2020 2074 6f74 616c 5f6d           total_m
+0000d8d0: 6172 6769 6e5f 7769 6474 6820 3d20 7365  argin_width = se
+0000d8e0: 6c66 2e5f 6765 745f 746f 7461 6c5f 6d61  lf._get_total_ma
+0000d8f0: 7267 696e 5f77 6964 7468 2829 0a0a 2020  rgin_width()..  
+0000d900: 2020 2020 2020 2020 2020 2320 5769 6e64            # Wind
+0000d910: 6f77 206f 6620 7468 6520 636f 6e74 656e  ow of the conten
+0000d920: 742e 2028 4361 6e20 6265 2060 4e6f 6e65  t. (Can be `None
+0000d930: 602e 290a 2020 2020 2020 2020 2020 2020  `.).            
+0000d940: 7072 6566 6572 7265 645f 7769 6474 6820  preferred_width 
+0000d950: 3d20 7365 6c66 2e63 6f6e 7465 6e74 2e70  = self.content.p
+0000d960: 7265 6665 7272 6564 5f77 6964 7468 280a  referred_width(.
+0000d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d980: 6d61 785f 6176 6169 6c61 626c 655f 7769  max_available_wi
+0000d990: 6474 6820 2d20 746f 7461 6c5f 6d61 7267  dth - total_marg
+0000d9a0: 696e 5f77 6964 7468 0a20 2020 2020 2020  in_width.       
+0000d9b0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0000d9c0: 2020 2020 6966 2070 7265 6665 7272 6564      if preferred
+0000d9d0: 5f77 6964 7468 2069 7320 6e6f 7420 4e6f  _width is not No
+0000d9e0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000d9f0: 2020 2020 2320 496e 636c 7564 6520 7769      # Include wi
+0000da00: 6474 6820 6f66 2074 6865 206d 6172 6769  dth of the margi
+0000da10: 6e73 2e0a 2020 2020 2020 2020 2020 2020  ns..            
+0000da20: 2020 2020 7072 6566 6572 7265 645f 7769      preferred_wi
+0000da30: 6474 6820 2b3d 2074 6f74 616c 5f6d 6172  dth += total_mar
+0000da40: 6769 6e5f 7769 6474 680a 2020 2020 2020  gin_width.      
+0000da50: 2020 2020 2020 7265 7475 726e 2070 7265        return pre
+0000da60: 6665 7272 6564 5f77 6964 7468 0a0a 2020  ferred_width..  
+0000da70: 2020 2020 2020 2320 4d65 7267 652e 0a20        # Merge.. 
+0000da80: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000da90: 6c66 2e5f 6d65 7267 655f 6469 6d65 6e73  lf._merge_dimens
+0000daa0: 696f 6e73 280a 2020 2020 2020 2020 2020  ions(.          
+0000dab0: 2020 6469 6d65 6e73 696f 6e3d 746f 5f64    dimension=to_d
+0000dac0: 696d 656e 7369 6f6e 2873 656c 662e 7769  imension(self.wi
+0000dad0: 6474 6829 2c0a 2020 2020 2020 2020 2020  dth),.          
+0000dae0: 2020 6765 745f 7072 6566 6572 7265 643d    get_preferred=
+0000daf0: 7072 6566 6572 7265 645f 636f 6e74 656e  preferred_conten
+0000db00: 745f 7769 6474 682c 0a20 2020 2020 2020  t_width,.       
+0000db10: 2020 2020 2064 6f6e 745f 6578 7465 6e64       dont_extend
+0000db20: 3d73 656c 662e 6669 7865 645f 7769 6474  =self.fixed_widt
+0000db30: 6828 292c 0a20 2020 2020 2020 2029 0a0a  h(),.        )..
+0000db40: 2020 2020 6465 6620 7072 6566 6572 7265      def preferre
+0000db50: 645f 6865 6967 6874 2873 656c 662c 2077  d_height(self, w
+0000db60: 6964 7468 3a20 696e 742c 206d 6178 5f61  idth: int, max_a
+0000db70: 7661 696c 6162 6c65 5f68 6569 6768 743a  vailable_height:
+0000db80: 2069 6e74 2920 2d3e 2044 696d 656e 7369   int) -> Dimensi
+0000db90: 6f6e 3a0a 2020 2020 2020 2020 2222 220a  on:.        """.
+0000dba0: 2020 2020 2020 2020 4361 6c63 756c 6174          Calculat
+0000dbb0: 6520 7468 6520 7072 6566 6572 7265 6420  e the preferred 
+0000dbc0: 6865 6967 6874 2066 6f72 2074 6869 7320  height for this 
+0000dbd0: 7769 6e64 6f77 2e0a 2020 2020 2020 2020  window..        
+0000dbe0: 2222 220a 0a20 2020 2020 2020 2064 6566  """..        def
+0000dbf0: 2070 7265 6665 7272 6564 5f63 6f6e 7465   preferred_conte
+0000dc00: 6e74 5f68 6569 6768 7428 2920 2d3e 204f  nt_height() -> O
+0000dc10: 7074 696f 6e61 6c5b 696e 745d 3a0a 2020  ptional[int]:.  
+0000dc20: 2020 2020 2020 2020 2020 2222 2243 6f6e            """Con
+0000dc30: 7465 6e74 2068 6569 6768 743a 2069 7320  tent height: is 
+0000dc40: 6f6e 6c79 2063 616c 6375 6c61 7465 6420  only calculated 
+0000dc50: 6966 206e 6f20 6578 6163 7420 6865 6967  if no exact heig
+0000dc60: 6874 2066 6f72 2074 6865 0a20 2020 2020  ht for the.     
+0000dc70: 2020 2020 2020 2077 696e 646f 7720 7761         window wa
+0000dc80: 7320 6769 7665 6e2e 2222 220a 2020 2020  s given.""".    
+0000dc90: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000dca0: 6967 6e6f 7265 5f63 6f6e 7465 6e74 5f68  ignore_content_h
+0000dcb0: 6569 6768 7428 293a 0a20 2020 2020 2020  eight():.       
+0000dcc0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000dcd0: 4e6f 6e65 0a0a 2020 2020 2020 2020 2020  None..          
+0000dce0: 2020 746f 7461 6c5f 6d61 7267 696e 5f77    total_margin_w
+0000dcf0: 6964 7468 203d 2073 656c 662e 5f67 6574  idth = self._get
+0000dd00: 5f74 6f74 616c 5f6d 6172 6769 6e5f 7769  _total_margin_wi
+0000dd10: 6474 6828 290a 2020 2020 2020 2020 2020  dth().          
+0000dd20: 2020 7772 6170 5f6c 696e 6573 203d 2073    wrap_lines = s
+0000dd30: 656c 662e 7772 6170 5f6c 696e 6573 2829  elf.wrap_lines()
+0000dd40: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0000dd50: 7475 726e 2073 656c 662e 636f 6e74 656e  turn self.conten
+0000dd60: 742e 7072 6566 6572 7265 645f 6865 6967  t.preferred_heig
+0000dd70: 6874 280a 2020 2020 2020 2020 2020 2020  ht(.            
+0000dd80: 2020 2020 7769 6474 6820 2d20 746f 7461      width - tota
+0000dd90: 6c5f 6d61 7267 696e 5f77 6964 7468 2c0a  l_margin_width,.
+0000dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ddb0: 6d61 785f 6176 6169 6c61 626c 655f 6865  max_available_he
+0000ddc0: 6967 6874 2c0a 2020 2020 2020 2020 2020  ight,.          
+0000ddd0: 2020 2020 2020 7772 6170 5f6c 696e 6573        wrap_lines
+0000dde0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ddf0: 2020 7365 6c66 2e67 6574 5f6c 696e 655f    self.get_line_
+0000de00: 7072 6566 6978 2c0a 2020 2020 2020 2020  prefix,.        
+0000de10: 2020 2020 290a 0a20 2020 2020 2020 2072      )..        r
+0000de20: 6574 7572 6e20 7365 6c66 2e5f 6d65 7267  eturn self._merg
+0000de30: 655f 6469 6d65 6e73 696f 6e73 280a 2020  e_dimensions(.  
+0000de40: 2020 2020 2020 2020 2020 6469 6d65 6e73            dimens
+0000de50: 696f 6e3d 746f 5f64 696d 656e 7369 6f6e  ion=to_dimension
+0000de60: 2873 656c 662e 6865 6967 6874 292c 0a20  (self.height),. 
+0000de70: 2020 2020 2020 2020 2020 2067 6574 5f70             get_p
+0000de80: 7265 6665 7272 6564 3d70 7265 6665 7272  referred=preferr
+0000de90: 6564 5f63 6f6e 7465 6e74 5f68 6569 6768  ed_content_heigh
+0000dea0: 742c 0a20 2020 2020 2020 2020 2020 2064  t,.            d
+0000deb0: 6f6e 745f 6578 7465 6e64 3d73 656c 662e  ont_extend=self.
+0000dec0: 6669 7865 645f 6865 6967 6874 2829 2c0a  fixed_height(),.
+0000ded0: 2020 2020 2020 2020 290a 0a20 2020 2040          )..    @
+0000dee0: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
+0000def0: 2064 6566 205f 6d65 7267 655f 6469 6d65   def _merge_dime
+0000df00: 6e73 696f 6e73 280a 2020 2020 2020 2020  nsions(.        
+0000df10: 6469 6d65 6e73 696f 6e3a 204f 7074 696f  dimension: Optio
+0000df20: 6e61 6c5b 4469 6d65 6e73 696f 6e5d 2c0a  nal[Dimension],.
+0000df30: 2020 2020 2020 2020 6765 745f 7072 6566          get_pref
+0000df40: 6572 7265 643a 2043 616c 6c61 626c 655b  erred: Callable[
+0000df50: 5b5d 2c20 4f70 7469 6f6e 616c 5b69 6e74  [], Optional[int
+0000df60: 5d5d 2c0a 2020 2020 2020 2020 646f 6e74  ]],.        dont
+0000df70: 5f65 7874 656e 643a 2062 6f6f 6c20 3d20  _extend: bool = 
+0000df80: 4661 6c73 652c 0a20 2020 2029 202d 3e20  False,.    ) -> 
+0000df90: 4469 6d65 6e73 696f 6e3a 0a20 2020 2020  Dimension:.     
+0000dfa0: 2020 2022 2222 0a20 2020 2020 2020 2054     """.        T
+0000dfb0: 616b 6520 7468 6520 4469 6d65 6e73 696f  ake the Dimensio
+0000dfc0: 6e20 6672 6f6d 2074 6869 7320 6057 696e  n from this `Win
+0000dfd0: 646f 7760 2063 6c61 7373 2061 6e64 2074  dow` class and t
+0000dfe0: 6865 2072 6563 6569 7665 6420 7072 6566  he received pref
+0000dff0: 6572 7265 640a 2020 2020 2020 2020 7369  erred.        si
+0000e000: 7a65 2066 726f 6d20 7468 6520 6055 4943  ze from the `UIC
+0000e010: 6f6e 7472 6f6c 6020 616e 6420 7265 7475  ontrol` and retu
+0000e020: 726e 2061 2060 4469 6d65 6e73 696f 6e60  rn a `Dimension`
+0000e030: 2074 6f20 7265 706f 7274 2074 6f20 7468   to report to th
+0000e040: 650a 2020 2020 2020 2020 7061 7265 6e74  e.        parent
+0000e050: 2063 6f6e 7461 696e 6572 2e0a 2020 2020   container..    
+0000e060: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000e070: 6469 6d65 6e73 696f 6e20 3d20 6469 6d65  dimension = dime
+0000e080: 6e73 696f 6e20 6f72 2044 696d 656e 7369  nsion or Dimensi
+0000e090: 6f6e 2829 0a0a 2020 2020 2020 2020 2320  on()..        # 
+0000e0a0: 5768 656e 2061 2070 7265 6665 7272 6564  When a preferred
+0000e0b0: 2064 696d 656e 7369 6f6e 2077 6173 2065   dimension was e
+0000e0c0: 7870 6c69 6369 746c 7920 6769 7665 6e20  xplicitly given 
+0000e0d0: 746f 2074 6865 2057 696e 646f 772c 0a20  to the Window,. 
+0000e0e0: 2020 2020 2020 2023 2069 676e 6f72 6520         # ignore 
+0000e0f0: 7468 6520 5549 436f 6e74 726f 6c2e 0a20  the UIControl.. 
+0000e100: 2020 2020 2020 2070 7265 6665 7272 6564         preferred
+0000e110: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d0a  : Optional[int].
+0000e120: 0a20 2020 2020 2020 2069 6620 6469 6d65  .        if dime
+0000e130: 6e73 696f 6e2e 7072 6566 6572 7265 645f  nsion.preferred_
+0000e140: 7370 6563 6966 6965 643a 0a20 2020 2020  specified:.     
+0000e150: 2020 2020 2020 2070 7265 6665 7272 6564         preferred
+0000e160: 203d 2064 696d 656e 7369 6f6e 2e70 7265   = dimension.pre
+0000e170: 6665 7272 6564 0a20 2020 2020 2020 2065  ferred.        e
+0000e180: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000e190: 2023 204f 7468 6572 7769 7365 2c20 6361   # Otherwise, ca
+0000e1a0: 6c63 756c 6174 6520 7468 6520 7072 6566  lculate the pref
+0000e1b0: 6572 7265 6420 6469 6d65 6e73 696f 6e20  erred dimension 
+0000e1c0: 6672 6f6d 2074 6865 2055 4920 636f 6e74  from the UI cont
+0000e1d0: 726f 6c0a 2020 2020 2020 2020 2020 2020  rol.            
+0000e1e0: 2320 636f 6e74 656e 742e 0a20 2020 2020  # content..     
+0000e1f0: 2020 2020 2020 2070 7265 6665 7272 6564         preferred
+0000e200: 203d 2067 6574 5f70 7265 6665 7272 6564   = get_preferred
+0000e210: 2829 0a0a 2020 2020 2020 2020 2320 5768  ()..        # Wh
+0000e220: 656e 2061 2027 7072 6566 6572 7265 6427  en a 'preferred'
+0000e230: 2064 696d 656e 7369 6f6e 2069 7320 6769   dimension is gi
+0000e240: 7665 6e20 6279 2074 6865 2055 4943 6f6e  ven by the UICon
+0000e250: 7472 6f6c 2c20 6d61 6b65 2073 7572 650a  trol, make sure.
+0000e260: 2020 2020 2020 2020 2320 7468 6174 2069          # that i
+0000e270: 7420 7374 6179 7320 7769 7468 696e 2074  t stays within t
+0000e280: 6865 2062 6f75 6e64 7320 6f66 2074 6865  he bounds of the
+0000e290: 2057 696e 646f 772e 0a20 2020 2020 2020   Window..       
+0000e2a0: 2069 6620 7072 6566 6572 7265 6420 6973   if preferred is
+0000e2b0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000e2c0: 2020 2020 2020 2069 6620 6469 6d65 6e73         if dimens
+0000e2d0: 696f 6e2e 6d61 785f 7370 6563 6966 6965  ion.max_specifie
+0000e2e0: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
+0000e2f0: 2020 2070 7265 6665 7272 6564 203d 206d     preferred = m
+0000e300: 696e 2870 7265 6665 7272 6564 2c20 6469  in(preferred, di
+0000e310: 6d65 6e73 696f 6e2e 6d61 7829 0a0a 2020  mension.max)..  
+0000e320: 2020 2020 2020 2020 2020 6966 2064 696d            if dim
+0000e330: 656e 7369 6f6e 2e6d 696e 5f73 7065 6369  ension.min_speci
+0000e340: 6669 6564 3a0a 2020 2020 2020 2020 2020  fied:.          
+0000e350: 2020 2020 2020 7072 6566 6572 7265 6420        preferred 
+0000e360: 3d20 6d61 7828 7072 6566 6572 7265 642c  = max(preferred,
+0000e370: 2064 696d 656e 7369 6f6e 2e6d 696e 290a   dimension.min).
+0000e380: 0a20 2020 2020 2020 2023 2057 6865 6e20  .        # When 
+0000e390: 6120 6064 6f6e 745f 6578 7465 6e64 6020  a `dont_extend` 
+0000e3a0: 666c 6167 2068 6173 2062 6565 6e20 6769  flag has been gi
+0000e3b0: 7665 6e2c 2075 7365 2074 6865 2070 7265  ven, use the pre
+0000e3c0: 6665 7272 6564 2064 696d 656e 7369 6f6e  ferred dimension
+0000e3d0: 0a20 2020 2020 2020 2023 2061 6c73 6f20  .        # also 
+0000e3e0: 6173 2074 6865 206d 6178 2064 696d 656e  as the max dimen
+0000e3f0: 7369 6f6e 2e0a 2020 2020 2020 2020 6d61  sion..        ma
+0000e400: 785f 3a20 4f70 7469 6f6e 616c 5b69 6e74  x_: Optional[int
+0000e410: 5d0a 2020 2020 2020 2020 6d69 6e5f 3a20  ].        min_: 
+0000e420: 4f70 7469 6f6e 616c 5b69 6e74 5d0a 0a20  Optional[int].. 
+0000e430: 2020 2020 2020 2069 6620 646f 6e74 5f65         if dont_e
+0000e440: 7874 656e 6420 616e 6420 7072 6566 6572  xtend and prefer
+0000e450: 7265 6420 6973 206e 6f74 204e 6f6e 653a  red is not None:
+0000e460: 0a20 2020 2020 2020 2020 2020 206d 6178  .            max
+0000e470: 5f20 3d20 6d69 6e28 6469 6d65 6e73 696f  _ = min(dimensio
+0000e480: 6e2e 6d61 782c 2070 7265 6665 7272 6564  n.max, preferred
+0000e490: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0000e4a0: 2020 2020 2020 2020 2020 2020 6d61 785f              max_
+0000e4b0: 203d 2064 696d 656e 7369 6f6e 2e6d 6178   = dimension.max
+0000e4c0: 2069 6620 6469 6d65 6e73 696f 6e2e 6d61   if dimension.ma
+0000e4d0: 785f 7370 6563 6966 6965 6420 656c 7365  x_specified else
+0000e4e0: 204e 6f6e 650a 0a20 2020 2020 2020 206d   None..        m
+0000e4f0: 696e 5f20 3d20 6469 6d65 6e73 696f 6e2e  in_ = dimension.
+0000e500: 6d69 6e20 6966 2064 696d 656e 7369 6f6e  min if dimension
+0000e510: 2e6d 696e 5f73 7065 6369 6669 6564 2065  .min_specified e
+0000e520: 6c73 6520 4e6f 6e65 0a0a 2020 2020 2020  lse None..      
+0000e530: 2020 7265 7475 726e 2044 696d 656e 7369    return Dimensi
+0000e540: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+0000e550: 6d69 6e3d 6d69 6e5f 2c20 6d61 783d 6d61  min=min_, max=ma
+0000e560: 785f 2c20 7072 6566 6572 7265 643d 7072  x_, preferred=pr
+0000e570: 6566 6572 7265 642c 2077 6569 6768 743d  eferred, weight=
+0000e580: 6469 6d65 6e73 696f 6e2e 7765 6967 6874  dimension.weight
+0000e590: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0000e5a0: 6465 6620 5f67 6574 5f75 695f 636f 6e74  def _get_ui_cont
+0000e5b0: 656e 7428 7365 6c66 2c20 7769 6474 683a  ent(self, width:
+0000e5c0: 2069 6e74 2c20 6865 6967 6874 3a20 696e   int, height: in
+0000e5d0: 7429 202d 3e20 5549 436f 6e74 656e 743a  t) -> UIContent:
+0000e5e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000e5f0: 2020 2020 2043 7265 6174 6520 6120 6055       Create a `U
+0000e600: 4943 6f6e 7465 6e74 6020 696e 7374 616e  IContent` instan
+0000e610: 6365 2e0a 2020 2020 2020 2020 2222 220a  ce..        """.
+0000e620: 0a20 2020 2020 2020 2064 6566 2067 6574  .        def get
+0000e630: 5f63 6f6e 7465 6e74 2829 202d 3e20 5549  _content() -> UI
+0000e640: 436f 6e74 656e 743a 0a20 2020 2020 2020  Content:.       
+0000e650: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000e660: 2e63 6f6e 7465 6e74 2e63 7265 6174 655f  .content.create_
+0000e670: 636f 6e74 656e 7428 7769 6474 683d 7769  content(width=wi
+0000e680: 6474 682c 2068 6569 6768 743d 6865 6967  dth, height=heig
+0000e690: 6874 290a 0a20 2020 2020 2020 206b 6579  ht)..        key
+0000e6a0: 203d 2028 6765 745f 6170 7028 292e 7265   = (get_app().re
+0000e6b0: 6e64 6572 5f63 6f75 6e74 6572 2c20 7769  nder_counter, wi
+0000e6c0: 6474 682c 2068 6569 6768 7429 0a20 2020  dth, height).   
+0000e6d0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000e6e0: 2e5f 7569 5f63 6f6e 7465 6e74 5f63 6163  ._ui_content_cac
+0000e6f0: 6865 2e67 6574 286b 6579 2c20 6765 745f  he.get(key, get_
+0000e700: 636f 6e74 656e 7429 0a0a 2020 2020 6465  content)..    de
+0000e710: 6620 5f67 6574 5f64 6967 7261 7068 5f63  f _get_digraph_c
+0000e720: 6861 7228 7365 6c66 2920 2d3e 204f 7074  har(self) -> Opt
+0000e730: 696f 6e61 6c5b 7374 725d 3a0a 2020 2020  ional[str]:.    
+0000e740: 2020 2020 2252 6574 7572 6e20 6046 616c      "Return `Fal
+0000e750: 7365 602c 206f 7220 7468 6520 4469 6772  se`, or the Digr
+0000e760: 6170 6820 7379 6d62 6f6c 2074 6f20 6265  aph symbol to be
+0000e770: 2075 7365 642e 220a 2020 2020 2020 2020   used.".        
+0000e780: 6170 7020 3d20 6765 745f 6170 7028 290a  app = get_app().
+0000e790: 2020 2020 2020 2020 6966 2061 7070 2e71          if app.q
+0000e7a0: 756f 7465 645f 696e 7365 7274 3a0a 2020  uoted_insert:.  
+0000e7b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000e7c0: 2022 5e22 0a20 2020 2020 2020 2069 6620   "^".        if 
+0000e7d0: 6170 702e 7669 5f73 7461 7465 2e77 6169  app.vi_state.wai
+0000e7e0: 7469 6e67 5f66 6f72 5f64 6967 7261 7068  ting_for_digraph
+0000e7f0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0000e800: 2061 7070 2e76 695f 7374 6174 652e 6469   app.vi_state.di
+0000e810: 6772 6170 685f 7379 6d62 6f6c 313a 0a20  graph_symbol1:. 
+0000e820: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000e830: 6574 7572 6e20 6170 702e 7669 5f73 7461  eturn app.vi_sta
+0000e840: 7465 2e64 6967 7261 7068 5f73 796d 626f  te.digraph_symbo
+0000e850: 6c31 0a20 2020 2020 2020 2020 2020 2072  l1.            r
+0000e860: 6574 7572 6e20 223f 220a 2020 2020 2020  eturn "?".      
+0000e870: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
+0000e880: 2020 2064 6566 2077 7269 7465 5f74 6f5f     def write_to_
+0000e890: 7363 7265 656e 280a 2020 2020 2020 2020  screen(.        
+0000e8a0: 7365 6c66 2c0a 2020 2020 2020 2020 7363  self,.        sc
+0000e8b0: 7265 656e 3a20 5363 7265 656e 2c0a 2020  reen: Screen,.  
+0000e8c0: 2020 2020 2020 6d6f 7573 655f 6861 6e64        mouse_hand
+0000e8d0: 6c65 7273 3a20 4d6f 7573 6548 616e 646c  lers: MouseHandl
+0000e8e0: 6572 732c 0a20 2020 2020 2020 2077 7269  ers,.        wri
+0000e8f0: 7465 5f70 6f73 6974 696f 6e3a 2057 7269  te_position: Wri
+0000e900: 7465 506f 7369 7469 6f6e 2c0a 2020 2020  tePosition,.    
+0000e910: 2020 2020 7061 7265 6e74 5f73 7479 6c65      parent_style
+0000e920: 3a20 7374 722c 0a20 2020 2020 2020 2065  : str,.        e
+0000e930: 7261 7365 5f62 673a 2062 6f6f 6c2c 0a20  rase_bg: bool,. 
+0000e940: 2020 2020 2020 207a 5f69 6e64 6578 3a20         z_index: 
+0000e950: 4f70 7469 6f6e 616c 5b69 6e74 5d2c 0a20  Optional[int],. 
+0000e960: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
+0000e970: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000e980: 2020 5772 6974 6520 7769 6e64 6f77 2074    Write window t
+0000e990: 6f20 7363 7265 656e 2e20 5468 6973 2072  o screen. This r
+0000e9a0: 656e 6465 7273 2074 6865 2075 7365 7220  enders the user 
+0000e9b0: 636f 6e74 726f 6c2c 2074 6865 206d 6172  control, the mar
+0000e9c0: 6769 6e73 2061 6e64 0a20 2020 2020 2020  gins and.       
+0000e9d0: 2063 6f70 6965 7320 6576 6572 7974 6869   copies everythi
+0000e9e0: 6e67 206f 7665 7220 746f 2074 6865 2061  ng over to the a
+0000e9f0: 6273 6f6c 7574 6520 706f 7369 7469 6f6e  bsolute position
+0000ea00: 2061 7420 7468 6520 6769 7665 6e20 7363   at the given sc
+0000ea10: 7265 656e 2e0a 2020 2020 2020 2020 2222  reen..        ""
+0000ea20: 220a 2020 2020 2020 2020 2320 4966 2066  ".        # If f
+0000ea30: 6978 6564 5f77 6964 7468 2f68 6569 6768  ixed_width/heigh
+0000ea40: 7420 7761 7320 6769 7665 6e2e 2054 6865  t was given. The
+0000ea50: 6e20 7265 6475 6365 2077 6964 7468 2f68  n reduce width/h
+0000ea60: 6569 6768 7420 696e 0a20 2020 2020 2020  eight in.       
+0000ea70: 2023 2057 7269 7465 506f 7369 7469 6f6e   # WritePosition
+0000ea80: 2069 6620 7468 6520 7061 7265 6e74 2077   if the parent w
+0000ea90: 616e 7465 6420 7573 2074 6f20 7061 696e  anted us to pain
+0000eaa0: 7420 696e 2061 2062 6967 6765 7220 6172  t in a bigger ar
+0000eab0: 6561 2e0a 2020 2020 2020 2020 2320 2854  ea..        # (T
+0000eac0: 6869 7320 6861 7070 656e 7320 6966 2074  his happens if t
+0000ead0: 6869 7320 7769 6e64 6f77 2069 7320 6275  his window is bu
+0000eae0: 6e64 6c65 6420 7769 7468 2061 6e6f 7468  ndled with anoth
+0000eaf0: 6572 2077 696e 646f 7720 696e 2061 0a20  er window in a. 
+0000eb00: 2020 2020 2020 2023 2048 5370 6c69 742f         # HSplit/
+0000eb10: 5653 706c 6974 2c20 6275 7420 7769 7468  VSplit, but with
+0000eb20: 2064 6966 6665 7265 6e74 2073 697a 6520   different size 
+0000eb30: 7265 7175 6972 656d 656e 7473 2e29 0a20  requirements.). 
+0000eb40: 2020 2020 2020 2077 7269 7465 5f70 6f73         write_pos
+0000eb50: 6974 696f 6e20 3d20 5772 6974 6550 6f73  ition = WritePos
+0000eb60: 6974 696f 6e28 0a20 2020 2020 2020 2020  ition(.         
+0000eb70: 2020 2078 706f 733d 7772 6974 655f 706f     xpos=write_po
+0000eb80: 7369 7469 6f6e 2e78 706f 732c 0a20 2020  sition.xpos,.   
+0000eb90: 2020 2020 2020 2020 2079 706f 733d 7772           ypos=wr
+0000eba0: 6974 655f 706f 7369 7469 6f6e 2e79 706f  ite_position.ypo
+0000ebb0: 732c 0a20 2020 2020 2020 2020 2020 2077  s,.            w
+0000ebc0: 6964 7468 3d77 7269 7465 5f70 6f73 6974  idth=write_posit
+0000ebd0: 696f 6e2e 7769 6474 682c 0a20 2020 2020  ion.width,.     
+0000ebe0: 2020 2020 2020 2068 6569 6768 743d 7772         height=wr
+0000ebf0: 6974 655f 706f 7369 7469 6f6e 2e68 6569  ite_position.hei
+0000ec00: 6768 742c 0a20 2020 2020 2020 2029 0a0a  ght,.        )..
+0000ec10: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000ec20: 6669 7865 645f 7769 6474 6828 293a 0a20  fixed_width():. 
+0000ec30: 2020 2020 2020 2020 2020 2077 7269 7465             write
+0000ec40: 5f70 6f73 6974 696f 6e2e 7769 6474 6820  _position.width 
+0000ec50: 3d20 6d69 6e28 0a20 2020 2020 2020 2020  = min(.         
+0000ec60: 2020 2020 2020 2077 7269 7465 5f70 6f73         write_pos
+0000ec70: 6974 696f 6e2e 7769 6474 682c 0a20 2020  ition.width,.   
+0000ec80: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000ec90: 662e 7072 6566 6572 7265 645f 7769 6474  f.preferred_widt
+0000eca0: 6828 7772 6974 655f 706f 7369 7469 6f6e  h(write_position
+0000ecb0: 2e77 6964 7468 292e 7072 6566 6572 7265  .width).preferre
+0000ecc0: 642c 0a20 2020 2020 2020 2020 2020 2029  d,.            )
+0000ecd0: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0000ece0: 662e 6669 7865 645f 6865 6967 6874 2829  f.fixed_height()
+0000ecf0: 3a0a 2020 2020 2020 2020 2020 2020 7772  :.            wr
+0000ed00: 6974 655f 706f 7369 7469 6f6e 2e68 6569  ite_position.hei
+0000ed10: 6768 7420 3d20 6d69 6e28 0a20 2020 2020  ght = min(.     
+0000ed20: 2020 2020 2020 2020 2020 2077 7269 7465             write
+0000ed30: 5f70 6f73 6974 696f 6e2e 6865 6967 6874  _position.height
+0000ed40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ed50: 2020 7365 6c66 2e70 7265 6665 7272 6564    self.preferred
+0000ed60: 5f68 6569 6768 7428 0a20 2020 2020 2020  _height(.       
+0000ed70: 2020 2020 2020 2020 2020 2020 2077 7269               wri
+0000ed80: 7465 5f70 6f73 6974 696f 6e2e 7769 6474  te_position.widt
+0000ed90: 682c 2077 7269 7465 5f70 6f73 6974 696f  h, write_positio
+0000eda0: 6e2e 6865 6967 6874 0a20 2020 2020 2020  n.height.       
+0000edb0: 2020 2020 2020 2020 2029 2e70 7265 6665           ).prefe
+0000edc0: 7272 6564 2c0a 2020 2020 2020 2020 2020  rred,.          
+0000edd0: 2020 290a 0a20 2020 2020 2020 2023 2044    )..        # D
+0000ede0: 7261 770a 2020 2020 2020 2020 7a5f 696e  raw.        z_in
+0000edf0: 6465 7820 3d20 7a5f 696e 6465 7820 6966  dex = z_index if
+0000ee00: 2073 656c 662e 7a5f 696e 6465 7820 6973   self.z_index is
+0000ee10: 204e 6f6e 6520 656c 7365 2073 656c 662e   None else self.
+0000ee20: 7a5f 696e 6465 780a 0a20 2020 2020 2020  z_index..       
+0000ee30: 2064 7261 775f 6675 6e63 203d 2070 6172   draw_func = par
+0000ee40: 7469 616c 280a 2020 2020 2020 2020 2020  tial(.          
+0000ee50: 2020 7365 6c66 2e5f 7772 6974 655f 746f    self._write_to
+0000ee60: 5f73 6372 6565 6e5f 6174 5f69 6e64 6578  _screen_at_index
+0000ee70: 2c0a 2020 2020 2020 2020 2020 2020 7363  ,.            sc
+0000ee80: 7265 656e 2c0a 2020 2020 2020 2020 2020  reen,.          
+0000ee90: 2020 6d6f 7573 655f 6861 6e64 6c65 7273    mouse_handlers
+0000eea0: 2c0a 2020 2020 2020 2020 2020 2020 7772  ,.            wr
+0000eeb0: 6974 655f 706f 7369 7469 6f6e 2c0a 2020  ite_position,.  
+0000eec0: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
+0000eed0: 5f73 7479 6c65 2c0a 2020 2020 2020 2020  _style,.        
+0000eee0: 2020 2020 6572 6173 655f 6267 2c0a 2020      erase_bg,.  
+0000eef0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+0000ef00: 2069 6620 7a5f 696e 6465 7820 6973 204e   if z_index is N
+0000ef10: 6f6e 6520 6f72 207a 5f69 6e64 6578 203c  one or z_index <
+0000ef20: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0000ef30: 2023 2057 6865 6e20 6e6f 207a 5f69 6e64   # When no z_ind
+0000ef40: 6578 2069 7320 6769 7665 6e2c 2064 7261  ex is given, dra
+0000ef50: 7720 7269 6768 7420 6177 6179 2e0a 2020  w right away..  
+0000ef60: 2020 2020 2020 2020 2020 6472 6177 5f66            draw_f
+0000ef70: 756e 6328 290a 2020 2020 2020 2020 656c  unc().        el
+0000ef80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000ef90: 2320 4f74 6865 7277 6973 652c 2070 6f73  # Otherwise, pos
+0000efa0: 7470 6f6e 652e 0a20 2020 2020 2020 2020  tpone..         
+0000efb0: 2020 2073 6372 6565 6e2e 6472 6177 5f77     screen.draw_w
+0000efc0: 6974 685f 7a5f 696e 6465 7828 7a5f 696e  ith_z_index(z_in
+0000efd0: 6465 783d 7a5f 696e 6465 782c 2064 7261  dex=z_index, dra
+0000efe0: 775f 6675 6e63 3d64 7261 775f 6675 6e63  w_func=draw_func
+0000eff0: 290a 0a20 2020 2064 6566 205f 7772 6974  )..    def _writ
+0000f000: 655f 746f 5f73 6372 6565 6e5f 6174 5f69  e_to_screen_at_i
+0000f010: 6e64 6578 280a 2020 2020 2020 2020 7365  ndex(.        se
+0000f020: 6c66 2c0a 2020 2020 2020 2020 7363 7265  lf,.        scre
+0000f030: 656e 3a20 5363 7265 656e 2c0a 2020 2020  en: Screen,.    
+0000f040: 2020 2020 6d6f 7573 655f 6861 6e64 6c65      mouse_handle
+0000f050: 7273 3a20 4d6f 7573 6548 616e 646c 6572  rs: MouseHandler
+0000f060: 732c 0a20 2020 2020 2020 2077 7269 7465  s,.        write
+0000f070: 5f70 6f73 6974 696f 6e3a 2057 7269 7465  _position: Write
+0000f080: 506f 7369 7469 6f6e 2c0a 2020 2020 2020  Position,.      
+0000f090: 2020 7061 7265 6e74 5f73 7479 6c65 3a20    parent_style: 
+0000f0a0: 7374 722c 0a20 2020 2020 2020 2065 7261  str,.        era
+0000f0b0: 7365 5f62 673a 2062 6f6f 6c2c 0a20 2020  se_bg: bool,.   
+0000f0c0: 2029 202d 3e20 4e6f 6e65 3a0a 2020 2020   ) -> None:.    
+0000f0d0: 2020 2020 2320 446f 6e27 7420 626f 7468      # Don't both
+0000f0e0: 6572 2077 7269 7469 6e67 2069 6e76 6973  er writing invis
+0000f0f0: 6962 6c65 2077 696e 646f 7773 2e0a 2020  ible windows..  
+0000f100: 2020 2020 2020 2320 2857 6520 7361 7665        # (We save
+0000f110: 2073 6f6d 6520 7469 6d65 2c20 6275 7420   some time, but 
+0000f120: 616c 736f 2061 766f 6964 2061 7070 6c79  also avoid apply
+0000f130: 696e 6720 6c61 7374 2d6c 696e 6520 7374  ing last-line st
+0000f140: 796c 696e 672e 290a 2020 2020 2020 2020  yling.).        
+0000f150: 6966 2077 7269 7465 5f70 6f73 6974 696f  if write_positio
+0000f160: 6e2e 6865 6967 6874 203c 3d20 3020 6f72  n.height <= 0 or
+0000f170: 2077 7269 7465 5f70 6f73 6974 696f 6e2e   write_position.
+0000f180: 7769 6474 6820 3c3d 2030 3a0a 2020 2020  width <= 0:.    
+0000f190: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+0000f1a0: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
+0000f1b0: 6174 6520 6d61 7267 696e 2073 697a 6573  ate margin sizes
+0000f1c0: 2e0a 2020 2020 2020 2020 6c65 6674 5f6d  ..        left_m
+0000f1d0: 6172 6769 6e5f 7769 6474 6873 203d 205b  argin_widths = [
+0000f1e0: 7365 6c66 2e5f 6765 745f 6d61 7267 696e  self._get_margin
+0000f1f0: 5f77 6964 7468 286d 2920 666f 7220 6d20  _width(m) for m 
+0000f200: 696e 2073 656c 662e 6c65 6674 5f6d 6172  in self.left_mar
+0000f210: 6769 6e73 5d0a 2020 2020 2020 2020 7269  gins].        ri
+0000f220: 6768 745f 6d61 7267 696e 5f77 6964 7468  ght_margin_width
+0000f230: 7320 3d20 5b73 656c 662e 5f67 6574 5f6d  s = [self._get_m
+0000f240: 6172 6769 6e5f 7769 6474 6828 6d29 2066  argin_width(m) f
+0000f250: 6f72 206d 2069 6e20 7365 6c66 2e72 6967  or m in self.rig
+0000f260: 6874 5f6d 6172 6769 6e73 5d0a 2020 2020  ht_margins].    
+0000f270: 2020 2020 746f 7461 6c5f 6d61 7267 696e      total_margin
+0000f280: 5f77 6964 7468 203d 2073 756d 286c 6566  _width = sum(lef
+0000f290: 745f 6d61 7267 696e 5f77 6964 7468 7320  t_margin_widths 
+0000f2a0: 2b20 7269 6768 745f 6d61 7267 696e 5f77  + right_margin_w
+0000f2b0: 6964 7468 7329 0a0a 2020 2020 2020 2020  idths)..        
+0000f2c0: 2320 5265 6e64 6572 2055 7365 7243 6f6e  # Render UserCon
+0000f2d0: 7472 6f6c 2e0a 2020 2020 2020 2020 7569  trol..        ui
+0000f2e0: 5f63 6f6e 7465 6e74 203d 2073 656c 662e  _content = self.
+0000f2f0: 636f 6e74 656e 742e 6372 6561 7465 5f63  content.create_c
+0000f300: 6f6e 7465 6e74 280a 2020 2020 2020 2020  ontent(.        
+0000f310: 2020 2020 7772 6974 655f 706f 7369 7469      write_positi
+0000f320: 6f6e 2e77 6964 7468 202d 2074 6f74 616c  on.width - total
+0000f330: 5f6d 6172 6769 6e5f 7769 6474 682c 2077  _margin_width, w
+0000f340: 7269 7465 5f70 6f73 6974 696f 6e2e 6865  rite_position.he
+0000f350: 6967 6874 0a20 2020 2020 2020 2029 0a20  ight.        ). 
+0000f360: 2020 2020 2020 2061 7373 6572 7420 6973         assert is
+0000f370: 696e 7374 616e 6365 2875 695f 636f 6e74  instance(ui_cont
+0000f380: 656e 742c 2055 4943 6f6e 7465 6e74 290a  ent, UIContent).
+0000f390: 0a20 2020 2020 2020 2023 2053 6372 6f6c  .        # Scrol
+0000f3a0: 6c20 636f 6e74 656e 742e 0a20 2020 2020  l content..     
+0000f3b0: 2020 2077 7261 705f 6c69 6e65 7320 3d20     wrap_lines = 
+0000f3c0: 7365 6c66 2e77 7261 705f 6c69 6e65 7328  self.wrap_lines(
+0000f3d0: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+0000f3e0: 7363 726f 6c6c 280a 2020 2020 2020 2020  scroll(.        
+0000f3f0: 2020 2020 7569 5f63 6f6e 7465 6e74 2c20      ui_content, 
+0000f400: 7772 6974 655f 706f 7369 7469 6f6e 2e77  write_position.w
+0000f410: 6964 7468 202d 2074 6f74 616c 5f6d 6172  idth - total_mar
+0000f420: 6769 6e5f 7769 6474 682c 2077 7269 7465  gin_width, write
+0000f430: 5f70 6f73 6974 696f 6e2e 6865 6967 6874  _position.height
+0000f440: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+0000f450: 2020 2020 2320 4572 6173 6520 6261 636b      # Erase back
+0000f460: 6772 6f75 6e64 2061 6e64 2066 696c 6c20  ground and fill 
+0000f470: 7769 7468 2060 6368 6172 602e 0a20 2020  with `char`..   
+0000f480: 2020 2020 2073 656c 662e 5f66 696c 6c5f       self._fill_
+0000f490: 6267 2873 6372 6565 6e2c 2077 7269 7465  bg(screen, write
+0000f4a0: 5f70 6f73 6974 696f 6e2c 2065 7261 7365  _position, erase
+0000f4b0: 5f62 6729 0a0a 2020 2020 2020 2020 2320  _bg)..        # 
+0000f4c0: 5265 736f 6c76 6520 6061 6c69 676e 6020  Resolve `align` 
+0000f4d0: 6174 7472 6962 7574 652e 0a20 2020 2020  attribute..     
+0000f4e0: 2020 2061 6c69 676e 203d 2073 656c 662e     align = self.
+0000f4f0: 616c 6967 6e28 2920 6966 2063 616c 6c61  align() if calla
+0000f500: 626c 6528 7365 6c66 2e61 6c69 676e 2920  ble(self.align) 
+0000f510: 656c 7365 2073 656c 662e 616c 6967 6e0a  else self.align.
+0000f520: 0a20 2020 2020 2020 2023 2057 7269 7465  .        # Write
+0000f530: 2062 6f64 790a 2020 2020 2020 2020 7669   body.        vi
+0000f540: 7369 626c 655f 6c69 6e65 5f74 6f5f 726f  sible_line_to_ro
+0000f550: 775f 636f 6c2c 2072 6f77 636f 6c5f 746f  w_col, rowcol_to
+0000f560: 5f79 7820 3d20 7365 6c66 2e5f 636f 7079  _yx = self._copy
+0000f570: 5f62 6f64 7928 0a20 2020 2020 2020 2020  _body(.         
+0000f580: 2020 2075 695f 636f 6e74 656e 742c 0a20     ui_content,. 
+0000f590: 2020 2020 2020 2020 2020 2073 6372 6565             scree
+0000f5a0: 6e2c 0a20 2020 2020 2020 2020 2020 2077  n,.            w
+0000f5b0: 7269 7465 5f70 6f73 6974 696f 6e2c 0a20  rite_position,. 
+0000f5c0: 2020 2020 2020 2020 2020 2073 756d 286c             sum(l
+0000f5d0: 6566 745f 6d61 7267 696e 5f77 6964 7468  eft_margin_width
+0000f5e0: 7329 2c0a 2020 2020 2020 2020 2020 2020  s),.            
+0000f5f0: 7772 6974 655f 706f 7369 7469 6f6e 2e77  write_position.w
+0000f600: 6964 7468 202d 2074 6f74 616c 5f6d 6172  idth - total_mar
+0000f610: 6769 6e5f 7769 6474 682c 0a20 2020 2020  gin_width,.     
+0000f620: 2020 2020 2020 2073 656c 662e 7665 7274         self.vert
+0000f630: 6963 616c 5f73 6372 6f6c 6c2c 0a20 2020  ical_scroll,.   
+0000f640: 2020 2020 2020 2020 2073 656c 662e 686f           self.ho
+0000f650: 7269 7a6f 6e74 616c 5f73 6372 6f6c 6c2c  rizontal_scroll,
+0000f660: 0a20 2020 2020 2020 2020 2020 2077 7261  .            wra
+0000f670: 705f 6c69 6e65 733d 7772 6170 5f6c 696e  p_lines=wrap_lin
+0000f680: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+0000f690: 6869 6768 6c69 6768 745f 6c69 6e65 733d  highlight_lines=
+0000f6a0: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+0000f6b0: 2020 7665 7274 6963 616c 5f73 6372 6f6c    vertical_scrol
+0000f6c0: 6c5f 323d 7365 6c66 2e76 6572 7469 6361  l_2=self.vertica
+0000f6d0: 6c5f 7363 726f 6c6c 5f32 2c0a 2020 2020  l_scroll_2,.    
+0000f6e0: 2020 2020 2020 2020 616c 7761 7973 5f68          always_h
+0000f6f0: 6964 655f 6375 7273 6f72 3d73 656c 662e  ide_cursor=self.
+0000f700: 616c 7761 7973 5f68 6964 655f 6375 7273  always_hide_curs
+0000f710: 6f72 2829 2c0a 2020 2020 2020 2020 2020  or(),.          
+0000f720: 2020 6861 735f 666f 6375 733d 6765 745f    has_focus=get_
+0000f730: 6170 7028 292e 6c61 796f 7574 2e63 7572  app().layout.cur
+0000f740: 7265 6e74 5f63 6f6e 7472 6f6c 203d 3d20  rent_control == 
+0000f750: 7365 6c66 2e63 6f6e 7465 6e74 2c0a 2020  self.content,.  
+0000f760: 2020 2020 2020 2020 2020 616c 6967 6e3d            align=
+0000f770: 616c 6967 6e2c 0a20 2020 2020 2020 2020  align,.         
+0000f780: 2020 2067 6574 5f6c 696e 655f 7072 6566     get_line_pref
+0000f790: 6978 3d73 656c 662e 6765 745f 6c69 6e65  ix=self.get_line
+0000f7a0: 5f70 7265 6669 782c 0a20 2020 2020 2020  _prefix,.       
+0000f7b0: 2029 0a0a 2020 2020 2020 2020 2320 5265   )..        # Re
+0000f7c0: 6d65 6d62 6572 2072 656e 6465 7220 696e  member render in
+0000f7d0: 666f 2e20 2853 6574 2062 6566 6f72 6520  fo. (Set before 
+0000f7e0: 6765 6e65 7261 7469 6e67 2074 6865 206d  generating the m
+0000f7f0: 6172 6769 6e73 2e20 5468 6579 206e 6565  argins. They nee
+0000f800: 6420 7468 6973 2e29 0a20 2020 2020 2020  d this.).       
+0000f810: 2078 5f6f 6666 7365 7420 3d20 7772 6974   x_offset = writ
+0000f820: 655f 706f 7369 7469 6f6e 2e78 706f 7320  e_position.xpos 
+0000f830: 2b20 7375 6d28 6c65 6674 5f6d 6172 6769  + sum(left_margi
+0000f840: 6e5f 7769 6474 6873 290a 2020 2020 2020  n_widths).      
+0000f850: 2020 795f 6f66 6673 6574 203d 2077 7269    y_offset = wri
+0000f860: 7465 5f70 6f73 6974 696f 6e2e 7970 6f73  te_position.ypos
+0000f870: 0a0a 2020 2020 2020 2020 7265 6e64 6572  ..        render
+0000f880: 5f69 6e66 6f20 3d20 5769 6e64 6f77 5265  _info = WindowRe
+0000f890: 6e64 6572 496e 666f 280a 2020 2020 2020  nderInfo(.      
+0000f8a0: 2020 2020 2020 7769 6e64 6f77 3d73 656c        window=sel
+0000f8b0: 662c 0a20 2020 2020 2020 2020 2020 2075  f,.            u
+0000f8c0: 695f 636f 6e74 656e 743d 7569 5f63 6f6e  i_content=ui_con
+0000f8d0: 7465 6e74 2c0a 2020 2020 2020 2020 2020  tent,.          
+0000f8e0: 2020 686f 7269 7a6f 6e74 616c 5f73 6372    horizontal_scr
+0000f8f0: 6f6c 6c3d 7365 6c66 2e68 6f72 697a 6f6e  oll=self.horizon
+0000f900: 7461 6c5f 7363 726f 6c6c 2c0a 2020 2020  tal_scroll,.    
+0000f910: 2020 2020 2020 2020 7665 7274 6963 616c          vertical
+0000f920: 5f73 6372 6f6c 6c3d 7365 6c66 2e76 6572  _scroll=self.ver
+0000f930: 7469 6361 6c5f 7363 726f 6c6c 2c0a 2020  tical_scroll,.  
+0000f940: 2020 2020 2020 2020 2020 7769 6e64 6f77            window
+0000f950: 5f77 6964 7468 3d77 7269 7465 5f70 6f73  _width=write_pos
+0000f960: 6974 696f 6e2e 7769 6474 6820 2d20 746f  ition.width - to
+0000f970: 7461 6c5f 6d61 7267 696e 5f77 6964 7468  tal_margin_width
+0000f980: 2c0a 2020 2020 2020 2020 2020 2020 7769  ,.            wi
+0000f990: 6e64 6f77 5f68 6569 6768 743d 7772 6974  ndow_height=writ
+0000f9a0: 655f 706f 7369 7469 6f6e 2e68 6569 6768  e_position.heigh
+0000f9b0: 742c 0a20 2020 2020 2020 2020 2020 2063  t,.            c
+0000f9c0: 6f6e 6669 6775 7265 645f 7363 726f 6c6c  onfigured_scroll
+0000f9d0: 5f6f 6666 7365 7473 3d73 656c 662e 7363  _offsets=self.sc
+0000f9e0: 726f 6c6c 5f6f 6666 7365 7473 2c0a 2020  roll_offsets,.  
+0000f9f0: 2020 2020 2020 2020 2020 7669 7369 626c            visibl
+0000fa00: 655f 6c69 6e65 5f74 6f5f 726f 775f 636f  e_line_to_row_co
+0000fa10: 6c3d 7669 7369 626c 655f 6c69 6e65 5f74  l=visible_line_t
+0000fa20: 6f5f 726f 775f 636f 6c2c 0a20 2020 2020  o_row_col,.     
+0000fa30: 2020 2020 2020 2072 6f77 636f 6c5f 746f         rowcol_to
+0000fa40: 5f79 783d 726f 7763 6f6c 5f74 6f5f 7978  _yx=rowcol_to_yx
+0000fa50: 2c0a 2020 2020 2020 2020 2020 2020 785f  ,.            x_
+0000fa60: 6f66 6673 6574 3d78 5f6f 6666 7365 742c  offset=x_offset,
+0000fa70: 0a20 2020 2020 2020 2020 2020 2079 5f6f  .            y_o
+0000fa80: 6666 7365 743d 795f 6f66 6673 6574 2c0a  ffset=y_offset,.
+0000fa90: 2020 2020 2020 2020 2020 2020 7772 6170              wrap
+0000faa0: 5f6c 696e 6573 3d77 7261 705f 6c69 6e65  _lines=wrap_line
+0000fab0: 732c 0a20 2020 2020 2020 2029 0a20 2020  s,.        ).   
+0000fac0: 2020 2020 2073 656c 662e 7265 6e64 6572       self.render
+0000fad0: 5f69 6e66 6f20 3d20 7265 6e64 6572 5f69  _info = render_i
+0000fae0: 6e66 6f0a 0a20 2020 2020 2020 2023 2053  nfo..        # S
+0000faf0: 6574 206d 6f75 7365 2068 616e 646c 6572  et mouse handler
+0000fb00: 732e 0a20 2020 2020 2020 2064 6566 206d  s..        def m
+0000fb10: 6f75 7365 5f68 616e 646c 6572 286d 6f75  ouse_handler(mou
+0000fb20: 7365 5f65 7665 6e74 3a20 4d6f 7573 6545  se_event: MouseE
+0000fb30: 7665 6e74 2920 2d3e 204e 6f6e 653a 0a20  vent) -> None:. 
+0000fb40: 2020 2020 2020 2020 2020 2022 2222 5772             """Wr
+0000fb50: 6170 7065 7220 6172 6f75 6e64 2074 6865  apper around the
+0000fb60: 206d 6f75 7365 5f68 616e 646c 6572 206f   mouse_handler o
+0000fb70: 6620 7468 6520 6055 4943 6f6e 7472 6f6c  f the `UIControl
+0000fb80: 6020 7468 6174 2074 7572 6e73 0a20 2020  ` that turns.   
+0000fb90: 2020 2020 2020 2020 2073 6372 6565 6e20           screen 
+0000fba0: 636f 6f72 6469 6e61 7465 7320 696e 746f  coordinates into
+0000fbb0: 206c 696e 6520 636f 6f72 6469 6e61 7465   line coordinate
+0000fbc0: 732e 2222 220a 2020 2020 2020 2020 2020  s.""".          
+0000fbd0: 2020 2320 446f 6e27 7420 6861 6e64 6c65    # Don't handle
+0000fbe0: 206d 6f75 7365 2065 7665 6e74 7320 6f75   mouse events ou
+0000fbf0: 7473 6964 6520 6f66 2074 6865 2063 7572  tside of the cur
+0000fc00: 7265 6e74 206d 6f64 616c 2070 6172 7420  rent modal part 
+0000fc10: 6f66 0a20 2020 2020 2020 2020 2020 2023  of.            #
+0000fc20: 2074 6865 2055 492e 0a20 2020 2020 2020   the UI..       
+0000fc30: 2020 2020 2069 6620 7365 6c66 206e 6f74       if self not
+0000fc40: 2069 6e20 6765 745f 6170 7028 292e 6c61   in get_app().la
+0000fc50: 796f 7574 2e77 616c 6b5f 7468 726f 7567  yout.walk_throug
+0000fc60: 685f 6d6f 6461 6c5f 6172 6561 2829 3a0a  h_modal_area():.
+0000fc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fc80: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
+0000fc90: 2020 2020 2320 4669 6e64 2072 6f77 2f63      # Find row/c
+0000fca0: 6f6c 2070 6f73 6974 696f 6e20 6669 7273  ol position firs
+0000fcb0: 742e 0a20 2020 2020 2020 2020 2020 2079  t..            y
+0000fcc0: 785f 746f 5f72 6f77 636f 6c20 3d20 7b76  x_to_rowcol = {v
+0000fcd0: 3a20 6b20 666f 7220 6b2c 2076 2069 6e20  : k for k, v in 
+0000fce0: 726f 7763 6f6c 5f74 6f5f 7978 2e69 7465  rowcol_to_yx.ite
+0000fcf0: 6d73 2829 7d0a 2020 2020 2020 2020 2020  ms()}.          
+0000fd00: 2020 7920 3d20 6d6f 7573 655f 6576 656e    y = mouse_even
+0000fd10: 742e 706f 7369 7469 6f6e 2e79 0a20 2020  t.position.y.   
+0000fd20: 2020 2020 2020 2020 2078 203d 206d 6f75           x = mou
+0000fd30: 7365 5f65 7665 6e74 2e70 6f73 6974 696f  se_event.positio
+0000fd40: 6e2e 780a 0a20 2020 2020 2020 2020 2020  n.x..           
+0000fd50: 2023 2049 6620 636c 6963 6b65 6420 6265   # If clicked be
+0000fd60: 6c6f 7720 7468 6520 636f 6e74 656e 7420  low the content 
+0000fd70: 6172 6561 2c20 6c6f 6f6b 2066 6f72 2061  area, look for a
+0000fd80: 2070 6f73 6974 696f 6e20 696e 2074 6865   position in the
+0000fd90: 0a20 2020 2020 2020 2020 2020 2023 206c  .            # l
+0000fda0: 6173 7420 6c69 6e65 2069 6e73 7465 6164  ast line instead
+0000fdb0: 2e0a 2020 2020 2020 2020 2020 2020 6d61  ..            ma
+0000fdc0: 785f 7920 3d20 7772 6974 655f 706f 7369  x_y = write_posi
+0000fdd0: 7469 6f6e 2e79 706f 7320 2b20 6c65 6e28  tion.ypos + len(
+0000fde0: 7669 7369 626c 655f 6c69 6e65 5f74 6f5f  visible_line_to_
+0000fdf0: 726f 775f 636f 6c29 202d 2031 0a20 2020  row_col) - 1.   
+0000fe00: 2020 2020 2020 2020 2079 203d 206d 696e           y = min
+0000fe10: 286d 6178 5f79 2c20 7929 0a20 2020 2020  (max_y, y).     
+0000fe20: 2020 2020 2020 2072 6573 756c 743a 204e         result: N
+0000fe30: 6f74 496d 706c 656d 656e 7465 644f 724e  otImplementedOrN
+0000fe40: 6f6e 650a 0a20 2020 2020 2020 2020 2020  one..           
+0000fe50: 2077 6869 6c65 2078 203e 3d20 303a 0a20   while x >= 0:. 
+0000fe60: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000fe70: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0000fe80: 2020 2020 2020 2020 726f 772c 2063 6f6c          row, col
+0000fe90: 203d 2079 785f 746f 5f72 6f77 636f 6c5b   = yx_to_rowcol[
+0000fea0: 792c 2078 5d0a 2020 2020 2020 2020 2020  y, x].          
+0000feb0: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
+0000fec0: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
+0000fed0: 2020 2020 2020 2020 2020 2023 2054 7279             # Try
+0000fee0: 2061 6761 696e 2e20 2857 6865 6e20 636c   again. (When cl
+0000fef0: 6963 6b69 6e67 206f 6e20 7468 6520 7269  icking on the ri
+0000ff00: 6768 7420 7369 6465 206f 6620 646f 7562  ght side of doub
+0000ff10: 6c65 0a20 2020 2020 2020 2020 2020 2020  le.             
+0000ff20: 2020 2020 2020 2023 2077 6964 7468 2063         # width c
+0000ff30: 6861 7261 6374 6572 732c 206f 7220 6f6e  haracters, or on
+0000ff40: 2074 6865 2072 6967 6874 2073 6964 6520   the right side 
+0000ff50: 6f66 2074 6865 2069 6e70 7574 2e29 0a20  of the input.). 
 0000ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff70: 6578 6365 7074 204b 6579 4572 726f 723a  except KeyError:
-0000ff80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ff90: 2020 2020 2023 2054 7279 2061 6761 696e       # Try again
-0000ffa0: 2e20 2857 6865 6e20 636c 6963 6b69 6e67  . (When clicking
-0000ffb0: 206f 6e20 7468 6520 7269 6768 7420 7369   on the right si
-0000ffc0: 6465 206f 6620 646f 7562 6c65 0a20 2020  de of double.   
-0000ffd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ffe0: 2023 2077 6964 7468 2063 6861 7261 6374   # width charact
-0000fff0: 6572 732c 206f 7220 6f6e 2074 6865 2072  ers, or on the r
-00010000: 6967 6874 2073 6964 6520 6f66 2074 6865  ight side of the
-00010010: 2069 6e70 7574 2e29 0a20 2020 2020 2020   input.).       
-00010020: 2020 2020 2020 2020 2020 2020 2078 202d               x -
-00010030: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00010040: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00010050: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00010060: 466f 756e 6420 706f 7369 7469 6f6e 2c20  Found position, 
-00010070: 6361 6c6c 2068 616e 646c 6572 206f 6620  call handler of 
-00010080: 5549 436f 6e74 726f 6c2e 0a20 2020 2020  UIControl..     
-00010090: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000100a0: 6573 756c 7420 3d20 7365 6c66 2e63 6f6e  esult = self.con
-000100b0: 7465 6e74 2e6d 6f75 7365 5f68 616e 646c  tent.mouse_handl
-000100c0: 6572 280a 2020 2020 2020 2020 2020 2020  er(.            
-000100d0: 2020 2020 2020 2020 2020 2020 4d6f 7573              Mous
-000100e0: 6545 7665 6e74 280a 2020 2020 2020 2020  eEvent(.        
-000100f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010100: 2020 2020 706f 7369 7469 6f6e 3d50 6f69      position=Poi
-00010110: 6e74 2878 3d63 6f6c 2c20 793d 726f 7729  nt(x=col, y=row)
-00010120: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00010130: 2020 2020 2020 2020 2020 2020 2020 6576                ev
-00010140: 656e 745f 7479 7065 3d6d 6f75 7365 5f65  ent_type=mouse_e
-00010150: 7665 6e74 2e65 7665 6e74 5f74 7970 652c  vent.event_type,
-00010160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010170: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00010180: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00010190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000101a0: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
-000101b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000101c0: 2020 2020 2020 2020 2020 2020 2023 206e               # n
-000101d0: 6f62 7265 616b 2e0a 2020 2020 2020 2020  obreak..        
-000101e0: 2020 2020 2020 2020 2320 284e 6f20 782f          # (No x/
-000101f0: 7920 636f 6f72 6469 6e61 7465 2066 6f75  y coordinate fou
-00010200: 6e64 2066 6f72 2074 6865 2063 6f6e 7465  nd for the conte
-00010210: 6e74 2e20 5468 6973 2068 6170 7065 6e73  nt. This happens
-00010220: 2069 6e0a 2020 2020 2020 2020 2020 2020   in.            
-00010230: 2020 2020 2320 6361 7365 206f 6620 6120      # case of a 
-00010240: 4475 6d6d 7943 6f6e 7472 6f6c 2c20 7468  DummyControl, th
-00010250: 6174 2064 6f65 7320 6e6f 7420 6861 7665  at does not have
-00010260: 2061 6e79 2063 6f6e 7465 6e74 2e0a 2020   any content..  
-00010270: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00010280: 5265 706f 7274 2028 302c 3029 2069 6e73  Report (0,0) ins
-00010290: 7465 6164 2e29 0a20 2020 2020 2020 2020  tead.).         
-000102a0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-000102b0: 7365 6c66 2e63 6f6e 7465 6e74 2e6d 6f75  self.content.mou
-000102c0: 7365 5f68 616e 646c 6572 280a 2020 2020  se_handler(.    
-000102d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000102e0: 4d6f 7573 6545 7665 6e74 280a 2020 2020  MouseEvent(.    
-000102f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010300: 2020 2020 706f 7369 7469 6f6e 3d50 6f69      position=Poi
-00010310: 6e74 2878 3d30 2c20 793d 3029 2c20 6576  nt(x=0, y=0), ev
-00010320: 656e 745f 7479 7065 3d6d 6f75 7365 5f65  ent_type=mouse_e
-00010330: 7665 6e74 2e65 7665 6e74 5f74 7970 650a  vent.event_type.
-00010340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010350: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00010360: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-00010370: 2020 2020 2023 2049 6620 6974 2072 6574       # If it ret
-00010380: 7572 6e73 204e 6f74 496d 706c 656d 656e  urns NotImplemen
-00010390: 7465 642c 2068 616e 646c 6520 6974 2068  ted, handle it h
-000103a0: 6572 652e 0a20 2020 2020 2020 2020 2020  ere..           
-000103b0: 2069 6620 7265 7375 6c74 203d 3d20 4e6f   if result == No
-000103c0: 7449 6d70 6c65 6d65 6e74 6564 3a0a 2020  tImplemented:.  
-000103d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000103e0: 6c66 2e5f 6d6f 7573 655f 6861 6e64 6c65  lf._mouse_handle
-000103f0: 7228 6d6f 7573 655f 6576 656e 7429 0a0a  r(mouse_event)..
-00010400: 2020 2020 2020 2020 6d6f 7573 655f 6861          mouse_ha
-00010410: 6e64 6c65 7273 2e73 6574 5f6d 6f75 7365  ndlers.set_mouse
-00010420: 5f68 616e 646c 6572 5f66 6f72 5f72 616e  _handler_for_ran
-00010430: 6765 280a 2020 2020 2020 2020 2020 2020  ge(.            
-00010440: 785f 6d69 6e3d 7772 6974 655f 706f 7369  x_min=write_posi
-00010450: 7469 6f6e 2e78 706f 7320 2b20 7375 6d28  tion.xpos + sum(
-00010460: 6c65 6674 5f6d 6172 6769 6e5f 7769 6474  left_margin_widt
-00010470: 6873 292c 0a20 2020 2020 2020 2020 2020  hs),.           
-00010480: 2078 5f6d 6178 3d77 7269 7465 5f70 6f73   x_max=write_pos
-00010490: 6974 696f 6e2e 7870 6f73 202b 2077 7269  ition.xpos + wri
-000104a0: 7465 5f70 6f73 6974 696f 6e2e 7769 6474  te_position.widt
-000104b0: 6820 2d20 746f 7461 6c5f 6d61 7267 696e  h - total_margin
-000104c0: 5f77 6964 7468 2c0a 2020 2020 2020 2020  _width,.        
-000104d0: 2020 2020 795f 6d69 6e3d 7772 6974 655f      y_min=write_
-000104e0: 706f 7369 7469 6f6e 2e79 706f 732c 0a20  position.ypos,. 
-000104f0: 2020 2020 2020 2020 2020 2079 5f6d 6178             y_max
-00010500: 3d77 7269 7465 5f70 6f73 6974 696f 6e2e  =write_position.
-00010510: 7970 6f73 202b 2077 7269 7465 5f70 6f73  ypos + write_pos
-00010520: 6974 696f 6e2e 6865 6967 6874 2c0a 2020  ition.height,.  
-00010530: 2020 2020 2020 2020 2020 6861 6e64 6c65            handle
-00010540: 723d 6d6f 7573 655f 6861 6e64 6c65 722c  r=mouse_handler,
-00010550: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00010560: 2020 2020 2320 5265 6e64 6572 2061 6e64      # Render and
-00010570: 2063 6f70 7920 6d61 7267 696e 732e 0a20   copy margins.. 
-00010580: 2020 2020 2020 206d 6f76 655f 7820 3d20         move_x = 
-00010590: 300a 0a20 2020 2020 2020 2064 6566 2072  0..        def r
-000105a0: 656e 6465 725f 6d61 7267 696e 286d 3a20  ender_margin(m: 
-000105b0: 4d61 7267 696e 2c20 7769 6474 683a 2069  Margin, width: i
-000105c0: 6e74 2920 2d3e 2055 4943 6f6e 7465 6e74  nt) -> UIContent
-000105d0: 3a0a 2020 2020 2020 2020 2020 2020 2252  :.            "R
-000105e0: 656e 6465 7220 6d61 7267 696e 2e20 5265  ender margin. Re
-000105f0: 7475 726e 2060 5363 7265 656e 602e 220a  turn `Screen`.".
-00010600: 2020 2020 2020 2020 2020 2020 2320 5265              # Re
-00010610: 7472 6965 7665 206d 6172 6769 6e20 6672  trieve margin fr
-00010620: 6167 6d65 6e74 732e 0a20 2020 2020 2020  agments..       
-00010630: 2020 2020 2066 7261 676d 656e 7473 203d       fragments =
-00010640: 206d 2e63 7265 6174 655f 6d61 7267 696e   m.create_margin
-00010650: 2872 656e 6465 725f 696e 666f 2c20 7769  (render_info, wi
-00010660: 6474 682c 2077 7269 7465 5f70 6f73 6974  dth, write_posit
-00010670: 696f 6e2e 6865 6967 6874 290a 0a20 2020  ion.height)..   
-00010680: 2020 2020 2020 2020 2023 2054 7572 6e20           # Turn 
-00010690: 6974 2069 6e74 6f20 6120 5549 436f 6e74  it into a UICont
-000106a0: 656e 7420 6f62 6a65 6374 2e0a 2020 2020  ent object..    
-000106b0: 2020 2020 2020 2020 2320 616c 7265 6164          # alread
-000106c0: 7920 7265 6e64 6572 6564 2074 686f 7365  y rendered those
-000106d0: 2066 7261 676d 656e 7473 2075 7369 6e67   fragments using
-000106e0: 2074 6869 7320 7369 7a65 2e29 0a20 2020   this size.).   
-000106f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00010700: 466f 726d 6174 7465 6454 6578 7443 6f6e  FormattedTextCon
-00010710: 7472 6f6c 2866 7261 676d 656e 7473 292e  trol(fragments).
-00010720: 6372 6561 7465 5f63 6f6e 7465 6e74 280a  create_content(.
-00010730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010740: 7769 6474 6820 2b20 312c 2077 7269 7465  width + 1, write
-00010750: 5f70 6f73 6974 696f 6e2e 6865 6967 6874  _position.height
-00010760: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00010770: 2020 2020 2020 2020 666f 7220 6d2c 2077          for m, w
-00010780: 6964 7468 2069 6e20 7a69 7028 7365 6c66  idth in zip(self
-00010790: 2e6c 6566 745f 6d61 7267 696e 732c 206c  .left_margins, l
-000107a0: 6566 745f 6d61 7267 696e 5f77 6964 7468  eft_margin_width
-000107b0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-000107c0: 6966 2077 6964 7468 203e 2030 3a20 2023  if width > 0:  #
-000107d0: 2028 436f 6e64 6974 696f 6e61 6c4d 6172   (ConditionalMar
-000107e0: 6769 6e20 7265 7475 726e 7320 6120 7a65  gin returns a ze
-000107f0: 726f 2077 6964 7468 2e20 2d2d 2044 6f6e  ro width. -- Don
-00010800: 2774 2072 656e 6465 722e 290a 2020 2020  't render.).    
-00010810: 2020 2020 2020 2020 2020 2020 2320 4372              # Cr
-00010820: 6561 7465 2073 6372 6565 6e20 666f 7220  eate screen for 
-00010830: 6d61 7267 696e 2e0a 2020 2020 2020 2020  margin..        
-00010840: 2020 2020 2020 2020 6d61 7267 696e 5f63          margin_c
-00010850: 6f6e 7465 6e74 203d 2072 656e 6465 725f  ontent = render_
-00010860: 6d61 7267 696e 286d 2c20 7769 6474 6829  margin(m, width)
-00010870: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010880: 2020 2320 436f 7079 2061 6e64 2073 6869    # Copy and shi
-00010890: 6674 2058 2e0a 2020 2020 2020 2020 2020  ft X..          
-000108a0: 2020 2020 2020 7365 6c66 2e5f 636f 7079        self._copy
-000108b0: 5f6d 6172 6769 6e28 6d61 7267 696e 5f63  _margin(margin_c
-000108c0: 6f6e 7465 6e74 2c20 7363 7265 656e 2c20  ontent, screen, 
-000108d0: 7772 6974 655f 706f 7369 7469 6f6e 2c20  write_position, 
-000108e0: 6d6f 7665 5f78 2c20 7769 6474 6829 0a20  move_x, width). 
-000108f0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00010900: 6f76 655f 7820 2b3d 2077 6964 7468 0a0a  ove_x += width..
-00010910: 2020 2020 2020 2020 6d6f 7665 5f78 203d          move_x =
-00010920: 2077 7269 7465 5f70 6f73 6974 696f 6e2e   write_position.
-00010930: 7769 6474 6820 2d20 7375 6d28 7269 6768  width - sum(righ
-00010940: 745f 6d61 7267 696e 5f77 6964 7468 7329  t_margin_widths)
-00010950: 0a0a 2020 2020 2020 2020 666f 7220 6d2c  ..        for m,
-00010960: 2077 6964 7468 2069 6e20 7a69 7028 7365   width in zip(se
-00010970: 6c66 2e72 6967 6874 5f6d 6172 6769 6e73  lf.right_margins
-00010980: 2c20 7269 6768 745f 6d61 7267 696e 5f77  , right_margin_w
-00010990: 6964 7468 7329 3a0a 2020 2020 2020 2020  idths):.        
-000109a0: 2020 2020 2320 4372 6561 7465 2073 6372      # Create scr
-000109b0: 6565 6e20 666f 7220 6d61 7267 696e 2e0a  een for margin..
-000109c0: 2020 2020 2020 2020 2020 2020 6d61 7267              marg
-000109d0: 696e 5f63 6f6e 7465 6e74 203d 2072 656e  in_content = ren
-000109e0: 6465 725f 6d61 7267 696e 286d 2c20 7769  der_margin(m, wi
-000109f0: 6474 6829 0a0a 2020 2020 2020 2020 2020  dth)..          
-00010a00: 2020 2320 436f 7079 2061 6e64 2073 6869    # Copy and shi
-00010a10: 6674 2058 2e0a 2020 2020 2020 2020 2020  ft X..          
-00010a20: 2020 7365 6c66 2e5f 636f 7079 5f6d 6172    self._copy_mar
-00010a30: 6769 6e28 6d61 7267 696e 5f63 6f6e 7465  gin(margin_conte
-00010a40: 6e74 2c20 7363 7265 656e 2c20 7772 6974  nt, screen, writ
-00010a50: 655f 706f 7369 7469 6f6e 2c20 6d6f 7665  e_position, move
-00010a60: 5f78 2c20 7769 6474 6829 0a20 2020 2020  _x, width).     
-00010a70: 2020 2020 2020 206d 6f76 655f 7820 2b3d         move_x +=
-00010a80: 2077 6964 7468 0a0a 2020 2020 2020 2020   width..        
-00010a90: 2320 4170 706c 7920 2773 656c 662e 7374  # Apply 'self.st
-00010aa0: 796c 6527 0a20 2020 2020 2020 2073 656c  yle'.        sel
-00010ab0: 662e 5f61 7070 6c79 5f73 7479 6c65 2873  f._apply_style(s
-00010ac0: 6372 6565 6e2c 2077 7269 7465 5f70 6f73  creen, write_pos
-00010ad0: 6974 696f 6e2c 2070 6172 656e 745f 7374  ition, parent_st
-00010ae0: 796c 6529 0a0a 2020 2020 2020 2020 2320  yle)..        # 
-00010af0: 5465 6c6c 2074 6865 2073 6372 6565 6e20  Tell the screen 
-00010b00: 7468 6174 2074 6869 7320 7573 6572 2063  that this user c
-00010b10: 6f6e 7472 6f6c 2068 6173 2062 6565 6e20  ontrol has been 
-00010b20: 7061 696e 7465 6420 6174 2074 6869 730a  painted at this.
-00010b30: 2020 2020 2020 2020 2320 706f 7369 7469          # positi
-00010b40: 6f6e 2e0a 2020 2020 2020 2020 7363 7265  on..        scre
-00010b50: 656e 2e76 6973 6962 6c65 5f77 696e 646f  en.visible_windo
-00010b60: 7773 5f74 6f5f 7772 6974 655f 706f 7369  ws_to_write_posi
-00010b70: 7469 6f6e 735b 7365 6c66 5d20 3d20 7772  tions[self] = wr
-00010b80: 6974 655f 706f 7369 7469 6f6e 0a0a 2020  ite_position..  
-00010b90: 2020 6465 6620 5f63 6f70 795f 626f 6479    def _copy_body
-00010ba0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-00010bb0: 2020 2020 2020 2020 7569 5f63 6f6e 7465          ui_conte
-00010bc0: 6e74 3a20 5549 436f 6e74 656e 742c 0a20  nt: UIContent,. 
-00010bd0: 2020 2020 2020 206e 6577 5f73 6372 6565         new_scree
-00010be0: 6e3a 2053 6372 6565 6e2c 0a20 2020 2020  n: Screen,.     
-00010bf0: 2020 2077 7269 7465 5f70 6f73 6974 696f     write_positio
-00010c00: 6e3a 2057 7269 7465 506f 7369 7469 6f6e  n: WritePosition
-00010c10: 2c0a 2020 2020 2020 2020 6d6f 7665 5f78  ,.        move_x
-00010c20: 3a20 696e 742c 0a20 2020 2020 2020 2077  : int,.        w
-00010c30: 6964 7468 3a20 696e 742c 0a20 2020 2020  idth: int,.     
-00010c40: 2020 2076 6572 7469 6361 6c5f 7363 726f     vertical_scro
-00010c50: 6c6c 3a20 696e 7420 3d20 302c 0a20 2020  ll: int = 0,.   
-00010c60: 2020 2020 2068 6f72 697a 6f6e 7461 6c5f       horizontal_
-00010c70: 7363 726f 6c6c 3a20 696e 7420 3d20 302c  scroll: int = 0,
-00010c80: 0a20 2020 2020 2020 2077 7261 705f 6c69  .        wrap_li
-00010c90: 6e65 733a 2062 6f6f 6c20 3d20 4661 6c73  nes: bool = Fals
-00010ca0: 652c 0a20 2020 2020 2020 2068 6967 686c  e,.        highl
-00010cb0: 6967 6874 5f6c 696e 6573 3a20 626f 6f6c  ight_lines: bool
-00010cc0: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
-00010cd0: 2020 7665 7274 6963 616c 5f73 6372 6f6c    vertical_scrol
-00010ce0: 6c5f 323a 2069 6e74 203d 2030 2c0a 2020  l_2: int = 0,.  
-00010cf0: 2020 2020 2020 616c 7761 7973 5f68 6964        always_hid
-00010d00: 655f 6375 7273 6f72 3a20 626f 6f6c 203d  e_cursor: bool =
-00010d10: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-00010d20: 6861 735f 666f 6375 733a 2062 6f6f 6c20  has_focus: bool 
-00010d30: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-00010d40: 2061 6c69 676e 3a20 5769 6e64 6f77 416c   align: WindowAl
-00010d50: 6967 6e20 3d20 5769 6e64 6f77 416c 6967  ign = WindowAlig
-00010d60: 6e2e 4c45 4654 2c0a 2020 2020 2020 2020  n.LEFT,.        
-00010d70: 6765 745f 6c69 6e65 5f70 7265 6669 783a  get_line_prefix:
-00010d80: 204f 7074 696f 6e61 6c5b 4361 6c6c 6162   Optional[Callab
-00010d90: 6c65 5b5b 696e 742c 2069 6e74 5d2c 2041  le[[int, int], A
-00010da0: 6e79 466f 726d 6174 7465 6454 6578 745d  nyFormattedText]
-00010db0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2920  ] = None,.    ) 
-00010dc0: 2d3e 2054 7570 6c65 5b44 6963 745b 696e  -> Tuple[Dict[in
-00010dd0: 742c 2054 7570 6c65 5b69 6e74 2c20 696e  t, Tuple[int, in
-00010de0: 745d 5d2c 2044 6963 745b 5475 706c 655b  t]], Dict[Tuple[
-00010df0: 696e 742c 2069 6e74 5d2c 2054 7570 6c65  int, int], Tuple
-00010e00: 5b69 6e74 2c20 696e 745d 5d5d 3a0a 2020  [int, int]]]:.  
-00010e10: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00010e20: 2020 436f 7079 2074 6865 2055 4943 6f6e    Copy the UICon
-00010e30: 7465 6e74 2069 6e74 6f20 7468 6520 6f75  tent into the ou
-00010e40: 7470 7574 2073 6372 6565 6e2e 0a20 2020  tput screen..   
-00010e50: 2020 2020 2052 6574 7572 6e20 2876 6973       Return (vis
-00010e60: 6962 6c65 5f6c 696e 655f 746f 5f72 6f77  ible_line_to_row
-00010e70: 5f63 6f6c 2c20 726f 7763 6f6c 5f74 6f5f  _col, rowcol_to_
-00010e80: 7978 2920 7475 706c 652e 0a0a 2020 2020  yx) tuple...    
-00010e90: 2020 2020 3a70 6172 616d 2067 6574 5f6c      :param get_l
-00010ea0: 696e 655f 7072 6566 6978 3a20 4e6f 6e65  ine_prefix: None
-00010eb0: 206f 7220 6120 6361 6c6c 6162 6c65 2074   or a callable t
-00010ec0: 6861 7420 7461 6b65 7320 6120 6c69 6e65  hat takes a line
-00010ed0: 206e 756d 6265 720a 2020 2020 2020 2020   number.        
-00010ee0: 2020 2020 2869 6e74 2920 616e 6420 6120      (int) and a 
-00010ef0: 7772 6170 5f63 6f75 6e74 2028 696e 7429  wrap_count (int)
-00010f00: 2061 6e64 2072 6574 7572 6e73 2066 6f72   and returns for
-00010f10: 6d61 7474 6564 2074 6578 742e 0a20 2020  matted text..   
-00010f20: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00010f30: 2078 706f 7320 3d20 7772 6974 655f 706f   xpos = write_po
-00010f40: 7369 7469 6f6e 2e78 706f 7320 2b20 6d6f  sition.xpos + mo
-00010f50: 7665 5f78 0a20 2020 2020 2020 2079 706f  ve_x.        ypo
-00010f60: 7320 3d20 7772 6974 655f 706f 7369 7469  s = write_positi
-00010f70: 6f6e 2e79 706f 730a 2020 2020 2020 2020  on.ypos.        
-00010f80: 6c69 6e65 5f63 6f75 6e74 203d 2075 695f  line_count = ui_
-00010f90: 636f 6e74 656e 742e 6c69 6e65 5f63 6f75  content.line_cou
-00010fa0: 6e74 0a20 2020 2020 2020 206e 6577 5f62  nt.        new_b
-00010fb0: 7566 6665 7220 3d20 6e65 775f 7363 7265  uffer = new_scre
-00010fc0: 656e 2e64 6174 615f 6275 6666 6572 0a20  en.data_buffer. 
-00010fd0: 2020 2020 2020 2065 6d70 7479 5f63 6861         empty_cha
-00010fe0: 7220 3d20 5f43 4841 525f 4341 4348 455b  r = _CHAR_CACHE[
-00010ff0: 2222 2c20 2222 5d0a 0a20 2020 2020 2020  "", ""]..       
-00011000: 2023 204d 6170 2076 6973 6962 6c65 206c   # Map visible l
-00011010: 696e 6520 6e75 6d62 6572 2074 6f20 2872  ine number to (r
-00011020: 6f77 2c20 636f 6c29 206f 6620 696e 7075  ow, col) of inpu
-00011030: 742e 0a20 2020 2020 2020 2023 2027 636f  t..        # 'co
-00011040: 6c27 2077 696c 6c20 616c 7761 7973 2062  l' will always b
-00011050: 6520 7a65 726f 2069 6620 6c69 6e65 2077  e zero if line w
-00011060: 7261 7070 696e 6720 6973 206f 6666 2e0a  rapping is off..
-00011070: 2020 2020 2020 2020 7669 7369 626c 655f          visible_
-00011080: 6c69 6e65 5f74 6f5f 726f 775f 636f 6c3a  line_to_row_col:
-00011090: 2044 6963 745b 696e 742c 2054 7570 6c65   Dict[int, Tuple
-000110a0: 5b69 6e74 2c20 696e 745d 5d20 3d20 7b7d  [int, int]] = {}
-000110b0: 0a0a 2020 2020 2020 2020 2320 4d61 7073  ..        # Maps
-000110c0: 2028 726f 772c 2063 6f6c 2920 6672 6f6d   (row, col) from
-000110d0: 2074 6865 2069 6e70 7574 2074 6f20 2879   the input to (y
-000110e0: 2c20 7829 2073 6372 6565 6e20 636f 6f72  , x) screen coor
-000110f0: 6469 6e61 7465 732e 0a20 2020 2020 2020  dinates..       
-00011100: 2072 6f77 636f 6c5f 746f 5f79 783a 2044   rowcol_to_yx: D
-00011110: 6963 745b 5475 706c 655b 696e 742c 2069  ict[Tuple[int, i
-00011120: 6e74 5d2c 2054 7570 6c65 5b69 6e74 2c20  nt], Tuple[int, 
-00011130: 696e 745d 5d20 3d20 7b7d 0a0a 2020 2020  int]] = {}..    
-00011140: 2020 2020 6465 6620 636f 7079 5f6c 696e      def copy_lin
-00011150: 6528 0a20 2020 2020 2020 2020 2020 206c  e(.            l
-00011160: 696e 653a 2053 7479 6c65 416e 6454 6578  ine: StyleAndTex
-00011170: 7454 7570 6c65 732c 0a20 2020 2020 2020  tTuples,.       
-00011180: 2020 2020 206c 696e 656e 6f3a 2069 6e74       lineno: int
-00011190: 2c0a 2020 2020 2020 2020 2020 2020 783a  ,.            x:
-000111a0: 2069 6e74 2c0a 2020 2020 2020 2020 2020   int,.          
-000111b0: 2020 793a 2069 6e74 2c0a 2020 2020 2020    y: int,.      
-000111c0: 2020 2020 2020 6973 5f69 6e70 7574 3a20        is_input: 
-000111d0: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-000111e0: 2020 2020 2020 2920 2d3e 2054 7570 6c65        ) -> Tuple
-000111f0: 5b69 6e74 2c20 696e 745d 3a0a 2020 2020  [int, int]:.    
-00011200: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00011210: 2020 2020 2020 2020 436f 7079 206f 7665          Copy ove
-00011220: 7220 6120 7369 6e67 6c65 206c 696e 6520  r a single line 
-00011230: 746f 2074 6865 206f 7574 7075 7420 7363  to the output sc
-00011240: 7265 656e 2e20 5468 6973 2063 616e 2077  reen. This can w
-00011250: 7261 7020 6f76 6572 0a20 2020 2020 2020  rap over.       
-00011260: 2020 2020 206d 756c 7469 706c 6520 6c69       multiple li
-00011270: 6e65 7320 696e 2074 6865 206f 7574 7075  nes in the outpu
-00011280: 742e 2049 7420 7769 6c6c 2063 616c 6c20  t. It will call 
-00011290: 7468 6520 7072 6566 6978 2028 7072 6f6d  the prefix (prom
-000112a0: 7074 290a 2020 2020 2020 2020 2020 2020  pt).            
-000112b0: 6675 6e63 7469 6f6e 2062 6566 6f72 6520  function before 
-000112c0: 6576 6572 7920 6c69 6e65 2e0a 2020 2020  every line..    
-000112d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000112e0: 2020 2020 2020 2020 6966 2069 735f 696e          if is_in
-000112f0: 7075 743a 0a20 2020 2020 2020 2020 2020  put:.           
-00011300: 2020 2020 2063 7572 7265 6e74 5f72 6f77       current_row
-00011310: 636f 6c5f 746f 5f79 7820 3d20 726f 7763  col_to_yx = rowc
-00011320: 6f6c 5f74 6f5f 7978 0a20 2020 2020 2020  ol_to_yx.       
-00011330: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00011340: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-00011350: 6e74 5f72 6f77 636f 6c5f 746f 5f79 7820  nt_rowcol_to_yx 
-00011360: 3d20 7b7d 2020 2320 5468 726f 7761 7761  = {}  # Throwawa
-00011370: 7920 6469 6374 696f 6e61 7279 2e0a 0a20  y dictionary... 
-00011380: 2020 2020 2020 2020 2020 2023 2044 7261             # Dra
-00011390: 7720 6c69 6e65 2070 7265 6669 782e 0a20  w line prefix.. 
-000113a0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-000113b0: 5f69 6e70 7574 2061 6e64 2067 6574 5f6c  _input and get_l
-000113c0: 696e 655f 7072 6566 6978 3a0a 2020 2020  ine_prefix:.    
-000113d0: 2020 2020 2020 2020 2020 2020 7072 6f6d              prom
-000113e0: 7074 203d 2074 6f5f 666f 726d 6174 7465  pt = to_formatte
-000113f0: 645f 7465 7874 2867 6574 5f6c 696e 655f  d_text(get_line_
-00011400: 7072 6566 6978 286c 696e 656e 6f2c 2030  prefix(lineno, 0
-00011410: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00011420: 2020 2078 2c20 7920 3d20 636f 7079 5f6c     x, y = copy_l
-00011430: 696e 6528 7072 6f6d 7074 2c20 6c69 6e65  ine(prompt, line
-00011440: 6e6f 2c20 782c 2079 2c20 6973 5f69 6e70  no, x, y, is_inp
-00011450: 7574 3d46 616c 7365 290a 0a20 2020 2020  ut=False)..     
-00011460: 2020 2020 2020 2023 2053 6372 6f6c 6c20         # Scroll 
-00011470: 686f 7269 7a6f 6e74 616c 6c79 2e0a 2020  horizontally..  
-00011480: 2020 2020 2020 2020 2020 736b 6970 7065            skippe
-00011490: 6420 3d20 3020 2023 2043 6861 7261 6374  d = 0  # Charact
-000114a0: 6572 7320 736b 6970 7065 6420 6265 6361  ers skipped beca
-000114b0: 7573 6520 6f66 2068 6f72 697a 6f6e 7461  use of horizonta
-000114c0: 6c20 7363 726f 6c6c 696e 672e 0a20 2020  l scrolling..   
-000114d0: 2020 2020 2020 2020 2069 6620 686f 7269           if hori
-000114e0: 7a6f 6e74 616c 5f73 6372 6f6c 6c20 616e  zontal_scroll an
-000114f0: 6420 6973 5f69 6e70 7574 3a0a 2020 2020  d is_input:.    
-00011500: 2020 2020 2020 2020 2020 2020 685f 7363              h_sc
-00011510: 726f 6c6c 203d 2068 6f72 697a 6f6e 7461  roll = horizonta
-00011520: 6c5f 7363 726f 6c6c 0a20 2020 2020 2020  l_scroll.       
-00011530: 2020 2020 2020 2020 206c 696e 6520 3d20           line = 
-00011540: 6578 706c 6f64 655f 7465 7874 5f66 7261  explode_text_fra
-00011550: 676d 656e 7473 286c 696e 6529 0a20 2020  gments(line).   
-00011560: 2020 2020 2020 2020 2020 2020 2077 6869               whi
-00011570: 6c65 2068 5f73 6372 6f6c 6c20 3e20 3020  le h_scroll > 0 
-00011580: 616e 6420 6c69 6e65 3a0a 2020 2020 2020  and line:.      
-00011590: 2020 2020 2020 2020 2020 2020 2020 685f                h_
-000115a0: 7363 726f 6c6c 202d 3d20 6765 745f 6377  scroll -= get_cw
-000115b0: 6964 7468 286c 696e 655b 305d 5b31 5d29  idth(line[0][1])
-000115c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000115d0: 2020 2020 2073 6b69 7070 6564 202b 3d20       skipped += 
-000115e0: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-000115f0: 2020 2020 2020 6465 6c20 6c69 6e65 5b3a        del line[:
-00011600: 315d 2020 2320 5265 6d6f 7665 2066 6972  1]  # Remove fir
-00011610: 7374 2063 6861 7261 6374 6572 2e0a 0a20  st character... 
-00011620: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-00011630: 202d 3d20 685f 7363 726f 6c6c 2020 2320   -= h_scroll  # 
-00011640: 5768 656e 2073 6372 6f6c 6c69 6e67 206f  When scrolling o
-00011650: 7665 7220 646f 7562 6c65 2077 6964 7468  ver double width
-00011660: 2063 6861 7261 6374 6572 2c0a 2020 2020   character,.    
-00011670: 2020 2020 2020 2020 2020 2020 2320 7468              # th
-00011680: 6973 2063 616e 2065 6e64 2075 7020 6265  is can end up be
-00011690: 696e 6720 6e65 6761 7469 7665 2e0a 0a20  ing negative... 
-000116a0: 2020 2020 2020 2020 2020 2023 2041 6c69             # Ali
-000116b0: 676e 2074 6869 7320 6c69 6e65 2e20 284e  gn this line. (N
-000116c0: 6f74 6520 7468 6174 2074 6869 7320 646f  ote that this do
-000116d0: 6573 6e27 7420 776f 726b 2077 656c 6c20  esn't work well 
-000116e0: 7768 656e 2077 6520 7573 650a 2020 2020  when we use.    
-000116f0: 2020 2020 2020 2020 2320 6765 745f 6c69          # get_li
-00011700: 6e65 5f70 7265 6669 7820 616e 6420 7468  ne_prefix and th
-00011710: 6174 2066 756e 6374 696f 6e20 7265 7475  at function retu
-00011720: 726e 7320 7661 7269 6162 6c65 2077 6964  rns variable wid
-00011730: 7468 2070 7265 6669 7865 732e 290a 2020  th prefixes.).  
-00011740: 2020 2020 2020 2020 2020 6c65 6674 203d            left =
-00011750: 2057 696e 646f 7741 6c69 676e 2e4c 4546   WindowAlign.LEF
-00011760: 540a 2020 2020 2020 2020 2020 2020 6365  T.            ce
-00011770: 6e74 6572 203d 2057 696e 646f 7741 6c69  nter = WindowAli
-00011780: 676e 2e43 454e 5445 520a 2020 2020 2020  gn.CENTER.      
-00011790: 2020 2020 2020 7269 6768 7420 3d20 5769        right = Wi
-000117a0: 6e64 6f77 416c 6967 6e2e 5249 4748 540a  ndowAlign.RIGHT.
-000117b0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-000117c0: 6c69 676e 203d 3d20 2263 656e 7465 7222  lign == "center"
-000117d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000117e0: 2020 6c69 6e65 5f77 6964 7468 203d 2066    line_width = f
-000117f0: 7261 676d 656e 745f 6c69 7374 5f77 6964  ragment_list_wid
-00011800: 7468 286c 696e 6529 0a20 2020 2020 2020  th(line).       
-00011810: 2020 2020 2020 2020 2069 6620 6c69 6e65           if line
-00011820: 5f77 6964 7468 203c 2077 6964 7468 3a0a  _width < width:.
-00011830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011840: 2020 2020 7820 2b3d 2028 7769 6474 6820      x += (width 
-00011850: 2d20 6c69 6e65 5f77 6964 7468 2920 2f2f  - line_width) //
-00011860: 2032 0a20 2020 2020 2020 2020 2020 2065   2.            e
-00011870: 6c69 6620 616c 6967 6e20 3d3d 2022 7269  lif align == "ri
-00011880: 6768 7422 3a0a 2020 2020 2020 2020 2020  ght":.          
-00011890: 2020 2020 2020 6c69 6e65 5f77 6964 7468        line_width
-000118a0: 203d 2066 7261 676d 656e 745f 6c69 7374   = fragment_list
-000118b0: 5f77 6964 7468 286c 696e 6529 0a20 2020  _width(line).   
-000118c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000118d0: 6c69 6e65 5f77 6964 7468 203c 2077 6964  line_width < wid
-000118e0: 7468 3a0a 2020 2020 2020 2020 2020 2020  th:.            
-000118f0: 2020 2020 2020 2020 7820 2b3d 2077 6964          x += wid
-00011900: 7468 202d 206c 696e 655f 7769 6474 680a  th - line_width.
-00011910: 0a20 2020 2020 2020 2020 2020 2063 6f6c  .            col
-00011920: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-00011930: 2077 7261 705f 636f 756e 7420 3d20 300a   wrap_count = 0.
-00011940: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00011950: 7374 796c 652c 2074 6578 742c 202a 5f20  style, text, *_ 
-00011960: 696e 206c 696e 653a 0a20 2020 2020 2020  in line:.       
-00011970: 2020 2020 2020 2020 206e 6577 5f62 7566           new_buf
-00011980: 6665 725f 726f 7720 3d20 6e65 775f 6275  fer_row = new_bu
-00011990: 6666 6572 5b79 202b 2079 706f 735d 0a0a  ffer[y + ypos]..
-000119a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000119b0: 2320 5265 6d65 6d62 6572 2072 6177 2056  # Remember raw V
-000119c0: 5420 6573 6361 7065 2073 6571 7565 6e63  T escape sequenc
-000119d0: 6573 2e20 2845 2e67 2e20 4669 6e61 6c54  es. (E.g. FinalT
-000119e0: 6572 6d27 730a 2020 2020 2020 2020 2020  erm's.          
-000119f0: 2020 2020 2020 2320 6573 6361 7065 2073        # escape s
-00011a00: 6571 7565 6e63 6573 2e29 0a20 2020 2020  equences.).     
-00011a10: 2020 2020 2020 2020 2020 2069 6620 225b             if "[
-00011a20: 5a65 726f 5769 6474 6845 7363 6170 655d  ZeroWidthEscape]
-00011a30: 2220 696e 2073 7479 6c65 3a0a 2020 2020  " in style:.    
+0000ff70: 2020 2078 202d 3d20 310a 2020 2020 2020     x -= 1.      
+0000ff80: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000ff90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ffa0: 2020 2020 2320 466f 756e 6420 706f 7369      # Found posi
+0000ffb0: 7469 6f6e 2c20 6361 6c6c 2068 616e 646c  tion, call handl
+0000ffc0: 6572 206f 6620 5549 436f 6e74 726f 6c2e  er of UIControl.
+0000ffd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ffe0: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
+0000fff0: 6c66 2e63 6f6e 7465 6e74 2e6d 6f75 7365  lf.content.mouse
+00010000: 5f68 616e 646c 6572 280a 2020 2020 2020  _handler(.      
+00010010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010020: 2020 4d6f 7573 6545 7665 6e74 280a 2020    MouseEvent(.  
+00010030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010040: 2020 2020 2020 2020 2020 706f 7369 7469            positi
+00010050: 6f6e 3d50 6f69 6e74 2878 3d63 6f6c 2c20  on=Point(x=col, 
+00010060: 793d 726f 7729 2c0a 2020 2020 2020 2020  y=row),.        
+00010070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010080: 2020 2020 6576 656e 745f 7479 7065 3d6d      event_type=m
+00010090: 6f75 7365 5f65 7665 6e74 2e65 7665 6e74  ouse_event.event
+000100a0: 5f74 7970 652c 0a20 2020 2020 2020 2020  _type,.         
+000100b0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000100c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000100d0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000100e0: 2020 2020 2020 2020 2020 2062 7265 616b             break
+000100f0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00010100: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00010110: 2020 2023 206e 6f62 7265 616b 2e0a 2020     # nobreak..  
+00010120: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00010130: 284e 6f20 782f 7920 636f 6f72 6469 6e61  (No x/y coordina
+00010140: 7465 2066 6f75 6e64 2066 6f72 2074 6865  te found for the
+00010150: 2063 6f6e 7465 6e74 2e20 5468 6973 2068   content. This h
+00010160: 6170 7065 6e73 2069 6e0a 2020 2020 2020  appens in.      
+00010170: 2020 2020 2020 2020 2020 2320 6361 7365            # case
+00010180: 206f 6620 6120 4475 6d6d 7943 6f6e 7472   of a DummyContr
+00010190: 6f6c 2c20 7468 6174 2064 6f65 7320 6e6f  ol, that does no
+000101a0: 7420 6861 7665 2061 6e79 2063 6f6e 7465  t have any conte
+000101b0: 6e74 2e0a 2020 2020 2020 2020 2020 2020  nt..            
+000101c0: 2020 2020 2320 5265 706f 7274 2028 302c      # Report (0,
+000101d0: 3029 2069 6e73 7465 6164 2e29 0a20 2020  0) instead.).   
+000101e0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+000101f0: 756c 7420 3d20 7365 6c66 2e63 6f6e 7465  ult = self.conte
+00010200: 6e74 2e6d 6f75 7365 5f68 616e 646c 6572  nt.mouse_handler
+00010210: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00010220: 2020 2020 2020 4d6f 7573 6545 7665 6e74        MouseEvent
+00010230: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00010240: 2020 2020 2020 2020 2020 706f 7369 7469            positi
+00010250: 6f6e 3d50 6f69 6e74 2878 3d30 2c20 793d  on=Point(x=0, y=
+00010260: 3029 2c20 6576 656e 745f 7479 7065 3d6d  0), event_type=m
+00010270: 6f75 7365 5f65 7665 6e74 2e65 7665 6e74  ouse_event.event
+00010280: 5f74 7970 650a 2020 2020 2020 2020 2020  _type.          
+00010290: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000102a0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+000102b0: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
+000102c0: 6974 2072 6574 7572 6e73 204e 6f74 496d  it returns NotIm
+000102d0: 706c 656d 656e 7465 642c 2068 616e 646c  plemented, handl
+000102e0: 6520 6974 2068 6572 652e 0a20 2020 2020  e it here..     
+000102f0: 2020 2020 2020 2069 6620 7265 7375 6c74         if result
+00010300: 203d 3d20 4e6f 7449 6d70 6c65 6d65 6e74   == NotImplement
+00010310: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+00010320: 2020 2020 7365 6c66 2e5f 6d6f 7573 655f      self._mouse_
+00010330: 6861 6e64 6c65 7228 6d6f 7573 655f 6576  handler(mouse_ev
+00010340: 656e 7429 0a0a 2020 2020 2020 2020 6d6f  ent)..        mo
+00010350: 7573 655f 6861 6e64 6c65 7273 2e73 6574  use_handlers.set
+00010360: 5f6d 6f75 7365 5f68 616e 646c 6572 5f66  _mouse_handler_f
+00010370: 6f72 5f72 616e 6765 280a 2020 2020 2020  or_range(.      
+00010380: 2020 2020 2020 785f 6d69 6e3d 7772 6974        x_min=writ
+00010390: 655f 706f 7369 7469 6f6e 2e78 706f 7320  e_position.xpos 
+000103a0: 2b20 7375 6d28 6c65 6674 5f6d 6172 6769  + sum(left_margi
+000103b0: 6e5f 7769 6474 6873 292c 0a20 2020 2020  n_widths),.     
+000103c0: 2020 2020 2020 2078 5f6d 6178 3d77 7269         x_max=wri
+000103d0: 7465 5f70 6f73 6974 696f 6e2e 7870 6f73  te_position.xpos
+000103e0: 202b 2077 7269 7465 5f70 6f73 6974 696f   + write_positio
+000103f0: 6e2e 7769 6474 6820 2d20 746f 7461 6c5f  n.width - total_
+00010400: 6d61 7267 696e 5f77 6964 7468 2c0a 2020  margin_width,.  
+00010410: 2020 2020 2020 2020 2020 795f 6d69 6e3d            y_min=
+00010420: 7772 6974 655f 706f 7369 7469 6f6e 2e79  write_position.y
+00010430: 706f 732c 0a20 2020 2020 2020 2020 2020  pos,.           
+00010440: 2079 5f6d 6178 3d77 7269 7465 5f70 6f73   y_max=write_pos
+00010450: 6974 696f 6e2e 7970 6f73 202b 2077 7269  ition.ypos + wri
+00010460: 7465 5f70 6f73 6974 696f 6e2e 6865 6967  te_position.heig
+00010470: 6874 2c0a 2020 2020 2020 2020 2020 2020  ht,.            
+00010480: 6861 6e64 6c65 723d 6d6f 7573 655f 6861  handler=mouse_ha
+00010490: 6e64 6c65 722c 0a20 2020 2020 2020 2029  ndler,.        )
+000104a0: 0a0a 2020 2020 2020 2020 2320 5265 6e64  ..        # Rend
+000104b0: 6572 2061 6e64 2063 6f70 7920 6d61 7267  er and copy marg
+000104c0: 696e 732e 0a20 2020 2020 2020 206d 6f76  ins..        mov
+000104d0: 655f 7820 3d20 300a 0a20 2020 2020 2020  e_x = 0..       
+000104e0: 2064 6566 2072 656e 6465 725f 6d61 7267   def render_marg
+000104f0: 696e 286d 3a20 4d61 7267 696e 2c20 7769  in(m: Margin, wi
+00010500: 6474 683a 2069 6e74 2920 2d3e 2055 4943  dth: int) -> UIC
+00010510: 6f6e 7465 6e74 3a0a 2020 2020 2020 2020  ontent:.        
+00010520: 2020 2020 2252 656e 6465 7220 6d61 7267      "Render marg
+00010530: 696e 2e20 5265 7475 726e 2060 5363 7265  in. Return `Scre
+00010540: 656e 602e 220a 2020 2020 2020 2020 2020  en`.".          
+00010550: 2020 2320 5265 7472 6965 7665 206d 6172    # Retrieve mar
+00010560: 6769 6e20 6672 6167 6d65 6e74 732e 0a20  gin fragments.. 
+00010570: 2020 2020 2020 2020 2020 2066 7261 676d             fragm
+00010580: 656e 7473 203d 206d 2e63 7265 6174 655f  ents = m.create_
+00010590: 6d61 7267 696e 2872 656e 6465 725f 696e  margin(render_in
+000105a0: 666f 2c20 7769 6474 682c 2077 7269 7465  fo, width, write
+000105b0: 5f70 6f73 6974 696f 6e2e 6865 6967 6874  _position.height
+000105c0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+000105d0: 2054 7572 6e20 6974 2069 6e74 6f20 6120   Turn it into a 
+000105e0: 5549 436f 6e74 656e 7420 6f62 6a65 6374  UIContent object
+000105f0: 2e0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00010600: 616c 7265 6164 7920 7265 6e64 6572 6564  already rendered
+00010610: 2074 686f 7365 2066 7261 676d 656e 7473   those fragments
+00010620: 2075 7369 6e67 2074 6869 7320 7369 7a65   using this size
+00010630: 2e29 0a20 2020 2020 2020 2020 2020 2072  .).            r
+00010640: 6574 7572 6e20 466f 726d 6174 7465 6454  eturn FormattedT
+00010650: 6578 7443 6f6e 7472 6f6c 2866 7261 676d  extControl(fragm
+00010660: 656e 7473 292e 6372 6561 7465 5f63 6f6e  ents).create_con
+00010670: 7465 6e74 280a 2020 2020 2020 2020 2020  tent(.          
+00010680: 2020 2020 2020 7769 6474 6820 2b20 312c        width + 1,
+00010690: 2077 7269 7465 5f70 6f73 6974 696f 6e2e   write_position.
+000106a0: 6865 6967 6874 0a20 2020 2020 2020 2020  height.         
+000106b0: 2020 2029 0a0a 2020 2020 2020 2020 666f     )..        fo
+000106c0: 7220 6d2c 2077 6964 7468 2069 6e20 7a69  r m, width in zi
+000106d0: 7028 7365 6c66 2e6c 6566 745f 6d61 7267  p(self.left_marg
+000106e0: 696e 732c 206c 6566 745f 6d61 7267 696e  ins, left_margin
+000106f0: 5f77 6964 7468 7329 3a0a 2020 2020 2020  _widths):.      
+00010700: 2020 2020 2020 6966 2077 6964 7468 203e        if width >
+00010710: 2030 3a20 2023 2028 436f 6e64 6974 696f   0:  # (Conditio
+00010720: 6e61 6c4d 6172 6769 6e20 7265 7475 726e  nalMargin return
+00010730: 7320 6120 7a65 726f 2077 6964 7468 2e20  s a zero width. 
+00010740: 2d2d 2044 6f6e 2774 2072 656e 6465 722e  -- Don't render.
+00010750: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00010760: 2020 2320 4372 6561 7465 2073 6372 6565    # Create scree
+00010770: 6e20 666f 7220 6d61 7267 696e 2e0a 2020  n for margin..  
+00010780: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+00010790: 7267 696e 5f63 6f6e 7465 6e74 203d 2072  rgin_content = r
+000107a0: 656e 6465 725f 6d61 7267 696e 286d 2c20  ender_margin(m, 
+000107b0: 7769 6474 6829 0a0a 2020 2020 2020 2020  width)..        
+000107c0: 2020 2020 2020 2020 2320 436f 7079 2061          # Copy a
+000107d0: 6e64 2073 6869 6674 2058 2e0a 2020 2020  nd shift X..    
+000107e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000107f0: 2e5f 636f 7079 5f6d 6172 6769 6e28 6d61  ._copy_margin(ma
+00010800: 7267 696e 5f63 6f6e 7465 6e74 2c20 7363  rgin_content, sc
+00010810: 7265 656e 2c20 7772 6974 655f 706f 7369  reen, write_posi
+00010820: 7469 6f6e 2c20 6d6f 7665 5f78 2c20 7769  tion, move_x, wi
+00010830: 6474 6829 0a20 2020 2020 2020 2020 2020  dth).           
+00010840: 2020 2020 206d 6f76 655f 7820 2b3d 2077       move_x += w
+00010850: 6964 7468 0a0a 2020 2020 2020 2020 6d6f  idth..        mo
+00010860: 7665 5f78 203d 2077 7269 7465 5f70 6f73  ve_x = write_pos
+00010870: 6974 696f 6e2e 7769 6474 6820 2d20 7375  ition.width - su
+00010880: 6d28 7269 6768 745f 6d61 7267 696e 5f77  m(right_margin_w
+00010890: 6964 7468 7329 0a0a 2020 2020 2020 2020  idths)..        
+000108a0: 666f 7220 6d2c 2077 6964 7468 2069 6e20  for m, width in 
+000108b0: 7a69 7028 7365 6c66 2e72 6967 6874 5f6d  zip(self.right_m
+000108c0: 6172 6769 6e73 2c20 7269 6768 745f 6d61  argins, right_ma
+000108d0: 7267 696e 5f77 6964 7468 7329 3a0a 2020  rgin_widths):.  
+000108e0: 2020 2020 2020 2020 2020 2320 4372 6561            # Crea
+000108f0: 7465 2073 6372 6565 6e20 666f 7220 6d61  te screen for ma
+00010900: 7267 696e 2e0a 2020 2020 2020 2020 2020  rgin..          
+00010910: 2020 6d61 7267 696e 5f63 6f6e 7465 6e74    margin_content
+00010920: 203d 2072 656e 6465 725f 6d61 7267 696e   = render_margin
+00010930: 286d 2c20 7769 6474 6829 0a0a 2020 2020  (m, width)..    
+00010940: 2020 2020 2020 2020 2320 436f 7079 2061          # Copy a
+00010950: 6e64 2073 6869 6674 2058 2e0a 2020 2020  nd shift X..    
+00010960: 2020 2020 2020 2020 7365 6c66 2e5f 636f          self._co
+00010970: 7079 5f6d 6172 6769 6e28 6d61 7267 696e  py_margin(margin
+00010980: 5f63 6f6e 7465 6e74 2c20 7363 7265 656e  _content, screen
+00010990: 2c20 7772 6974 655f 706f 7369 7469 6f6e  , write_position
+000109a0: 2c20 6d6f 7665 5f78 2c20 7769 6474 6829  , move_x, width)
+000109b0: 0a20 2020 2020 2020 2020 2020 206d 6f76  .            mov
+000109c0: 655f 7820 2b3d 2077 6964 7468 0a0a 2020  e_x += width..  
+000109d0: 2020 2020 2020 2320 4170 706c 7920 2773        # Apply 's
+000109e0: 656c 662e 7374 796c 6527 0a20 2020 2020  elf.style'.     
+000109f0: 2020 2073 656c 662e 5f61 7070 6c79 5f73     self._apply_s
+00010a00: 7479 6c65 2873 6372 6565 6e2c 2077 7269  tyle(screen, wri
+00010a10: 7465 5f70 6f73 6974 696f 6e2c 2070 6172  te_position, par
+00010a20: 656e 745f 7374 796c 6529 0a0a 2020 2020  ent_style)..    
+00010a30: 2020 2020 2320 5465 6c6c 2074 6865 2073      # Tell the s
+00010a40: 6372 6565 6e20 7468 6174 2074 6869 7320  creen that this 
+00010a50: 7573 6572 2063 6f6e 7472 6f6c 2068 6173  user control has
+00010a60: 2062 6565 6e20 7061 696e 7465 6420 6174   been painted at
+00010a70: 2074 6869 730a 2020 2020 2020 2020 2320   this.        # 
+00010a80: 706f 7369 7469 6f6e 2e0a 2020 2020 2020  position..      
+00010a90: 2020 7363 7265 656e 2e76 6973 6962 6c65    screen.visible
+00010aa0: 5f77 696e 646f 7773 5f74 6f5f 7772 6974  _windows_to_writ
+00010ab0: 655f 706f 7369 7469 6f6e 735b 7365 6c66  e_positions[self
+00010ac0: 5d20 3d20 7772 6974 655f 706f 7369 7469  ] = write_positi
+00010ad0: 6f6e 0a0a 2020 2020 6465 6620 5f63 6f70  on..    def _cop
+00010ae0: 795f 626f 6479 280a 2020 2020 2020 2020  y_body(.        
+00010af0: 7365 6c66 2c0a 2020 2020 2020 2020 7569  self,.        ui
+00010b00: 5f63 6f6e 7465 6e74 3a20 5549 436f 6e74  _content: UICont
+00010b10: 656e 742c 0a20 2020 2020 2020 206e 6577  ent,.        new
+00010b20: 5f73 6372 6565 6e3a 2053 6372 6565 6e2c  _screen: Screen,
+00010b30: 0a20 2020 2020 2020 2077 7269 7465 5f70  .        write_p
+00010b40: 6f73 6974 696f 6e3a 2057 7269 7465 506f  osition: WritePo
+00010b50: 7369 7469 6f6e 2c0a 2020 2020 2020 2020  sition,.        
+00010b60: 6d6f 7665 5f78 3a20 696e 742c 0a20 2020  move_x: int,.   
+00010b70: 2020 2020 2077 6964 7468 3a20 696e 742c       width: int,
+00010b80: 0a20 2020 2020 2020 2076 6572 7469 6361  .        vertica
+00010b90: 6c5f 7363 726f 6c6c 3a20 696e 7420 3d20  l_scroll: int = 
+00010ba0: 302c 0a20 2020 2020 2020 2068 6f72 697a  0,.        horiz
+00010bb0: 6f6e 7461 6c5f 7363 726f 6c6c 3a20 696e  ontal_scroll: in
+00010bc0: 7420 3d20 302c 0a20 2020 2020 2020 2077  t = 0,.        w
+00010bd0: 7261 705f 6c69 6e65 733a 2062 6f6f 6c20  rap_lines: bool 
+00010be0: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
+00010bf0: 2068 6967 686c 6967 6874 5f6c 696e 6573   highlight_lines
+00010c00: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+00010c10: 2020 2020 2020 2020 7665 7274 6963 616c          vertical
+00010c20: 5f73 6372 6f6c 6c5f 323a 2069 6e74 203d  _scroll_2: int =
+00010c30: 2030 2c0a 2020 2020 2020 2020 616c 7761   0,.        alwa
+00010c40: 7973 5f68 6964 655f 6375 7273 6f72 3a20  ys_hide_cursor: 
+00010c50: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
+00010c60: 2020 2020 2020 6861 735f 666f 6375 733a        has_focus:
+00010c70: 2062 6f6f 6c20 3d20 4661 6c73 652c 0a20   bool = False,. 
+00010c80: 2020 2020 2020 2061 6c69 676e 3a20 5769         align: Wi
+00010c90: 6e64 6f77 416c 6967 6e20 3d20 5769 6e64  ndowAlign = Wind
+00010ca0: 6f77 416c 6967 6e2e 4c45 4654 2c0a 2020  owAlign.LEFT,.  
+00010cb0: 2020 2020 2020 6765 745f 6c69 6e65 5f70        get_line_p
+00010cc0: 7265 6669 783a 204f 7074 696f 6e61 6c5b  refix: Optional[
+00010cd0: 4361 6c6c 6162 6c65 5b5b 696e 742c 2069  Callable[[int, i
+00010ce0: 6e74 5d2c 2041 6e79 466f 726d 6174 7465  nt], AnyFormatte
+00010cf0: 6454 6578 745d 5d20 3d20 4e6f 6e65 2c0a  dText]] = None,.
+00010d00: 2020 2020 2920 2d3e 2054 7570 6c65 5b44      ) -> Tuple[D
+00010d10: 6963 745b 696e 742c 2054 7570 6c65 5b69  ict[int, Tuple[i
+00010d20: 6e74 2c20 696e 745d 5d2c 2044 6963 745b  nt, int]], Dict[
+00010d30: 5475 706c 655b 696e 742c 2069 6e74 5d2c  Tuple[int, int],
+00010d40: 2054 7570 6c65 5b69 6e74 2c20 696e 745d   Tuple[int, int]
+00010d50: 5d5d 3a0a 2020 2020 2020 2020 2222 220a  ]]:.        """.
+00010d60: 2020 2020 2020 2020 436f 7079 2074 6865          Copy the
+00010d70: 2055 4943 6f6e 7465 6e74 2069 6e74 6f20   UIContent into 
+00010d80: 7468 6520 6f75 7470 7574 2073 6372 6565  the output scree
+00010d90: 6e2e 0a20 2020 2020 2020 2052 6574 7572  n..        Retur
+00010da0: 6e20 2876 6973 6962 6c65 5f6c 696e 655f  n (visible_line_
+00010db0: 746f 5f72 6f77 5f63 6f6c 2c20 726f 7763  to_row_col, rowc
+00010dc0: 6f6c 5f74 6f5f 7978 2920 7475 706c 652e  ol_to_yx) tuple.
+00010dd0: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00010de0: 2067 6574 5f6c 696e 655f 7072 6566 6978   get_line_prefix
+00010df0: 3a20 4e6f 6e65 206f 7220 6120 6361 6c6c  : None or a call
+00010e00: 6162 6c65 2074 6861 7420 7461 6b65 7320  able that takes 
+00010e10: 6120 6c69 6e65 206e 756d 6265 720a 2020  a line number.  
+00010e20: 2020 2020 2020 2020 2020 2869 6e74 2920            (int) 
+00010e30: 616e 6420 6120 7772 6170 5f63 6f75 6e74  and a wrap_count
+00010e40: 2028 696e 7429 2061 6e64 2072 6574 7572   (int) and retur
+00010e50: 6e73 2066 6f72 6d61 7474 6564 2074 6578  ns formatted tex
+00010e60: 742e 0a20 2020 2020 2020 2022 2222 0a20  t..        """. 
+00010e70: 2020 2020 2020 2078 706f 7320 3d20 7772         xpos = wr
+00010e80: 6974 655f 706f 7369 7469 6f6e 2e78 706f  ite_position.xpo
+00010e90: 7320 2b20 6d6f 7665 5f78 0a20 2020 2020  s + move_x.     
+00010ea0: 2020 2079 706f 7320 3d20 7772 6974 655f     ypos = write_
+00010eb0: 706f 7369 7469 6f6e 2e79 706f 730a 2020  position.ypos.  
+00010ec0: 2020 2020 2020 6c69 6e65 5f63 6f75 6e74        line_count
+00010ed0: 203d 2075 695f 636f 6e74 656e 742e 6c69   = ui_content.li
+00010ee0: 6e65 5f63 6f75 6e74 0a20 2020 2020 2020  ne_count.       
+00010ef0: 206e 6577 5f62 7566 6665 7220 3d20 6e65   new_buffer = ne
+00010f00: 775f 7363 7265 656e 2e64 6174 615f 6275  w_screen.data_bu
+00010f10: 6666 6572 0a20 2020 2020 2020 2065 6d70  ffer.        emp
+00010f20: 7479 5f63 6861 7220 3d20 5f43 4841 525f  ty_char = _CHAR_
+00010f30: 4341 4348 455b 2222 2c20 2222 5d0a 0a20  CACHE["", ""].. 
+00010f40: 2020 2020 2020 2023 204d 6170 2076 6973         # Map vis
+00010f50: 6962 6c65 206c 696e 6520 6e75 6d62 6572  ible line number
+00010f60: 2074 6f20 2872 6f77 2c20 636f 6c29 206f   to (row, col) o
+00010f70: 6620 696e 7075 742e 0a20 2020 2020 2020  f input..       
+00010f80: 2023 2027 636f 6c27 2077 696c 6c20 616c   # 'col' will al
+00010f90: 7761 7973 2062 6520 7a65 726f 2069 6620  ways be zero if 
+00010fa0: 6c69 6e65 2077 7261 7070 696e 6720 6973  line wrapping is
+00010fb0: 206f 6666 2e0a 2020 2020 2020 2020 7669   off..        vi
+00010fc0: 7369 626c 655f 6c69 6e65 5f74 6f5f 726f  sible_line_to_ro
+00010fd0: 775f 636f 6c3a 2044 6963 745b 696e 742c  w_col: Dict[int,
+00010fe0: 2054 7570 6c65 5b69 6e74 2c20 696e 745d   Tuple[int, int]
+00010ff0: 5d20 3d20 7b7d 0a0a 2020 2020 2020 2020  ] = {}..        
+00011000: 2320 4d61 7073 2028 726f 772c 2063 6f6c  # Maps (row, col
+00011010: 2920 6672 6f6d 2074 6865 2069 6e70 7574  ) from the input
+00011020: 2074 6f20 2879 2c20 7829 2073 6372 6565   to (y, x) scree
+00011030: 6e20 636f 6f72 6469 6e61 7465 732e 0a20  n coordinates.. 
+00011040: 2020 2020 2020 2072 6f77 636f 6c5f 746f         rowcol_to
+00011050: 5f79 783a 2044 6963 745b 5475 706c 655b  _yx: Dict[Tuple[
+00011060: 696e 742c 2069 6e74 5d2c 2054 7570 6c65  int, int], Tuple
+00011070: 5b69 6e74 2c20 696e 745d 5d20 3d20 7b7d  [int, int]] = {}
+00011080: 0a0a 2020 2020 2020 2020 6465 6620 636f  ..        def co
+00011090: 7079 5f6c 696e 6528 0a20 2020 2020 2020  py_line(.       
+000110a0: 2020 2020 206c 696e 653a 2053 7479 6c65       line: Style
+000110b0: 416e 6454 6578 7454 7570 6c65 732c 0a20  AndTextTuples,. 
+000110c0: 2020 2020 2020 2020 2020 206c 696e 656e             linen
+000110d0: 6f3a 2069 6e74 2c0a 2020 2020 2020 2020  o: int,.        
+000110e0: 2020 2020 783a 2069 6e74 2c0a 2020 2020      x: int,.    
+000110f0: 2020 2020 2020 2020 793a 2069 6e74 2c0a          y: int,.
+00011100: 2020 2020 2020 2020 2020 2020 6973 5f69              is_i
+00011110: 6e70 7574 3a20 626f 6f6c 203d 2046 616c  nput: bool = Fal
+00011120: 7365 2c0a 2020 2020 2020 2020 2920 2d3e  se,.        ) ->
+00011130: 2054 7570 6c65 5b69 6e74 2c20 696e 745d   Tuple[int, int]
+00011140: 3a0a 2020 2020 2020 2020 2020 2020 2222  :.            ""
+00011150: 220a 2020 2020 2020 2020 2020 2020 436f  ".            Co
+00011160: 7079 206f 7665 7220 6120 7369 6e67 6c65  py over a single
+00011170: 206c 696e 6520 746f 2074 6865 206f 7574   line to the out
+00011180: 7075 7420 7363 7265 656e 2e20 5468 6973  put screen. This
+00011190: 2063 616e 2077 7261 7020 6f76 6572 0a20   can wrap over. 
+000111a0: 2020 2020 2020 2020 2020 206d 756c 7469             multi
+000111b0: 706c 6520 6c69 6e65 7320 696e 2074 6865  ple lines in the
+000111c0: 206f 7574 7075 742e 2049 7420 7769 6c6c   output. It will
+000111d0: 2063 616c 6c20 7468 6520 7072 6566 6978   call the prefix
+000111e0: 2028 7072 6f6d 7074 290a 2020 2020 2020   (prompt).      
+000111f0: 2020 2020 2020 6675 6e63 7469 6f6e 2062        function b
+00011200: 6566 6f72 6520 6576 6572 7920 6c69 6e65  efore every line
+00011210: 2e0a 2020 2020 2020 2020 2020 2020 2222  ..            ""
+00011220: 220a 2020 2020 2020 2020 2020 2020 6966  ".            if
+00011230: 2069 735f 696e 7075 743a 0a20 2020 2020   is_input:.     
+00011240: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+00011250: 6e74 5f72 6f77 636f 6c5f 746f 5f79 7820  nt_rowcol_to_yx 
+00011260: 3d20 726f 7763 6f6c 5f74 6f5f 7978 0a20  = rowcol_to_yx. 
+00011270: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00011280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011290: 2063 7572 7265 6e74 5f72 6f77 636f 6c5f   current_rowcol_
+000112a0: 746f 5f79 7820 3d20 7b7d 2020 2320 5468  to_yx = {}  # Th
+000112b0: 726f 7761 7761 7920 6469 6374 696f 6e61  rowaway dictiona
+000112c0: 7279 2e0a 0a20 2020 2020 2020 2020 2020  ry...           
+000112d0: 2023 2044 7261 7720 6c69 6e65 2070 7265   # Draw line pre
+000112e0: 6669 782e 0a20 2020 2020 2020 2020 2020  fix..           
+000112f0: 2069 6620 6973 5f69 6e70 7574 2061 6e64   if is_input and
+00011300: 2067 6574 5f6c 696e 655f 7072 6566 6978   get_line_prefix
+00011310: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011320: 2020 7072 6f6d 7074 203d 2074 6f5f 666f    prompt = to_fo
+00011330: 726d 6174 7465 645f 7465 7874 2867 6574  rmatted_text(get
+00011340: 5f6c 696e 655f 7072 6566 6978 286c 696e  _line_prefix(lin
+00011350: 656e 6f2c 2030 2929 0a20 2020 2020 2020  eno, 0)).       
+00011360: 2020 2020 2020 2020 2078 2c20 7920 3d20           x, y = 
+00011370: 636f 7079 5f6c 696e 6528 7072 6f6d 7074  copy_line(prompt
+00011380: 2c20 6c69 6e65 6e6f 2c20 782c 2079 2c20  , lineno, x, y, 
+00011390: 6973 5f69 6e70 7574 3d46 616c 7365 290a  is_input=False).
+000113a0: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
+000113b0: 6372 6f6c 6c20 686f 7269 7a6f 6e74 616c  croll horizontal
+000113c0: 6c79 2e0a 2020 2020 2020 2020 2020 2020  ly..            
+000113d0: 736b 6970 7065 6420 3d20 3020 2023 2043  skipped = 0  # C
+000113e0: 6861 7261 6374 6572 7320 736b 6970 7065  haracters skippe
+000113f0: 6420 6265 6361 7573 6520 6f66 2068 6f72  d because of hor
+00011400: 697a 6f6e 7461 6c20 7363 726f 6c6c 696e  izontal scrollin
+00011410: 672e 0a20 2020 2020 2020 2020 2020 2069  g..            i
+00011420: 6620 686f 7269 7a6f 6e74 616c 5f73 6372  f horizontal_scr
+00011430: 6f6c 6c20 616e 6420 6973 5f69 6e70 7574  oll and is_input
+00011440: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011450: 2020 685f 7363 726f 6c6c 203d 2068 6f72    h_scroll = hor
+00011460: 697a 6f6e 7461 6c5f 7363 726f 6c6c 0a20  izontal_scroll. 
+00011470: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00011480: 696e 6520 3d20 6578 706c 6f64 655f 7465  ine = explode_te
+00011490: 7874 5f66 7261 676d 656e 7473 286c 696e  xt_fragments(lin
+000114a0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+000114b0: 2020 2077 6869 6c65 2068 5f73 6372 6f6c     while h_scrol
+000114c0: 6c20 3e20 3020 616e 6420 6c69 6e65 3a0a  l > 0 and line:.
+000114d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000114e0: 2020 2020 685f 7363 726f 6c6c 202d 3d20      h_scroll -= 
+000114f0: 6765 745f 6377 6964 7468 286c 696e 655b  get_cwidth(line[
+00011500: 305d 5b31 5d29 0a20 2020 2020 2020 2020  0][1]).         
+00011510: 2020 2020 2020 2020 2020 2073 6b69 7070             skipp
+00011520: 6564 202b 3d20 310a 2020 2020 2020 2020  ed += 1.        
+00011530: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+00011540: 6c69 6e65 5b3a 315d 2020 2320 5265 6d6f  line[:1]  # Remo
+00011550: 7665 2066 6972 7374 2063 6861 7261 6374  ve first charact
+00011560: 6572 2e0a 0a20 2020 2020 2020 2020 2020  er...           
+00011570: 2020 2020 2078 202d 3d20 685f 7363 726f       x -= h_scro
+00011580: 6c6c 2020 2320 5768 656e 2073 6372 6f6c  ll  # When scrol
+00011590: 6c69 6e67 206f 7665 7220 646f 7562 6c65  ling over double
+000115a0: 2077 6964 7468 2063 6861 7261 6374 6572   width character
+000115b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000115c0: 2020 2320 7468 6973 2063 616e 2065 6e64    # this can end
+000115d0: 2075 7020 6265 696e 6720 6e65 6761 7469   up being negati
+000115e0: 7665 2e0a 0a20 2020 2020 2020 2020 2020  ve...           
+000115f0: 2023 2041 6c69 676e 2074 6869 7320 6c69   # Align this li
+00011600: 6e65 2e20 284e 6f74 6520 7468 6174 2074  ne. (Note that t
+00011610: 6869 7320 646f 6573 6e27 7420 776f 726b  his doesn't work
+00011620: 2077 656c 6c20 7768 656e 2077 6520 7573   well when we us
+00011630: 650a 2020 2020 2020 2020 2020 2020 2320  e.            # 
+00011640: 6765 745f 6c69 6e65 5f70 7265 6669 7820  get_line_prefix 
+00011650: 616e 6420 7468 6174 2066 756e 6374 696f  and that functio
+00011660: 6e20 7265 7475 726e 7320 7661 7269 6162  n returns variab
+00011670: 6c65 2077 6964 7468 2070 7265 6669 7865  le width prefixe
+00011680: 732e 290a 2020 2020 2020 2020 2020 2020  s.).            
+00011690: 6c65 6674 203d 2057 696e 646f 7741 6c69  left = WindowAli
+000116a0: 676e 2e4c 4546 540a 2020 2020 2020 2020  gn.LEFT.        
+000116b0: 2020 2020 6365 6e74 6572 203d 2057 696e      center = Win
+000116c0: 646f 7741 6c69 676e 2e43 454e 5445 520a  dowAlign.CENTER.
+000116d0: 2020 2020 2020 2020 2020 2020 7269 6768              righ
+000116e0: 7420 3d20 5769 6e64 6f77 416c 6967 6e2e  t = WindowAlign.
+000116f0: 5249 4748 540a 2020 2020 2020 2020 2020  RIGHT.          
+00011700: 2020 6966 2061 6c69 676e 203d 3d20 2263    if align == "c
+00011710: 656e 7465 7222 3a0a 2020 2020 2020 2020  enter":.        
+00011720: 2020 2020 2020 2020 6c69 6e65 5f77 6964          line_wid
+00011730: 7468 203d 2066 7261 676d 656e 745f 6c69  th = fragment_li
+00011740: 7374 5f77 6964 7468 286c 696e 6529 0a20  st_width(line). 
+00011750: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00011760: 6620 6c69 6e65 5f77 6964 7468 203c 2077  f line_width < w
+00011770: 6964 7468 3a0a 2020 2020 2020 2020 2020  idth:.          
+00011780: 2020 2020 2020 2020 2020 7820 2b3d 2028            x += (
+00011790: 7769 6474 6820 2d20 6c69 6e65 5f77 6964  width - line_wid
+000117a0: 7468 2920 2f2f 2032 0a20 2020 2020 2020  th) // 2.       
+000117b0: 2020 2020 2065 6c69 6620 616c 6967 6e20       elif align 
+000117c0: 3d3d 2022 7269 6768 7422 3a0a 2020 2020  == "right":.    
+000117d0: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+000117e0: 5f77 6964 7468 203d 2066 7261 676d 656e  _width = fragmen
+000117f0: 745f 6c69 7374 5f77 6964 7468 286c 696e  t_list_width(lin
+00011800: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00011810: 2020 2069 6620 6c69 6e65 5f77 6964 7468     if line_width
+00011820: 203c 2077 6964 7468 3a0a 2020 2020 2020   < width:.      
+00011830: 2020 2020 2020 2020 2020 2020 2020 7820                x 
+00011840: 2b3d 2077 6964 7468 202d 206c 696e 655f  += width - line_
+00011850: 7769 6474 680a 0a20 2020 2020 2020 2020  width..         
+00011860: 2020 2063 6f6c 203d 2030 0a20 2020 2020     col = 0.     
+00011870: 2020 2020 2020 2077 7261 705f 636f 756e         wrap_coun
+00011880: 7420 3d20 300a 2020 2020 2020 2020 2020  t = 0.          
+00011890: 2020 666f 7220 7374 796c 652c 2074 6578    for style, tex
+000118a0: 742c 202a 5f20 696e 206c 696e 653a 0a20  t, *_ in line:. 
+000118b0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000118c0: 6577 5f62 7566 6665 725f 726f 7720 3d20  ew_buffer_row = 
+000118d0: 6e65 775f 6275 6666 6572 5b79 202b 2079  new_buffer[y + y
+000118e0: 706f 735d 0a0a 2020 2020 2020 2020 2020  pos]..          
+000118f0: 2020 2020 2020 2320 5265 6d65 6d62 6572        # Remember
+00011900: 2072 6177 2056 5420 6573 6361 7065 2073   raw VT escape s
+00011910: 6571 7565 6e63 6573 2e20 2845 2e67 2e20  equences. (E.g. 
+00011920: 4669 6e61 6c54 6572 6d27 730a 2020 2020  FinalTerm's.    
+00011930: 2020 2020 2020 2020 2020 2020 2320 6573              # es
+00011940: 6361 7065 2073 6571 7565 6e63 6573 2e29  cape sequences.)
+00011950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011960: 2069 6620 225b 5a65 726f 5769 6474 6845   if "[ZeroWidthE
+00011970: 7363 6170 655d 2220 696e 2073 7479 6c65  scape]" in style
+00011980: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011990: 2020 2020 2020 6e65 775f 7363 7265 656e        new_screen
+000119a0: 2e7a 6572 6f5f 7769 6474 685f 6573 6361  .zero_width_esca
+000119b0: 7065 735b 7920 2b20 7970 6f73 5d5b 7820  pes[y + ypos][x 
+000119c0: 2b20 7870 6f73 5d20 2b3d 2074 6578 740a  + xpos] += text.
+000119d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119e0: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
+000119f0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00011a00: 7220 6320 696e 2074 6578 743a 0a20 2020  r c in text:.   
+00011a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a20: 2063 6861 7220 3d20 5f43 4841 525f 4341   char = _CHAR_CA
+00011a30: 4348 455b 632c 2073 7479 6c65 5d0a 2020  CHE[c, style].  
 00011a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a50: 6e65 775f 7363 7265 656e 2e7a 6572 6f5f  new_screen.zero_
-00011a60: 7769 6474 685f 6573 6361 7065 735b 7920  width_escapes[y 
-00011a70: 2b20 7970 6f73 5d5b 7820 2b20 7870 6f73  + ypos][x + xpos
-00011a80: 5d20 2b3d 2074 6578 740a 2020 2020 2020  ] += text.      
-00011a90: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00011aa0: 6e74 696e 7565 0a0a 2020 2020 2020 2020  ntinue..        
-00011ab0: 2020 2020 2020 2020 666f 7220 6320 696e          for c in
-00011ac0: 2074 6578 743a 0a20 2020 2020 2020 2020   text:.         
-00011ad0: 2020 2020 2020 2020 2020 2063 6861 7220             char 
-00011ae0: 3d20 5f43 4841 525f 4341 4348 455b 632c  = _CHAR_CACHE[c,
-00011af0: 2073 7479 6c65 5d0a 2020 2020 2020 2020   style].        
-00011b00: 2020 2020 2020 2020 2020 2020 6368 6172              char
-00011b10: 5f77 6964 7468 203d 2063 6861 722e 7769  _width = char.wi
-00011b20: 6474 680a 0a20 2020 2020 2020 2020 2020  dth..           
-00011b30: 2020 2020 2020 2020 2023 2057 7261 7020           # Wrap 
-00011b40: 7768 656e 2074 6865 206c 696e 6520 7769  when the line wi
-00011b50: 6474 6820 6973 2065 7863 6565 6465 642e  dth is exceeded.
-00011b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011b70: 2020 2020 2069 6620 7772 6170 5f6c 696e       if wrap_lin
-00011b80: 6573 2061 6e64 2078 202b 2063 6861 725f  es and x + char_
-00011b90: 7769 6474 6820 3e20 7769 6474 683a 0a20  width > width:. 
+00011a50: 2020 6368 6172 5f77 6964 7468 203d 2063    char_width = c
+00011a60: 6861 722e 7769 6474 680a 0a20 2020 2020  har.width..     
+00011a70: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00011a80: 2057 7261 7020 7768 656e 2074 6865 206c   Wrap when the l
+00011a90: 696e 6520 7769 6474 6820 6973 2065 7863  ine width is exc
+00011aa0: 6565 6465 642e 0a20 2020 2020 2020 2020  eeded..         
+00011ab0: 2020 2020 2020 2020 2020 2069 6620 7772             if wr
+00011ac0: 6170 5f6c 696e 6573 2061 6e64 2078 202b  ap_lines and x +
+00011ad0: 2063 6861 725f 7769 6474 6820 3e20 7769   char_width > wi
+00011ae0: 6474 683a 0a20 2020 2020 2020 2020 2020  dth:.           
+00011af0: 2020 2020 2020 2020 2020 2020 2076 6973               vis
+00011b00: 6962 6c65 5f6c 696e 655f 746f 5f72 6f77  ible_line_to_row
+00011b10: 5f63 6f6c 5b79 202b 2031 5d20 3d20 280a  _col[y + 1] = (.
+00011b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b30: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+00011b40: 6e6f 2c0a 2020 2020 2020 2020 2020 2020  no,.            
+00011b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b60: 7669 7369 626c 655f 6c69 6e65 5f74 6f5f  visible_line_to_
+00011b70: 726f 775f 636f 6c5b 795d 5b31 5d20 2b20  row_col[y][1] + 
+00011b80: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
+00011b90: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
 00011ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011bb0: 2020 2020 2020 2076 6973 6962 6c65 5f6c         visible_l
-00011bc0: 696e 655f 746f 5f72 6f77 5f63 6f6c 5b79  ine_to_row_col[y
-00011bd0: 202b 2031 5d20 3d20 280a 2020 2020 2020   + 1] = (.      
-00011be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011bf0: 2020 2020 2020 6c69 6e65 6e6f 2c0a 2020        lineno,.  
-00011c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c10: 2020 2020 2020 2020 2020 7669 7369 626c            visibl
-00011c20: 655f 6c69 6e65 5f74 6f5f 726f 775f 636f  e_line_to_row_co
-00011c30: 6c5b 795d 5b31 5d20 2b20 782c 0a20 2020  l[y][1] + x,.   
-00011c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c50: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00011c60: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-00011c70: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00011c80: 2020 2020 2020 2020 2020 2020 2020 7772                wr
-00011c90: 6170 5f63 6f75 6e74 202b 3d20 310a 2020  ap_count += 1.  
-00011ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011cb0: 2020 2020 2020 7820 3d20 300a 0a20 2020        x = 0..   
+00011bb0: 2020 2020 2079 202b 3d20 310a 2020 2020       y += 1.    
+00011bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011bd0: 2020 2020 7772 6170 5f63 6f75 6e74 202b      wrap_count +
+00011be0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+00011bf0: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
+00011c00: 300a 0a20 2020 2020 2020 2020 2020 2020  0..             
+00011c10: 2020 2020 2020 2020 2020 2023 2049 6e73             # Ins
+00011c20: 6572 7420 6c69 6e65 2070 7265 6669 7820  ert line prefix 
+00011c30: 2863 6f6e 7469 6e75 6174 696f 6e20 7072  (continuation pr
+00011c40: 6f6d 7074 292e 0a20 2020 2020 2020 2020  ompt)..         
+00011c50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00011c60: 6620 6973 5f69 6e70 7574 2061 6e64 2067  f is_input and g
+00011c70: 6574 5f6c 696e 655f 7072 6566 6978 3a0a  et_line_prefix:.
+00011c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c90: 2020 2020 2020 2020 2020 2020 7072 6f6d              prom
+00011ca0: 7074 203d 2074 6f5f 666f 726d 6174 7465  pt = to_formatte
+00011cb0: 645f 7465 7874 280a 2020 2020 2020 2020  d_text(.        
 00011cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011cd0: 2020 2020 2023 2049 6e73 6572 7420 6c69       # Insert li
-00011ce0: 6e65 2070 7265 6669 7820 2863 6f6e 7469  ne prefix (conti
-00011cf0: 6e75 6174 696f 6e20 7072 6f6d 7074 292e  nuation prompt).
-00011d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011d10: 2020 2020 2020 2020 2069 6620 6973 5f69           if is_i
-00011d20: 6e70 7574 2061 6e64 2067 6574 5f6c 696e  nput and get_lin
-00011d30: 655f 7072 6566 6978 3a0a 2020 2020 2020  e_prefix:.      
-00011d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d50: 2020 2020 2020 7072 6f6d 7074 203d 2074        prompt = t
-00011d60: 6f5f 666f 726d 6174 7465 645f 7465 7874  o_formatted_text
-00011d70: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00011d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d90: 2020 6765 745f 6c69 6e65 5f70 7265 6669    get_line_prefi
-00011da0: 7828 6c69 6e65 6e6f 2c20 7772 6170 5f63  x(lineno, wrap_c
-00011db0: 6f75 6e74 290a 2020 2020 2020 2020 2020  ount).          
-00011dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011dd0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00011de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011df0: 782c 2079 203d 2063 6f70 795f 6c69 6e65  x, y = copy_line
-00011e00: 2870 726f 6d70 742c 206c 696e 656e 6f2c  (prompt, lineno,
-00011e10: 2078 2c20 792c 2069 735f 696e 7075 743d   x, y, is_input=
-00011e20: 4661 6c73 6529 0a0a 2020 2020 2020 2020  False)..        
+00011cd0: 2020 2020 2020 2020 6765 745f 6c69 6e65          get_line
+00011ce0: 5f70 7265 6669 7828 6c69 6e65 6e6f 2c20  _prefix(lineno, 
+00011cf0: 7772 6170 5f63 6f75 6e74 290a 2020 2020  wrap_count).    
+00011d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d10: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00011d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d30: 2020 2020 2020 782c 2079 203d 2063 6f70        x, y = cop
+00011d40: 795f 6c69 6e65 2870 726f 6d70 742c 206c  y_line(prompt, l
+00011d50: 696e 656e 6f2c 2078 2c20 792c 2069 735f  ineno, x, y, is_
+00011d60: 696e 7075 743d 4661 6c73 6529 0a0a 2020  input=False)..  
+00011d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d80: 2020 2020 2020 6e65 775f 6275 6666 6572        new_buffer
+00011d90: 5f72 6f77 203d 206e 6577 5f62 7566 6665  _row = new_buffe
+00011da0: 725b 7920 2b20 7970 6f73 5d0a 0a20 2020  r[y + ypos]..   
+00011db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011dc0: 2020 2020 2069 6620 7920 3e3d 2077 7269       if y >= wri
+00011dd0: 7465 5f70 6f73 6974 696f 6e2e 6865 6967  te_position.heig
+00011de0: 6874 3a0a 2020 2020 2020 2020 2020 2020  ht:.            
+00011df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e00: 7265 7475 726e 2078 2c20 7920 2023 2042  return x, y  # B
+00011e10: 7265 616b 206f 7574 206f 6620 616c 6c20  reak out of all 
+00011e20: 666f 7220 6c6f 6f70 732e 0a0a 2020 2020  for loops...    
 00011e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e40: 6e65 775f 6275 6666 6572 5f72 6f77 203d  new_buffer_row =
-00011e50: 206e 6577 5f62 7566 6665 725b 7920 2b20   new_buffer[y + 
-00011e60: 7970 6f73 5d0a 0a20 2020 2020 2020 2020  ypos]..         
-00011e70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00011e80: 6620 7920 3e3d 2077 7269 7465 5f70 6f73  f y >= write_pos
-00011e90: 6974 696f 6e2e 6865 6967 6874 3a0a 2020  ition.height:.  
-00011ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011eb0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00011ec0: 2078 2c20 7920 2023 2042 7265 616b 206f   x, y  # Break o
-00011ed0: 7574 206f 6620 616c 6c20 666f 7220 6c6f  ut of all for lo
-00011ee0: 6f70 732e 0a0a 2020 2020 2020 2020 2020  ops...          
-00011ef0: 2020 2020 2020 2020 2020 2320 5365 7420            # Set 
-00011f00: 6368 6172 6163 7465 7220 696e 2073 6372  character in scr
-00011f10: 6565 6e20 616e 6420 7368 6966 7420 2778  een and shift 'x
-00011f20: 272e 0a20 2020 2020 2020 2020 2020 2020  '..             
-00011f30: 2020 2020 2020 2069 6620 7820 3e3d 2030         if x >= 0
-00011f40: 2061 6e64 2079 203e 3d20 3020 616e 6420   and y >= 0 and 
-00011f50: 7820 3c20 7772 6974 655f 706f 7369 7469  x < write_positi
-00011f60: 6f6e 2e77 6964 7468 3a0a 2020 2020 2020  on.width:.      
-00011f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f80: 2020 6e65 775f 6275 6666 6572 5f72 6f77    new_buffer_row
-00011f90: 5b78 202b 2078 706f 735d 203d 2063 6861  [x + xpos] = cha
-00011fa0: 720a 0a20 2020 2020 2020 2020 2020 2020  r..             
-00011fb0: 2020 2020 2020 2020 2020 2023 2057 6865             # Whe
-00011fc0: 6e20 7765 2070 7269 6e74 2061 206d 756c  n we print a mul
-00011fd0: 7469 2077 6964 7468 2063 6861 7261 6374  ti width charact
-00011fe0: 6572 2c20 6d61 6b65 2073 7572 650a 2020  er, make sure.  
-00011ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012000: 2020 2020 2020 2320 746f 2065 7261 7365        # to erase
-00012010: 2074 6865 206e 6569 6768 626f 7572 7320   the neighbours 
-00012020: 706f 7369 7469 6f6e 7320 696e 2074 6865  positions in the
-00012030: 2073 6372 6565 6e2e 0a20 2020 2020 2020   screen..       
+00011e40: 2320 5365 7420 6368 6172 6163 7465 7220  # Set character 
+00011e50: 696e 2073 6372 6565 6e20 616e 6420 7368  in screen and sh
+00011e60: 6966 7420 2778 272e 0a20 2020 2020 2020  ift 'x'..       
+00011e70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00011e80: 7820 3e3d 2030 2061 6e64 2079 203e 3d20  x >= 0 and y >= 
+00011e90: 3020 616e 6420 7820 3c20 7772 6974 655f  0 and x < write_
+00011ea0: 706f 7369 7469 6f6e 2e77 6964 7468 3a0a  position.width:.
+00011eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ec0: 2020 2020 2020 2020 6e65 775f 6275 6666          new_buff
+00011ed0: 6572 5f72 6f77 5b78 202b 2078 706f 735d  er_row[x + xpos]
+00011ee0: 203d 2063 6861 720a 0a20 2020 2020 2020   = char..       
+00011ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f00: 2023 2057 6865 6e20 7765 2070 7269 6e74   # When we print
+00011f10: 2061 206d 756c 7469 2077 6964 7468 2063   a multi width c
+00011f20: 6861 7261 6374 6572 2c20 6d61 6b65 2073  haracter, make s
+00011f30: 7572 650a 2020 2020 2020 2020 2020 2020  ure.            
+00011f40: 2020 2020 2020 2020 2020 2020 2320 746f              # to
+00011f50: 2065 7261 7365 2074 6865 206e 6569 6768   erase the neigh
+00011f60: 626f 7572 7320 706f 7369 7469 6f6e 7320  bours positions 
+00011f70: 696e 2074 6865 2073 6372 6565 6e2e 0a20  in the screen.. 
+00011f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f90: 2020 2020 2020 2023 2028 5468 6520 656d         # (The em
+00011fa0: 7074 7920 7374 7269 6e67 2069 6620 6469  pty string if di
+00011fb0: 6666 6572 656e 7420 6672 6f6d 2065 7665  fferent from eve
+00011fc0: 7279 7468 696e 672c 0a20 2020 2020 2020  rything,.       
+00011fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011fe0: 2023 2073 6f20 6e65 7874 2072 6564 7261   # so next redra
+00011ff0: 7720 7468 6973 2063 656c 6c20 7769 6c6c  w this cell will
+00012000: 2072 6570 6169 6e74 2061 6e79 7761 792e   repaint anyway.
+00012010: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00012020: 2020 2020 2020 2020 2020 6966 2063 6861            if cha
+00012030: 725f 7769 6474 6820 3e20 313a 0a20 2020  r_width > 1:.   
 00012040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012050: 2023 2028 5468 6520 656d 7074 7920 7374   # (The empty st
-00012060: 7269 6e67 2069 6620 6469 6666 6572 656e  ring if differen
-00012070: 7420 6672 6f6d 2065 7665 7279 7468 696e  t from everythin
-00012080: 672c 0a20 2020 2020 2020 2020 2020 2020  g,.             
-00012090: 2020 2020 2020 2020 2020 2023 2073 6f20             # so 
-000120a0: 6e65 7874 2072 6564 7261 7720 7468 6973  next redraw this
-000120b0: 2063 656c 6c20 7769 6c6c 2072 6570 6169   cell will repai
-000120c0: 6e74 2061 6e79 7761 792e 290a 2020 2020  nt anyway.).    
-000120d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000120e0: 2020 2020 6966 2063 6861 725f 7769 6474      if char_widt
-000120f0: 6820 3e20 313a 0a20 2020 2020 2020 2020  h > 1:.         
-00012100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012110: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00012120: 6528 312c 2063 6861 725f 7769 6474 6829  e(1, char_width)
-00012130: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00012140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012150: 2020 6e65 775f 6275 6666 6572 5f72 6f77    new_buffer_row
-00012160: 5b78 202b 2078 706f 7320 2b20 695d 203d  [x + xpos + i] =
-00012170: 2065 6d70 7479 5f63 6861 720a 0a20 2020   empty_char..   
-00012180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012190: 2020 2020 2023 2049 6620 7468 6973 2069       # If this i
-000121a0: 7320 6120 7a65 726f 2077 6964 7468 2063  s a zero width c
-000121b0: 6861 7261 6374 6572 732c 2074 6865 6e20  haracters, then 
-000121c0: 6974 2773 0a20 2020 2020 2020 2020 2020  it's.           
-000121d0: 2020 2020 2020 2020 2020 2020 2023 2070               # p
-000121e0: 726f 6261 626c 7920 7061 7274 206f 6620  robably part of 
-000121f0: 6120 6465 636f 6d70 6f73 6564 2075 6e69  a decomposed uni
-00012200: 636f 6465 2063 6861 7261 6374 6572 2e0a  code character..
+00012050: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
+00012060: 6e20 7261 6e67 6528 312c 2063 6861 725f  n range(1, char_
+00012070: 7769 6474 6829 3a0a 2020 2020 2020 2020  width):.        
+00012080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012090: 2020 2020 2020 2020 6e65 775f 6275 6666          new_buff
+000120a0: 6572 5f72 6f77 5b78 202b 2078 706f 7320  er_row[x + xpos 
+000120b0: 2b20 695d 203d 2065 6d70 7479 5f63 6861  + i] = empty_cha
+000120c0: 720a 0a20 2020 2020 2020 2020 2020 2020  r..             
+000120d0: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
+000120e0: 7468 6973 2069 7320 6120 7a65 726f 2077  this is a zero w
+000120f0: 6964 7468 2063 6861 7261 6374 6572 732c  idth characters,
+00012100: 2074 6865 6e20 6974 2773 0a20 2020 2020   then it's.     
+00012110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012120: 2020 2023 2070 726f 6261 626c 7920 7061     # probably pa
+00012130: 7274 206f 6620 6120 6465 636f 6d70 6f73  rt of a decompos
+00012140: 6564 2075 6e69 636f 6465 2063 6861 7261  ed unicode chara
+00012150: 6374 6572 2e0a 2020 2020 2020 2020 2020  cter..          
+00012160: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00012170: 5365 653a 2068 7474 7073 3a2f 2f65 6e2e  See: https://en.
+00012180: 7769 6b69 7065 6469 612e 6f72 672f 7769  wikipedia.org/wi
+00012190: 6b69 2f55 6e69 636f 6465 5f65 7175 6976  ki/Unicode_equiv
+000121a0: 616c 656e 6365 0a20 2020 2020 2020 2020  alence.         
+000121b0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000121c0: 204d 6572 6765 2069 7420 696e 2074 6865   Merge it in the
+000121d0: 2070 7265 7669 6f75 7320 6365 6c6c 2e0a   previous cell..
+000121e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000121f0: 2020 2020 2020 2020 656c 6966 2063 6861          elif cha
+00012200: 725f 7769 6474 6820 3d3d 2030 3a0a 2020  r_width == 0:.  
 00012210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012220: 2020 2020 2020 2020 2320 5365 653a 2068          # See: h
-00012230: 7474 7073 3a2f 2f65 6e2e 7769 6b69 7065  ttps://en.wikipe
-00012240: 6469 612e 6f72 672f 7769 6b69 2f55 6e69  dia.org/wiki/Uni
-00012250: 636f 6465 5f65 7175 6976 616c 656e 6365  code_equivalence
-00012260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012270: 2020 2020 2020 2020 2023 204d 6572 6765           # Merge
-00012280: 2069 7420 696e 2074 6865 2070 7265 7669   it in the previ
-00012290: 6f75 7320 6365 6c6c 2e0a 2020 2020 2020  ous cell..      
-000122a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000122b0: 2020 656c 6966 2063 6861 725f 7769 6474    elif char_widt
-000122c0: 6820 3d3d 2030 3a0a 2020 2020 2020 2020  h == 0:.        
-000122d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000122e0: 2020 2020 2320 4861 6e64 6c65 2061 6c6c      # Handle all
-000122f0: 2063 6861 7261 6374 6572 2077 6964 7468   character width
-00012300: 732e 2049 6620 7468 6520 7072 6576 696f  s. If the previo
-00012310: 7573 0a20 2020 2020 2020 2020 2020 2020  us.             
-00012320: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00012330: 2063 6861 7261 6374 6572 2069 7320 6120   character is a 
-00012340: 6d75 6c74 6977 6964 7468 2063 6861 7261  multiwidth chara
-00012350: 6374 6572 2c20 7468 656e 0a20 2020 2020  cter, then.     
+00012220: 2020 2020 2020 2020 2020 2320 4861 6e64            # Hand
+00012230: 6c65 2061 6c6c 2063 6861 7261 6374 6572  le all character
+00012240: 2077 6964 7468 732e 2049 6620 7468 6520   widths. If the 
+00012250: 7072 6576 696f 7573 0a20 2020 2020 2020  previous.       
+00012260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012270: 2020 2020 2023 2063 6861 7261 6374 6572       # character
+00012280: 2069 7320 6120 6d75 6c74 6977 6964 7468   is a multiwidth
+00012290: 2063 6861 7261 6374 6572 2c20 7468 656e   character, then
+000122a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000122b0: 2020 2020 2020 2020 2020 2020 2023 206d               # m
+000122c0: 6572 6765 2069 7420 7477 6f20 706f 7369  erge it two posi
+000122d0: 7469 6f6e 7320 6261 636b 2e0a 2020 2020  tions back..    
+000122e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000122f0: 2020 2020 2020 2020 666f 7220 7077 2069          for pw i
+00012300: 6e20 5b32 2c20 315d 3a20 2023 2050 7265  n [2, 1]:  # Pre
+00012310: 7669 6f75 7320 6368 6172 6163 7465 7220  vious character 
+00012320: 7769 6474 682e 0a20 2020 2020 2020 2020  width..         
+00012330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012340: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
+00012350: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00012360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012370: 2020 2020 2020 2023 206d 6572 6765 2069         # merge i
-00012380: 7420 7477 6f20 706f 7369 7469 6f6e 7320  t two positions 
-00012390: 6261 636b 2e0a 2020 2020 2020 2020 2020  back..          
-000123a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000123b0: 2020 666f 7220 7077 2069 6e20 5b32 2c20    for pw in [2, 
-000123c0: 315d 3a20 2023 2050 7265 7669 6f75 7320  1]:  # Previous 
-000123d0: 6368 6172 6163 7465 7220 7769 6474 682e  character width.
-000123e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000123f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012400: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
-00012410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012420: 2020 2020 2020 2020 2020 7820 2d20 7077            x - pw
-00012430: 203e 3d20 300a 2020 2020 2020 2020 2020   >= 0.          
+00012370: 7820 2d20 7077 203e 3d20 300a 2020 2020  x - pw >= 0.    
+00012380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000123a0: 616e 6420 6e65 775f 6275 6666 6572 5f72  and new_buffer_r
+000123b0: 6f77 5b78 202b 2078 706f 7320 2d20 7077  ow[x + xpos - pw
+000123c0: 5d2e 7769 6474 6820 3d3d 2070 770a 2020  ].width == pw.  
+000123d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000123e0: 2020 2020 2020 2020 2020 2020 2020 293a                ):
+000123f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012410: 2020 2020 2070 7265 765f 6368 6172 203d       prev_char =
+00012420: 206e 6577 5f62 7566 6665 725f 726f 775b   new_buffer_row[
+00012430: 7820 2b20 7870 6f73 202d 2070 775d 0a20  x + xpos - pw]. 
 00012440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012450: 2020 2020 2020 2020 2020 616e 6420 6e65            and ne
-00012460: 775f 6275 6666 6572 5f72 6f77 5b78 202b  w_buffer_row[x +
-00012470: 2078 706f 7320 2d20 7077 5d2e 7769 6474   xpos - pw].widt
-00012480: 6820 3d3d 2070 770a 2020 2020 2020 2020  h == pw.        
+00012450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012460: 2020 2063 6861 7232 203d 205f 4348 4152     char2 = _CHAR
+00012470: 5f43 4143 4845 5b0a 2020 2020 2020 2020  _CACHE[.        
+00012480: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00012490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000124a0: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-000124b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000124c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000124d0: 7265 765f 6368 6172 203d 206e 6577 5f62  rev_char = new_b
-000124e0: 7566 6665 725f 726f 775b 7820 2b20 7870  uffer_row[x + xp
-000124f0: 6f73 202d 2070 775d 0a20 2020 2020 2020  os - pw].       
-00012500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012510: 2020 2020 2020 2020 2020 2020 2063 6861               cha
-00012520: 7232 203d 205f 4348 4152 5f43 4143 4845  r2 = _CHAR_CACHE
-00012530: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-00012540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012550: 2020 2020 2020 2020 2020 7072 6576 5f63            prev_c
-00012560: 6861 722e 6368 6172 202b 2063 2c20 7072  har.char + c, pr
-00012570: 6576 5f63 6861 722e 7374 796c 650a 2020  ev_char.style.  
+000124a0: 7072 6576 5f63 6861 722e 6368 6172 202b  prev_char.char +
+000124b0: 2063 2c20 7072 6576 5f63 6861 722e 7374   c, prev_char.st
+000124c0: 796c 650a 2020 2020 2020 2020 2020 2020  yle.            
+000124d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000124e0: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
+000124f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012500: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+00012510: 775f 6275 6666 6572 5f72 6f77 5b78 202b  w_buffer_row[x +
+00012520: 2078 706f 7320 2d20 7077 5d20 3d20 6368   xpos - pw] = ch
+00012530: 6172 320a 0a20 2020 2020 2020 2020 2020  ar2..           
+00012540: 2020 2020 2020 2020 2020 2020 2023 204b               # K
+00012550: 6565 7020 7472 6163 6b20 6f66 2077 7269  eep track of wri
+00012560: 7465 2070 6f73 6974 696f 6e20 666f 7220  te position for 
+00012570: 6561 6368 2063 6861 7261 6374 6572 2e0a  each character..
 00012580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000125a0: 2020 5d0a 2020 2020 2020 2020 2020 2020    ].            
-000125b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000125c0: 2020 2020 2020 2020 6e65 775f 6275 6666          new_buff
-000125d0: 6572 5f72 6f77 5b78 202b 2078 706f 7320  er_row[x + xpos 
-000125e0: 2d20 7077 5d20 3d20 6368 6172 320a 0a20  - pw] = char2.. 
+00012590: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+000125a0: 726f 7763 6f6c 5f74 6f5f 7978 5b6c 696e  rowcol_to_yx[lin
+000125b0: 656e 6f2c 2063 6f6c 202b 2073 6b69 7070  eno, col + skipp
+000125c0: 6564 5d20 3d20 280a 2020 2020 2020 2020  ed] = (.        
+000125d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000125e0: 2020 2020 7920 2b20 7970 6f73 2c0a 2020      y + ypos,.  
 000125f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012600: 2020 2020 2020 2023 204b 6565 7020 7472         # Keep tr
-00012610: 6163 6b20 6f66 2077 7269 7465 2070 6f73  ack of write pos
-00012620: 6974 696f 6e20 666f 7220 6561 6368 2063  ition for each c
-00012630: 6861 7261 6374 6572 2e0a 2020 2020 2020  haracter..      
-00012640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012650: 2020 6375 7272 656e 745f 726f 7763 6f6c    current_rowcol
-00012660: 5f74 6f5f 7978 5b6c 696e 656e 6f2c 2063  _to_yx[lineno, c
-00012670: 6f6c 202b 2073 6b69 7070 6564 5d20 3d20  ol + skipped] = 
-00012680: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00012690: 2020 2020 2020 2020 2020 2020 2020 7920                y 
-000126a0: 2b20 7970 6f73 2c0a 2020 2020 2020 2020  + ypos,.        
-000126b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126c0: 2020 2020 7820 2b20 7870 6f73 2c0a 2020      x + xpos,.  
-000126d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126e0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-000126f0: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
-00012700: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-00012710: 2020 2020 2020 2020 2020 7820 2b3d 2063            x += c
-00012720: 6861 725f 7769 6474 680a 2020 2020 2020  har_width.      
-00012730: 2020 2020 2020 7265 7475 726e 2078 2c20        return x, 
-00012740: 790a 0a20 2020 2020 2020 2023 2043 6f70  y..        # Cop
-00012750: 7920 636f 6e74 656e 742e 0a20 2020 2020  y content..     
-00012760: 2020 2064 6566 2063 6f70 7928 2920 2d3e     def copy() ->
-00012770: 2069 6e74 3a0a 2020 2020 2020 2020 2020   int:.          
-00012780: 2020 7920 3d20 2d76 6572 7469 6361 6c5f    y = -vertical_
-00012790: 7363 726f 6c6c 5f32 0a20 2020 2020 2020  scroll_2.       
-000127a0: 2020 2020 206c 696e 656e 6f20 3d20 7665       lineno = ve
-000127b0: 7274 6963 616c 5f73 6372 6f6c 6c0a 0a20  rtical_scroll.. 
-000127c0: 2020 2020 2020 2020 2020 2077 6869 6c65             while
-000127d0: 2079 203c 2077 7269 7465 5f70 6f73 6974   y < write_posit
-000127e0: 696f 6e2e 6865 6967 6874 2061 6e64 206c  ion.height and l
-000127f0: 696e 656e 6f20 3c20 6c69 6e65 5f63 6f75  ineno < line_cou
-00012800: 6e74 3a0a 2020 2020 2020 2020 2020 2020  nt:.            
-00012810: 2020 2020 2320 5461 6b65 2074 6865 206e      # Take the n
-00012820: 6578 7420 6c69 6e65 2061 6e64 2063 6f70  ext line and cop
-00012830: 7920 6974 2069 6e20 7468 6520 7265 616c  y it in the real
-00012840: 2073 6372 6565 6e2e 0a20 2020 2020 2020   screen..       
-00012850: 2020 2020 2020 2020 206c 696e 6520 3d20           line = 
-00012860: 7569 5f63 6f6e 7465 6e74 2e67 6574 5f6c  ui_content.get_l
-00012870: 696e 6528 6c69 6e65 6e6f 290a 0a20 2020  ine(lineno)..   
-00012880: 2020 2020 2020 2020 2020 2020 2076 6973               vis
-00012890: 6962 6c65 5f6c 696e 655f 746f 5f72 6f77  ible_line_to_row
-000128a0: 5f63 6f6c 5b79 5d20 3d20 286c 696e 656e  _col[y] = (linen
-000128b0: 6f2c 2068 6f72 697a 6f6e 7461 6c5f 7363  o, horizontal_sc
-000128c0: 726f 6c6c 290a 0a20 2020 2020 2020 2020  roll)..         
-000128d0: 2020 2020 2020 2023 2043 6f70 7920 6d61         # Copy ma
-000128e0: 7267 696e 2061 6e64 2061 6374 7561 6c20  rgin and actual 
-000128f0: 6c69 6e65 2e0a 2020 2020 2020 2020 2020  line..          
-00012900: 2020 2020 2020 7820 3d20 300a 2020 2020        x = 0.    
-00012910: 2020 2020 2020 2020 2020 2020 782c 2079              x, y
-00012920: 203d 2063 6f70 795f 6c69 6e65 286c 696e   = copy_line(lin
-00012930: 652c 206c 696e 656e 6f2c 2078 2c20 792c  e, lineno, x, y,
-00012940: 2069 735f 696e 7075 743d 5472 7565 290a   is_input=True).
-00012950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012960: 206c 696e 656e 6f20 2b3d 2031 0a20 2020   lineno += 1.   
-00012970: 2020 2020 2020 2020 2020 2020 2079 202b               y +
-00012980: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00012990: 7265 7475 726e 2079 0a0a 2020 2020 2020  return y..      
-000129a0: 2020 636f 7079 2829 0a0a 2020 2020 2020    copy()..      
-000129b0: 2020 6465 6620 6375 7273 6f72 5f70 6f73    def cursor_pos
-000129c0: 5f74 6f5f 7363 7265 656e 5f70 6f73 2872  _to_screen_pos(r
-000129d0: 6f77 3a20 696e 742c 2063 6f6c 3a20 696e  ow: int, col: in
-000129e0: 7429 202d 3e20 506f 696e 743a 0a20 2020  t) -> Point:.   
-000129f0: 2020 2020 2020 2020 2022 5472 616e 736c           "Transl
-00012a00: 6174 6520 726f 772f 636f 6c20 6672 6f6d  ate row/col from
-00012a10: 2055 4943 6f6e 7465 6e74 2074 6f20 7265   UIContent to re
-00012a20: 616c 2053 6372 6565 6e20 636f 6f72 6469  al Screen coordi
-00012a30: 6e61 7465 732e 220a 2020 2020 2020 2020  nates.".        
-00012a40: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00012a50: 2020 2020 2020 2020 2079 2c20 7820 3d20           y, x = 
-00012a60: 726f 7763 6f6c 5f74 6f5f 7978 5b72 6f77  rowcol_to_yx[row
-00012a70: 2c20 636f 6c5d 0a20 2020 2020 2020 2020  , col].         
-00012a80: 2020 2065 7863 6570 7420 4b65 7945 7272     except KeyErr
-00012a90: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-00012aa0: 2020 2020 2320 4e6f 726d 616c 6c79 2074      # Normally t
-00012ab0: 6869 7320 7368 6f75 6c64 206e 6576 6572  his should never
-00012ac0: 2068 6170 7065 6e2e 2028 4974 2069 7320   happen. (It is 
-00012ad0: 6120 6275 672c 2069 6620 6974 2068 6170  a bug, if it hap
-00012ae0: 7065 6e73 2e29 0a20 2020 2020 2020 2020  pens.).         
-00012af0: 2020 2020 2020 2023 2042 7574 2074 6f20         # But to 
-00012b00: 6265 2073 7572 652c 2072 6574 7572 6e20  be sure, return 
-00012b10: 2830 2c20 3029 0a20 2020 2020 2020 2020  (0, 0).         
-00012b20: 2020 2020 2020 2072 6574 7572 6e20 506f         return Po
-00012b30: 696e 7428 783d 302c 2079 3d30 290a 0a20  int(x=0, y=0).. 
-00012b40: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00012b50: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00012b60: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-00012b70: 2020 2023 2020 2020 2027 496e 7661 6c69     #     'Invali
-00012b80: 6420 706f 7369 7469 6f6e 2e20 726f 773d  d position. row=
-00012b90: 2572 2063 6f6c 3d25 722c 2076 6572 7469  %r col=%r, verti
-00012ba0: 6361 6c5f 7363 726f 6c6c 3d25 722c 2027  cal_scroll=%r, '
-00012bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012bc0: 2023 2020 2020 2027 686f 7269 7a6f 6e74   #     'horizont
-00012bd0: 616c 5f73 6372 6f6c 6c3d 2572 2c20 6865  al_scroll=%r, he
-00012be0: 6967 6874 3d25 7227 2025 0a20 2020 2020  ight=%r' %.     
-00012bf0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00012c00: 2028 726f 772c 2063 6f6c 2c20 7665 7274   (row, col, vert
-00012c10: 6963 616c 5f73 6372 6f6c 6c2c 2068 6f72  ical_scroll, hor
-00012c20: 697a 6f6e 7461 6c5f 7363 726f 6c6c 2c20  izontal_scroll, 
-00012c30: 7772 6974 655f 706f 7369 7469 6f6e 2e68  write_position.h
-00012c40: 6569 6768 7429 290a 2020 2020 2020 2020  eight)).        
-00012c50: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00012c60: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00012c70: 2050 6f69 6e74 2878 3d78 2c20 793d 7929   Point(x=x, y=y)
-00012c80: 0a0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
-00012c90: 6375 7273 6f72 2061 6e64 206d 656e 7520  cursor and menu 
-00012ca0: 706f 7369 7469 6f6e 732e 0a20 2020 2020  positions..     
-00012cb0: 2020 2069 6620 7569 5f63 6f6e 7465 6e74     if ui_content
-00012cc0: 2e63 7572 736f 725f 706f 7369 7469 6f6e  .cursor_position
-00012cd0: 3a0a 2020 2020 2020 2020 2020 2020 7363  :.            sc
-00012ce0: 7265 656e 5f63 7572 736f 725f 706f 7369  reen_cursor_posi
-00012cf0: 7469 6f6e 203d 2063 7572 736f 725f 706f  tion = cursor_po
-00012d00: 735f 746f 5f73 6372 6565 6e5f 706f 7328  s_to_screen_pos(
-00012d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012d20: 2075 695f 636f 6e74 656e 742e 6375 7273   ui_content.curs
-00012d30: 6f72 5f70 6f73 6974 696f 6e2e 792c 2075  or_position.y, u
-00012d40: 695f 636f 6e74 656e 742e 6375 7273 6f72  i_content.cursor
-00012d50: 5f70 6f73 6974 696f 6e2e 780a 2020 2020  _position.x.    
-00012d60: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00012d70: 2020 2020 2020 2069 6620 6861 735f 666f         if has_fo
-00012d80: 6375 733a 0a20 2020 2020 2020 2020 2020  cus:.           
-00012d90: 2020 2020 206e 6577 5f73 6372 6565 6e2e       new_screen.
-00012da0: 7365 745f 6375 7273 6f72 5f70 6f73 6974  set_cursor_posit
-00012db0: 696f 6e28 7365 6c66 2c20 7363 7265 656e  ion(self, screen
-00012dc0: 5f63 7572 736f 725f 706f 7369 7469 6f6e  _cursor_position
-00012dd0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-00012de0: 2020 2069 6620 616c 7761 7973 5f68 6964     if always_hid
-00012df0: 655f 6375 7273 6f72 3a0a 2020 2020 2020  e_cursor:.      
-00012e00: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00012e10: 775f 7363 7265 656e 2e73 686f 775f 6375  w_screen.show_cu
-00012e20: 7273 6f72 203d 2046 616c 7365 0a20 2020  rsor = False.   
-00012e30: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00012e40: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00012e50: 2020 2020 2020 206e 6577 5f73 6372 6565         new_scree
-00012e60: 6e2e 7368 6f77 5f63 7572 736f 7220 3d20  n.show_cursor = 
-00012e70: 7569 5f63 6f6e 7465 6e74 2e73 686f 775f  ui_content.show_
-00012e80: 6375 7273 6f72 0a0a 2020 2020 2020 2020  cursor..        
-00012e90: 2020 2020 2020 2020 7365 6c66 2e5f 6869          self._hi
-00012ea0: 6768 6c69 6768 745f 6469 6772 6170 6828  ghlight_digraph(
-00012eb0: 6e65 775f 7363 7265 656e 290a 0a20 2020  new_screen)..   
-00012ec0: 2020 2020 2020 2020 2069 6620 6869 6768           if high
-00012ed0: 6c69 6768 745f 6c69 6e65 733a 0a20 2020  light_lines:.   
-00012ee0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00012ef0: 662e 5f68 6967 686c 6967 6874 5f63 7572  f._highlight_cur
-00012f00: 736f 726c 696e 6573 280a 2020 2020 2020  sorlines(.      
-00012f10: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00012f20: 775f 7363 7265 656e 2c0a 2020 2020 2020  w_screen,.      
-00012f30: 2020 2020 2020 2020 2020 2020 2020 7363                sc
-00012f40: 7265 656e 5f63 7572 736f 725f 706f 7369  reen_cursor_posi
-00012f50: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
-00012f60: 2020 2020 2020 2020 2020 7870 6f73 2c0a            xpos,.
-00012f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f80: 2020 2020 7970 6f73 2c0a 2020 2020 2020      ypos,.      
-00012f90: 2020 2020 2020 2020 2020 2020 2020 7769                wi
-00012fa0: 6474 682c 0a20 2020 2020 2020 2020 2020  dth,.           
-00012fb0: 2020 2020 2020 2020 2077 7269 7465 5f70           write_p
-00012fc0: 6f73 6974 696f 6e2e 6865 6967 6874 2c0a  osition.height,.
-00012fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fe0: 290a 0a20 2020 2020 2020 2023 2044 7261  )..        # Dra
-00012ff0: 7720 696e 7075 7420 6368 6172 6163 7465  w input characte
-00013000: 7273 2066 726f 6d20 7468 6520 696e 7075  rs from the inpu
-00013010: 7420 7072 6f63 6573 736f 7220 7175 6575  t processor queu
-00013020: 652e 0a20 2020 2020 2020 2069 6620 6861  e..        if ha
-00013030: 735f 666f 6375 7320 616e 6420 7569 5f63  s_focus and ui_c
-00013040: 6f6e 7465 6e74 2e63 7572 736f 725f 706f  ontent.cursor_po
-00013050: 7369 7469 6f6e 3a0a 2020 2020 2020 2020  sition:.        
-00013060: 2020 2020 7365 6c66 2e5f 7368 6f77 5f6b      self._show_k
-00013070: 6579 5f70 726f 6365 7373 6f72 5f6b 6579  ey_processor_key
-00013080: 5f62 7566 6665 7228 6e65 775f 7363 7265  _buffer(new_scre
-00013090: 656e 290a 0a20 2020 2020 2020 2023 2053  en)..        # S
-000130a0: 6574 206d 656e 7520 706f 7369 7469 6f6e  et menu position
-000130b0: 2e0a 2020 2020 2020 2020 6966 2075 695f  ..        if ui_
-000130c0: 636f 6e74 656e 742e 6d65 6e75 5f70 6f73  content.menu_pos
-000130d0: 6974 696f 6e3a 0a20 2020 2020 2020 2020  ition:.         
-000130e0: 2020 206e 6577 5f73 6372 6565 6e2e 7365     new_screen.se
-000130f0: 745f 6d65 6e75 5f70 6f73 6974 696f 6e28  t_menu_position(
-00013100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013110: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
-00013120: 2020 2020 2020 2063 7572 736f 725f 706f         cursor_po
-00013130: 735f 746f 5f73 6372 6565 6e5f 706f 7328  s_to_screen_pos(
-00013140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013150: 2020 2020 2075 695f 636f 6e74 656e 742e       ui_content.
-00013160: 6d65 6e75 5f70 6f73 6974 696f 6e2e 792c  menu_position.y,
-00013170: 2075 695f 636f 6e74 656e 742e 6d65 6e75   ui_content.menu
-00013180: 5f70 6f73 6974 696f 6e2e 780a 2020 2020  _position.x.    
-00013190: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
-000131a0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-000131b0: 2020 2020 2020 2320 5570 6461 7465 206f        # Update o
-000131c0: 7574 7075 7420 7363 7265 656e 2068 6569  utput screen hei
-000131d0: 6768 742e 0a20 2020 2020 2020 206e 6577  ght..        new
-000131e0: 5f73 6372 6565 6e2e 6865 6967 6874 203d  _screen.height =
-000131f0: 206d 6178 286e 6577 5f73 6372 6565 6e2e   max(new_screen.
-00013200: 6865 6967 6874 2c20 7970 6f73 202b 2077  height, ypos + w
-00013210: 7269 7465 5f70 6f73 6974 696f 6e2e 6865  rite_position.he
-00013220: 6967 6874 290a 0a20 2020 2020 2020 2072  ight)..        r
-00013230: 6574 7572 6e20 7669 7369 626c 655f 6c69  eturn visible_li
-00013240: 6e65 5f74 6f5f 726f 775f 636f 6c2c 2072  ne_to_row_col, r
-00013250: 6f77 636f 6c5f 746f 5f79 780a 0a20 2020  owcol_to_yx..   
-00013260: 2064 6566 205f 6669 6c6c 5f62 6728 0a20   def _fill_bg(. 
-00013270: 2020 2020 2020 2073 656c 662c 2073 6372         self, scr
-00013280: 6565 6e3a 2053 6372 6565 6e2c 2077 7269  een: Screen, wri
-00013290: 7465 5f70 6f73 6974 696f 6e3a 2057 7269  te_position: Wri
-000132a0: 7465 506f 7369 7469 6f6e 2c20 6572 6173  tePosition, eras
-000132b0: 655f 6267 3a20 626f 6f6c 0a20 2020 2029  e_bg: bool.    )
-000132c0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-000132d0: 2020 2222 220a 2020 2020 2020 2020 4572    """.        Er
-000132e0: 6173 652f 6669 6c6c 2074 6865 2062 6163  ase/fill the bac
-000132f0: 6b67 726f 756e 642e 0a20 2020 2020 2020  kground..       
-00013300: 2028 5573 6566 756c 2066 6f72 2066 6c6f   (Useful for flo
-00013310: 6174 7320 616e 6420 7768 656e 2061 2060  ats and when a `
-00013320: 6368 6172 6020 6861 7320 6265 656e 2067  char` has been g
-00013330: 6976 656e 2e29 0a20 2020 2020 2020 2022  iven.).        "
-00013340: 2222 0a20 2020 2020 2020 2063 6861 723a  "".        char:
-00013350: 204f 7074 696f 6e61 6c5b 7374 725d 0a20   Optional[str]. 
-00013360: 2020 2020 2020 2069 6620 6361 6c6c 6162         if callab
-00013370: 6c65 2873 656c 662e 6368 6172 293a 0a20  le(self.char):. 
-00013380: 2020 2020 2020 2020 2020 2063 6861 7220             char 
-00013390: 3d20 7365 6c66 2e63 6861 7228 290a 2020  = self.char().  
-000133a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000133b0: 2020 2020 2020 2020 6368 6172 203d 2073          char = s
-000133c0: 656c 662e 6368 6172 0a0a 2020 2020 2020  elf.char..      
-000133d0: 2020 6966 2065 7261 7365 5f62 6720 6f72    if erase_bg or
-000133e0: 2063 6861 723a 0a20 2020 2020 2020 2020   char:.         
-000133f0: 2020 2077 7020 3d20 7772 6974 655f 706f     wp = write_po
-00013400: 7369 7469 6f6e 0a20 2020 2020 2020 2020  sition.         
-00013410: 2020 2063 6861 725f 6f62 6a20 3d20 5f43     char_obj = _C
-00013420: 4841 525f 4341 4348 455b 6368 6172 206f  HAR_CACHE[char o
-00013430: 7220 2220 222c 2022 225d 0a0a 2020 2020  r " ", ""]..    
-00013440: 2020 2020 2020 2020 666f 7220 7920 696e          for y in
-00013450: 2072 616e 6765 2877 702e 7970 6f73 2c20   range(wp.ypos, 
-00013460: 7770 2e79 706f 7320 2b20 7770 2e68 6569  wp.ypos + wp.hei
-00013470: 6768 7429 3a0a 2020 2020 2020 2020 2020  ght):.          
-00013480: 2020 2020 2020 726f 7720 3d20 7363 7265        row = scre
-00013490: 656e 2e64 6174 615f 6275 6666 6572 5b79  en.data_buffer[y
-000134a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000134b0: 2020 666f 7220 7820 696e 2072 616e 6765    for x in range
-000134c0: 2877 702e 7870 6f73 2c20 7770 2e78 706f  (wp.xpos, wp.xpo
-000134d0: 7320 2b20 7770 2e77 6964 7468 293a 0a20  s + wp.width):. 
-000134e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134f0: 2020 2072 6f77 5b78 5d20 3d20 6368 6172     row[x] = char
-00013500: 5f6f 626a 0a0a 2020 2020 6465 6620 5f61  _obj..    def _a
-00013510: 7070 6c79 5f73 7479 6c65 280a 2020 2020  pply_style(.    
-00013520: 2020 2020 7365 6c66 2c20 6e65 775f 7363      self, new_sc
-00013530: 7265 656e 3a20 5363 7265 656e 2c20 7772  reen: Screen, wr
-00013540: 6974 655f 706f 7369 7469 6f6e 3a20 5772  ite_position: Wr
-00013550: 6974 6550 6f73 6974 696f 6e2c 2070 6172  itePosition, par
-00013560: 656e 745f 7374 796c 653a 2073 7472 0a20  ent_style: str. 
-00013570: 2020 2029 202d 3e20 4e6f 6e65 3a0a 0a20     ) -> None:.. 
-00013580: 2020 2020 2020 2023 2041 7070 6c79 2060         # Apply `
-00013590: 7365 6c66 2e73 7479 6c65 602e 0a20 2020  self.style`..   
-000135a0: 2020 2020 2073 7479 6c65 203d 2070 6172       style = par
-000135b0: 656e 745f 7374 796c 6520 2b20 2220 2220  ent_style + " " 
-000135c0: 2b20 746f 5f73 7472 2873 656c 662e 7374  + to_str(self.st
-000135d0: 796c 6529 0a0a 2020 2020 2020 2020 6e65  yle)..        ne
-000135e0: 775f 7363 7265 656e 2e66 696c 6c5f 6172  w_screen.fill_ar
-000135f0: 6561 2877 7269 7465 5f70 6f73 6974 696f  ea(write_positio
-00013600: 6e2c 2073 7479 6c65 3d73 7479 6c65 2c20  n, style=style, 
-00013610: 6166 7465 723d 4661 6c73 6529 0a0a 2020  after=False)..  
-00013620: 2020 2020 2020 2320 4170 706c 7920 7468        # Apply th
-00013630: 6520 276c 6173 742d 6c69 6e65 2720 636c  e 'last-line' cl
-00013640: 6173 7320 746f 2074 6865 206c 6173 7420  ass to the last 
-00013650: 6c69 6e65 206f 6620 6561 6368 2057 696e  line of each Win
-00013660: 646f 772e 2054 6869 7320 6361 6e0a 2020  dow. This can.  
-00013670: 2020 2020 2020 2320 6265 2075 7365 6420        # be used 
-00013680: 746f 2061 7070 6c79 2061 6e20 2775 6e64  to apply an 'und
-00013690: 6572 6c69 6e65 2720 746f 2074 6865 2075  erline' to the u
-000136a0: 7365 7220 636f 6e74 726f 6c2e 0a20 2020  ser control..   
-000136b0: 2020 2020 2077 7020 3d20 5772 6974 6550       wp = WriteP
-000136c0: 6f73 6974 696f 6e28 0a20 2020 2020 2020  osition(.       
-000136d0: 2020 2020 2077 7269 7465 5f70 6f73 6974       write_posit
-000136e0: 696f 6e2e 7870 6f73 2c0a 2020 2020 2020  ion.xpos,.      
-000136f0: 2020 2020 2020 7772 6974 655f 706f 7369        write_posi
-00013700: 7469 6f6e 2e79 706f 7320 2b20 7772 6974  tion.ypos + writ
-00013710: 655f 706f 7369 7469 6f6e 2e68 6569 6768  e_position.heigh
-00013720: 7420 2d20 312c 0a20 2020 2020 2020 2020  t - 1,.         
-00013730: 2020 2077 7269 7465 5f70 6f73 6974 696f     write_positio
-00013740: 6e2e 7769 6474 682c 0a20 2020 2020 2020  n.width,.       
-00013750: 2020 2020 2031 2c0a 2020 2020 2020 2020       1,.        
-00013760: 290a 2020 2020 2020 2020 6e65 775f 7363  ).        new_sc
-00013770: 7265 656e 2e66 696c 6c5f 6172 6561 2877  reen.fill_area(w
-00013780: 702c 2022 636c 6173 733a 6c61 7374 2d6c  p, "class:last-l
-00013790: 696e 6522 2c20 6166 7465 723d 5472 7565  ine", after=True
-000137a0: 290a 0a20 2020 2064 6566 205f 6869 6768  )..    def _high
-000137b0: 6c69 6768 745f 6469 6772 6170 6828 7365  light_digraph(se
-000137c0: 6c66 2c20 6e65 775f 7363 7265 656e 3a20  lf, new_screen: 
-000137d0: 5363 7265 656e 2920 2d3e 204e 6f6e 653a  Screen) -> None:
-000137e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000137f0: 2020 2020 2057 6865 6e20 7765 2061 7265       When we are
-00013800: 2069 6e20 5669 2064 6967 7261 7068 206d   in Vi digraph m
-00013810: 6f64 652c 2070 7574 2061 2071 7565 7374  ode, put a quest
-00013820: 696f 6e20 6d61 726b 2075 6e64 6572 6e65  ion mark underne
-00013830: 6174 6820 7468 650a 2020 2020 2020 2020  ath the.        
-00013840: 6375 7273 6f72 2e0a 2020 2020 2020 2020  cursor..        
-00013850: 2222 220a 2020 2020 2020 2020 6469 6772  """.        digr
-00013860: 6170 685f 6368 6172 203d 2073 656c 662e  aph_char = self.
-00013870: 5f67 6574 5f64 6967 7261 7068 5f63 6861  _get_digraph_cha
-00013880: 7228 290a 2020 2020 2020 2020 6966 2064  r().        if d
-00013890: 6967 7261 7068 5f63 6861 723a 0a20 2020  igraph_char:.   
-000138a0: 2020 2020 2020 2020 2063 706f 7320 3d20           cpos = 
-000138b0: 6e65 775f 7363 7265 656e 2e67 6574 5f63  new_screen.get_c
-000138c0: 7572 736f 725f 706f 7369 7469 6f6e 2873  ursor_position(s
-000138d0: 656c 6629 0a20 2020 2020 2020 2020 2020  elf).           
-000138e0: 206e 6577 5f73 6372 6565 6e2e 6461 7461   new_screen.data
-000138f0: 5f62 7566 6665 725b 6370 6f73 2e79 5d5b  _buffer[cpos.y][
-00013900: 6370 6f73 2e78 5d20 3d20 5f43 4841 525f  cpos.x] = _CHAR_
-00013910: 4341 4348 455b 0a20 2020 2020 2020 2020  CACHE[.         
-00013920: 2020 2020 2020 2064 6967 7261 7068 5f63         digraph_c
-00013930: 6861 722c 2022 636c 6173 733a 6469 6772  har, "class:digr
-00013940: 6170 6822 0a20 2020 2020 2020 2020 2020  aph".           
-00013950: 205d 0a0a 2020 2020 6465 6620 5f73 686f   ]..    def _sho
-00013960: 775f 6b65 795f 7072 6f63 6573 736f 725f  w_key_processor_
-00013970: 6b65 795f 6275 6666 6572 2873 656c 662c  key_buffer(self,
-00013980: 206e 6577 5f73 6372 6565 6e3a 2053 6372   new_screen: Scr
-00013990: 6565 6e29 202d 3e20 4e6f 6e65 3a0a 2020  een) -> None:.  
-000139a0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000139b0: 2020 5768 656e 2074 6865 2075 7365 7220    When the user 
-000139c0: 6973 2074 7970 696e 6720 6120 6b65 7920  is typing a key 
-000139d0: 6269 6e64 696e 6720 7468 6174 2063 6f6e  binding that con
-000139e0: 7369 7374 7320 6f66 2073 6576 6572 616c  sists of several
-000139f0: 206b 6579 732c 0a20 2020 2020 2020 2064   keys,.        d
-00013a00: 6973 706c 6179 2074 6865 206c 6173 7420  isplay the last 
-00013a10: 7072 6573 7365 6420 6b65 7920 6966 2074  pressed key if t
-00013a20: 6865 2075 7365 7220 6973 2069 6e20 696e  he user is in in
-00013a30: 7365 7274 206d 6f64 6520 616e 6420 7468  sert mode and th
-00013a40: 6520 6b65 790a 2020 2020 2020 2020 6973  e key.        is
-00013a50: 206d 6561 6e69 6e67 6675 6c20 746f 2062   meaningful to b
-00013a60: 6520 6469 7370 6c61 7965 642e 0a20 2020  e displayed..   
-00013a70: 2020 2020 2045 2e67 2e20 536f 6d65 2070       E.g. Some p
-00013a80: 656f 706c 6520 7761 6e74 2074 6f20 6269  eople want to bi
-00013a90: 6e64 2027 6a6a 2720 746f 2065 7363 6170  nd 'jj' to escap
-00013aa0: 6520 696e 2056 6920 696e 7365 7274 206d  e in Vi insert m
-00013ab0: 6f64 652e 2042 7574 2074 6865 0a20 2020  ode. But the.   
-00013ac0: 2020 2020 2020 2020 2020 6669 7273 7420            first 
-00013ad0: 276a 2720 6e65 6564 7320 746f 2062 6520  'j' needs to be 
-00013ae0: 6469 7370 6c61 7965 6420 696e 206f 7264  displayed in ord
-00013af0: 6572 2074 6f20 6765 7420 736f 6d65 2066  er to get some f
-00013b00: 6565 6462 6163 6b2e 0a20 2020 2020 2020  eedback..       
-00013b10: 2022 2222 0a20 2020 2020 2020 2061 7070   """.        app
-00013b20: 203d 2067 6574 5f61 7070 2829 0a20 2020   = get_app().   
-00013b30: 2020 2020 206b 6579 5f62 7566 6665 7220       key_buffer 
-00013b40: 3d20 6170 702e 6b65 795f 7072 6f63 6573  = app.key_proces
-00013b50: 736f 722e 6b65 795f 6275 6666 6572 0a0a  sor.key_buffer..
-00013b60: 2020 2020 2020 2020 6966 206b 6579 5f62          if key_b
-00013b70: 7566 6665 7220 616e 6420 5f69 6e5f 696e  uffer and _in_in
-00013b80: 7365 7274 5f6d 6f64 6528 2920 616e 6420  sert_mode() and 
-00013b90: 6e6f 7420 6170 702e 6973 5f64 6f6e 653a  not app.is_done:
-00013ba0: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
-00013bb0: 6865 2074 6578 7475 616c 2064 6174 6120  he textual data 
-00013bc0: 666f 7220 7468 6520 6769 7665 6e20 6b65  for the given ke
-00013bd0: 792e 2028 4361 6e20 6265 2061 2056 5431  y. (Can be a VT1
-00013be0: 3030 2065 7363 6170 650a 2020 2020 2020  00 escape.      
-00013bf0: 2020 2020 2020 2320 7365 7175 656e 6365        # sequence
-00013c00: 2e29 0a20 2020 2020 2020 2020 2020 2064  .).            d
-00013c10: 6174 6120 3d20 6b65 795f 6275 6666 6572  ata = key_buffer
-00013c20: 5b2d 315d 2e64 6174 610a 0a20 2020 2020  [-1].data..     
-00013c30: 2020 2020 2020 2023 2044 6973 706c 6179         # Display
-00013c40: 206f 6e6c 7920 6966 2074 6869 7320 6973   only if this is
-00013c50: 2061 2031 2063 656c 6c20 7769 6474 6820   a 1 cell width 
-00013c60: 6368 6172 6163 7465 722e 0a20 2020 2020  character..     
-00013c70: 2020 2020 2020 2069 6620 6765 745f 6377         if get_cw
-00013c80: 6964 7468 2864 6174 6129 203d 3d20 313a  idth(data) == 1:
-00013c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013ca0: 2063 706f 7320 3d20 6e65 775f 7363 7265   cpos = new_scre
-00013cb0: 656e 2e67 6574 5f63 7572 736f 725f 706f  en.get_cursor_po
-00013cc0: 7369 7469 6f6e 2873 656c 6629 0a20 2020  sition(self).   
-00013cd0: 2020 2020 2020 2020 2020 2020 206e 6577               new
-00013ce0: 5f73 6372 6565 6e2e 6461 7461 5f62 7566  _screen.data_buf
-00013cf0: 6665 725b 6370 6f73 2e79 5d5b 6370 6f73  fer[cpos.y][cpos
-00013d00: 2e78 5d20 3d20 5f43 4841 525f 4341 4348  .x] = _CHAR_CACH
-00013d10: 455b 0a20 2020 2020 2020 2020 2020 2020  E[.             
-00013d20: 2020 2020 2020 2064 6174 612c 2022 636c         data, "cl
-00013d30: 6173 733a 7061 7274 6961 6c2d 6b65 792d  ass:partial-key-
-00013d40: 6269 6e64 696e 6722 0a20 2020 2020 2020  binding".       
-00013d50: 2020 2020 2020 2020 205d 0a0a 2020 2020           ]..    
-00013d60: 6465 6620 5f68 6967 686c 6967 6874 5f63  def _highlight_c
-00013d70: 7572 736f 726c 696e 6573 280a 2020 2020  ursorlines(.    
-00013d80: 2020 2020 7365 6c66 2c20 6e65 775f 7363      self, new_sc
-00013d90: 7265 656e 3a20 5363 7265 656e 2c20 6370  reen: Screen, cp
-00013da0: 6f73 3a20 506f 696e 742c 2078 3a20 696e  os: Point, x: in
-00013db0: 742c 2079 3a20 696e 742c 2077 6964 7468  t, y: int, width
-00013dc0: 3a20 696e 742c 2068 6569 6768 743a 2069  : int, height: i
-00013dd0: 6e74 0a20 2020 2029 202d 3e20 4e6f 6e65  nt.    ) -> None
-00013de0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00013df0: 2020 2020 2020 4869 6768 6c69 6768 7420        Highlight 
-00013e00: 6375 7273 6f72 2072 6f77 2f63 6f6c 756d  cursor row/colum
-00013e10: 6e2e 0a20 2020 2020 2020 2022 2222 0a20  n..        """. 
-00013e20: 2020 2020 2020 2063 7572 736f 725f 6c69         cursor_li
-00013e30: 6e65 5f73 7479 6c65 203d 2022 2063 6c61  ne_style = " cla
-00013e40: 7373 3a63 7572 736f 722d 6c69 6e65 2022  ss:cursor-line "
-00013e50: 0a20 2020 2020 2020 2063 7572 736f 725f  .        cursor_
-00013e60: 636f 6c75 6d6e 5f73 7479 6c65 203d 2022  column_style = "
-00013e70: 2063 6c61 7373 3a63 7572 736f 722d 636f   class:cursor-co
-00013e80: 6c75 6d6e 2022 0a0a 2020 2020 2020 2020  lumn "..        
-00013e90: 6461 7461 5f62 7566 6665 7220 3d20 6e65  data_buffer = ne
-00013ea0: 775f 7363 7265 656e 2e64 6174 615f 6275  w_screen.data_bu
-00013eb0: 6666 6572 0a0a 2020 2020 2020 2020 2320  ffer..        # 
-00013ec0: 4869 6768 6c69 6768 7420 6375 7273 6f72  Highlight cursor
-00013ed0: 206c 696e 652e 0a20 2020 2020 2020 2069   line..        i
-00013ee0: 6620 7365 6c66 2e63 7572 736f 726c 696e  f self.cursorlin
-00013ef0: 6528 293a 0a20 2020 2020 2020 2020 2020  e():.           
-00013f00: 2072 6f77 203d 2064 6174 615f 6275 6666   row = data_buff
-00013f10: 6572 5b63 706f 732e 795d 0a20 2020 2020  er[cpos.y].     
-00013f20: 2020 2020 2020 2066 6f72 2078 2069 6e20         for x in 
-00013f30: 7261 6e67 6528 782c 2078 202b 2077 6964  range(x, x + wid
-00013f40: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
-00013f50: 2020 2020 206f 7269 6769 6e61 6c5f 6368       original_ch
-00013f60: 6172 203d 2072 6f77 5b78 5d0a 2020 2020  ar = row[x].    
-00013f70: 2020 2020 2020 2020 2020 2020 726f 775b              row[
-00013f80: 785d 203d 205f 4348 4152 5f43 4143 4845  x] = _CHAR_CACHE
-00013f90: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-00013fa0: 2020 2020 2020 6f72 6967 696e 616c 5f63        original_c
-00013fb0: 6861 722e 6368 6172 2c20 6f72 6967 696e  har.char, origin
-00013fc0: 616c 5f63 6861 722e 7374 796c 6520 2b20  al_char.style + 
-00013fd0: 6375 7273 6f72 5f6c 696e 655f 7374 796c  cursor_line_styl
-00013fe0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00013ff0: 2020 5d0a 0a20 2020 2020 2020 2023 2048    ]..        # H
-00014000: 6967 686c 6967 6874 2063 7572 736f 7220  ighlight cursor 
-00014010: 636f 6c75 6d6e 2e0a 2020 2020 2020 2020  column..        
-00014020: 6966 2073 656c 662e 6375 7273 6f72 636f  if self.cursorco
-00014030: 6c75 6d6e 2829 3a0a 2020 2020 2020 2020  lumn():.        
-00014040: 2020 2020 666f 7220 7932 2069 6e20 7261      for y2 in ra
-00014050: 6e67 6528 792c 2079 202b 2068 6569 6768  nge(y, y + heigh
-00014060: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-00014070: 2020 2020 726f 7720 3d20 6461 7461 5f62      row = data_b
-00014080: 7566 6665 725b 7932 5d0a 2020 2020 2020  uffer[y2].      
-00014090: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
-000140a0: 616c 5f63 6861 7220 3d20 726f 775b 6370  al_char = row[cp
-000140b0: 6f73 2e78 5d0a 2020 2020 2020 2020 2020  os.x].          
-000140c0: 2020 2020 2020 726f 775b 6370 6f73 2e78        row[cpos.x
-000140d0: 5d20 3d20 5f43 4841 525f 4341 4348 455b  ] = _CHAR_CACHE[
-000140e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000140f0: 2020 2020 206f 7269 6769 6e61 6c5f 6368       original_ch
-00014100: 6172 2e63 6861 722c 206f 7269 6769 6e61  ar.char, origina
-00014110: 6c5f 6368 6172 2e73 7479 6c65 202b 2063  l_char.style + c
-00014120: 7572 736f 725f 636f 6c75 6d6e 5f73 7479  ursor_column_sty
-00014130: 6c65 0a20 2020 2020 2020 2020 2020 2020  le.             
-00014140: 2020 205d 0a0a 2020 2020 2020 2020 2320     ]..        # 
-00014150: 4869 6768 6c69 6768 7420 636f 6c6f 7220  Highlight color 
-00014160: 636f 6c75 6d6e 730a 2020 2020 2020 2020  columns.        
-00014170: 636f 6c6f 7263 6f6c 756d 6e73 203d 2073  colorcolumns = s
-00014180: 656c 662e 636f 6c6f 7263 6f6c 756d 6e73  elf.colorcolumns
-00014190: 0a20 2020 2020 2020 2069 6620 6361 6c6c  .        if call
-000141a0: 6162 6c65 2863 6f6c 6f72 636f 6c75 6d6e  able(colorcolumn
-000141b0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-000141c0: 636f 6c6f 7263 6f6c 756d 6e73 203d 2063  colorcolumns = c
-000141d0: 6f6c 6f72 636f 6c75 6d6e 7328 290a 0a20  olorcolumns().. 
-000141e0: 2020 2020 2020 2066 6f72 2063 6320 696e         for cc in
-000141f0: 2063 6f6c 6f72 636f 6c75 6d6e 733a 0a20   colorcolumns:. 
-00014200: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00014210: 7420 6973 696e 7374 616e 6365 2863 632c  t isinstance(cc,
-00014220: 2043 6f6c 6f72 436f 6c75 6d6e 290a 2020   ColorColumn).  
-00014230: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
-00014240: 203d 2063 632e 706f 7369 7469 6f6e 0a0a   = cc.position..
-00014250: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00014260: 6f6c 756d 6e20 3c20 7820 2b20 7769 6474  olumn < x + widt
-00014270: 683a 2020 2320 4f6e 6c79 2064 7261 7720  h:  # Only draw 
-00014280: 7768 656e 2076 6973 6962 6c65 2e0a 2020  when visible..  
-00014290: 2020 2020 2020 2020 2020 2020 2020 636f                co
-000142a0: 6c6f 725f 636f 6c75 6d6e 5f73 7479 6c65  lor_column_style
-000142b0: 203d 2022 2022 202b 2063 632e 7374 796c   = " " + cc.styl
-000142c0: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
-000142d0: 2020 2066 6f72 2079 3220 696e 2072 616e     for y2 in ran
-000142e0: 6765 2879 2c20 7920 2b20 6865 6967 6874  ge(y, y + height
-000142f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00014300: 2020 2020 2020 2072 6f77 203d 2064 6174         row = dat
-00014310: 615f 6275 6666 6572 5b79 325d 0a20 2020  a_buffer[y2].   
+00012600: 2020 2020 2020 2020 2020 7820 2b20 7870            x + xp
+00012610: 6f73 2c0a 2020 2020 2020 2020 2020 2020  os,.            
+00012620: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00012630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012640: 2020 2063 6f6c 202b 3d20 310a 2020 2020     col += 1.    
+00012650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012660: 7820 2b3d 2063 6861 725f 7769 6474 680a  x += char_width.
+00012670: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00012680: 726e 2078 2c20 790a 0a20 2020 2020 2020  rn x, y..       
+00012690: 2023 2043 6f70 7920 636f 6e74 656e 742e   # Copy content.
+000126a0: 0a20 2020 2020 2020 2064 6566 2063 6f70  .        def cop
+000126b0: 7928 2920 2d3e 2069 6e74 3a0a 2020 2020  y() -> int:.    
+000126c0: 2020 2020 2020 2020 7920 3d20 2d76 6572          y = -ver
+000126d0: 7469 6361 6c5f 7363 726f 6c6c 5f32 0a20  tical_scroll_2. 
+000126e0: 2020 2020 2020 2020 2020 206c 696e 656e             linen
+000126f0: 6f20 3d20 7665 7274 6963 616c 5f73 6372  o = vertical_scr
+00012700: 6f6c 6c0a 0a20 2020 2020 2020 2020 2020  oll..           
+00012710: 2077 6869 6c65 2079 203c 2077 7269 7465   while y < write
+00012720: 5f70 6f73 6974 696f 6e2e 6865 6967 6874  _position.height
+00012730: 2061 6e64 206c 696e 656e 6f20 3c20 6c69   and lineno < li
+00012740: 6e65 5f63 6f75 6e74 3a0a 2020 2020 2020  ne_count:.      
+00012750: 2020 2020 2020 2020 2020 2320 5461 6b65            # Take
+00012760: 2074 6865 206e 6578 7420 6c69 6e65 2061   the next line a
+00012770: 6e64 2063 6f70 7920 6974 2069 6e20 7468  nd copy it in th
+00012780: 6520 7265 616c 2073 6372 6565 6e2e 0a20  e real screen.. 
+00012790: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+000127a0: 696e 6520 3d20 7569 5f63 6f6e 7465 6e74  ine = ui_content
+000127b0: 2e67 6574 5f6c 696e 6528 6c69 6e65 6e6f  .get_line(lineno
+000127c0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+000127d0: 2020 2076 6973 6962 6c65 5f6c 696e 655f     visible_line_
+000127e0: 746f 5f72 6f77 5f63 6f6c 5b79 5d20 3d20  to_row_col[y] = 
+000127f0: 286c 696e 656e 6f2c 2068 6f72 697a 6f6e  (lineno, horizon
+00012800: 7461 6c5f 7363 726f 6c6c 290a 0a20 2020  tal_scroll)..   
+00012810: 2020 2020 2020 2020 2020 2020 2023 2043               # C
+00012820: 6f70 7920 6d61 7267 696e 2061 6e64 2061  opy margin and a
+00012830: 6374 7561 6c20 6c69 6e65 2e0a 2020 2020  ctual line..    
+00012840: 2020 2020 2020 2020 2020 2020 7820 3d20              x = 
+00012850: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
+00012860: 2020 782c 2079 203d 2063 6f70 795f 6c69    x, y = copy_li
+00012870: 6e65 286c 696e 652c 206c 696e 656e 6f2c  ne(line, lineno,
+00012880: 2078 2c20 792c 2069 735f 696e 7075 743d   x, y, is_input=
+00012890: 5472 7565 290a 0a20 2020 2020 2020 2020  True)..         
+000128a0: 2020 2020 2020 206c 696e 656e 6f20 2b3d         lineno +=
+000128b0: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+000128c0: 2020 2079 202b 3d20 310a 2020 2020 2020     y += 1.      
+000128d0: 2020 2020 2020 7265 7475 726e 2079 0a0a        return y..
+000128e0: 2020 2020 2020 2020 636f 7079 2829 0a0a          copy()..
+000128f0: 2020 2020 2020 2020 6465 6620 6375 7273          def curs
+00012900: 6f72 5f70 6f73 5f74 6f5f 7363 7265 656e  or_pos_to_screen
+00012910: 5f70 6f73 2872 6f77 3a20 696e 742c 2063  _pos(row: int, c
+00012920: 6f6c 3a20 696e 7429 202d 3e20 506f 696e  ol: int) -> Poin
+00012930: 743a 0a20 2020 2020 2020 2020 2020 2022  t:.            "
+00012940: 5472 616e 736c 6174 6520 726f 772f 636f  Translate row/co
+00012950: 6c20 6672 6f6d 2055 4943 6f6e 7465 6e74  l from UIContent
+00012960: 2074 6f20 7265 616c 2053 6372 6565 6e20   to real Screen 
+00012970: 636f 6f72 6469 6e61 7465 732e 220a 2020  coordinates.".  
+00012980: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00012990: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+000129a0: 2c20 7820 3d20 726f 7763 6f6c 5f74 6f5f  , x = rowcol_to_
+000129b0: 7978 5b72 6f77 2c20 636f 6c5d 0a20 2020  yx[row, col].   
+000129c0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+000129d0: 4b65 7945 7272 6f72 3a0a 2020 2020 2020  KeyError:.      
+000129e0: 2020 2020 2020 2020 2020 2320 4e6f 726d            # Norm
+000129f0: 616c 6c79 2074 6869 7320 7368 6f75 6c64  ally this should
+00012a00: 206e 6576 6572 2068 6170 7065 6e2e 2028   never happen. (
+00012a10: 4974 2069 7320 6120 6275 672c 2069 6620  It is a bug, if 
+00012a20: 6974 2068 6170 7065 6e73 2e29 0a20 2020  it happens.).   
+00012a30: 2020 2020 2020 2020 2020 2020 2023 2042               # B
+00012a40: 7574 2074 6f20 6265 2073 7572 652c 2072  ut to be sure, r
+00012a50: 6574 7572 6e20 2830 2c20 3029 0a20 2020  eturn (0, 0).   
+00012a60: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00012a70: 7572 6e20 506f 696e 7428 783d 302c 2079  urn Point(x=0, y
+00012a80: 3d30 290a 0a20 2020 2020 2020 2020 2020  =0)..           
+00012a90: 2020 2020 2023 2072 6169 7365 2056 616c       # raise Val
+00012aa0: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+00012ab0: 2020 2020 2020 2020 2023 2020 2020 2027           #     '
+00012ac0: 496e 7661 6c69 6420 706f 7369 7469 6f6e  Invalid position
+00012ad0: 2e20 726f 773d 2572 2063 6f6c 3d25 722c  . row=%r col=%r,
+00012ae0: 2076 6572 7469 6361 6c5f 7363 726f 6c6c   vertical_scroll
+00012af0: 3d25 722c 2027 0a20 2020 2020 2020 2020  =%r, '.         
+00012b00: 2020 2020 2020 2023 2020 2020 2027 686f         #     'ho
+00012b10: 7269 7a6f 6e74 616c 5f73 6372 6f6c 6c3d  rizontal_scroll=
+00012b20: 2572 2c20 6865 6967 6874 3d25 7227 2025  %r, height=%r' %
+00012b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012b40: 2023 2020 2020 2028 726f 772c 2063 6f6c   #     (row, col
+00012b50: 2c20 7665 7274 6963 616c 5f73 6372 6f6c  , vertical_scrol
+00012b60: 6c2c 2068 6f72 697a 6f6e 7461 6c5f 7363  l, horizontal_sc
+00012b70: 726f 6c6c 2c20 7772 6974 655f 706f 7369  roll, write_posi
+00012b80: 7469 6f6e 2e68 6569 6768 7429 290a 2020  tion.height)).  
+00012b90: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00012ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012bb0: 7265 7475 726e 2050 6f69 6e74 2878 3d78  return Point(x=x
+00012bc0: 2c20 793d 7929 0a0a 2020 2020 2020 2020  , y=y)..        
+00012bd0: 2320 5365 7420 6375 7273 6f72 2061 6e64  # Set cursor and
+00012be0: 206d 656e 7520 706f 7369 7469 6f6e 732e   menu positions.
+00012bf0: 0a20 2020 2020 2020 2069 6620 7569 5f63  .        if ui_c
+00012c00: 6f6e 7465 6e74 2e63 7572 736f 725f 706f  ontent.cursor_po
+00012c10: 7369 7469 6f6e 3a0a 2020 2020 2020 2020  sition:.        
+00012c20: 2020 2020 7363 7265 656e 5f63 7572 736f      screen_curso
+00012c30: 725f 706f 7369 7469 6f6e 203d 2063 7572  r_position = cur
+00012c40: 736f 725f 706f 735f 746f 5f73 6372 6565  sor_pos_to_scree
+00012c50: 6e5f 706f 7328 0a20 2020 2020 2020 2020  n_pos(.         
+00012c60: 2020 2020 2020 2075 695f 636f 6e74 656e         ui_conten
+00012c70: 742e 6375 7273 6f72 5f70 6f73 6974 696f  t.cursor_positio
+00012c80: 6e2e 792c 2075 695f 636f 6e74 656e 742e  n.y, ui_content.
+00012c90: 6375 7273 6f72 5f70 6f73 6974 696f 6e2e  cursor_position.
+00012ca0: 780a 2020 2020 2020 2020 2020 2020 290a  x.            ).
+00012cb0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00012cc0: 6861 735f 666f 6375 733a 0a20 2020 2020  has_focus:.     
+00012cd0: 2020 2020 2020 2020 2020 206e 6577 5f73             new_s
+00012ce0: 6372 6565 6e2e 7365 745f 6375 7273 6f72  creen.set_cursor
+00012cf0: 5f70 6f73 6974 696f 6e28 7365 6c66 2c20  _position(self, 
+00012d00: 7363 7265 656e 5f63 7572 736f 725f 706f  screen_cursor_po
+00012d10: 7369 7469 6f6e 290a 0a20 2020 2020 2020  sition)..       
+00012d20: 2020 2020 2020 2020 2069 6620 616c 7761           if alwa
+00012d30: 7973 5f68 6964 655f 6375 7273 6f72 3a0a  ys_hide_cursor:.
+00012d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d50: 2020 2020 6e65 775f 7363 7265 656e 2e73      new_screen.s
+00012d60: 686f 775f 6375 7273 6f72 203d 2046 616c  how_cursor = Fal
+00012d70: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
+00012d80: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00012d90: 2020 2020 2020 2020 2020 2020 206e 6577               new
+00012da0: 5f73 6372 6565 6e2e 7368 6f77 5f63 7572  _screen.show_cur
+00012db0: 736f 7220 3d20 7569 5f63 6f6e 7465 6e74  sor = ui_content
+00012dc0: 2e73 686f 775f 6375 7273 6f72 0a0a 2020  .show_cursor..  
+00012dd0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00012de0: 6c66 2e5f 6869 6768 6c69 6768 745f 6469  lf._highlight_di
+00012df0: 6772 6170 6828 6e65 775f 7363 7265 656e  graph(new_screen
+00012e00: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00012e10: 6620 6869 6768 6c69 6768 745f 6c69 6e65  f highlight_line
+00012e20: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00012e30: 2020 2073 656c 662e 5f68 6967 686c 6967     self._highlig
+00012e40: 6874 5f63 7572 736f 726c 696e 6573 280a  ht_cursorlines(.
+00012e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e60: 2020 2020 6e65 775f 7363 7265 656e 2c0a      new_screen,.
+00012e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e80: 2020 2020 7363 7265 656e 5f63 7572 736f      screen_curso
+00012e90: 725f 706f 7369 7469 6f6e 2c0a 2020 2020  r_position,.    
+00012ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012eb0: 7870 6f73 2c0a 2020 2020 2020 2020 2020  xpos,.          
+00012ec0: 2020 2020 2020 2020 2020 7970 6f73 2c0a            ypos,.
+00012ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ee0: 2020 2020 7769 6474 682c 0a20 2020 2020      width,.     
+00012ef0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+00012f00: 7269 7465 5f70 6f73 6974 696f 6e2e 6865  rite_position.he
+00012f10: 6967 6874 2c0a 2020 2020 2020 2020 2020  ight,.          
+00012f20: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00012f30: 2023 2044 7261 7720 696e 7075 7420 6368   # Draw input ch
+00012f40: 6172 6163 7465 7273 2066 726f 6d20 7468  aracters from th
+00012f50: 6520 696e 7075 7420 7072 6f63 6573 736f  e input processo
+00012f60: 7220 7175 6575 652e 0a20 2020 2020 2020  r queue..       
+00012f70: 2069 6620 6861 735f 666f 6375 7320 616e   if has_focus an
+00012f80: 6420 7569 5f63 6f6e 7465 6e74 2e63 7572  d ui_content.cur
+00012f90: 736f 725f 706f 7369 7469 6f6e 3a0a 2020  sor_position:.  
+00012fa0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00012fb0: 7368 6f77 5f6b 6579 5f70 726f 6365 7373  show_key_process
+00012fc0: 6f72 5f6b 6579 5f62 7566 6665 7228 6e65  or_key_buffer(ne
+00012fd0: 775f 7363 7265 656e 290a 0a20 2020 2020  w_screen)..     
+00012fe0: 2020 2023 2053 6574 206d 656e 7520 706f     # Set menu po
+00012ff0: 7369 7469 6f6e 2e0a 2020 2020 2020 2020  sition..        
+00013000: 6966 2075 695f 636f 6e74 656e 742e 6d65  if ui_content.me
+00013010: 6e75 5f70 6f73 6974 696f 6e3a 0a20 2020  nu_position:.   
+00013020: 2020 2020 2020 2020 206e 6577 5f73 6372           new_scr
+00013030: 6565 6e2e 7365 745f 6d65 6e75 5f70 6f73  een.set_menu_pos
+00013040: 6974 696f 6e28 0a20 2020 2020 2020 2020  ition(.         
+00013050: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+00013060: 2020 2020 2020 2020 2020 2020 2063 7572               cur
+00013070: 736f 725f 706f 735f 746f 5f73 6372 6565  sor_pos_to_scree
+00013080: 6e5f 706f 7328 0a20 2020 2020 2020 2020  n_pos(.         
+00013090: 2020 2020 2020 2020 2020 2075 695f 636f             ui_co
+000130a0: 6e74 656e 742e 6d65 6e75 5f70 6f73 6974  ntent.menu_posit
+000130b0: 696f 6e2e 792c 2075 695f 636f 6e74 656e  ion.y, ui_conten
+000130c0: 742e 6d65 6e75 5f70 6f73 6974 696f 6e2e  t.menu_position.
+000130d0: 780a 2020 2020 2020 2020 2020 2020 2020  x.              
+000130e0: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+000130f0: 2029 0a0a 2020 2020 2020 2020 2320 5570   )..        # Up
+00013100: 6461 7465 206f 7574 7075 7420 7363 7265  date output scre
+00013110: 656e 2068 6569 6768 742e 0a20 2020 2020  en height..     
+00013120: 2020 206e 6577 5f73 6372 6565 6e2e 6865     new_screen.he
+00013130: 6967 6874 203d 206d 6178 286e 6577 5f73  ight = max(new_s
+00013140: 6372 6565 6e2e 6865 6967 6874 2c20 7970  creen.height, yp
+00013150: 6f73 202b 2077 7269 7465 5f70 6f73 6974  os + write_posit
+00013160: 696f 6e2e 6865 6967 6874 290a 0a20 2020  ion.height)..   
+00013170: 2020 2020 2072 6574 7572 6e20 7669 7369       return visi
+00013180: 626c 655f 6c69 6e65 5f74 6f5f 726f 775f  ble_line_to_row_
+00013190: 636f 6c2c 2072 6f77 636f 6c5f 746f 5f79  col, rowcol_to_y
+000131a0: 780a 0a20 2020 2064 6566 205f 6669 6c6c  x..    def _fill
+000131b0: 5f62 6728 0a20 2020 2020 2020 2073 656c  _bg(.        sel
+000131c0: 662c 2073 6372 6565 6e3a 2053 6372 6565  f, screen: Scree
+000131d0: 6e2c 2077 7269 7465 5f70 6f73 6974 696f  n, write_positio
+000131e0: 6e3a 2057 7269 7465 506f 7369 7469 6f6e  n: WritePosition
+000131f0: 2c20 6572 6173 655f 6267 3a20 626f 6f6c  , erase_bg: bool
+00013200: 0a20 2020 2029 202d 3e20 4e6f 6e65 3a0a  .    ) -> None:.
+00013210: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00013220: 2020 2020 4572 6173 652f 6669 6c6c 2074      Erase/fill t
+00013230: 6865 2062 6163 6b67 726f 756e 642e 0a20  he background.. 
+00013240: 2020 2020 2020 2028 5573 6566 756c 2066         (Useful f
+00013250: 6f72 2066 6c6f 6174 7320 616e 6420 7768  or floats and wh
+00013260: 656e 2061 2060 6368 6172 6020 6861 7320  en a `char` has 
+00013270: 6265 656e 2067 6976 656e 2e29 0a20 2020  been given.).   
+00013280: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00013290: 2063 6861 723a 204f 7074 696f 6e61 6c5b   char: Optional[
+000132a0: 7374 725d 0a20 2020 2020 2020 2069 6620  str].        if 
+000132b0: 6361 6c6c 6162 6c65 2873 656c 662e 6368  callable(self.ch
+000132c0: 6172 293a 0a20 2020 2020 2020 2020 2020  ar):.           
+000132d0: 2063 6861 7220 3d20 7365 6c66 2e63 6861   char = self.cha
+000132e0: 7228 290a 2020 2020 2020 2020 656c 7365  r().        else
+000132f0: 3a0a 2020 2020 2020 2020 2020 2020 6368  :.            ch
+00013300: 6172 203d 2073 656c 662e 6368 6172 0a0a  ar = self.char..
+00013310: 2020 2020 2020 2020 6966 2065 7261 7365          if erase
+00013320: 5f62 6720 6f72 2063 6861 723a 0a20 2020  _bg or char:.   
+00013330: 2020 2020 2020 2020 2077 7020 3d20 7772           wp = wr
+00013340: 6974 655f 706f 7369 7469 6f6e 0a20 2020  ite_position.   
+00013350: 2020 2020 2020 2020 2063 6861 725f 6f62           char_ob
+00013360: 6a20 3d20 5f43 4841 525f 4341 4348 455b  j = _CHAR_CACHE[
+00013370: 6368 6172 206f 7220 2220 222c 2022 225d  char or " ", ""]
+00013380: 0a0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+00013390: 7220 7920 696e 2072 616e 6765 2877 702e  r y in range(wp.
+000133a0: 7970 6f73 2c20 7770 2e79 706f 7320 2b20  ypos, wp.ypos + 
+000133b0: 7770 2e68 6569 6768 7429 3a0a 2020 2020  wp.height):.    
+000133c0: 2020 2020 2020 2020 2020 2020 726f 7720              row 
+000133d0: 3d20 7363 7265 656e 2e64 6174 615f 6275  = screen.data_bu
+000133e0: 6666 6572 5b79 5d0a 2020 2020 2020 2020  ffer[y].        
+000133f0: 2020 2020 2020 2020 666f 7220 7820 696e          for x in
+00013400: 2072 616e 6765 2877 702e 7870 6f73 2c20   range(wp.xpos, 
+00013410: 7770 2e78 706f 7320 2b20 7770 2e77 6964  wp.xpos + wp.wid
+00013420: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
+00013430: 2020 2020 2020 2020 2072 6f77 5b78 5d20           row[x] 
+00013440: 3d20 6368 6172 5f6f 626a 0a0a 2020 2020  = char_obj..    
+00013450: 6465 6620 5f61 7070 6c79 5f73 7479 6c65  def _apply_style
+00013460: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
+00013470: 6e65 775f 7363 7265 656e 3a20 5363 7265  new_screen: Scre
+00013480: 656e 2c20 7772 6974 655f 706f 7369 7469  en, write_positi
+00013490: 6f6e 3a20 5772 6974 6550 6f73 6974 696f  on: WritePositio
+000134a0: 6e2c 2070 6172 656e 745f 7374 796c 653a  n, parent_style:
+000134b0: 2073 7472 0a20 2020 2029 202d 3e20 4e6f   str.    ) -> No
+000134c0: 6e65 3a0a 0a20 2020 2020 2020 2023 2041  ne:..        # A
+000134d0: 7070 6c79 2060 7365 6c66 2e73 7479 6c65  pply `self.style
+000134e0: 602e 0a20 2020 2020 2020 2073 7479 6c65  `..        style
+000134f0: 203d 2070 6172 656e 745f 7374 796c 6520   = parent_style 
+00013500: 2b20 2220 2220 2b20 746f 5f73 7472 2873  + " " + to_str(s
+00013510: 656c 662e 7374 796c 6529 0a0a 2020 2020  elf.style)..    
+00013520: 2020 2020 6e65 775f 7363 7265 656e 2e66      new_screen.f
+00013530: 696c 6c5f 6172 6561 2877 7269 7465 5f70  ill_area(write_p
+00013540: 6f73 6974 696f 6e2c 2073 7479 6c65 3d73  osition, style=s
+00013550: 7479 6c65 2c20 6166 7465 723d 4661 6c73  tyle, after=Fals
+00013560: 6529 0a0a 2020 2020 2020 2020 2320 4170  e)..        # Ap
+00013570: 706c 7920 7468 6520 276c 6173 742d 6c69  ply the 'last-li
+00013580: 6e65 2720 636c 6173 7320 746f 2074 6865  ne' class to the
+00013590: 206c 6173 7420 6c69 6e65 206f 6620 6561   last line of ea
+000135a0: 6368 2057 696e 646f 772e 2054 6869 7320  ch Window. This 
+000135b0: 6361 6e0a 2020 2020 2020 2020 2320 6265  can.        # be
+000135c0: 2075 7365 6420 746f 2061 7070 6c79 2061   used to apply a
+000135d0: 6e20 2775 6e64 6572 6c69 6e65 2720 746f  n 'underline' to
+000135e0: 2074 6865 2075 7365 7220 636f 6e74 726f   the user contro
+000135f0: 6c2e 0a20 2020 2020 2020 2077 7020 3d20  l..        wp = 
+00013600: 5772 6974 6550 6f73 6974 696f 6e28 0a20  WritePosition(. 
+00013610: 2020 2020 2020 2020 2020 2077 7269 7465             write
+00013620: 5f70 6f73 6974 696f 6e2e 7870 6f73 2c0a  _position.xpos,.
+00013630: 2020 2020 2020 2020 2020 2020 7772 6974              writ
+00013640: 655f 706f 7369 7469 6f6e 2e79 706f 7320  e_position.ypos 
+00013650: 2b20 7772 6974 655f 706f 7369 7469 6f6e  + write_position
+00013660: 2e68 6569 6768 7420 2d20 312c 0a20 2020  .height - 1,.   
+00013670: 2020 2020 2020 2020 2077 7269 7465 5f70           write_p
+00013680: 6f73 6974 696f 6e2e 7769 6474 682c 0a20  osition.width,. 
+00013690: 2020 2020 2020 2020 2020 2031 2c0a 2020             1,.  
+000136a0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000136b0: 6e65 775f 7363 7265 656e 2e66 696c 6c5f  new_screen.fill_
+000136c0: 6172 6561 2877 702c 2022 636c 6173 733a  area(wp, "class:
+000136d0: 6c61 7374 2d6c 696e 6522 2c20 6166 7465  last-line", afte
+000136e0: 723d 5472 7565 290a 0a20 2020 2064 6566  r=True)..    def
+000136f0: 205f 6869 6768 6c69 6768 745f 6469 6772   _highlight_digr
+00013700: 6170 6828 7365 6c66 2c20 6e65 775f 7363  aph(self, new_sc
+00013710: 7265 656e 3a20 5363 7265 656e 2920 2d3e  reen: Screen) ->
+00013720: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00013730: 2222 0a20 2020 2020 2020 2057 6865 6e20  "".        When 
+00013740: 7765 2061 7265 2069 6e20 5669 2064 6967  we are in Vi dig
+00013750: 7261 7068 206d 6f64 652c 2070 7574 2061  raph mode, put a
+00013760: 2071 7565 7374 696f 6e20 6d61 726b 2075   question mark u
+00013770: 6e64 6572 6e65 6174 6820 7468 650a 2020  nderneath the.  
+00013780: 2020 2020 2020 6375 7273 6f72 2e0a 2020        cursor..  
+00013790: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000137a0: 2020 6469 6772 6170 685f 6368 6172 203d    digraph_char =
+000137b0: 2073 656c 662e 5f67 6574 5f64 6967 7261   self._get_digra
+000137c0: 7068 5f63 6861 7228 290a 2020 2020 2020  ph_char().      
+000137d0: 2020 6966 2064 6967 7261 7068 5f63 6861    if digraph_cha
+000137e0: 723a 0a20 2020 2020 2020 2020 2020 2063  r:.            c
+000137f0: 706f 7320 3d20 6e65 775f 7363 7265 656e  pos = new_screen
+00013800: 2e67 6574 5f63 7572 736f 725f 706f 7369  .get_cursor_posi
+00013810: 7469 6f6e 2873 656c 6629 0a20 2020 2020  tion(self).     
+00013820: 2020 2020 2020 206e 6577 5f73 6372 6565         new_scree
+00013830: 6e2e 6461 7461 5f62 7566 6665 725b 6370  n.data_buffer[cp
+00013840: 6f73 2e79 5d5b 6370 6f73 2e78 5d20 3d20  os.y][cpos.x] = 
+00013850: 5f43 4841 525f 4341 4348 455b 0a20 2020  _CHAR_CACHE[.   
+00013860: 2020 2020 2020 2020 2020 2020 2064 6967               dig
+00013870: 7261 7068 5f63 6861 722c 2022 636c 6173  raph_char, "clas
+00013880: 733a 6469 6772 6170 6822 0a20 2020 2020  s:digraph".     
+00013890: 2020 2020 2020 205d 0a0a 2020 2020 6465         ]..    de
+000138a0: 6620 5f73 686f 775f 6b65 795f 7072 6f63  f _show_key_proc
+000138b0: 6573 736f 725f 6b65 795f 6275 6666 6572  essor_key_buffer
+000138c0: 2873 656c 662c 206e 6577 5f73 6372 6565  (self, new_scree
+000138d0: 6e3a 2053 6372 6565 6e29 202d 3e20 4e6f  n: Screen) -> No
+000138e0: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
+000138f0: 2020 2020 2020 2020 5768 656e 2074 6865          When the
+00013900: 2075 7365 7220 6973 2074 7970 696e 6720   user is typing 
+00013910: 6120 6b65 7920 6269 6e64 696e 6720 7468  a key binding th
+00013920: 6174 2063 6f6e 7369 7374 7320 6f66 2073  at consists of s
+00013930: 6576 6572 616c 206b 6579 732c 0a20 2020  everal keys,.   
+00013940: 2020 2020 2064 6973 706c 6179 2074 6865       display the
+00013950: 206c 6173 7420 7072 6573 7365 6420 6b65   last pressed ke
+00013960: 7920 6966 2074 6865 2075 7365 7220 6973  y if the user is
+00013970: 2069 6e20 696e 7365 7274 206d 6f64 6520   in insert mode 
+00013980: 616e 6420 7468 6520 6b65 790a 2020 2020  and the key.    
+00013990: 2020 2020 6973 206d 6561 6e69 6e67 6675      is meaningfu
+000139a0: 6c20 746f 2062 6520 6469 7370 6c61 7965  l to be displaye
+000139b0: 642e 0a20 2020 2020 2020 2045 2e67 2e20  d..        E.g. 
+000139c0: 536f 6d65 2070 656f 706c 6520 7761 6e74  Some people want
+000139d0: 2074 6f20 6269 6e64 2027 6a6a 2720 746f   to bind 'jj' to
+000139e0: 2065 7363 6170 6520 696e 2056 6920 696e   escape in Vi in
+000139f0: 7365 7274 206d 6f64 652e 2042 7574 2074  sert mode. But t
+00013a00: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
+00013a10: 6669 7273 7420 276a 2720 6e65 6564 7320  first 'j' needs 
+00013a20: 746f 2062 6520 6469 7370 6c61 7965 6420  to be displayed 
+00013a30: 696e 206f 7264 6572 2074 6f20 6765 7420  in order to get 
+00013a40: 736f 6d65 2066 6565 6462 6163 6b2e 0a20  some feedback.. 
+00013a50: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00013a60: 2020 2061 7070 203d 2067 6574 5f61 7070     app = get_app
+00013a70: 2829 0a20 2020 2020 2020 206b 6579 5f62  ().        key_b
+00013a80: 7566 6665 7220 3d20 6170 702e 6b65 795f  uffer = app.key_
+00013a90: 7072 6f63 6573 736f 722e 6b65 795f 6275  processor.key_bu
+00013aa0: 6666 6572 0a0a 2020 2020 2020 2020 6966  ffer..        if
+00013ab0: 206b 6579 5f62 7566 6665 7220 616e 6420   key_buffer and 
+00013ac0: 5f69 6e5f 696e 7365 7274 5f6d 6f64 6528  _in_insert_mode(
+00013ad0: 2920 616e 6420 6e6f 7420 6170 702e 6973  ) and not app.is
+00013ae0: 5f64 6f6e 653a 0a20 2020 2020 2020 2020  _done:.         
+00013af0: 2020 2023 2054 6865 2074 6578 7475 616c     # The textual
+00013b00: 2064 6174 6120 666f 7220 7468 6520 6769   data for the gi
+00013b10: 7665 6e20 6b65 792e 2028 4361 6e20 6265  ven key. (Can be
+00013b20: 2061 2056 5431 3030 2065 7363 6170 650a   a VT100 escape.
+00013b30: 2020 2020 2020 2020 2020 2020 2320 7365              # se
+00013b40: 7175 656e 6365 2e29 0a20 2020 2020 2020  quence.).       
+00013b50: 2020 2020 2064 6174 6120 3d20 6b65 795f       data = key_
+00013b60: 6275 6666 6572 5b2d 315d 2e64 6174 610a  buffer[-1].data.
+00013b70: 0a20 2020 2020 2020 2020 2020 2023 2044  .            # D
+00013b80: 6973 706c 6179 206f 6e6c 7920 6966 2074  isplay only if t
+00013b90: 6869 7320 6973 2061 2031 2063 656c 6c20  his is a 1 cell 
+00013ba0: 7769 6474 6820 6368 6172 6163 7465 722e  width character.
+00013bb0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00013bc0: 6765 745f 6377 6964 7468 2864 6174 6129  get_cwidth(data)
+00013bd0: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
+00013be0: 2020 2020 2020 2063 706f 7320 3d20 6e65         cpos = ne
+00013bf0: 775f 7363 7265 656e 2e67 6574 5f63 7572  w_screen.get_cur
+00013c00: 736f 725f 706f 7369 7469 6f6e 2873 656c  sor_position(sel
+00013c10: 6629 0a20 2020 2020 2020 2020 2020 2020  f).             
+00013c20: 2020 206e 6577 5f73 6372 6565 6e2e 6461     new_screen.da
+00013c30: 7461 5f62 7566 6665 725b 6370 6f73 2e79  ta_buffer[cpos.y
+00013c40: 5d5b 6370 6f73 2e78 5d20 3d20 5f43 4841  ][cpos.x] = _CHA
+00013c50: 525f 4341 4348 455b 0a20 2020 2020 2020  R_CACHE[.       
+00013c60: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00013c70: 612c 2022 636c 6173 733a 7061 7274 6961  a, "class:partia
+00013c80: 6c2d 6b65 792d 6269 6e64 696e 6722 0a20  l-key-binding". 
+00013c90: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+00013ca0: 0a0a 2020 2020 6465 6620 5f68 6967 686c  ..    def _highl
+00013cb0: 6967 6874 5f63 7572 736f 726c 696e 6573  ight_cursorlines
+00013cc0: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
+00013cd0: 6e65 775f 7363 7265 656e 3a20 5363 7265  new_screen: Scre
+00013ce0: 656e 2c20 6370 6f73 3a20 506f 696e 742c  en, cpos: Point,
+00013cf0: 2078 3a20 696e 742c 2079 3a20 696e 742c   x: int, y: int,
+00013d00: 2077 6964 7468 3a20 696e 742c 2068 6569   width: int, hei
+00013d10: 6768 743a 2069 6e74 0a20 2020 2029 202d  ght: int.    ) -
+00013d20: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00013d30: 2222 220a 2020 2020 2020 2020 4869 6768  """.        High
+00013d40: 6c69 6768 7420 6375 7273 6f72 2072 6f77  light cursor row
+00013d50: 2f63 6f6c 756d 6e2e 0a20 2020 2020 2020  /column..       
+00013d60: 2022 2222 0a20 2020 2020 2020 2063 7572   """.        cur
+00013d70: 736f 725f 6c69 6e65 5f73 7479 6c65 203d  sor_line_style =
+00013d80: 2022 2063 6c61 7373 3a63 7572 736f 722d   " class:cursor-
+00013d90: 6c69 6e65 2022 0a20 2020 2020 2020 2063  line ".        c
+00013da0: 7572 736f 725f 636f 6c75 6d6e 5f73 7479  ursor_column_sty
+00013db0: 6c65 203d 2022 2063 6c61 7373 3a63 7572  le = " class:cur
+00013dc0: 736f 722d 636f 6c75 6d6e 2022 0a0a 2020  sor-column "..  
+00013dd0: 2020 2020 2020 6461 7461 5f62 7566 6665        data_buffe
+00013de0: 7220 3d20 6e65 775f 7363 7265 656e 2e64  r = new_screen.d
+00013df0: 6174 615f 6275 6666 6572 0a0a 2020 2020  ata_buffer..    
+00013e00: 2020 2020 2320 4869 6768 6c69 6768 7420      # Highlight 
+00013e10: 6375 7273 6f72 206c 696e 652e 0a20 2020  cursor line..   
+00013e20: 2020 2020 2069 6620 7365 6c66 2e63 7572       if self.cur
+00013e30: 736f 726c 696e 6528 293a 0a20 2020 2020  sorline():.     
+00013e40: 2020 2020 2020 2072 6f77 203d 2064 6174         row = dat
+00013e50: 615f 6275 6666 6572 5b63 706f 732e 795d  a_buffer[cpos.y]
+00013e60: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00013e70: 2078 2069 6e20 7261 6e67 6528 782c 2078   x in range(x, x
+00013e80: 202b 2077 6964 7468 293a 0a20 2020 2020   + width):.     
+00013e90: 2020 2020 2020 2020 2020 206f 7269 6769             origi
+00013ea0: 6e61 6c5f 6368 6172 203d 2072 6f77 5b78  nal_char = row[x
+00013eb0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00013ec0: 2020 726f 775b 785d 203d 205f 4348 4152    row[x] = _CHAR
+00013ed0: 5f43 4143 4845 5b0a 2020 2020 2020 2020  _CACHE[.        
+00013ee0: 2020 2020 2020 2020 2020 2020 6f72 6967              orig
+00013ef0: 696e 616c 5f63 6861 722e 6368 6172 2c20  inal_char.char, 
+00013f00: 6f72 6967 696e 616c 5f63 6861 722e 7374  original_char.st
+00013f10: 796c 6520 2b20 6375 7273 6f72 5f6c 696e  yle + cursor_lin
+00013f20: 655f 7374 796c 650a 2020 2020 2020 2020  e_style.        
+00013f30: 2020 2020 2020 2020 5d0a 0a20 2020 2020          ]..     
+00013f40: 2020 2023 2048 6967 686c 6967 6874 2063     # Highlight c
+00013f50: 7572 736f 7220 636f 6c75 6d6e 2e0a 2020  ursor column..  
+00013f60: 2020 2020 2020 6966 2073 656c 662e 6375        if self.cu
+00013f70: 7273 6f72 636f 6c75 6d6e 2829 3a0a 2020  rsorcolumn():.  
+00013f80: 2020 2020 2020 2020 2020 666f 7220 7932            for y2
+00013f90: 2069 6e20 7261 6e67 6528 792c 2079 202b   in range(y, y +
+00013fa0: 2068 6569 6768 7429 3a0a 2020 2020 2020   height):.      
+00013fb0: 2020 2020 2020 2020 2020 726f 7720 3d20            row = 
+00013fc0: 6461 7461 5f62 7566 6665 725b 7932 5d0a  data_buffer[y2].
+00013fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013fe0: 6f72 6967 696e 616c 5f63 6861 7220 3d20  original_char = 
+00013ff0: 726f 775b 6370 6f73 2e78 5d0a 2020 2020  row[cpos.x].    
+00014000: 2020 2020 2020 2020 2020 2020 726f 775b              row[
+00014010: 6370 6f73 2e78 5d20 3d20 5f43 4841 525f  cpos.x] = _CHAR_
+00014020: 4341 4348 455b 0a20 2020 2020 2020 2020  CACHE[.         
+00014030: 2020 2020 2020 2020 2020 206f 7269 6769             origi
+00014040: 6e61 6c5f 6368 6172 2e63 6861 722c 206f  nal_char.char, o
+00014050: 7269 6769 6e61 6c5f 6368 6172 2e73 7479  riginal_char.sty
+00014060: 6c65 202b 2063 7572 736f 725f 636f 6c75  le + cursor_colu
+00014070: 6d6e 5f73 7479 6c65 0a20 2020 2020 2020  mn_style.       
+00014080: 2020 2020 2020 2020 205d 0a0a 2020 2020           ]..    
+00014090: 2020 2020 2320 4869 6768 6c69 6768 7420      # Highlight 
+000140a0: 636f 6c6f 7220 636f 6c75 6d6e 730a 2020  color columns.  
+000140b0: 2020 2020 2020 636f 6c6f 7263 6f6c 756d        colorcolum
+000140c0: 6e73 203d 2073 656c 662e 636f 6c6f 7263  ns = self.colorc
+000140d0: 6f6c 756d 6e73 0a20 2020 2020 2020 2069  olumns.        i
+000140e0: 6620 6361 6c6c 6162 6c65 2863 6f6c 6f72  f callable(color
+000140f0: 636f 6c75 6d6e 7329 3a0a 2020 2020 2020  columns):.      
+00014100: 2020 2020 2020 636f 6c6f 7263 6f6c 756d        colorcolum
+00014110: 6e73 203d 2063 6f6c 6f72 636f 6c75 6d6e  ns = colorcolumn
+00014120: 7328 290a 0a20 2020 2020 2020 2066 6f72  s()..        for
+00014130: 2063 6320 696e 2063 6f6c 6f72 636f 6c75   cc in colorcolu
+00014140: 6d6e 733a 0a20 2020 2020 2020 2020 2020  mns:.           
+00014150: 2061 7373 6572 7420 6973 696e 7374 616e   assert isinstan
+00014160: 6365 2863 632c 2043 6f6c 6f72 436f 6c75  ce(cc, ColorColu
+00014170: 6d6e 290a 2020 2020 2020 2020 2020 2020  mn).            
+00014180: 636f 6c75 6d6e 203d 2063 632e 706f 7369  column = cc.posi
+00014190: 7469 6f6e 0a0a 2020 2020 2020 2020 2020  tion..          
+000141a0: 2020 6966 2063 6f6c 756d 6e20 3c20 7820    if column < x 
+000141b0: 2b20 7769 6474 683a 2020 2320 4f6e 6c79  + width:  # Only
+000141c0: 2064 7261 7720 7768 656e 2076 6973 6962   draw when visib
+000141d0: 6c65 2e0a 2020 2020 2020 2020 2020 2020  le..            
+000141e0: 2020 2020 636f 6c6f 725f 636f 6c75 6d6e      color_column
+000141f0: 5f73 7479 6c65 203d 2022 2022 202b 2063  _style = " " + c
+00014200: 632e 7374 796c 650a 0a20 2020 2020 2020  c.style..       
+00014210: 2020 2020 2020 2020 2066 6f72 2079 3220           for y2 
+00014220: 696e 2072 616e 6765 2879 2c20 7920 2b20  in range(y, y + 
+00014230: 6865 6967 6874 293a 0a20 2020 2020 2020  height):.       
+00014240: 2020 2020 2020 2020 2020 2020 2072 6f77               row
+00014250: 203d 2064 6174 615f 6275 6666 6572 5b79   = data_buffer[y
+00014260: 325d 0a20 2020 2020 2020 2020 2020 2020  2].             
+00014270: 2020 2020 2020 206f 7269 6769 6e61 6c5f         original_
+00014280: 6368 6172 203d 2072 6f77 5b63 6f6c 756d  char = row[colum
+00014290: 6e20 2b20 785d 0a20 2020 2020 2020 2020  n + x].         
+000142a0: 2020 2020 2020 2020 2020 2072 6f77 5b63             row[c
+000142b0: 6f6c 756d 6e20 2b20 785d 203d 205f 4348  olumn + x] = _CH
+000142c0: 4152 5f43 4143 4845 5b0a 2020 2020 2020  AR_CACHE[.      
+000142d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000142e0: 2020 6f72 6967 696e 616c 5f63 6861 722e    original_char.
+000142f0: 6368 6172 2c20 6f72 6967 696e 616c 5f63  char, original_c
+00014300: 6861 722e 7374 796c 6520 2b20 636f 6c6f  har.style + colo
+00014310: 725f 636f 6c75 6d6e 5f73 7479 6c65 0a20  r_column_style. 
 00014320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014330: 206f 7269 6769 6e61 6c5f 6368 6172 203d   original_char =
-00014340: 2072 6f77 5b63 6f6c 756d 6e20 2b20 785d   row[column + x]
-00014350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014360: 2020 2020 2072 6f77 5b63 6f6c 756d 6e20       row[column 
-00014370: 2b20 785d 203d 205f 4348 4152 5f43 4143  + x] = _CHAR_CAC
-00014380: 4845 5b0a 2020 2020 2020 2020 2020 2020  HE[.            
-00014390: 2020 2020 2020 2020 2020 2020 6f72 6967              orig
-000143a0: 696e 616c 5f63 6861 722e 6368 6172 2c20  inal_char.char, 
-000143b0: 6f72 6967 696e 616c 5f63 6861 722e 7374  original_char.st
-000143c0: 796c 6520 2b20 636f 6c6f 725f 636f 6c75  yle + color_colu
-000143d0: 6d6e 5f73 7479 6c65 0a20 2020 2020 2020  mn_style.       
-000143e0: 2020 2020 2020 2020 2020 2020 205d 0a0a               ]..
-000143f0: 2020 2020 6465 6620 5f63 6f70 795f 6d61      def _copy_ma
-00014400: 7267 696e 280a 2020 2020 2020 2020 7365  rgin(.        se
-00014410: 6c66 2c0a 2020 2020 2020 2020 6d61 7267  lf,.        marg
-00014420: 696e 5f63 6f6e 7465 6e74 3a20 5549 436f  in_content: UICo
-00014430: 6e74 656e 742c 0a20 2020 2020 2020 206e  ntent,.        n
-00014440: 6577 5f73 6372 6565 6e3a 2053 6372 6565  ew_screen: Scree
-00014450: 6e2c 0a20 2020 2020 2020 2077 7269 7465  n,.        write
-00014460: 5f70 6f73 6974 696f 6e3a 2057 7269 7465  _position: Write
-00014470: 506f 7369 7469 6f6e 2c0a 2020 2020 2020  Position,.      
-00014480: 2020 6d6f 7665 5f78 3a20 696e 742c 0a20    move_x: int,. 
-00014490: 2020 2020 2020 2077 6964 7468 3a20 696e         width: in
-000144a0: 742c 0a20 2020 2029 202d 3e20 4e6f 6e65  t,.    ) -> None
-000144b0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-000144c0: 2020 2020 2020 436f 7079 2063 6861 7261        Copy chara
-000144d0: 6374 6572 7320 6672 6f6d 2074 6865 206d  cters from the m
-000144e0: 6172 6769 6e20 7363 7265 656e 2074 6f20  argin screen to 
-000144f0: 7468 6520 7265 616c 2073 6372 6565 6e2e  the real screen.
-00014500: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00014510: 2020 2020 2078 706f 7320 3d20 7772 6974       xpos = writ
-00014520: 655f 706f 7369 7469 6f6e 2e78 706f 7320  e_position.xpos 
-00014530: 2b20 6d6f 7665 5f78 0a20 2020 2020 2020  + move_x.       
-00014540: 2079 706f 7320 3d20 7772 6974 655f 706f   ypos = write_po
-00014550: 7369 7469 6f6e 2e79 706f 730a 0a20 2020  sition.ypos..   
-00014560: 2020 2020 206d 6172 6769 6e5f 7772 6974       margin_writ
-00014570: 655f 706f 7369 7469 6f6e 203d 2057 7269  e_position = Wri
-00014580: 7465 506f 7369 7469 6f6e 2878 706f 732c  tePosition(xpos,
-00014590: 2079 706f 732c 2077 6964 7468 2c20 7772   ypos, width, wr
-000145a0: 6974 655f 706f 7369 7469 6f6e 2e68 6569  ite_position.hei
-000145b0: 6768 7429 0a20 2020 2020 2020 2073 656c  ght).        sel
-000145c0: 662e 5f63 6f70 795f 626f 6479 286d 6172  f._copy_body(mar
-000145d0: 6769 6e5f 636f 6e74 656e 742c 206e 6577  gin_content, new
-000145e0: 5f73 6372 6565 6e2c 206d 6172 6769 6e5f  _screen, margin_
-000145f0: 7772 6974 655f 706f 7369 7469 6f6e 2c20  write_position, 
-00014600: 302c 2077 6964 7468 290a 0a20 2020 2064  0, width)..    d
-00014610: 6566 205f 7363 726f 6c6c 2873 656c 662c  ef _scroll(self,
-00014620: 2075 695f 636f 6e74 656e 743a 2055 4943   ui_content: UIC
-00014630: 6f6e 7465 6e74 2c20 7769 6474 683a 2069  ontent, width: i
-00014640: 6e74 2c20 6865 6967 6874 3a20 696e 7429  nt, height: int)
-00014650: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00014660: 2020 2222 220a 2020 2020 2020 2020 5363    """.        Sc
-00014670: 726f 6c6c 2062 6f64 792e 2045 6e73 7572  roll body. Ensur
-00014680: 6520 7468 6174 2074 6865 2063 7572 736f  e that the curso
-00014690: 7220 6973 2076 6973 6962 6c65 2e0a 2020  r is visible..  
-000146a0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000146b0: 2020 6966 2073 656c 662e 7772 6170 5f6c    if self.wrap_l
-000146c0: 696e 6573 2829 3a0a 2020 2020 2020 2020  ines():.        
-000146d0: 2020 2020 6675 6e63 203d 2073 656c 662e      func = self.
-000146e0: 5f73 6372 6f6c 6c5f 7768 656e 5f6c 696e  _scroll_when_lin
-000146f0: 6577 7261 7070 696e 670a 2020 2020 2020  ewrapping.      
-00014700: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00014710: 2020 2020 6675 6e63 203d 2073 656c 662e      func = self.
-00014720: 5f73 6372 6f6c 6c5f 7769 7468 6f75 745f  _scroll_without_
-00014730: 6c69 6e65 7772 6170 7069 6e67 0a0a 2020  linewrapping..  
-00014740: 2020 2020 2020 6675 6e63 2875 695f 636f        func(ui_co
-00014750: 6e74 656e 742c 2077 6964 7468 2c20 6865  ntent, width, he
-00014760: 6967 6874 290a 0a20 2020 2064 6566 205f  ight)..    def _
-00014770: 7363 726f 6c6c 5f77 6865 6e5f 6c69 6e65  scroll_when_line
-00014780: 7772 6170 7069 6e67 280a 2020 2020 2020  wrapping(.      
-00014790: 2020 7365 6c66 2c20 7569 5f63 6f6e 7465    self, ui_conte
-000147a0: 6e74 3a20 5549 436f 6e74 656e 742c 2077  nt: UIContent, w
-000147b0: 6964 7468 3a20 696e 742c 2068 6569 6768  idth: int, heigh
-000147c0: 743a 2069 6e74 0a20 2020 2029 202d 3e20  t: int.    ) -> 
-000147d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-000147e0: 220a 2020 2020 2020 2020 5363 726f 6c6c  ".        Scroll
-000147f0: 2074 6f20 6d61 6b65 2073 7572 6520 7468   to make sure th
-00014800: 6520 6375 7273 6f72 2070 6f73 6974 696f  e cursor positio
-00014810: 6e20 6973 2076 6973 6962 6c65 2061 6e64  n is visible and
-00014820: 2074 6861 7420 7765 206d 6169 6e74 6169   that we maintai
-00014830: 6e0a 2020 2020 2020 2020 7468 6520 7265  n.        the re
-00014840: 7175 6573 7465 6420 7363 726f 6c6c 206f  quested scroll o
-00014850: 6666 7365 742e 0a0a 2020 2020 2020 2020  ffset...        
-00014860: 5365 7420 6073 656c 662e 686f 7269 7a6f  Set `self.horizo
-00014870: 6e74 616c 5f73 6372 6f6c 6c2f 7665 7274  ntal_scroll/vert
-00014880: 6963 616c 5f73 6372 6f6c 6c60 2e0a 2020  ical_scroll`..  
-00014890: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000148a0: 2020 7363 726f 6c6c 5f6f 6666 7365 7473    scroll_offsets
-000148b0: 5f62 6f74 746f 6d20 3d20 7365 6c66 2e73  _bottom = self.s
-000148c0: 6372 6f6c 6c5f 6f66 6673 6574 732e 626f  croll_offsets.bo
-000148d0: 7474 6f6d 0a20 2020 2020 2020 2073 6372  ttom.        scr
-000148e0: 6f6c 6c5f 6f66 6673 6574 735f 746f 7020  oll_offsets_top 
-000148f0: 3d20 7365 6c66 2e73 6372 6f6c 6c5f 6f66  = self.scroll_of
-00014900: 6673 6574 732e 746f 700a 0a20 2020 2020  fsets.top..     
-00014910: 2020 2023 2057 6520 646f 6e27 7420 6861     # We don't ha
-00014920: 7665 2068 6f72 697a 6f6e 7461 6c20 7363  ve horizontal sc
-00014930: 726f 6c6c 696e 672e 0a20 2020 2020 2020  rolling..       
-00014940: 2073 656c 662e 686f 7269 7a6f 6e74 616c   self.horizontal
-00014950: 5f73 6372 6f6c 6c20 3d20 300a 0a20 2020  _scroll = 0..   
-00014960: 2020 2020 2064 6566 2067 6574 5f6c 696e       def get_lin
-00014970: 655f 6865 6967 6874 286c 696e 656e 6f3a  e_height(lineno:
-00014980: 2069 6e74 2920 2d3e 2069 6e74 3a0a 2020   int) -> int:.  
-00014990: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000149a0: 2075 695f 636f 6e74 656e 742e 6765 745f   ui_content.get_
-000149b0: 6865 6967 6874 5f66 6f72 5f6c 696e 6528  height_for_line(
-000149c0: 6c69 6e65 6e6f 2c20 7769 6474 682c 2073  lineno, width, s
-000149d0: 656c 662e 6765 745f 6c69 6e65 5f70 7265  elf.get_line_pre
-000149e0: 6669 7829 0a0a 2020 2020 2020 2020 2320  fix)..        # 
-000149f0: 5768 656e 2074 6865 7265 2069 7320 6e6f  When there is no
-00014a00: 2073 7061 6365 2c20 7265 7365 7420 6076   space, reset `v
-00014a10: 6572 7469 6361 6c5f 7363 726f 6c6c 5f32  ertical_scroll_2
-00014a20: 6020 746f 207a 6572 6f20 616e 6420 6162  ` to zero and ab
-00014a30: 6f72 742e 0a20 2020 2020 2020 2023 2054  ort..        # T
-00014a40: 6869 7320 6361 6e20 6861 7070 656e 2069  his can happen i
-00014a50: 6620 7468 6520 6d61 7267 696e 2069 7320  f the margin is 
-00014a60: 6269 6767 6572 2074 6861 6e20 7468 6520  bigger than the 
-00014a70: 7769 6e64 6f77 2077 6964 7468 2e0a 2020  window width..  
-00014a80: 2020 2020 2020 2320 4f74 6865 7277 6973        # Otherwis
-00014a90: 6520 7468 6520 7465 7874 2068 6569 6768  e the text heigh
-00014aa0: 7420 7769 6c6c 2062 6563 6f6d 6520 2269  t will become "i
-00014ab0: 6e66 696e 6974 6522 2028 6120 6269 6720  nfinite" (a big 
-00014ac0: 6e75 6d62 6572 2920 616e 640a 2020 2020  number) and.    
-00014ad0: 2020 2020 2320 7468 6520 636f 7079 5f6c      # the copy_l
-00014ae0: 696e 6520 7769 6c6c 2073 7065 6e64 2061  ine will spend a
-00014af0: 2068 7567 6520 616d 6f75 6e74 206f 6620   huge amount of 
-00014b00: 6974 6572 6174 696f 6e73 2074 7279 696e  iterations tryin
-00014b10: 6720 746f 2072 656e 6465 720a 2020 2020  g to render.    
-00014b20: 2020 2020 2320 6e6f 7468 696e 672e 0a20      # nothing.. 
-00014b30: 2020 2020 2020 2069 6620 7769 6474 6820         if width 
-00014b40: 3c3d 2030 3a0a 2020 2020 2020 2020 2020  <= 0:.          
-00014b50: 2020 7365 6c66 2e76 6572 7469 6361 6c5f    self.vertical_
-00014b60: 7363 726f 6c6c 203d 2075 695f 636f 6e74  scroll = ui_cont
-00014b70: 656e 742e 6375 7273 6f72 5f70 6f73 6974  ent.cursor_posit
-00014b80: 696f 6e2e 790a 2020 2020 2020 2020 2020  ion.y.          
-00014b90: 2020 7365 6c66 2e76 6572 7469 6361 6c5f    self.vertical_
-00014ba0: 7363 726f 6c6c 5f32 203d 2030 0a20 2020  scroll_2 = 0.   
-00014bb0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-00014bc0: 0a20 2020 2020 2020 2023 2049 6620 7468  .        # If th
-00014bd0: 6520 6375 7272 656e 7420 6c69 6e65 2063  e current line c
-00014be0: 6f6e 7375 6d65 7320 6d6f 7265 2074 6861  onsumes more tha
-00014bf0: 6e20 7468 6520 7768 6f6c 6520 7769 6e64  n the whole wind
-00014c00: 6f77 2068 6569 6768 742c 0a20 2020 2020  ow height,.     
-00014c10: 2020 2023 2074 6865 6e20 7765 2068 6176     # then we hav
-00014c20: 6520 746f 2073 6372 6f6c 6c20 7665 7274  e to scroll vert
-00014c30: 6963 616c 6c79 2069 6e73 6964 6520 7468  ically inside th
-00014c40: 6973 206c 696e 652e 2028 5765 2064 6f6e  is line. (We don
-00014c50: 2774 2074 616b 650a 2020 2020 2020 2020  't take.        
-00014c60: 2320 7468 6520 7363 726f 6c6c 206f 6666  # the scroll off
-00014c70: 7365 7473 2069 6e74 6f20 6163 636f 756e  sets into accoun
-00014c80: 7420 666f 7220 7468 6973 2e29 0a20 2020  t for this.).   
-00014c90: 2020 2020 2023 2041 6c73 6f2c 2069 676e       # Also, ign
-00014ca0: 6f72 6520 7468 6520 7363 726f 6c6c 206f  ore the scroll o
-00014cb0: 6666 7365 7473 2069 6e20 7468 6973 2063  ffsets in this c
-00014cc0: 6173 652e 204a 7573 7420 7365 7420 7468  ase. Just set th
-00014cd0: 6520 7665 7274 6963 616c 0a20 2020 2020  e vertical.     
-00014ce0: 2020 2023 2073 6372 6f6c 6c20 746f 2074     # scroll to t
-00014cf0: 6869 7320 6c69 6e65 2e0a 2020 2020 2020  his line..      
-00014d00: 2020 6c69 6e65 5f68 6569 6768 7420 3d20    line_height = 
-00014d10: 6765 745f 6c69 6e65 5f68 6569 6768 7428  get_line_height(
-00014d20: 7569 5f63 6f6e 7465 6e74 2e63 7572 736f  ui_content.curso
-00014d30: 725f 706f 7369 7469 6f6e 2e79 290a 2020  r_position.y).  
-00014d40: 2020 2020 2020 6966 206c 696e 655f 6865        if line_he
-00014d50: 6967 6874 203e 2068 6569 6768 7420 2d20  ight > height - 
-00014d60: 7363 726f 6c6c 5f6f 6666 7365 7473 5f74  scroll_offsets_t
-00014d70: 6f70 3a0a 2020 2020 2020 2020 2020 2020  op:.            
-00014d80: 2320 4361 6c63 756c 6174 6520 7468 6520  # Calculate the 
-00014d90: 6865 6967 6874 206f 6620 7468 6520 7465  height of the te
-00014da0: 7874 2062 6566 6f72 6520 7468 6520 6375  xt before the cu
-00014db0: 7273 6f72 2028 696e 636c 7564 696e 670a  rsor (including.
-00014dc0: 2020 2020 2020 2020 2020 2020 2320 6c69              # li
-00014dd0: 6e65 2070 7265 6669 7865 7329 2e0a 2020  ne prefixes)..  
-00014de0: 2020 2020 2020 2020 2020 7465 7874 5f62            text_b
-00014df0: 6566 6f72 655f 6865 6967 6874 203d 2075  efore_height = u
-00014e00: 695f 636f 6e74 656e 742e 6765 745f 6865  i_content.get_he
-00014e10: 6967 6874 5f66 6f72 5f6c 696e 6528 0a20  ight_for_line(. 
-00014e20: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00014e30: 695f 636f 6e74 656e 742e 6375 7273 6f72  i_content.cursor
-00014e40: 5f70 6f73 6974 696f 6e2e 792c 0a20 2020  _position.y,.   
-00014e50: 2020 2020 2020 2020 2020 2020 2077 6964               wid
-00014e60: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
-00014e70: 2020 2020 7365 6c66 2e67 6574 5f6c 696e      self.get_lin
-00014e80: 655f 7072 6566 6978 2c0a 2020 2020 2020  e_prefix,.      
-00014e90: 2020 2020 2020 2020 2020 736c 6963 655f            slice_
-00014ea0: 7374 6f70 3d75 695f 636f 6e74 656e 742e  stop=ui_content.
-00014eb0: 6375 7273 6f72 5f70 6f73 6974 696f 6e2e  cursor_position.
-00014ec0: 782c 0a20 2020 2020 2020 2020 2020 2029  x,.            )
-00014ed0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00014ee0: 4164 6a75 7374 2073 6372 6f6c 6c20 6f66  Adjust scroll of
-00014ef0: 6673 6574 2e0a 2020 2020 2020 2020 2020  fset..          
-00014f00: 2020 7365 6c66 2e76 6572 7469 6361 6c5f    self.vertical_
-00014f10: 7363 726f 6c6c 203d 2075 695f 636f 6e74  scroll = ui_cont
-00014f20: 656e 742e 6375 7273 6f72 5f70 6f73 6974  ent.cursor_posit
-00014f30: 696f 6e2e 790a 2020 2020 2020 2020 2020  ion.y.          
-00014f40: 2020 7365 6c66 2e76 6572 7469 6361 6c5f    self.vertical_
-00014f50: 7363 726f 6c6c 5f32 203d 206d 696e 280a  scroll_2 = min(.
-00014f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f70: 7465 7874 5f62 6566 6f72 655f 6865 6967  text_before_heig
-00014f80: 6874 202d 2031 2c20 2023 204b 6565 7020  ht - 1,  # Keep 
-00014f90: 7468 6520 6375 7273 6f72 2076 6973 6962  the cursor visib
-00014fa0: 6c65 2e0a 2020 2020 2020 2020 2020 2020  le..            
-00014fb0: 2020 2020 6c69 6e65 5f68 6569 6768 740a      line_height.
-00014fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014fd0: 2d20 6865 6967 6874 2c20 2023 2041 766f  - height,  # Avo
-00014fe0: 6964 2062 6c61 6e6b 206c 696e 6573 2061  id blank lines a
-00014ff0: 7420 7468 6520 626f 7474 6f6d 2077 6865  t the bottom whe
-00015000: 6e20 7363 6f6c 6c69 6e67 2075 7020 6167  n scolling up ag
-00015010: 6169 6e2e 0a20 2020 2020 2020 2020 2020  ain..           
-00015020: 2020 2020 2073 656c 662e 7665 7274 6963       self.vertic
-00015030: 616c 5f73 6372 6f6c 6c5f 322c 0a20 2020  al_scroll_2,.   
-00015040: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00015050: 2020 2020 2020 2073 656c 662e 7665 7274         self.vert
-00015060: 6963 616c 5f73 6372 6f6c 6c5f 3220 3d20  ical_scroll_2 = 
-00015070: 6d61 7828 0a20 2020 2020 2020 2020 2020  max(.           
-00015080: 2020 2020 2030 2c20 7465 7874 5f62 6566       0, text_bef
-00015090: 6f72 655f 6865 6967 6874 202d 2068 6569  ore_height - hei
-000150a0: 6768 742c 2073 656c 662e 7665 7274 6963  ght, self.vertic
-000150b0: 616c 5f73 6372 6f6c 6c5f 320a 2020 2020  al_scroll_2.    
-000150c0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000150d0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-000150e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000150f0: 2020 2020 2020 2073 656c 662e 7665 7274         self.vert
-00015100: 6963 616c 5f73 6372 6f6c 6c5f 3220 3d20  ical_scroll_2 = 
-00015110: 300a 0a20 2020 2020 2020 2023 2043 7572  0..        # Cur
-00015120: 7265 6e74 206c 696e 6520 646f 6573 6e27  rent line doesn'
-00015130: 7420 636f 6e73 756d 6520 7468 6520 7768  t consume the wh
-00015140: 6f6c 6520 6865 6967 6874 2e20 5461 6b65  ole height. Take
-00015150: 2073 6372 6f6c 6c20 6f66 6673 6574 7320   scroll offsets 
-00015160: 696e 746f 2061 6363 6f75 6e74 2e0a 2020  into account..  
-00015170: 2020 2020 2020 6465 6620 6765 745f 6d69        def get_mi
-00015180: 6e5f 7665 7274 6963 616c 5f73 6372 6f6c  n_vertical_scrol
-00015190: 6c28 2920 2d3e 2069 6e74 3a0a 2020 2020  l() -> int:.    
-000151a0: 2020 2020 2020 2020 2320 4d61 6b65 2073          # Make s
-000151b0: 7572 6520 7468 6174 2074 6865 2063 7572  ure that the cur
-000151c0: 736f 7220 6c69 6e65 2069 7320 6e6f 7420  sor line is not 
-000151d0: 6265 6c6f 7720 7468 6520 626f 7474 6f6d  below the bottom
-000151e0: 2e0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-000151f0: 2843 616c 6375 6c61 7465 2068 6f77 206d  (Calculate how m
-00015200: 616e 7920 6c69 6e65 7320 6361 6e20 6265  any lines can be
-00015210: 2073 686f 776e 2062 6574 7765 656e 2074   shown between t
-00015220: 6865 2063 7572 736f 7220 616e 6420 7468  he cursor and th
-00015230: 6520 2e29 0a20 2020 2020 2020 2020 2020  e .).           
-00015240: 2075 7365 645f 6865 6967 6874 203d 2030   used_height = 0
-00015250: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
-00015260: 765f 6c69 6e65 6e6f 203d 2075 695f 636f  v_lineno = ui_co
-00015270: 6e74 656e 742e 6375 7273 6f72 5f70 6f73  ntent.cursor_pos
-00015280: 6974 696f 6e2e 790a 0a20 2020 2020 2020  ition.y..       
-00015290: 2020 2020 2066 6f72 206c 696e 656e 6f20       for lineno 
-000152a0: 696e 2072 616e 6765 2875 695f 636f 6e74  in range(ui_cont
-000152b0: 656e 742e 6375 7273 6f72 5f70 6f73 6974  ent.cursor_posit
-000152c0: 696f 6e2e 792c 202d 312c 202d 3129 3a0a  ion.y, -1, -1):.
+00014330: 2020 205d 0a0a 2020 2020 6465 6620 5f63     ]..    def _c
+00014340: 6f70 795f 6d61 7267 696e 280a 2020 2020  opy_margin(.    
+00014350: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00014360: 2020 6d61 7267 696e 5f63 6f6e 7465 6e74    margin_content
+00014370: 3a20 5549 436f 6e74 656e 742c 0a20 2020  : UIContent,.   
+00014380: 2020 2020 206e 6577 5f73 6372 6565 6e3a       new_screen:
+00014390: 2053 6372 6565 6e2c 0a20 2020 2020 2020   Screen,.       
+000143a0: 2077 7269 7465 5f70 6f73 6974 696f 6e3a   write_position:
+000143b0: 2057 7269 7465 506f 7369 7469 6f6e 2c0a   WritePosition,.
+000143c0: 2020 2020 2020 2020 6d6f 7665 5f78 3a20          move_x: 
+000143d0: 696e 742c 0a20 2020 2020 2020 2077 6964  int,.        wid
+000143e0: 7468 3a20 696e 742c 0a20 2020 2029 202d  th: int,.    ) -
+000143f0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00014400: 2222 220a 2020 2020 2020 2020 436f 7079  """.        Copy
+00014410: 2063 6861 7261 6374 6572 7320 6672 6f6d   characters from
+00014420: 2074 6865 206d 6172 6769 6e20 7363 7265   the margin scre
+00014430: 656e 2074 6f20 7468 6520 7265 616c 2073  en to the real s
+00014440: 6372 6565 6e2e 0a20 2020 2020 2020 2022  creen..        "
+00014450: 2222 0a20 2020 2020 2020 2078 706f 7320  "".        xpos 
+00014460: 3d20 7772 6974 655f 706f 7369 7469 6f6e  = write_position
+00014470: 2e78 706f 7320 2b20 6d6f 7665 5f78 0a20  .xpos + move_x. 
+00014480: 2020 2020 2020 2079 706f 7320 3d20 7772         ypos = wr
+00014490: 6974 655f 706f 7369 7469 6f6e 2e79 706f  ite_position.ypo
+000144a0: 730a 0a20 2020 2020 2020 206d 6172 6769  s..        margi
+000144b0: 6e5f 7772 6974 655f 706f 7369 7469 6f6e  n_write_position
+000144c0: 203d 2057 7269 7465 506f 7369 7469 6f6e   = WritePosition
+000144d0: 2878 706f 732c 2079 706f 732c 2077 6964  (xpos, ypos, wid
+000144e0: 7468 2c20 7772 6974 655f 706f 7369 7469  th, write_positi
+000144f0: 6f6e 2e68 6569 6768 7429 0a20 2020 2020  on.height).     
+00014500: 2020 2073 656c 662e 5f63 6f70 795f 626f     self._copy_bo
+00014510: 6479 286d 6172 6769 6e5f 636f 6e74 656e  dy(margin_conten
+00014520: 742c 206e 6577 5f73 6372 6565 6e2c 206d  t, new_screen, m
+00014530: 6172 6769 6e5f 7772 6974 655f 706f 7369  argin_write_posi
+00014540: 7469 6f6e 2c20 302c 2077 6964 7468 290a  tion, 0, width).
+00014550: 0a20 2020 2064 6566 205f 7363 726f 6c6c  .    def _scroll
+00014560: 2873 656c 662c 2075 695f 636f 6e74 656e  (self, ui_conten
+00014570: 743a 2055 4943 6f6e 7465 6e74 2c20 7769  t: UIContent, wi
+00014580: 6474 683a 2069 6e74 2c20 6865 6967 6874  dth: int, height
+00014590: 3a20 696e 7429 202d 3e20 4e6f 6e65 3a0a  : int) -> None:.
+000145a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000145b0: 2020 2020 5363 726f 6c6c 2062 6f64 792e      Scroll body.
+000145c0: 2045 6e73 7572 6520 7468 6174 2074 6865   Ensure that the
+000145d0: 2063 7572 736f 7220 6973 2076 6973 6962   cursor is visib
+000145e0: 6c65 2e0a 2020 2020 2020 2020 2222 220a  le..        """.
+000145f0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00014600: 7772 6170 5f6c 696e 6573 2829 3a0a 2020  wrap_lines():.  
+00014610: 2020 2020 2020 2020 2020 6675 6e63 203d            func =
+00014620: 2073 656c 662e 5f73 6372 6f6c 6c5f 7768   self._scroll_wh
+00014630: 656e 5f6c 696e 6577 7261 7070 696e 670a  en_linewrapping.
+00014640: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00014650: 2020 2020 2020 2020 2020 6675 6e63 203d            func =
+00014660: 2073 656c 662e 5f73 6372 6f6c 6c5f 7769   self._scroll_wi
+00014670: 7468 6f75 745f 6c69 6e65 7772 6170 7069  thout_linewrappi
+00014680: 6e67 0a0a 2020 2020 2020 2020 6675 6e63  ng..        func
+00014690: 2875 695f 636f 6e74 656e 742c 2077 6964  (ui_content, wid
+000146a0: 7468 2c20 6865 6967 6874 290a 0a20 2020  th, height)..   
+000146b0: 2064 6566 205f 7363 726f 6c6c 5f77 6865   def _scroll_whe
+000146c0: 6e5f 6c69 6e65 7772 6170 7069 6e67 280a  n_linewrapping(.
+000146d0: 2020 2020 2020 2020 7365 6c66 2c20 7569          self, ui
+000146e0: 5f63 6f6e 7465 6e74 3a20 5549 436f 6e74  _content: UICont
+000146f0: 656e 742c 2077 6964 7468 3a20 696e 742c  ent, width: int,
+00014700: 2068 6569 6768 743a 2069 6e74 0a20 2020   height: int.   
+00014710: 2029 202d 3e20 4e6f 6e65 3a0a 2020 2020   ) -> None:.    
+00014720: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00014730: 5363 726f 6c6c 2074 6f20 6d61 6b65 2073  Scroll to make s
+00014740: 7572 6520 7468 6520 6375 7273 6f72 2070  ure the cursor p
+00014750: 6f73 6974 696f 6e20 6973 2076 6973 6962  osition is visib
+00014760: 6c65 2061 6e64 2074 6861 7420 7765 206d  le and that we m
+00014770: 6169 6e74 6169 6e0a 2020 2020 2020 2020  aintain.        
+00014780: 7468 6520 7265 7175 6573 7465 6420 7363  the requested sc
+00014790: 726f 6c6c 206f 6666 7365 742e 0a0a 2020  roll offset...  
+000147a0: 2020 2020 2020 5365 7420 6073 656c 662e        Set `self.
+000147b0: 686f 7269 7a6f 6e74 616c 5f73 6372 6f6c  horizontal_scrol
+000147c0: 6c2f 7665 7274 6963 616c 5f73 6372 6f6c  l/vertical_scrol
+000147d0: 6c60 2e0a 2020 2020 2020 2020 2222 220a  l`..        """.
+000147e0: 2020 2020 2020 2020 7363 726f 6c6c 5f6f          scroll_o
+000147f0: 6666 7365 7473 5f62 6f74 746f 6d20 3d20  ffsets_bottom = 
+00014800: 7365 6c66 2e73 6372 6f6c 6c5f 6f66 6673  self.scroll_offs
+00014810: 6574 732e 626f 7474 6f6d 0a20 2020 2020  ets.bottom.     
+00014820: 2020 2073 6372 6f6c 6c5f 6f66 6673 6574     scroll_offset
+00014830: 735f 746f 7020 3d20 7365 6c66 2e73 6372  s_top = self.scr
+00014840: 6f6c 6c5f 6f66 6673 6574 732e 746f 700a  oll_offsets.top.
+00014850: 0a20 2020 2020 2020 2023 2057 6520 646f  .        # We do
+00014860: 6e27 7420 6861 7665 2068 6f72 697a 6f6e  n't have horizon
+00014870: 7461 6c20 7363 726f 6c6c 696e 672e 0a20  tal scrolling.. 
+00014880: 2020 2020 2020 2073 656c 662e 686f 7269         self.hori
+00014890: 7a6f 6e74 616c 5f73 6372 6f6c 6c20 3d20  zontal_scroll = 
+000148a0: 300a 0a20 2020 2020 2020 2064 6566 2067  0..        def g
+000148b0: 6574 5f6c 696e 655f 6865 6967 6874 286c  et_line_height(l
+000148c0: 696e 656e 6f3a 2069 6e74 2920 2d3e 2069  ineno: int) -> i
+000148d0: 6e74 3a0a 2020 2020 2020 2020 2020 2020  nt:.            
+000148e0: 7265 7475 726e 2075 695f 636f 6e74 656e  return ui_conten
+000148f0: 742e 6765 745f 6865 6967 6874 5f66 6f72  t.get_height_for
+00014900: 5f6c 696e 6528 6c69 6e65 6e6f 2c20 7769  _line(lineno, wi
+00014910: 6474 682c 2073 656c 662e 6765 745f 6c69  dth, self.get_li
+00014920: 6e65 5f70 7265 6669 7829 0a0a 2020 2020  ne_prefix)..    
+00014930: 2020 2020 2320 5768 656e 2074 6865 7265      # When there
+00014940: 2069 7320 6e6f 2073 7061 6365 2c20 7265   is no space, re
+00014950: 7365 7420 6076 6572 7469 6361 6c5f 7363  set `vertical_sc
+00014960: 726f 6c6c 5f32 6020 746f 207a 6572 6f20  roll_2` to zero 
+00014970: 616e 6420 6162 6f72 742e 0a20 2020 2020  and abort..     
+00014980: 2020 2023 2054 6869 7320 6361 6e20 6861     # This can ha
+00014990: 7070 656e 2069 6620 7468 6520 6d61 7267  ppen if the marg
+000149a0: 696e 2069 7320 6269 6767 6572 2074 6861  in is bigger tha
+000149b0: 6e20 7468 6520 7769 6e64 6f77 2077 6964  n the window wid
+000149c0: 7468 2e0a 2020 2020 2020 2020 2320 4f74  th..        # Ot
+000149d0: 6865 7277 6973 6520 7468 6520 7465 7874  herwise the text
+000149e0: 2068 6569 6768 7420 7769 6c6c 2062 6563   height will bec
+000149f0: 6f6d 6520 2269 6e66 696e 6974 6522 2028  ome "infinite" (
+00014a00: 6120 6269 6720 6e75 6d62 6572 2920 616e  a big number) an
+00014a10: 640a 2020 2020 2020 2020 2320 7468 6520  d.        # the 
+00014a20: 636f 7079 5f6c 696e 6520 7769 6c6c 2073  copy_line will s
+00014a30: 7065 6e64 2061 2068 7567 6520 616d 6f75  pend a huge amou
+00014a40: 6e74 206f 6620 6974 6572 6174 696f 6e73  nt of iterations
+00014a50: 2074 7279 696e 6720 746f 2072 656e 6465   trying to rende
+00014a60: 720a 2020 2020 2020 2020 2320 6e6f 7468  r.        # noth
+00014a70: 696e 672e 0a20 2020 2020 2020 2069 6620  ing..        if 
+00014a80: 7769 6474 6820 3c3d 2030 3a0a 2020 2020  width <= 0:.    
+00014a90: 2020 2020 2020 2020 7365 6c66 2e76 6572          self.ver
+00014aa0: 7469 6361 6c5f 7363 726f 6c6c 203d 2075  tical_scroll = u
+00014ab0: 695f 636f 6e74 656e 742e 6375 7273 6f72  i_content.cursor
+00014ac0: 5f70 6f73 6974 696f 6e2e 790a 2020 2020  _position.y.    
+00014ad0: 2020 2020 2020 2020 7365 6c66 2e76 6572          self.ver
+00014ae0: 7469 6361 6c5f 7363 726f 6c6c 5f32 203d  tical_scroll_2 =
+00014af0: 2030 0a20 2020 2020 2020 2020 2020 2072   0.            r
+00014b00: 6574 7572 6e0a 0a20 2020 2020 2020 2023  eturn..        #
+00014b10: 2049 6620 7468 6520 6375 7272 656e 7420   If the current 
+00014b20: 6c69 6e65 2063 6f6e 7375 6d65 7320 6d6f  line consumes mo
+00014b30: 7265 2074 6861 6e20 7468 6520 7768 6f6c  re than the whol
+00014b40: 6520 7769 6e64 6f77 2068 6569 6768 742c  e window height,
+00014b50: 0a20 2020 2020 2020 2023 2074 6865 6e20  .        # then 
+00014b60: 7765 2068 6176 6520 746f 2073 6372 6f6c  we have to scrol
+00014b70: 6c20 7665 7274 6963 616c 6c79 2069 6e73  l vertically ins
+00014b80: 6964 6520 7468 6973 206c 696e 652e 2028  ide this line. (
+00014b90: 5765 2064 6f6e 2774 2074 616b 650a 2020  We don't take.  
+00014ba0: 2020 2020 2020 2320 7468 6520 7363 726f        # the scro
+00014bb0: 6c6c 206f 6666 7365 7473 2069 6e74 6f20  ll offsets into 
+00014bc0: 6163 636f 756e 7420 666f 7220 7468 6973  account for this
+00014bd0: 2e29 0a20 2020 2020 2020 2023 2041 6c73  .).        # Als
+00014be0: 6f2c 2069 676e 6f72 6520 7468 6520 7363  o, ignore the sc
+00014bf0: 726f 6c6c 206f 6666 7365 7473 2069 6e20  roll offsets in 
+00014c00: 7468 6973 2063 6173 652e 204a 7573 7420  this case. Just 
+00014c10: 7365 7420 7468 6520 7665 7274 6963 616c  set the vertical
+00014c20: 0a20 2020 2020 2020 2023 2073 6372 6f6c  .        # scrol
+00014c30: 6c20 746f 2074 6869 7320 6c69 6e65 2e0a  l to this line..
+00014c40: 2020 2020 2020 2020 6c69 6e65 5f68 6569          line_hei
+00014c50: 6768 7420 3d20 6765 745f 6c69 6e65 5f68  ght = get_line_h
+00014c60: 6569 6768 7428 7569 5f63 6f6e 7465 6e74  eight(ui_content
+00014c70: 2e63 7572 736f 725f 706f 7369 7469 6f6e  .cursor_position
+00014c80: 2e79 290a 2020 2020 2020 2020 6966 206c  .y).        if l
+00014c90: 696e 655f 6865 6967 6874 203e 2068 6569  ine_height > hei
+00014ca0: 6768 7420 2d20 7363 726f 6c6c 5f6f 6666  ght - scroll_off
+00014cb0: 7365 7473 5f74 6f70 3a0a 2020 2020 2020  sets_top:.      
+00014cc0: 2020 2020 2020 2320 4361 6c63 756c 6174        # Calculat
+00014cd0: 6520 7468 6520 6865 6967 6874 206f 6620  e the height of 
+00014ce0: 7468 6520 7465 7874 2062 6566 6f72 6520  the text before 
+00014cf0: 7468 6520 6375 7273 6f72 2028 696e 636c  the cursor (incl
+00014d00: 7564 696e 670a 2020 2020 2020 2020 2020  uding.          
+00014d10: 2020 2320 6c69 6e65 2070 7265 6669 7865    # line prefixe
+00014d20: 7329 2e0a 2020 2020 2020 2020 2020 2020  s)..            
+00014d30: 7465 7874 5f62 6566 6f72 655f 6865 6967  text_before_heig
+00014d40: 6874 203d 2075 695f 636f 6e74 656e 742e  ht = ui_content.
+00014d50: 6765 745f 6865 6967 6874 5f66 6f72 5f6c  get_height_for_l
+00014d60: 696e 6528 0a20 2020 2020 2020 2020 2020  ine(.           
+00014d70: 2020 2020 2075 695f 636f 6e74 656e 742e       ui_content.
+00014d80: 6375 7273 6f72 5f70 6f73 6974 696f 6e2e  cursor_position.
+00014d90: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
+00014da0: 2020 2077 6964 7468 2c0a 2020 2020 2020     width,.      
+00014db0: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
+00014dc0: 6574 5f6c 696e 655f 7072 6566 6978 2c0a  et_line_prefix,.
+00014dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014de0: 736c 6963 655f 7374 6f70 3d75 695f 636f  slice_stop=ui_co
+00014df0: 6e74 656e 742e 6375 7273 6f72 5f70 6f73  ntent.cursor_pos
+00014e00: 6974 696f 6e2e 782c 0a20 2020 2020 2020  ition.x,.       
+00014e10: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00014e20: 2020 2020 2320 4164 6a75 7374 2073 6372      # Adjust scr
+00014e30: 6f6c 6c20 6f66 6673 6574 2e0a 2020 2020  oll offset..    
+00014e40: 2020 2020 2020 2020 7365 6c66 2e76 6572          self.ver
+00014e50: 7469 6361 6c5f 7363 726f 6c6c 203d 2075  tical_scroll = u
+00014e60: 695f 636f 6e74 656e 742e 6375 7273 6f72  i_content.cursor
+00014e70: 5f70 6f73 6974 696f 6e2e 790a 2020 2020  _position.y.    
+00014e80: 2020 2020 2020 2020 7365 6c66 2e76 6572          self.ver
+00014e90: 7469 6361 6c5f 7363 726f 6c6c 5f32 203d  tical_scroll_2 =
+00014ea0: 206d 696e 280a 2020 2020 2020 2020 2020   min(.          
+00014eb0: 2020 2020 2020 7465 7874 5f62 6566 6f72        text_befor
+00014ec0: 655f 6865 6967 6874 202d 2031 2c20 2023  e_height - 1,  #
+00014ed0: 204b 6565 7020 7468 6520 6375 7273 6f72   Keep the cursor
+00014ee0: 2076 6973 6962 6c65 2e0a 2020 2020 2020   visible..      
+00014ef0: 2020 2020 2020 2020 2020 6c69 6e65 5f68            line_h
+00014f00: 6569 6768 740a 2020 2020 2020 2020 2020  eight.          
+00014f10: 2020 2020 2020 2d20 6865 6967 6874 2c20        - height, 
+00014f20: 2023 2041 766f 6964 2062 6c61 6e6b 206c   # Avoid blank l
+00014f30: 696e 6573 2061 7420 7468 6520 626f 7474  ines at the bott
+00014f40: 6f6d 2077 6865 6e20 7363 6f6c 6c69 6e67  om when scolling
+00014f50: 2075 7020 6167 6169 6e2e 0a20 2020 2020   up again..     
+00014f60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00014f70: 7665 7274 6963 616c 5f73 6372 6f6c 6c5f  vertical_scroll_
+00014f80: 322c 0a20 2020 2020 2020 2020 2020 2029  2,.            )
+00014f90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00014fa0: 662e 7665 7274 6963 616c 5f73 6372 6f6c  f.vertical_scrol
+00014fb0: 6c5f 3220 3d20 6d61 7828 0a20 2020 2020  l_2 = max(.     
+00014fc0: 2020 2020 2020 2020 2020 2030 2c20 7465             0, te
+00014fd0: 7874 5f62 6566 6f72 655f 6865 6967 6874  xt_before_height
+00014fe0: 202d 2068 6569 6768 742c 2073 656c 662e   - height, self.
+00014ff0: 7665 7274 6963 616c 5f73 6372 6f6c 6c5f  vertical_scroll_
+00015000: 320a 2020 2020 2020 2020 2020 2020 290a  2.            ).
+00015010: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00015020: 726e 0a20 2020 2020 2020 2065 6c73 653a  rn.        else:
+00015030: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00015040: 662e 7665 7274 6963 616c 5f73 6372 6f6c  f.vertical_scrol
+00015050: 6c5f 3220 3d20 300a 0a20 2020 2020 2020  l_2 = 0..       
+00015060: 2023 2043 7572 7265 6e74 206c 696e 6520   # Current line 
+00015070: 646f 6573 6e27 7420 636f 6e73 756d 6520  doesn't consume 
+00015080: 7468 6520 7768 6f6c 6520 6865 6967 6874  the whole height
+00015090: 2e20 5461 6b65 2073 6372 6f6c 6c20 6f66  . Take scroll of
+000150a0: 6673 6574 7320 696e 746f 2061 6363 6f75  fsets into accou
+000150b0: 6e74 2e0a 2020 2020 2020 2020 6465 6620  nt..        def 
+000150c0: 6765 745f 6d69 6e5f 7665 7274 6963 616c  get_min_vertical
+000150d0: 5f73 6372 6f6c 6c28 2920 2d3e 2069 6e74  _scroll() -> int
+000150e0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+000150f0: 4d61 6b65 2073 7572 6520 7468 6174 2074  Make sure that t
+00015100: 6865 2063 7572 736f 7220 6c69 6e65 2069  he cursor line i
+00015110: 7320 6e6f 7420 6265 6c6f 7720 7468 6520  s not below the 
+00015120: 626f 7474 6f6d 2e0a 2020 2020 2020 2020  bottom..        
+00015130: 2020 2020 2320 2843 616c 6375 6c61 7465      # (Calculate
+00015140: 2068 6f77 206d 616e 7920 6c69 6e65 7320   how many lines 
+00015150: 6361 6e20 6265 2073 686f 776e 2062 6574  can be shown bet
+00015160: 7765 656e 2074 6865 2063 7572 736f 7220  ween the cursor 
+00015170: 616e 6420 7468 6520 2e29 0a20 2020 2020  and the .).     
+00015180: 2020 2020 2020 2075 7365 645f 6865 6967         used_heig
+00015190: 6874 203d 2030 0a20 2020 2020 2020 2020  ht = 0.         
+000151a0: 2020 2070 7265 765f 6c69 6e65 6e6f 203d     prev_lineno =
+000151b0: 2075 695f 636f 6e74 656e 742e 6375 7273   ui_content.curs
+000151c0: 6f72 5f70 6f73 6974 696f 6e2e 790a 0a20  or_position.y.. 
+000151d0: 2020 2020 2020 2020 2020 2066 6f72 206c             for l
+000151e0: 696e 656e 6f20 696e 2072 616e 6765 2875  ineno in range(u
+000151f0: 695f 636f 6e74 656e 742e 6375 7273 6f72  i_content.cursor
+00015200: 5f70 6f73 6974 696f 6e2e 792c 202d 312c  _position.y, -1,
+00015210: 202d 3129 3a0a 2020 2020 2020 2020 2020   -1):.          
+00015220: 2020 2020 2020 7573 6564 5f68 6569 6768        used_heigh
+00015230: 7420 2b3d 2067 6574 5f6c 696e 655f 6865  t += get_line_he
+00015240: 6967 6874 286c 696e 656e 6f29 0a0a 2020  ight(lineno)..  
+00015250: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00015260: 2075 7365 645f 6865 6967 6874 203e 2068   used_height > h
+00015270: 6569 6768 7420 2d20 7363 726f 6c6c 5f6f  eight - scroll_o
+00015280: 6666 7365 7473 5f62 6f74 746f 6d3a 0a20  ffsets_bottom:. 
+00015290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152a0: 2020 2072 6574 7572 6e20 7072 6576 5f6c     return prev_l
+000152b0: 696e 656e 6f0a 2020 2020 2020 2020 2020  ineno.          
+000152c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
 000152d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152e0: 7573 6564 5f68 6569 6768 7420 2b3d 2067  used_height += g
-000152f0: 6574 5f6c 696e 655f 6865 6967 6874 286c  et_line_height(l
-00015300: 696e 656e 6f29 0a0a 2020 2020 2020 2020  ineno)..        
-00015310: 2020 2020 2020 2020 6966 2075 7365 645f          if used_
-00015320: 6865 6967 6874 203e 2068 6569 6768 7420  height > height 
-00015330: 2d20 7363 726f 6c6c 5f6f 6666 7365 7473  - scroll_offsets
-00015340: 5f62 6f74 746f 6d3a 0a20 2020 2020 2020  _bottom:.       
-00015350: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00015360: 7572 6e20 7072 6576 5f6c 696e 656e 6f0a  urn prev_lineno.
-00015370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015380: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00015390: 2020 2020 2020 2020 2020 7072 6576 5f6c            prev_l
-000153a0: 696e 656e 6f20 3d20 6c69 6e65 6e6f 0a20  ineno = lineno. 
-000153b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000153c0: 6e20 300a 0a20 2020 2020 2020 2064 6566  n 0..        def
-000153d0: 2067 6574 5f6d 6178 5f76 6572 7469 6361   get_max_vertica
-000153e0: 6c5f 7363 726f 6c6c 2829 202d 3e20 696e  l_scroll() -> in
-000153f0: 743a 0a20 2020 2020 2020 2020 2020 2023  t:.            #
-00015400: 204d 616b 6520 7375 7265 2074 6861 7420   Make sure that 
-00015410: 7468 6520 6375 7273 6f72 206c 696e 6520  the cursor line 
-00015420: 6973 206e 6f74 2061 626f 7665 2074 6865  is not above the
-00015430: 2074 6f70 2e0a 2020 2020 2020 2020 2020   top..          
-00015440: 2020 7072 6576 5f6c 696e 656e 6f20 3d20    prev_lineno = 
-00015450: 7569 5f63 6f6e 7465 6e74 2e63 7572 736f  ui_content.curso
-00015460: 725f 706f 7369 7469 6f6e 2e79 0a20 2020  r_position.y.   
-00015470: 2020 2020 2020 2020 2075 7365 645f 6865           used_he
-00015480: 6967 6874 203d 2030 0a0a 2020 2020 2020  ight = 0..      
-00015490: 2020 2020 2020 666f 7220 6c69 6e65 6e6f        for lineno
-000154a0: 2069 6e20 7261 6e67 6528 7569 5f63 6f6e   in range(ui_con
-000154b0: 7465 6e74 2e63 7572 736f 725f 706f 7369  tent.cursor_posi
-000154c0: 7469 6f6e 2e79 202d 2031 2c20 2d31 2c20  tion.y - 1, -1, 
-000154d0: 2d31 293a 0a20 2020 2020 2020 2020 2020  -1):.           
-000154e0: 2020 2020 2075 7365 645f 6865 6967 6874       used_height
-000154f0: 202b 3d20 6765 745f 6c69 6e65 5f68 6569   += get_line_hei
-00015500: 6768 7428 6c69 6e65 6e6f 290a 0a20 2020  ght(lineno)..   
-00015510: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00015520: 7573 6564 5f68 6569 6768 7420 3e20 7363  used_height > sc
-00015530: 726f 6c6c 5f6f 6666 7365 7473 5f74 6f70  roll_offsets_top
-00015540: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00015550: 2020 2020 2020 7265 7475 726e 2070 7265        return pre
-00015560: 765f 6c69 6e65 6e6f 0a20 2020 2020 2020  v_lineno.       
-00015570: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00015580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015590: 2020 2070 7265 765f 6c69 6e65 6e6f 203d     prev_lineno =
-000155a0: 206c 696e 656e 6f0a 2020 2020 2020 2020   lineno.        
-000155b0: 2020 2020 7265 7475 726e 2070 7265 765f      return prev_
-000155c0: 6c69 6e65 6e6f 0a0a 2020 2020 2020 2020  lineno..        
-000155d0: 6465 6620 6765 745f 746f 706d 6f73 745f  def get_topmost_
-000155e0: 7669 7369 626c 6528 2920 2d3e 2069 6e74  visible() -> int
-000155f0: 3a0a 2020 2020 2020 2020 2020 2020 2222  :.            ""
-00015600: 220a 2020 2020 2020 2020 2020 2020 4361  ".            Ca
-00015610: 6c63 756c 6174 6520 7468 6520 7570 7065  lculate the uppe
-00015620: 7220 6d6f 7374 206c 696e 6520 7468 6174  r most line that
-00015630: 2063 616e 2062 6520 7669 7369 626c 652c   can be visible,
-00015640: 2077 6869 6c65 2074 6865 2062 6f74 746f   while the botto
-00015650: 6d0a 2020 2020 2020 2020 2020 2020 6973  m.            is
-00015660: 2073 7469 6c6c 2076 6973 6962 6c65 2e20   still visible. 
-00015670: 5765 2073 686f 756c 6420 6e6f 7420 616c  We should not al
-00015680: 6c6f 7720 7363 726f 6c6c 206d 6f72 6520  low scroll more 
-00015690: 7468 616e 2074 6869 7320 6966 0a20 2020  than this if.   
-000156a0: 2020 2020 2020 2020 2060 616c 6c6f 775f           `allow_
-000156b0: 7363 726f 6c6c 5f62 6579 6f6e 645f 626f  scroll_beyond_bo
-000156c0: 7474 6f6d 6020 6973 2066 616c 7365 2e0a  ttom` is false..
-000156d0: 2020 2020 2020 2020 2020 2020 2222 220a              """.
-000156e0: 2020 2020 2020 2020 2020 2020 7072 6576              prev
-000156f0: 5f6c 696e 656e 6f20 3d20 7569 5f63 6f6e  _lineno = ui_con
-00015700: 7465 6e74 2e6c 696e 655f 636f 756e 7420  tent.line_count 
-00015710: 2d20 310a 2020 2020 2020 2020 2020 2020  - 1.            
-00015720: 7573 6564 5f68 6569 6768 7420 3d20 300a  used_height = 0.
-00015730: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00015740: 6c69 6e65 6e6f 2069 6e20 7261 6e67 6528  lineno in range(
-00015750: 7569 5f63 6f6e 7465 6e74 2e6c 696e 655f  ui_content.line_
-00015760: 636f 756e 7420 2d20 312c 202d 312c 202d  count - 1, -1, -
-00015770: 3129 3a0a 2020 2020 2020 2020 2020 2020  1):.            
-00015780: 2020 2020 7573 6564 5f68 6569 6768 7420      used_height 
-00015790: 2b3d 2067 6574 5f6c 696e 655f 6865 6967  += get_line_heig
-000157a0: 6874 286c 696e 656e 6f29 0a20 2020 2020  ht(lineno).     
-000157b0: 2020 2020 2020 2020 2020 2069 6620 7573             if us
-000157c0: 6564 5f68 6569 6768 7420 3e20 6865 6967  ed_height > heig
-000157d0: 6874 3a0a 2020 2020 2020 2020 2020 2020  ht:.            
-000157e0: 2020 2020 2020 2020 7265 7475 726e 2070          return p
-000157f0: 7265 765f 6c69 6e65 6e6f 0a20 2020 2020  rev_lineno.     
-00015800: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00015810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015820: 2020 2020 2070 7265 765f 6c69 6e65 6e6f       prev_lineno
-00015830: 203d 206c 696e 656e 6f0a 2020 2020 2020   = lineno.      
-00015840: 2020 2020 2020 7265 7475 726e 2070 7265        return pre
-00015850: 765f 6c69 6e65 6e6f 0a0a 2020 2020 2020  v_lineno..      
-00015860: 2020 2320 5363 726f 6c6c 2076 6572 7469    # Scroll verti
-00015870: 6361 6c6c 792e 2028 4d61 6b65 2073 7572  cally. (Make sur
-00015880: 6520 7468 6174 2074 6865 2077 686f 6c65  e that the whole
-00015890: 206c 696e 6520 7768 6963 6820 636f 6e74   line which cont
-000158a0: 6169 6e73 2074 6865 0a20 2020 2020 2020  ains the.       
-000158b0: 2023 2063 7572 736f 7220 6973 2076 6973   # cursor is vis
-000158c0: 6962 6c65 2e0a 2020 2020 2020 2020 746f  ible..        to
-000158d0: 706d 6f73 745f 7669 7369 626c 6520 3d20  pmost_visible = 
-000158e0: 6765 745f 746f 706d 6f73 745f 7669 7369  get_topmost_visi
-000158f0: 626c 6528 290a 0a20 2020 2020 2020 2023  ble()..        #
-00015900: 204e 6f74 653a 2074 6865 2060 6d69 6e28   Note: the `min(
-00015910: 746f 706d 6f73 745f 7669 7369 626c 652c  topmost_visible,
-00015920: 202e 2e2e 2960 2069 7320 746f 206d 616b   ...)` is to mak
-00015930: 6520 7375 7265 2074 6861 7420 7765 0a20  e sure that we. 
-00015940: 2020 2020 2020 2023 2064 6f6e 2774 2072         # don't r
-00015950: 6571 7569 7265 2073 6372 6f6c 6c69 6e67  equire scrolling
-00015960: 2075 7020 6265 6361 7573 6520 6f66 2074   up because of t
-00015970: 6865 2062 6f74 746f 6d20 7363 726f 6c6c  he bottom scroll
-00015980: 206f 6666 7365 742c 0a20 2020 2020 2020   offset,.       
-00015990: 2023 2077 6865 6e20 7765 2061 7265 2061   # when we are a
-000159a0: 7420 7468 6520 656e 6420 6f66 2074 6865  t the end of the
-000159b0: 2064 6f63 756d 656e 742e 0a20 2020 2020   document..     
-000159c0: 2020 2073 656c 662e 7665 7274 6963 616c     self.vertical
-000159d0: 5f73 6372 6f6c 6c20 3d20 6d61 7828 0a20  _scroll = max(. 
-000159e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000159f0: 7665 7274 6963 616c 5f73 6372 6f6c 6c2c  vertical_scroll,
-00015a00: 206d 696e 2874 6f70 6d6f 7374 5f76 6973   min(topmost_vis
-00015a10: 6962 6c65 2c20 6765 745f 6d69 6e5f 7665  ible, get_min_ve
-00015a20: 7274 6963 616c 5f73 6372 6f6c 6c28 2929  rtical_scroll())
-00015a30: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00015a40: 2020 2073 656c 662e 7665 7274 6963 616c     self.vertical
-00015a50: 5f73 6372 6f6c 6c20 3d20 6d69 6e28 7365  _scroll = min(se
-00015a60: 6c66 2e76 6572 7469 6361 6c5f 7363 726f  lf.vertical_scro
-00015a70: 6c6c 2c20 6765 745f 6d61 785f 7665 7274  ll, get_max_vert
-00015a80: 6963 616c 5f73 6372 6f6c 6c28 2929 0a0a  ical_scroll())..
-00015a90: 2020 2020 2020 2020 2320 4469 7361 6c6c          # Disall
-00015aa0: 6f77 2073 6372 6f6c 6c69 6e67 2062 6579  ow scrolling bey
-00015ab0: 6f6e 6420 626f 7474 6f6d 3f0a 2020 2020  ond bottom?.    
-00015ac0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-00015ad0: 616c 6c6f 775f 7363 726f 6c6c 5f62 6579  allow_scroll_bey
-00015ae0: 6f6e 645f 626f 7474 6f6d 2829 3a0a 2020  ond_bottom():.  
-00015af0: 2020 2020 2020 2020 2020 7365 6c66 2e76            self.v
-00015b00: 6572 7469 6361 6c5f 7363 726f 6c6c 203d  ertical_scroll =
-00015b10: 206d 696e 2873 656c 662e 7665 7274 6963   min(self.vertic
-00015b20: 616c 5f73 6372 6f6c 6c2c 2074 6f70 6d6f  al_scroll, topmo
-00015b30: 7374 5f76 6973 6962 6c65 290a 0a20 2020  st_visible)..   
-00015b40: 2064 6566 205f 7363 726f 6c6c 5f77 6974   def _scroll_wit
-00015b50: 686f 7574 5f6c 696e 6577 7261 7070 696e  hout_linewrappin
-00015b60: 6728 0a20 2020 2020 2020 2073 656c 662c  g(.        self,
-00015b70: 2075 695f 636f 6e74 656e 743a 2055 4943   ui_content: UIC
-00015b80: 6f6e 7465 6e74 2c20 7769 6474 683a 2069  ontent, width: i
-00015b90: 6e74 2c20 6865 6967 6874 3a20 696e 740a  nt, height: int.
-00015ba0: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
-00015bb0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00015bc0: 2020 2053 6372 6f6c 6c20 746f 206d 616b     Scroll to mak
-00015bd0: 6520 7375 7265 2074 6865 2063 7572 736f  e sure the curso
-00015be0: 7220 706f 7369 7469 6f6e 2069 7320 7669  r position is vi
-00015bf0: 7369 626c 6520 616e 6420 7468 6174 2077  sible and that w
-00015c00: 6520 6d61 696e 7461 696e 0a20 2020 2020  e maintain.     
-00015c10: 2020 2074 6865 2072 6571 7565 7374 6564     the requested
-00015c20: 2073 6372 6f6c 6c20 6f66 6673 6574 2e0a   scroll offset..
-00015c30: 0a20 2020 2020 2020 2053 6574 2060 7365  .        Set `se
-00015c40: 6c66 2e68 6f72 697a 6f6e 7461 6c5f 7363  lf.horizontal_sc
-00015c50: 726f 6c6c 2f76 6572 7469 6361 6c5f 7363  roll/vertical_sc
-00015c60: 726f 6c6c 602e 0a20 2020 2020 2020 2022  roll`..        "
-00015c70: 2222 0a20 2020 2020 2020 2063 7572 736f  "".        curso
-00015c80: 725f 706f 7369 7469 6f6e 203d 2075 695f  r_position = ui_
-00015c90: 636f 6e74 656e 742e 6375 7273 6f72 5f70  content.cursor_p
-00015ca0: 6f73 6974 696f 6e20 6f72 2050 6f69 6e74  osition or Point
-00015cb0: 2878 3d30 2c20 793d 3029 0a0a 2020 2020  (x=0, y=0)..    
-00015cc0: 2020 2020 2320 5769 7468 6f75 7420 6c69      # Without li
-00015cd0: 6e65 2077 7261 7070 696e 672c 2077 6520  ne wrapping, we 
-00015ce0: 7769 6c6c 206e 6576 6572 2068 6176 6520  will never have 
-00015cf0: 746f 2073 6372 6f6c 6c20 7665 7274 6963  to scroll vertic
-00015d00: 616c 6c79 2069 6e73 6964 650a 2020 2020  ally inside.    
-00015d10: 2020 2020 2320 6120 7369 6e67 6c65 206c      # a single l
-00015d20: 696e 652e 0a20 2020 2020 2020 2073 656c  ine..        sel
-00015d30: 662e 7665 7274 6963 616c 5f73 6372 6f6c  f.vertical_scrol
-00015d40: 6c5f 3220 3d20 300a 0a20 2020 2020 2020  l_2 = 0..       
-00015d50: 2069 6620 7569 5f63 6f6e 7465 6e74 2e6c   if ui_content.l
-00015d60: 696e 655f 636f 756e 7420 3d3d 2030 3a0a  ine_count == 0:.
-00015d70: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00015d80: 2e76 6572 7469 6361 6c5f 7363 726f 6c6c  .vertical_scroll
-00015d90: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-00015da0: 2073 656c 662e 686f 7269 7a6f 6e74 616c   self.horizontal
-00015db0: 5f73 6372 6f6c 6c20 3d20 300a 2020 2020  _scroll = 0.    
-00015dc0: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-00015dd0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00015de0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-00015df0: 5f6c 696e 655f 7465 7874 203d 2066 7261  _line_text = fra
-00015e00: 676d 656e 745f 6c69 7374 5f74 6f5f 7465  gment_list_to_te
-00015e10: 7874 280a 2020 2020 2020 2020 2020 2020  xt(.            
-00015e20: 2020 2020 7569 5f63 6f6e 7465 6e74 2e67      ui_content.g
-00015e30: 6574 5f6c 696e 6528 6375 7273 6f72 5f70  et_line(cursor_p
-00015e40: 6f73 6974 696f 6e2e 7929 0a20 2020 2020  osition.y).     
-00015e50: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00015e60: 2020 6465 6620 646f 5f73 6372 6f6c 6c28    def do_scroll(
-00015e70: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
-00015e80: 7265 6e74 5f73 6372 6f6c 6c3a 2069 6e74  rent_scroll: int
-00015e90: 2c0a 2020 2020 2020 2020 2020 2020 7363  ,.            sc
-00015ea0: 726f 6c6c 5f6f 6666 7365 745f 7374 6172  roll_offset_star
-00015eb0: 743a 2069 6e74 2c0a 2020 2020 2020 2020  t: int,.        
-00015ec0: 2020 2020 7363 726f 6c6c 5f6f 6666 7365      scroll_offse
-00015ed0: 745f 656e 643a 2069 6e74 2c0a 2020 2020  t_end: int,.    
-00015ee0: 2020 2020 2020 2020 6375 7273 6f72 5f70          cursor_p
-00015ef0: 6f73 3a20 696e 742c 0a20 2020 2020 2020  os: int,.       
-00015f00: 2020 2020 2077 696e 646f 775f 7369 7a65       window_size
-00015f10: 3a20 696e 742c 0a20 2020 2020 2020 2020  : int,.         
-00015f20: 2020 2063 6f6e 7465 6e74 5f73 697a 653a     content_size:
-00015f30: 2069 6e74 2c0a 2020 2020 2020 2020 2920   int,.        ) 
-00015f40: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
-00015f50: 2020 2020 2253 6372 6f6c 6c69 6e67 2061      "Scrolling a
-00015f60: 6c67 6f72 6974 686d 2e20 5573 6564 2066  lgorithm. Used f
-00015f70: 6f72 2062 6f74 6820 686f 7269 7a6f 6e74  or both horizont
-00015f80: 616c 2061 6e64 2076 6572 7469 6361 6c20  al and vertical 
-00015f90: 7363 726f 6c6c 696e 672e 220a 2020 2020  scrolling.".    
-00015fa0: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
-00015fb0: 6174 6520 7468 6520 7363 726f 6c6c 206f  ate the scroll o
-00015fc0: 6666 7365 7420 746f 2061 7070 6c79 2e0a  ffset to apply..
-00015fd0: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
-00015fe0: 6973 2063 616e 206f 6276 696f 7573 6c79  is can obviously
-00015ff0: 206e 6576 6572 2062 6520 6d6f 7265 2074   never be more t
-00016000: 6861 6e20 6861 7665 2074 6865 2073 6372  han have the scr
-00016010: 6565 6e20 7369 7a65 2e20 416c 736f 2c20  een size. Also, 
-00016020: 7768 656e 2074 6865 0a20 2020 2020 2020  when the.       
-00016030: 2020 2020 2023 2063 7572 736f 7220 6170       # cursor ap
-00016040: 7065 6172 7320 6174 2074 6865 2074 6f70  pears at the top
-00016050: 206f 7220 626f 7474 6f6d 2c20 7765 2064   or bottom, we d
-00016060: 6f6e 2774 2061 7070 6c79 2074 6865 206f  on't apply the o
-00016070: 6666 7365 742e 0a20 2020 2020 2020 2020  ffset..         
-00016080: 2020 2073 6372 6f6c 6c5f 6f66 6673 6574     scroll_offset
-00016090: 5f73 7461 7274 203d 2069 6e74 280a 2020  _start = int(.  
-000160a0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
-000160b0: 6e28 7363 726f 6c6c 5f6f 6666 7365 745f  n(scroll_offset_
-000160c0: 7374 6172 742c 2077 696e 646f 775f 7369  start, window_si
-000160d0: 7a65 202f 2032 2c20 6375 7273 6f72 5f70  ze / 2, cursor_p
-000160e0: 6f73 290a 2020 2020 2020 2020 2020 2020  os).            
-000160f0: 290a 2020 2020 2020 2020 2020 2020 7363  ).            sc
-00016100: 726f 6c6c 5f6f 6666 7365 745f 656e 6420  roll_offset_end 
-00016110: 3d20 696e 7428 0a20 2020 2020 2020 2020  = int(.         
-00016120: 2020 2020 2020 206d 696e 2873 6372 6f6c         min(scrol
-00016130: 6c5f 6f66 6673 6574 5f65 6e64 2c20 7769  l_offset_end, wi
-00016140: 6e64 6f77 5f73 697a 6520 2f20 322c 2063  ndow_size / 2, c
-00016150: 6f6e 7465 6e74 5f73 697a 6520 2d20 3120  ontent_size - 1 
-00016160: 2d20 6375 7273 6f72 5f70 6f73 290a 2020  - cursor_pos).  
-00016170: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00016180: 2020 2020 2020 2020 2023 2050 7265 7665           # Preve
-00016190: 6e74 206e 6567 6174 6976 6520 7363 726f  nt negative scro
-000161a0: 6c6c 206f 6666 7365 7473 2e0a 2020 2020  ll offsets..    
-000161b0: 2020 2020 2020 2020 6966 2063 7572 7265          if curre
-000161c0: 6e74 5f73 6372 6f6c 6c20 3c20 303a 0a20  nt_scroll < 0:. 
-000161d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000161e0: 7572 7265 6e74 5f73 6372 6f6c 6c20 3d20  urrent_scroll = 
-000161f0: 300a 0a20 2020 2020 2020 2020 2020 2023  0..            #
-00016200: 2053 6372 6f6c 6c20 6261 636b 2069 6620   Scroll back if 
-00016210: 7765 2073 6372 6f6c 6c65 6420 746f 206d  we scrolled to m
-00016220: 7563 6820 616e 6420 7468 6572 6527 7320  uch and there's 
-00016230: 7374 696c 6c20 7370 6163 6520 746f 2073  still space to s
-00016240: 686f 7720 6d6f 7265 206f 6620 7468 6520  how more of the 
-00016250: 646f 6375 6d65 6e74 2e0a 2020 2020 2020  document..      
-00016260: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
-00016270: 2020 2020 2020 2020 2020 206e 6f74 2073             not s
-00016280: 656c 662e 616c 6c6f 775f 7363 726f 6c6c  elf.allow_scroll
-00016290: 5f62 6579 6f6e 645f 626f 7474 6f6d 2829  _beyond_bottom()
-000162a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000162b0: 2061 6e64 2063 7572 7265 6e74 5f73 6372   and current_scr
-000162c0: 6f6c 6c20 3e20 636f 6e74 656e 745f 7369  oll > content_si
-000162d0: 7a65 202d 2077 696e 646f 775f 7369 7a65  ze - window_size
-000162e0: 0a20 2020 2020 2020 2020 2020 2029 3a0a  .            ):.
-000162f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016300: 6375 7272 656e 745f 7363 726f 6c6c 203d  current_scroll =
-00016310: 206d 6178 2830 2c20 636f 6e74 656e 745f   max(0, content_
-00016320: 7369 7a65 202d 2077 696e 646f 775f 7369  size - window_si
-00016330: 7a65 290a 0a20 2020 2020 2020 2020 2020  ze)..           
-00016340: 2023 2053 6372 6f6c 6c20 7570 2069 6620   # Scroll up if 
-00016350: 6375 7273 6f72 2069 7320 6265 666f 7265  cursor is before
-00016360: 2076 6973 6962 6c65 2070 6172 742e 0a20   visible part.. 
-00016370: 2020 2020 2020 2020 2020 2069 6620 6375             if cu
-00016380: 7272 656e 745f 7363 726f 6c6c 203e 2063  rrent_scroll > c
-00016390: 7572 736f 725f 706f 7320 2d20 7363 726f  ursor_pos - scro
-000163a0: 6c6c 5f6f 6666 7365 745f 7374 6172 743a  ll_offset_start:
-000163b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000163c0: 2063 7572 7265 6e74 5f73 6372 6f6c 6c20   current_scroll 
-000163d0: 3d20 6d61 7828 302c 2063 7572 736f 725f  = max(0, cursor_
-000163e0: 706f 7320 2d20 7363 726f 6c6c 5f6f 6666  pos - scroll_off
-000163f0: 7365 745f 7374 6172 7429 0a0a 2020 2020  set_start)..    
-00016400: 2020 2020 2020 2020 2320 5363 726f 6c6c          # Scroll
-00016410: 2064 6f77 6e20 6966 2063 7572 736f 7220   down if cursor 
-00016420: 6973 2061 6674 6572 2076 6973 6962 6c65  is after visible
-00016430: 2070 6172 742e 0a20 2020 2020 2020 2020   part..         
-00016440: 2020 2069 6620 6375 7272 656e 745f 7363     if current_sc
-00016450: 726f 6c6c 203c 2028 6375 7273 6f72 5f70  roll < (cursor_p
-00016460: 6f73 202b 2031 2920 2d20 7769 6e64 6f77  os + 1) - window
-00016470: 5f73 697a 6520 2b20 7363 726f 6c6c 5f6f  _size + scroll_o
-00016480: 6666 7365 745f 656e 643a 0a20 2020 2020  ffset_end:.     
-00016490: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-000164a0: 6e74 5f73 6372 6f6c 6c20 3d20 2863 7572  nt_scroll = (cur
-000164b0: 736f 725f 706f 7320 2b20 3129 202d 2077  sor_pos + 1) - w
-000164c0: 696e 646f 775f 7369 7a65 202b 2073 6372  indow_size + scr
-000164d0: 6f6c 6c5f 6f66 6673 6574 5f65 6e64 0a0a  oll_offset_end..
-000164e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000164f0: 726e 2063 7572 7265 6e74 5f73 6372 6f6c  rn current_scrol
-00016500: 6c0a 0a20 2020 2020 2020 2023 2057 6865  l..        # Whe
-00016510: 6e20 6120 7072 6566 6572 7265 6420 7363  n a preferred sc
-00016520: 726f 6c6c 2069 7320 6769 7665 6e2c 2074  roll is given, t
-00016530: 616b 6520 7468 6174 2066 6972 7374 2069  ake that first i
-00016540: 6e74 6f20 6163 636f 756e 742e 0a20 2020  nto account..   
-00016550: 2020 2020 2069 6620 7365 6c66 2e67 6574       if self.get
-00016560: 5f76 6572 7469 6361 6c5f 7363 726f 6c6c  _vertical_scroll
-00016570: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00016580: 6c66 2e76 6572 7469 6361 6c5f 7363 726f  lf.vertical_scro
-00016590: 6c6c 203d 2073 656c 662e 6765 745f 7665  ll = self.get_ve
-000165a0: 7274 6963 616c 5f73 6372 6f6c 6c28 7365  rtical_scroll(se
-000165b0: 6c66 290a 2020 2020 2020 2020 2020 2020  lf).            
-000165c0: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
-000165d0: 6528 7365 6c66 2e76 6572 7469 6361 6c5f  e(self.vertical_
-000165e0: 7363 726f 6c6c 2c20 696e 7429 0a20 2020  scroll, int).   
-000165f0: 2020 2020 2069 6620 7365 6c66 2e67 6574       if self.get
-00016600: 5f68 6f72 697a 6f6e 7461 6c5f 7363 726f  _horizontal_scro
-00016610: 6c6c 3a0a 2020 2020 2020 2020 2020 2020  ll:.            
-00016620: 7365 6c66 2e68 6f72 697a 6f6e 7461 6c5f  self.horizontal_
-00016630: 7363 726f 6c6c 203d 2073 656c 662e 6765  scroll = self.ge
-00016640: 745f 686f 7269 7a6f 6e74 616c 5f73 6372  t_horizontal_scr
-00016650: 6f6c 6c28 7365 6c66 290a 2020 2020 2020  oll(self).      
-00016660: 2020 2020 2020 6173 7365 7274 2069 7369        assert isi
-00016670: 6e73 7461 6e63 6528 7365 6c66 2e68 6f72  nstance(self.hor
-00016680: 697a 6f6e 7461 6c5f 7363 726f 6c6c 2c20  izontal_scroll, 
-00016690: 696e 7429 0a0a 2020 2020 2020 2020 2320  int)..        # 
-000166a0: 5570 6461 7465 2068 6f72 697a 6f6e 7461  Update horizonta
-000166b0: 6c2f 7665 7274 6963 616c 2073 6372 6f6c  l/vertical scrol
-000166c0: 6c20 746f 206d 616b 6520 7375 7265 2074  l to make sure t
-000166d0: 6861 7420 7468 6520 6375 7273 6f72 0a20  hat the cursor. 
-000166e0: 2020 2020 2020 2023 2072 656d 6169 6e73         # remains
-000166f0: 2076 6973 6962 6c65 2e0a 2020 2020 2020   visible..      
-00016700: 2020 6f66 6673 6574 7320 3d20 7365 6c66    offsets = self
-00016710: 2e73 6372 6f6c 6c5f 6f66 6673 6574 730a  .scroll_offsets.
-00016720: 0a20 2020 2020 2020 2073 656c 662e 7665  .        self.ve
-00016730: 7274 6963 616c 5f73 6372 6f6c 6c20 3d20  rtical_scroll = 
-00016740: 646f 5f73 6372 6f6c 6c28 0a20 2020 2020  do_scroll(.     
-00016750: 2020 2020 2020 2063 7572 7265 6e74 5f73         current_s
-00016760: 6372 6f6c 6c3d 7365 6c66 2e76 6572 7469  croll=self.verti
-00016770: 6361 6c5f 7363 726f 6c6c 2c0a 2020 2020  cal_scroll,.    
-00016780: 2020 2020 2020 2020 7363 726f 6c6c 5f6f          scroll_o
-00016790: 6666 7365 745f 7374 6172 743d 6f66 6673  ffset_start=offs
-000167a0: 6574 732e 746f 702c 0a20 2020 2020 2020  ets.top,.       
-000167b0: 2020 2020 2073 6372 6f6c 6c5f 6f66 6673       scroll_offs
-000167c0: 6574 5f65 6e64 3d6f 6666 7365 7473 2e62  et_end=offsets.b
-000167d0: 6f74 746f 6d2c 0a20 2020 2020 2020 2020  ottom,.         
-000167e0: 2020 2063 7572 736f 725f 706f 733d 7569     cursor_pos=ui
-000167f0: 5f63 6f6e 7465 6e74 2e63 7572 736f 725f  _content.cursor_
-00016800: 706f 7369 7469 6f6e 2e79 2c0a 2020 2020  position.y,.    
-00016810: 2020 2020 2020 2020 7769 6e64 6f77 5f73          window_s
-00016820: 697a 653d 6865 6967 6874 2c0a 2020 2020  ize=height,.    
-00016830: 2020 2020 2020 2020 636f 6e74 656e 745f          content_
-00016840: 7369 7a65 3d75 695f 636f 6e74 656e 742e  size=ui_content.
-00016850: 6c69 6e65 5f63 6f75 6e74 2c0a 2020 2020  line_count,.    
-00016860: 2020 2020 290a 0a20 2020 2020 2020 2069      )..        i
-00016870: 6620 7365 6c66 2e67 6574 5f6c 696e 655f  f self.get_line_
-00016880: 7072 6566 6978 3a0a 2020 2020 2020 2020  prefix:.        
-00016890: 2020 2020 6375 7272 656e 745f 6c69 6e65      current_line
-000168a0: 5f70 7265 6669 785f 7769 6474 6820 3d20  _prefix_width = 
-000168b0: 6672 6167 6d65 6e74 5f6c 6973 745f 7769  fragment_list_wi
-000168c0: 6474 6828 0a20 2020 2020 2020 2020 2020  dth(.           
-000168d0: 2020 2020 2074 6f5f 666f 726d 6174 7465       to_formatte
-000168e0: 645f 7465 7874 2873 656c 662e 6765 745f  d_text(self.get_
-000168f0: 6c69 6e65 5f70 7265 6669 7828 7569 5f63  line_prefix(ui_c
-00016900: 6f6e 7465 6e74 2e63 7572 736f 725f 706f  ontent.cursor_po
-00016910: 7369 7469 6f6e 2e79 2c20 3029 290a 2020  sition.y, 0)).  
-00016920: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00016930: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00016940: 2020 2020 2020 6375 7272 656e 745f 6c69        current_li
-00016950: 6e65 5f70 7265 6669 785f 7769 6474 6820  ne_prefix_width 
-00016960: 3d20 300a 0a20 2020 2020 2020 2073 656c  = 0..        sel
-00016970: 662e 686f 7269 7a6f 6e74 616c 5f73 6372  f.horizontal_scr
-00016980: 6f6c 6c20 3d20 646f 5f73 6372 6f6c 6c28  oll = do_scroll(
-00016990: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
-000169a0: 7265 6e74 5f73 6372 6f6c 6c3d 7365 6c66  rent_scroll=self
-000169b0: 2e68 6f72 697a 6f6e 7461 6c5f 7363 726f  .horizontal_scro
-000169c0: 6c6c 2c0a 2020 2020 2020 2020 2020 2020  ll,.            
-000169d0: 7363 726f 6c6c 5f6f 6666 7365 745f 7374  scroll_offset_st
-000169e0: 6172 743d 6f66 6673 6574 732e 6c65 6674  art=offsets.left
-000169f0: 2c0a 2020 2020 2020 2020 2020 2020 7363  ,.            sc
-00016a00: 726f 6c6c 5f6f 6666 7365 745f 656e 643d  roll_offset_end=
-00016a10: 6f66 6673 6574 732e 7269 6768 742c 0a20  offsets.right,. 
-00016a20: 2020 2020 2020 2020 2020 2063 7572 736f             curso
-00016a30: 725f 706f 733d 6765 745f 6377 6964 7468  r_pos=get_cwidth
-00016a40: 2863 7572 7265 6e74 5f6c 696e 655f 7465  (current_line_te
-00016a50: 7874 5b3a 2075 695f 636f 6e74 656e 742e  xt[: ui_content.
-00016a60: 6375 7273 6f72 5f70 6f73 6974 696f 6e2e  cursor_position.
-00016a70: 785d 292c 0a20 2020 2020 2020 2020 2020  x]),.           
-00016a80: 2077 696e 646f 775f 7369 7a65 3d77 6964   window_size=wid
-00016a90: 7468 202d 2063 7572 7265 6e74 5f6c 696e  th - current_lin
-00016aa0: 655f 7072 6566 6978 5f77 6964 7468 2c0a  e_prefix_width,.
-00016ab0: 2020 2020 2020 2020 2020 2020 2320 5765              # We
-00016ac0: 2063 616e 206f 6e6c 7920 616e 616c 7973   can only analys
-00016ad0: 6520 7468 6520 6375 7272 656e 7420 6c69  e the current li
-00016ae0: 6e65 2e20 4361 6c63 756c 6174 696e 6720  ne. Calculating 
-00016af0: 7468 6520 7769 6474 6820 6f66 660a 2020  the width off.  
-00016b00: 2020 2020 2020 2020 2020 2320 616c 6c20            # all 
-00016b10: 7468 6520 6c69 6e65 7320 6973 2074 6f6f  the lines is too
-00016b20: 2065 7870 656e 7369 7665 2e0a 2020 2020   expensive..    
-00016b30: 2020 2020 2020 2020 636f 6e74 656e 745f          content_
-00016b40: 7369 7a65 3d6d 6178 280a 2020 2020 2020  size=max(.      
-00016b50: 2020 2020 2020 2020 2020 6765 745f 6377            get_cw
-00016b60: 6964 7468 2863 7572 7265 6e74 5f6c 696e  idth(current_lin
-00016b70: 655f 7465 7874 292c 2073 656c 662e 686f  e_text), self.ho
-00016b80: 7269 7a6f 6e74 616c 5f73 6372 6f6c 6c20  rizontal_scroll 
-00016b90: 2b20 7769 6474 680a 2020 2020 2020 2020  + width.        
-00016ba0: 2020 2020 292c 0a20 2020 2020 2020 2029      ),.        )
-00016bb0: 0a0a 2020 2020 6465 6620 5f6d 6f75 7365  ..    def _mouse
-00016bc0: 5f68 616e 646c 6572 2873 656c 662c 206d  _handler(self, m
-00016bd0: 6f75 7365 5f65 7665 6e74 3a20 4d6f 7573  ouse_event: Mous
-00016be0: 6545 7665 6e74 2920 2d3e 204e 6f6e 653a  eEvent) -> None:
-00016bf0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00016c00: 2020 2020 204d 6f75 7365 2068 616e 646c       Mouse handl
-00016c10: 6572 2e20 4361 6c6c 6564 2077 6865 6e20  er. Called when 
-00016c20: 7468 6520 5549 2063 6f6e 7472 6f6c 2064  the UI control d
-00016c30: 6f65 736e 2774 2068 616e 646c 6520 7468  oesn't handle th
-00016c40: 6973 0a20 2020 2020 2020 2070 6172 7469  is.        parti
-00016c50: 6375 6c61 7220 6576 656e 742e 0a20 2020  cular event..   
-00016c60: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00016c70: 2069 6620 6d6f 7573 655f 6576 656e 742e   if mouse_event.
-00016c80: 6576 656e 745f 7479 7065 203d 3d20 4d6f  event_type == Mo
-00016c90: 7573 6545 7665 6e74 5479 7065 2e53 4352  useEventType.SCR
-00016ca0: 4f4c 4c5f 444f 574e 3a0a 2020 2020 2020  OLL_DOWN:.      
-00016cb0: 2020 2020 2020 7365 6c66 2e5f 7363 726f        self._scro
-00016cc0: 6c6c 5f64 6f77 6e28 290a 2020 2020 2020  ll_down().      
-00016cd0: 2020 656c 6966 206d 6f75 7365 5f65 7665    elif mouse_eve
-00016ce0: 6e74 2e65 7665 6e74 5f74 7970 6520 3d3d  nt.event_type ==
-00016cf0: 204d 6f75 7365 4576 656e 7454 7970 652e   MouseEventType.
-00016d00: 5343 524f 4c4c 5f55 503a 0a20 2020 2020  SCROLL_UP:.     
-00016d10: 2020 2020 2020 2073 656c 662e 5f73 6372         self._scr
-00016d20: 6f6c 6c5f 7570 2829 0a0a 2020 2020 6465  oll_up()..    de
-00016d30: 6620 5f73 6372 6f6c 6c5f 646f 776e 2873  f _scroll_down(s
-00016d40: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
-00016d50: 2020 2020 2020 2253 6372 6f6c 6c20 7769        "Scroll wi
-00016d60: 6e64 6f77 2064 6f77 6e2e 220a 2020 2020  ndow down.".    
-00016d70: 2020 2020 696e 666f 203d 2073 656c 662e      info = self.
-00016d80: 7265 6e64 6572 5f69 6e66 6f0a 0a20 2020  render_info..   
-00016d90: 2020 2020 2069 6620 696e 666f 2069 7320       if info is 
-00016da0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00016db0: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
-00016dc0: 2020 6966 2073 656c 662e 7665 7274 6963    if self.vertic
-00016dd0: 616c 5f73 6372 6f6c 6c20 3c20 696e 666f  al_scroll < info
-00016de0: 2e63 6f6e 7465 6e74 5f68 6569 6768 7420  .content_height 
-00016df0: 2d20 696e 666f 2e77 696e 646f 775f 6865  - info.window_he
-00016e00: 6967 6874 3a0a 2020 2020 2020 2020 2020  ight:.          
-00016e10: 2020 6966 2069 6e66 6f2e 6375 7273 6f72    if info.cursor
-00016e20: 5f70 6f73 6974 696f 6e2e 7920 3c3d 2069  _position.y <= i
-00016e30: 6e66 6f2e 636f 6e66 6967 7572 6564 5f73  nfo.configured_s
-00016e40: 6372 6f6c 6c5f 6f66 6673 6574 732e 746f  croll_offsets.to
-00016e50: 703a 0a20 2020 2020 2020 2020 2020 2020  p:.             
-00016e60: 2020 2073 656c 662e 636f 6e74 656e 742e     self.content.
-00016e70: 6d6f 7665 5f63 7572 736f 725f 646f 776e  move_cursor_down
-00016e80: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-00016e90: 7365 6c66 2e76 6572 7469 6361 6c5f 7363  self.vertical_sc
-00016ea0: 726f 6c6c 202b 3d20 310a 0a20 2020 2064  roll += 1..    d
-00016eb0: 6566 205f 7363 726f 6c6c 5f75 7028 7365  ef _scroll_up(se
-00016ec0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-00016ed0: 2020 2020 2022 5363 726f 6c6c 2077 696e       "Scroll win
-00016ee0: 646f 7720 7570 2e22 0a20 2020 2020 2020  dow up.".       
-00016ef0: 2069 6e66 6f20 3d20 7365 6c66 2e72 656e   info = self.ren
-00016f00: 6465 725f 696e 666f 0a0a 2020 2020 2020  der_info..      
-00016f10: 2020 6966 2069 6e66 6f20 6973 204e 6f6e    if info is Non
-00016f20: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00016f30: 6574 7572 6e0a 0a20 2020 2020 2020 2069  eturn..        i
-00016f40: 6620 696e 666f 2e76 6572 7469 6361 6c5f  f info.vertical_
-00016f50: 7363 726f 6c6c 203e 2030 3a0a 2020 2020  scroll > 0:.    
-00016f60: 2020 2020 2020 2020 2320 544f 444f 3a20          # TODO: 
-00016f70: 6e6f 7420 656e 7469 7265 6c79 2063 6f72  not entirely cor
-00016f80: 7265 6374 2079 6574 2069 6e20 6361 7365  rect yet in case
-00016f90: 206f 6620 6c69 6e65 2077 7261 7070 696e   of line wrappin
-00016fa0: 6720 616e 6420 6c6f 6e67 206c 696e 6573  g and long lines
-00016fb0: 2e0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00016fc0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00016fd0: 2020 2069 6e66 6f2e 6375 7273 6f72 5f70     info.cursor_p
-00016fe0: 6f73 6974 696f 6e2e 790a 2020 2020 2020  osition.y.      
-00016ff0: 2020 2020 2020 2020 2020 3e3d 2069 6e66            >= inf
-00017000: 6f2e 7769 6e64 6f77 5f68 6569 6768 7420  o.window_height 
-00017010: 2d20 3120 2d20 696e 666f 2e63 6f6e 6669  - 1 - info.confi
-00017020: 6775 7265 645f 7363 726f 6c6c 5f6f 6666  gured_scroll_off
-00017030: 7365 7473 2e62 6f74 746f 6d0a 2020 2020  sets.bottom.    
-00017040: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-00017050: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00017060: 636f 6e74 656e 742e 6d6f 7665 5f63 7572  content.move_cur
-00017070: 736f 725f 7570 2829 0a0a 2020 2020 2020  sor_up()..      
-00017080: 2020 2020 2020 7365 6c66 2e76 6572 7469        self.verti
-00017090: 6361 6c5f 7363 726f 6c6c 202d 3d20 310a  cal_scroll -= 1.
-000170a0: 0a20 2020 2064 6566 2067 6574 5f6b 6579  .    def get_key
-000170b0: 5f62 696e 6469 6e67 7328 7365 6c66 2920  _bindings(self) 
-000170c0: 2d3e 204f 7074 696f 6e61 6c5b 4b65 7942  -> Optional[KeyB
-000170d0: 696e 6469 6e67 7342 6173 655d 3a0a 2020  indingsBase]:.  
-000170e0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000170f0: 662e 636f 6e74 656e 742e 6765 745f 6b65  f.content.get_ke
-00017100: 795f 6269 6e64 696e 6773 2829 0a0a 2020  y_bindings()..  
-00017110: 2020 6465 6620 6765 745f 6368 696c 6472    def get_childr
-00017120: 656e 2873 656c 6629 202d 3e20 4c69 7374  en(self) -> List
-00017130: 5b43 6f6e 7461 696e 6572 5d3a 0a20 2020  [Container]:.   
-00017140: 2020 2020 2072 6574 7572 6e20 5b5d 0a0a       return []..
-00017150: 0a63 6c61 7373 2043 6f6e 6469 7469 6f6e  .class Condition
-00017160: 616c 436f 6e74 6169 6e65 7228 436f 6e74  alContainer(Cont
-00017170: 6169 6e65 7229 3a0a 2020 2020 2222 220a  ainer):.    """.
-00017180: 2020 2020 5772 6170 7065 7220 6172 6f75      Wrapper arou
-00017190: 6e64 2061 6e79 206f 7468 6572 2063 6f6e  nd any other con
-000171a0: 7461 696e 6572 2074 6861 7420 6361 6e20  tainer that can 
-000171b0: 6368 616e 6765 2074 6865 2076 6973 6962  change the visib
-000171c0: 696c 6974 792e 2054 6865 0a20 2020 2072  ility. The.    r
-000171d0: 6563 6569 7665 6420 6066 696c 7465 7260  eceived `filter`
-000171e0: 2064 6574 6572 6d69 6e65 7320 7768 6574   determines whet
-000171f0: 6865 7220 7468 6520 6769 7665 6e20 636f  her the given co
-00017200: 6e74 6169 6e65 7220 7368 6f75 6c64 2062  ntainer should b
-00017210: 650a 2020 2020 6469 7370 6c61 7965 6420  e.    displayed 
-00017220: 6f72 206e 6f74 2e0a 0a20 2020 203a 7061  or not...    :pa
-00017230: 7261 6d20 636f 6e74 656e 743a 203a 636c  ram content: :cl
-00017240: 6173 733a 602e 436f 6e74 6169 6e65 7260  ass:`.Container`
-00017250: 2069 6e73 7461 6e63 652e 0a20 2020 203a   instance..    :
-00017260: 7061 7261 6d20 6669 6c74 6572 3a20 3a63  param filter: :c
-00017270: 6c61 7373 3a60 2e46 696c 7465 7260 2069  lass:`.Filter` i
-00017280: 6e73 7461 6e63 652e 0a20 2020 2022 2222  nstance..    """
-00017290: 0a0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-000172a0: 5f5f 2873 656c 662c 2063 6f6e 7465 6e74  __(self, content
-000172b0: 3a20 416e 7943 6f6e 7461 696e 6572 2c20  : AnyContainer, 
-000172c0: 6669 6c74 6572 3a20 4669 6c74 6572 4f72  filter: FilterOr
-000172d0: 426f 6f6c 2920 2d3e 204e 6f6e 653a 0a20  Bool) -> None:. 
-000172e0: 2020 2020 2020 2073 656c 662e 636f 6e74         self.cont
-000172f0: 656e 7420 3d20 746f 5f63 6f6e 7461 696e  ent = to_contain
-00017300: 6572 2863 6f6e 7465 6e74 290a 2020 2020  er(content).    
-00017310: 2020 2020 7365 6c66 2e66 696c 7465 7220      self.filter 
-00017320: 3d20 746f 5f66 696c 7465 7228 6669 6c74  = to_filter(filt
-00017330: 6572 290a 0a20 2020 2064 6566 205f 5f72  er)..    def __r
-00017340: 6570 725f 5f28 7365 6c66 2920 2d3e 2073  epr__(self) -> s
-00017350: 7472 3a0a 2020 2020 2020 2020 7265 7475  tr:.        retu
-00017360: 726e 2022 436f 6e64 6974 696f 6e61 6c43  rn "ConditionalC
-00017370: 6f6e 7461 696e 6572 2825 722c 2066 696c  ontainer(%r, fil
-00017380: 7465 723d 2572 2922 2025 2028 7365 6c66  ter=%r)" % (self
-00017390: 2e63 6f6e 7465 6e74 2c20 7365 6c66 2e66  .content, self.f
-000173a0: 696c 7465 7229 0a0a 2020 2020 6465 6620  ilter)..    def 
-000173b0: 7265 7365 7428 7365 6c66 2920 2d3e 204e  reset(self) -> N
-000173c0: 6f6e 653a 0a20 2020 2020 2020 2073 656c  one:.        sel
-000173d0: 662e 636f 6e74 656e 742e 7265 7365 7428  f.content.reset(
-000173e0: 290a 0a20 2020 2064 6566 2070 7265 6665  )..    def prefe
-000173f0: 7272 6564 5f77 6964 7468 2873 656c 662c  rred_width(self,
-00017400: 206d 6178 5f61 7661 696c 6162 6c65 5f77   max_available_w
-00017410: 6964 7468 3a20 696e 7429 202d 3e20 4469  idth: int) -> Di
-00017420: 6d65 6e73 696f 6e3a 0a20 2020 2020 2020  mension:.       
-00017430: 2069 6620 7365 6c66 2e66 696c 7465 7228   if self.filter(
-00017440: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00017450: 6574 7572 6e20 7365 6c66 2e63 6f6e 7465  eturn self.conte
-00017460: 6e74 2e70 7265 6665 7272 6564 5f77 6964  nt.preferred_wid
-00017470: 7468 286d 6178 5f61 7661 696c 6162 6c65  th(max_available
-00017480: 5f77 6964 7468 290a 2020 2020 2020 2020  _width).        
-00017490: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000174a0: 2020 7265 7475 726e 2044 696d 656e 7369    return Dimensi
-000174b0: 6f6e 2e7a 6572 6f28 290a 0a20 2020 2064  on.zero()..    d
-000174c0: 6566 2070 7265 6665 7272 6564 5f68 6569  ef preferred_hei
-000174d0: 6768 7428 7365 6c66 2c20 7769 6474 683a  ght(self, width:
-000174e0: 2069 6e74 2c20 6d61 785f 6176 6169 6c61   int, max_availa
-000174f0: 626c 655f 6865 6967 6874 3a20 696e 7429  ble_height: int)
-00017500: 202d 3e20 4469 6d65 6e73 696f 6e3a 0a20   -> Dimension:. 
-00017510: 2020 2020 2020 2069 6620 7365 6c66 2e66         if self.f
-00017520: 696c 7465 7228 293a 0a20 2020 2020 2020  ilter():.       
-00017530: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00017540: 2e63 6f6e 7465 6e74 2e70 7265 6665 7272  .content.preferr
-00017550: 6564 5f68 6569 6768 7428 7769 6474 682c  ed_height(width,
-00017560: 206d 6178 5f61 7661 696c 6162 6c65 5f68   max_available_h
-00017570: 6569 6768 7429 0a20 2020 2020 2020 2065  eight).        e
-00017580: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00017590: 2072 6574 7572 6e20 4469 6d65 6e73 696f   return Dimensio
-000175a0: 6e2e 7a65 726f 2829 0a0a 2020 2020 6465  n.zero()..    de
-000175b0: 6620 7772 6974 655f 746f 5f73 6372 6565  f write_to_scree
-000175c0: 6e28 0a20 2020 2020 2020 2073 656c 662c  n(.        self,
-000175d0: 0a20 2020 2020 2020 2073 6372 6565 6e3a  .        screen:
-000175e0: 2053 6372 6565 6e2c 0a20 2020 2020 2020   Screen,.       
-000175f0: 206d 6f75 7365 5f68 616e 646c 6572 733a   mouse_handlers:
-00017600: 204d 6f75 7365 4861 6e64 6c65 7273 2c0a   MouseHandlers,.
-00017610: 2020 2020 2020 2020 7772 6974 655f 706f          write_po
-00017620: 7369 7469 6f6e 3a20 5772 6974 6550 6f73  sition: WritePos
-00017630: 6974 696f 6e2c 0a20 2020 2020 2020 2070  ition,.        p
-00017640: 6172 656e 745f 7374 796c 653a 2073 7472  arent_style: str
-00017650: 2c0a 2020 2020 2020 2020 6572 6173 655f  ,.        erase_
-00017660: 6267 3a20 626f 6f6c 2c0a 2020 2020 2020  bg: bool,.      
-00017670: 2020 7a5f 696e 6465 783a 204f 7074 696f    z_index: Optio
-00017680: 6e61 6c5b 696e 745d 2c0a 2020 2020 2920  nal[int],.    ) 
-00017690: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-000176a0: 2069 6620 7365 6c66 2e66 696c 7465 7228   if self.filter(
-000176b0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-000176c0: 6574 7572 6e20 7365 6c66 2e63 6f6e 7465  eturn self.conte
-000176d0: 6e74 2e77 7269 7465 5f74 6f5f 7363 7265  nt.write_to_scre
-000176e0: 656e 280a 2020 2020 2020 2020 2020 2020  en(.            
-000176f0: 2020 2020 7363 7265 656e 2c20 6d6f 7573      screen, mous
-00017700: 655f 6861 6e64 6c65 7273 2c20 7772 6974  e_handlers, writ
-00017710: 655f 706f 7369 7469 6f6e 2c20 7061 7265  e_position, pare
-00017720: 6e74 5f73 7479 6c65 2c20 6572 6173 655f  nt_style, erase_
-00017730: 6267 2c20 7a5f 696e 6465 780a 2020 2020  bg, z_index.    
-00017740: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-00017750: 6566 2067 6574 5f63 6869 6c64 7265 6e28  ef get_children(
-00017760: 7365 6c66 2920 2d3e 204c 6973 745b 436f  self) -> List[Co
-00017770: 6e74 6169 6e65 725d 3a0a 2020 2020 2020  ntainer]:.      
-00017780: 2020 7265 7475 726e 205b 7365 6c66 2e63    return [self.c
-00017790: 6f6e 7465 6e74 5d0a 0a0a 636c 6173 7320  ontent]...class 
-000177a0: 4479 6e61 6d69 6343 6f6e 7461 696e 6572  DynamicContainer
-000177b0: 2843 6f6e 7461 696e 6572 293a 0a20 2020  (Container):.   
-000177c0: 2022 2222 0a20 2020 2043 6f6e 7461 696e   """.    Contain
-000177d0: 6572 2063 6c61 7373 2074 6861 7420 6479  er class that dy
-000177e0: 6e61 6d69 6361 6c6c 7920 7265 7475 726e  namically return
-000177f0: 7320 616e 7920 436f 6e74 6169 6e65 722e  s any Container.
-00017800: 0a0a 2020 2020 3a70 6172 616d 2067 6574  ..    :param get
-00017810: 5f63 6f6e 7461 696e 6572 3a20 4361 6c6c  _container: Call
-00017820: 6162 6c65 2074 6861 7420 7265 7475 726e  able that return
-00017830: 7320 6120 3a63 6c61 7373 3a60 2e43 6f6e  s a :class:`.Con
-00017840: 7461 696e 6572 6020 696e 7374 616e 6365  tainer` instance
-00017850: 0a20 2020 2020 2020 206f 7220 616e 7920  .        or any 
-00017860: 7769 6467 6574 2077 6974 6820 6120 6060  widget with a ``
-00017870: 5f5f 7074 5f63 6f6e 7461 696e 6572 5f5f  __pt_container__
-00017880: 6060 206d 6574 686f 642e 0a20 2020 2022  `` method..    "
-00017890: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
-000178a0: 6974 5f5f 2873 656c 662c 2067 6574 5f63  it__(self, get_c
-000178b0: 6f6e 7461 696e 6572 3a20 4361 6c6c 6162  ontainer: Callab
-000178c0: 6c65 5b5b 5d2c 2041 6e79 436f 6e74 6169  le[[], AnyContai
-000178d0: 6e65 725d 2920 2d3e 204e 6f6e 653a 0a20  ner]) -> None:. 
-000178e0: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
-000178f0: 636f 6e74 6169 6e65 7220 3d20 6765 745f  container = get_
-00017900: 636f 6e74 6169 6e65 720a 0a20 2020 2064  container..    d
-00017910: 6566 205f 6765 745f 636f 6e74 6169 6e65  ef _get_containe
-00017920: 7228 7365 6c66 2920 2d3e 2043 6f6e 7461  r(self) -> Conta
-00017930: 696e 6572 3a0a 2020 2020 2020 2020 2222  iner:.        ""
-00017940: 220a 2020 2020 2020 2020 5265 7475 726e  ".        Return
-00017950: 2074 6865 2063 7572 7265 6e74 2063 6f6e   the current con
-00017960: 7461 696e 6572 206f 626a 6563 742e 0a0a  tainer object...
-00017970: 2020 2020 2020 2020 5765 2063 616c 6c20          We call 
-00017980: 6074 6f5f 636f 6e74 6169 6e65 7260 2c20  `to_container`, 
-00017990: 6265 6361 7573 6520 6067 6574 5f63 6f6e  because `get_con
-000179a0: 7461 696e 6572 6020 6361 6e20 616c 736f  tainer` can also
-000179b0: 2072 6574 7572 6e20 610a 2020 2020 2020   return a.      
-000179c0: 2020 7769 6467 6574 2077 6974 6820 6120    widget with a 
-000179d0: 6060 5f5f 7074 5f63 6f6e 7461 696e 6572  ``__pt_container
-000179e0: 5f5f 6060 206d 6574 686f 642e 0a20 2020  __`` method..   
-000179f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00017a00: 206f 626a 203d 2073 656c 662e 6765 745f   obj = self.get_
-00017a10: 636f 6e74 6169 6e65 7228 290a 2020 2020  container().    
-00017a20: 2020 2020 7265 7475 726e 2074 6f5f 636f      return to_co
-00017a30: 6e74 6169 6e65 7228 6f62 6a29 0a0a 2020  ntainer(obj)..  
-00017a40: 2020 6465 6620 7265 7365 7428 7365 6c66    def reset(self
-00017a50: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00017a60: 2020 2073 656c 662e 5f67 6574 5f63 6f6e     self._get_con
-00017a70: 7461 696e 6572 2829 2e72 6573 6574 2829  tainer().reset()
-00017a80: 0a0a 2020 2020 6465 6620 7072 6566 6572  ..    def prefer
-00017a90: 7265 645f 7769 6474 6828 7365 6c66 2c20  red_width(self, 
-00017aa0: 6d61 785f 6176 6169 6c61 626c 655f 7769  max_available_wi
-00017ab0: 6474 683a 2069 6e74 2920 2d3e 2044 696d  dth: int) -> Dim
-00017ac0: 656e 7369 6f6e 3a0a 2020 2020 2020 2020  ension:.        
-00017ad0: 7265 7475 726e 2073 656c 662e 5f67 6574  return self._get
-00017ae0: 5f63 6f6e 7461 696e 6572 2829 2e70 7265  _container().pre
-00017af0: 6665 7272 6564 5f77 6964 7468 286d 6178  ferred_width(max
-00017b00: 5f61 7661 696c 6162 6c65 5f77 6964 7468  _available_width
-00017b10: 290a 0a20 2020 2064 6566 2070 7265 6665  )..    def prefe
-00017b20: 7272 6564 5f68 6569 6768 7428 7365 6c66  rred_height(self
-00017b30: 2c20 7769 6474 683a 2069 6e74 2c20 6d61  , width: int, ma
-00017b40: 785f 6176 6169 6c61 626c 655f 6865 6967  x_available_heig
-00017b50: 6874 3a20 696e 7429 202d 3e20 4469 6d65  ht: int) -> Dime
-00017b60: 6e73 696f 6e3a 0a20 2020 2020 2020 2072  nsion:.        r
-00017b70: 6574 7572 6e20 7365 6c66 2e5f 6765 745f  eturn self._get_
-00017b80: 636f 6e74 6169 6e65 7228 292e 7072 6566  container().pref
-00017b90: 6572 7265 645f 6865 6967 6874 2877 6964  erred_height(wid
-00017ba0: 7468 2c20 6d61 785f 6176 6169 6c61 626c  th, max_availabl
-00017bb0: 655f 6865 6967 6874 290a 0a20 2020 2064  e_height)..    d
-00017bc0: 6566 2077 7269 7465 5f74 6f5f 7363 7265  ef write_to_scre
-00017bd0: 656e 280a 2020 2020 2020 2020 7365 6c66  en(.        self
-00017be0: 2c0a 2020 2020 2020 2020 7363 7265 656e  ,.        screen
-00017bf0: 3a20 5363 7265 656e 2c0a 2020 2020 2020  : Screen,.      
-00017c00: 2020 6d6f 7573 655f 6861 6e64 6c65 7273    mouse_handlers
-00017c10: 3a20 4d6f 7573 6548 616e 646c 6572 732c  : MouseHandlers,
-00017c20: 0a20 2020 2020 2020 2077 7269 7465 5f70  .        write_p
-00017c30: 6f73 6974 696f 6e3a 2057 7269 7465 506f  osition: WritePo
-00017c40: 7369 7469 6f6e 2c0a 2020 2020 2020 2020  sition,.        
-00017c50: 7061 7265 6e74 5f73 7479 6c65 3a20 7374  parent_style: st
-00017c60: 722c 0a20 2020 2020 2020 2065 7261 7365  r,.        erase
-00017c70: 5f62 673a 2062 6f6f 6c2c 0a20 2020 2020  _bg: bool,.     
-00017c80: 2020 207a 5f69 6e64 6578 3a20 4f70 7469     z_index: Opti
-00017c90: 6f6e 616c 5b69 6e74 5d2c 0a20 2020 2029  onal[int],.    )
-00017ca0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00017cb0: 2020 7365 6c66 2e5f 6765 745f 636f 6e74    self._get_cont
-00017cc0: 6169 6e65 7228 292e 7772 6974 655f 746f  ainer().write_to
-00017cd0: 5f73 6372 6565 6e28 0a20 2020 2020 2020  _screen(.       
-00017ce0: 2020 2020 2073 6372 6565 6e2c 206d 6f75       screen, mou
-00017cf0: 7365 5f68 616e 646c 6572 732c 2077 7269  se_handlers, wri
-00017d00: 7465 5f70 6f73 6974 696f 6e2c 2070 6172  te_position, par
-00017d10: 656e 745f 7374 796c 652c 2065 7261 7365  ent_style, erase
-00017d20: 5f62 672c 207a 5f69 6e64 6578 0a20 2020  _bg, z_index.   
-00017d30: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00017d40: 6973 5f6d 6f64 616c 2873 656c 6629 202d  is_modal(self) -
-00017d50: 3e20 626f 6f6c 3a0a 2020 2020 2020 2020  > bool:.        
-00017d60: 7265 7475 726e 2046 616c 7365 0a0a 2020  return False..  
-00017d70: 2020 6465 6620 6765 745f 6b65 795f 6269    def get_key_bi
-00017d80: 6e64 696e 6773 2873 656c 6629 202d 3e20  ndings(self) -> 
-00017d90: 4f70 7469 6f6e 616c 5b4b 6579 4269 6e64  Optional[KeyBind
-00017da0: 696e 6773 4261 7365 5d3a 0a20 2020 2020  ingsBase]:.     
-00017db0: 2020 2023 204b 6579 2062 696e 6469 6e67     # Key binding
-00017dc0: 7320 7769 6c6c 2062 6520 636f 6c6c 6563  s will be collec
-00017dd0: 7465 6420 7768 656e 2060 6c61 796f 7574  ted when `layout
-00017de0: 2e77 616c 6b28 2960 2066 696e 6473 2074  .walk()` finds t
-00017df0: 6865 2063 6869 6c64 0a20 2020 2020 2020  he child.       
-00017e00: 2023 2063 6f6e 7461 696e 6572 2e0a 2020   # container..  
-00017e10: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00017e20: 650a 0a20 2020 2064 6566 2067 6574 5f63  e..    def get_c
-00017e30: 6869 6c64 7265 6e28 7365 6c66 2920 2d3e  hildren(self) ->
-00017e40: 204c 6973 745b 436f 6e74 6169 6e65 725d   List[Container]
-00017e50: 3a0a 2020 2020 2020 2020 2320 4865 7265  :.        # Here
-00017e60: 2077 6520 6861 7665 2074 6f20 7265 7475   we have to retu
-00017e70: 726e 2074 6865 2063 7572 7265 6e74 2061  rn the current a
-00017e80: 6374 6976 6520 636f 6e74 6169 6e65 7220  ctive container 
-00017e90: 6974 7365 6c66 2c20 6e6f 7420 6974 730a  itself, not its.
-00017ea0: 2020 2020 2020 2020 2320 6368 696c 6472          # childr
-00017eb0: 656e 2e20 4f74 6865 7277 6973 652c 2077  en. Otherwise, w
-00017ec0: 6520 7275 6e20 696e 746f 2069 7373 7565  e run into issue
-00017ed0: 7320 7768 6572 6520 606c 6179 6f75 742e  s where `layout.
-00017ee0: 7761 6c6b 2829 6020 7769 6c6c 0a20 2020  walk()` will.   
-00017ef0: 2020 2020 2023 206e 6576 6572 2073 6565       # never see
-00017f00: 2061 6e20 6f62 6a65 6374 206f 6620 7479   an object of ty
-00017f10: 7065 2060 5769 6e64 6f77 6020 6966 2074  pe `Window` if t
-00017f20: 6869 7320 636f 6e74 6169 6e73 2061 2077  his contains a w
-00017f30: 696e 646f 772e 2057 650a 2020 2020 2020  indow. We.      
-00017f40: 2020 2320 6361 6e27 742f 7368 6f75 6c64    # can't/should
-00017f50: 6e27 7420 7072 6f78 7920 7468 6520 2269  n't proxy the "i
-00017f60: 7369 6e73 7461 6e63 6522 2063 6865 636b  sinstance" check
-00017f70: 2e0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00017f80: 205b 7365 6c66 2e5f 6765 745f 636f 6e74   [self._get_cont
-00017f90: 6169 6e65 7228 295d 0a0a 0a64 6566 2074  ainer()]...def t
-00017fa0: 6f5f 636f 6e74 6169 6e65 7228 636f 6e74  o_container(cont
-00017fb0: 6169 6e65 723a 2041 6e79 436f 6e74 6169  ainer: AnyContai
-00017fc0: 6e65 7229 202d 3e20 436f 6e74 6169 6e65  ner) -> Containe
-00017fd0: 723a 0a20 2020 2022 2222 0a20 2020 204d  r:.    """.    M
-00017fe0: 616b 6520 7375 7265 2074 6861 7420 7468  ake sure that th
-00017ff0: 6520 6769 7665 6e20 6f62 6a65 6374 2069  e given object i
-00018000: 7320 6120 3a63 6c61 7373 3a60 2e43 6f6e  s a :class:`.Con
-00018010: 7461 696e 6572 602e 0a20 2020 2022 2222  tainer`..    """
-00018020: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-00018030: 6365 2863 6f6e 7461 696e 6572 2c20 436f  ce(container, Co
-00018040: 6e74 6169 6e65 7229 3a0a 2020 2020 2020  ntainer):.      
-00018050: 2020 7265 7475 726e 2063 6f6e 7461 696e    return contain
-00018060: 6572 0a20 2020 2065 6c69 6620 6861 7361  er.    elif hasa
-00018070: 7474 7228 636f 6e74 6169 6e65 722c 2022  ttr(container, "
-00018080: 5f5f 7074 5f63 6f6e 7461 696e 6572 5f5f  __pt_container__
-00018090: 2229 3a0a 2020 2020 2020 2020 7265 7475  "):.        retu
-000180a0: 726e 2074 6f5f 636f 6e74 6169 6e65 7228  rn to_container(
-000180b0: 636f 6e74 6169 6e65 722e 5f5f 7074 5f63  container.__pt_c
-000180c0: 6f6e 7461 696e 6572 5f5f 2829 290a 2020  ontainer__()).  
-000180d0: 2020 656c 7365 3a0a 0a20 2020 2020 2020    else:..       
-000180e0: 2072 6169 7365 2065 7272 6f72 732e 5573   raise errors.Us
-000180f0: 6167 6545 7272 6f72 2822 5c6e 2025 7220  ageError("\n %r 
-00018100: 6973 204e 4f54 2061 2063 6f6e 7461 696e  is NOT a contain
-00018110: 6572 206f 626a 6563 742e 5c6e 2043 6865  er object.\n Che
-00018120: 636b 2074 6865 2064 6f63 756d 656e 7461  ck the documenta
-00018130: 7469 6f6e 2066 6f72 206d 6974 6967 6174  tion for mitigat
-00018140: 696f 6e20 7374 6570 732e 5c6e 5c6e 2068  ion steps.\n\n h
-00018150: 7474 7073 3a2f 2f71 756f 2e72 6561 6474  ttps://quo.readt
-00018160: 6865 646f 6373 2e69 6f2f 656e 2f6c 6174  hedocs.io/en/lat
-00018170: 6573 7422 2025 2028 636f 6e74 6169 6e65  est" % (containe
-00018180: 7229 290a 0a0a 6465 6620 746f 5f77 696e  r))...def to_win
-00018190: 646f 7728 636f 6e74 6169 6e65 723a 2041  dow(container: A
-000181a0: 6e79 436f 6e74 6169 6e65 7229 202d 3e20  nyContainer) -> 
-000181b0: 5769 6e64 6f77 3a0a 2020 2020 2222 220a  Window:.    """.
-000181c0: 2020 2020 4d61 6b65 2073 7572 6520 7468      Make sure th
-000181d0: 6174 2074 6865 2067 6976 656e 2061 7267  at the given arg
-000181e0: 756d 656e 7420 6973 2061 203a 636c 6173  ument is a :clas
-000181f0: 733a 602e 5769 6e64 6f77 602e 0a20 2020  s:`.Window`..   
-00018200: 2022 2222 0a20 2020 2069 6620 6973 696e   """.    if isin
-00018210: 7374 616e 6365 2863 6f6e 7461 696e 6572  stance(container
-00018220: 2c20 5769 6e64 6f77 293a 0a20 2020 2020  , Window):.     
-00018230: 2020 2072 6574 7572 6e20 636f 6e74 6169     return contai
-00018240: 6e65 720a 2020 2020 656c 6966 2068 6173  ner.    elif has
-00018250: 6174 7472 2863 6f6e 7461 696e 6572 2c20  attr(container, 
-00018260: 225f 5f70 745f 636f 6e74 6169 6e65 725f  "__pt_container_
-00018270: 5f22 293a 0a20 2020 2020 2020 2072 6574  _"):.        ret
-00018280: 7572 6e20 746f 5f77 696e 646f 7728 6361  urn to_window(ca
-00018290: 7374 2822 4d61 6769 6343 6f6e 7461 696e  st("MagicContain
-000182a0: 6572 222c 2063 6f6e 7461 696e 6572 292e  er", container).
-000182b0: 5f5f 7074 5f63 6f6e 7461 696e 6572 5f5f  __pt_container__
-000182c0: 2829 290a 2020 2020 656c 7365 3a0a 2020  ()).    else:.  
-000182d0: 2020 2020 2020 7261 6973 6520 6572 726f        raise erro
-000182e0: 7273 2e55 7361 6765 4572 726f 7228 225c  rs.UsageError("\
-000182f0: 6ee2 9aa0 efb8 8f20 4e6f 7420 6120 5769  n...... Not a Wi
-00018300: 6e64 6f77 206f 626a 6563 743a 2025 722e  ndow object: %r.
-00018310: 2220 2520 2863 6f6e 7461 696e 6572 2c29  " % (container,)
-00018320: 290a 0a0a 6465 6620 6973 5f63 6f6e 7461  )...def is_conta
-00018330: 696e 6572 2876 616c 7565 3a20 6f62 6a65  iner(value: obje
-00018340: 6374 2920 2d3e 2062 6f6f 6c3a 0a20 2020  ct) -> bool:.   
-00018350: 2022 2222 0a20 2020 2043 6865 636b 7320   """.    Checks 
-00018360: 7768 6574 6865 7220 7468 6520 6769 7665  whether the give
-00018370: 6e20 7661 6c75 6520 6973 2061 2063 6f6e  n value is a con
-00018380: 7461 696e 6572 206f 626a 6563 740a 2020  tainer object.  
-00018390: 2020 2866 6f72 2075 7365 2069 6e20 6173    (for use in as
-000183a0: 7365 7274 2073 7461 7465 6d65 6e74 7329  sert statements)
-000183b0: 2e0a 2020 2020 2222 220a 2020 2020 6966  ..    """.    if
-000183c0: 2069 7369 6e73 7461 6e63 6528 7661 6c75   isinstance(valu
-000183d0: 652c 2043 6f6e 7461 696e 6572 293a 0a20  e, Container):. 
-000183e0: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-000183f0: 7565 0a20 2020 2069 6620 6861 7361 7474  ue.    if hasatt
-00018400: 7228 7661 6c75 652c 2022 5f5f 7074 5f63  r(value, "__pt_c
-00018410: 6f6e 7461 696e 6572 5f5f 2229 3a0a 2020  ontainer__"):.  
-00018420: 2020 2020 2020 7265 7475 726e 2069 735f        return is_
-00018430: 636f 6e74 6169 6e65 7228 6361 7374 2822  container(cast("
-00018440: 4d61 6769 6343 6f6e 7461 696e 6572 222c  MagicContainer",
-00018450: 2076 616c 7565 292e 5f5f 7074 5f63 6f6e   value).__pt_con
-00018460: 7461 696e 6572 5f5f 2829 290a 2020 2020  tainer__()).    
-00018470: 7265 7475 726e 2046 616c 7365 0a         return False.
+000152e0: 7072 6576 5f6c 696e 656e 6f20 3d20 6c69  prev_lineno = li
+000152f0: 6e65 6e6f 0a20 2020 2020 2020 2020 2020  neno.           
+00015300: 2072 6574 7572 6e20 300a 0a20 2020 2020   return 0..     
+00015310: 2020 2064 6566 2067 6574 5f6d 6178 5f76     def get_max_v
+00015320: 6572 7469 6361 6c5f 7363 726f 6c6c 2829  ertical_scroll()
+00015330: 202d 3e20 696e 743a 0a20 2020 2020 2020   -> int:.       
+00015340: 2020 2020 2023 204d 616b 6520 7375 7265       # Make sure
+00015350: 2074 6861 7420 7468 6520 6375 7273 6f72   that the cursor
+00015360: 206c 696e 6520 6973 206e 6f74 2061 626f   line is not abo
+00015370: 7665 2074 6865 2074 6f70 2e0a 2020 2020  ve the top..    
+00015380: 2020 2020 2020 2020 7072 6576 5f6c 696e          prev_lin
+00015390: 656e 6f20 3d20 7569 5f63 6f6e 7465 6e74  eno = ui_content
+000153a0: 2e63 7572 736f 725f 706f 7369 7469 6f6e  .cursor_position
+000153b0: 2e79 0a20 2020 2020 2020 2020 2020 2075  .y.            u
+000153c0: 7365 645f 6865 6967 6874 203d 2030 0a0a  sed_height = 0..
+000153d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000153e0: 6c69 6e65 6e6f 2069 6e20 7261 6e67 6528  lineno in range(
+000153f0: 7569 5f63 6f6e 7465 6e74 2e63 7572 736f  ui_content.curso
+00015400: 725f 706f 7369 7469 6f6e 2e79 202d 2031  r_position.y - 1
+00015410: 2c20 2d31 2c20 2d31 293a 0a20 2020 2020  , -1, -1):.     
+00015420: 2020 2020 2020 2020 2020 2075 7365 645f             used_
+00015430: 6865 6967 6874 202b 3d20 6765 745f 6c69  height += get_li
+00015440: 6e65 5f68 6569 6768 7428 6c69 6e65 6e6f  ne_height(lineno
+00015450: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00015460: 2020 2069 6620 7573 6564 5f68 6569 6768     if used_heigh
+00015470: 7420 3e20 7363 726f 6c6c 5f6f 6666 7365  t > scroll_offse
+00015480: 7473 5f74 6f70 3a0a 2020 2020 2020 2020  ts_top:.        
+00015490: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000154a0: 726e 2070 7265 765f 6c69 6e65 6e6f 0a20  rn prev_lineno. 
+000154b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000154c0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000154d0: 2020 2020 2020 2020 2070 7265 765f 6c69           prev_li
+000154e0: 6e65 6e6f 203d 206c 696e 656e 6f0a 2020  neno = lineno.  
+000154f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00015500: 2070 7265 765f 6c69 6e65 6e6f 0a0a 2020   prev_lineno..  
+00015510: 2020 2020 2020 6465 6620 6765 745f 746f        def get_to
+00015520: 706d 6f73 745f 7669 7369 626c 6528 2920  pmost_visible() 
+00015530: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
+00015540: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00015550: 2020 2020 4361 6c63 756c 6174 6520 7468      Calculate th
+00015560: 6520 7570 7065 7220 6d6f 7374 206c 696e  e upper most lin
+00015570: 6520 7468 6174 2063 616e 2062 6520 7669  e that can be vi
+00015580: 7369 626c 652c 2077 6869 6c65 2074 6865  sible, while the
+00015590: 2062 6f74 746f 6d0a 2020 2020 2020 2020   bottom.        
+000155a0: 2020 2020 6973 2073 7469 6c6c 2076 6973      is still vis
+000155b0: 6962 6c65 2e20 5765 2073 686f 756c 6420  ible. We should 
+000155c0: 6e6f 7420 616c 6c6f 7720 7363 726f 6c6c  not allow scroll
+000155d0: 206d 6f72 6520 7468 616e 2074 6869 7320   more than this 
+000155e0: 6966 0a20 2020 2020 2020 2020 2020 2060  if.            `
+000155f0: 616c 6c6f 775f 7363 726f 6c6c 5f62 6579  allow_scroll_bey
+00015600: 6f6e 645f 626f 7474 6f6d 6020 6973 2066  ond_bottom` is f
+00015610: 616c 7365 2e0a 2020 2020 2020 2020 2020  alse..          
+00015620: 2020 2222 220a 2020 2020 2020 2020 2020    """.          
+00015630: 2020 7072 6576 5f6c 696e 656e 6f20 3d20    prev_lineno = 
+00015640: 7569 5f63 6f6e 7465 6e74 2e6c 696e 655f  ui_content.line_
+00015650: 636f 756e 7420 2d20 310a 2020 2020 2020  count - 1.      
+00015660: 2020 2020 2020 7573 6564 5f68 6569 6768        used_heigh
+00015670: 7420 3d20 300a 2020 2020 2020 2020 2020  t = 0.          
+00015680: 2020 666f 7220 6c69 6e65 6e6f 2069 6e20    for lineno in 
+00015690: 7261 6e67 6528 7569 5f63 6f6e 7465 6e74  range(ui_content
+000156a0: 2e6c 696e 655f 636f 756e 7420 2d20 312c  .line_count - 1,
+000156b0: 202d 312c 202d 3129 3a0a 2020 2020 2020   -1, -1):.      
+000156c0: 2020 2020 2020 2020 2020 7573 6564 5f68            used_h
+000156d0: 6569 6768 7420 2b3d 2067 6574 5f6c 696e  eight += get_lin
+000156e0: 655f 6865 6967 6874 286c 696e 656e 6f29  e_height(lineno)
+000156f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015700: 2069 6620 7573 6564 5f68 6569 6768 7420   if used_height 
+00015710: 3e20 6865 6967 6874 3a0a 2020 2020 2020  > height:.      
+00015720: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00015730: 7475 726e 2070 7265 765f 6c69 6e65 6e6f  turn prev_lineno
+00015740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015750: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00015760: 2020 2020 2020 2020 2020 2070 7265 765f             prev_
+00015770: 6c69 6e65 6e6f 203d 206c 696e 656e 6f0a  lineno = lineno.
+00015780: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00015790: 726e 2070 7265 765f 6c69 6e65 6e6f 0a0a  rn prev_lineno..
+000157a0: 2020 2020 2020 2020 2320 5363 726f 6c6c          # Scroll
+000157b0: 2076 6572 7469 6361 6c6c 792e 2028 4d61   vertically. (Ma
+000157c0: 6b65 2073 7572 6520 7468 6174 2074 6865  ke sure that the
+000157d0: 2077 686f 6c65 206c 696e 6520 7768 6963   whole line whic
+000157e0: 6820 636f 6e74 6169 6e73 2074 6865 0a20  h contains the. 
+000157f0: 2020 2020 2020 2023 2063 7572 736f 7220         # cursor 
+00015800: 6973 2076 6973 6962 6c65 2e0a 2020 2020  is visible..    
+00015810: 2020 2020 746f 706d 6f73 745f 7669 7369      topmost_visi
+00015820: 626c 6520 3d20 6765 745f 746f 706d 6f73  ble = get_topmos
+00015830: 745f 7669 7369 626c 6528 290a 0a20 2020  t_visible()..   
+00015840: 2020 2020 2023 204e 6f74 653a 2074 6865       # Note: the
+00015850: 2060 6d69 6e28 746f 706d 6f73 745f 7669   `min(topmost_vi
+00015860: 7369 626c 652c 202e 2e2e 2960 2069 7320  sible, ...)` is 
+00015870: 746f 206d 616b 6520 7375 7265 2074 6861  to make sure tha
+00015880: 7420 7765 0a20 2020 2020 2020 2023 2064  t we.        # d
+00015890: 6f6e 2774 2072 6571 7569 7265 2073 6372  on't require scr
+000158a0: 6f6c 6c69 6e67 2075 7020 6265 6361 7573  olling up becaus
+000158b0: 6520 6f66 2074 6865 2062 6f74 746f 6d20  e of the bottom 
+000158c0: 7363 726f 6c6c 206f 6666 7365 742c 0a20  scroll offset,. 
+000158d0: 2020 2020 2020 2023 2077 6865 6e20 7765         # when we
+000158e0: 2061 7265 2061 7420 7468 6520 656e 6420   are at the end 
+000158f0: 6f66 2074 6865 2064 6f63 756d 656e 742e  of the document.
+00015900: 0a20 2020 2020 2020 2073 656c 662e 7665  .        self.ve
+00015910: 7274 6963 616c 5f73 6372 6f6c 6c20 3d20  rtical_scroll = 
+00015920: 6d61 7828 0a20 2020 2020 2020 2020 2020  max(.           
+00015930: 2073 656c 662e 7665 7274 6963 616c 5f73   self.vertical_s
+00015940: 6372 6f6c 6c2c 206d 696e 2874 6f70 6d6f  croll, min(topmo
+00015950: 7374 5f76 6973 6962 6c65 2c20 6765 745f  st_visible, get_
+00015960: 6d69 6e5f 7665 7274 6963 616c 5f73 6372  min_vertical_scr
+00015970: 6f6c 6c28 2929 0a20 2020 2020 2020 2029  oll()).        )
+00015980: 0a20 2020 2020 2020 2073 656c 662e 7665  .        self.ve
+00015990: 7274 6963 616c 5f73 6372 6f6c 6c20 3d20  rtical_scroll = 
+000159a0: 6d69 6e28 7365 6c66 2e76 6572 7469 6361  min(self.vertica
+000159b0: 6c5f 7363 726f 6c6c 2c20 6765 745f 6d61  l_scroll, get_ma
+000159c0: 785f 7665 7274 6963 616c 5f73 6372 6f6c  x_vertical_scrol
+000159d0: 6c28 2929 0a0a 2020 2020 2020 2020 2320  l())..        # 
+000159e0: 4469 7361 6c6c 6f77 2073 6372 6f6c 6c69  Disallow scrolli
+000159f0: 6e67 2062 6579 6f6e 6420 626f 7474 6f6d  ng beyond bottom
+00015a00: 3f0a 2020 2020 2020 2020 6966 206e 6f74  ?.        if not
+00015a10: 2073 656c 662e 616c 6c6f 775f 7363 726f   self.allow_scro
+00015a20: 6c6c 5f62 6579 6f6e 645f 626f 7474 6f6d  ll_beyond_bottom
+00015a30: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00015a40: 7365 6c66 2e76 6572 7469 6361 6c5f 7363  self.vertical_sc
+00015a50: 726f 6c6c 203d 206d 696e 2873 656c 662e  roll = min(self.
+00015a60: 7665 7274 6963 616c 5f73 6372 6f6c 6c2c  vertical_scroll,
+00015a70: 2074 6f70 6d6f 7374 5f76 6973 6962 6c65   topmost_visible
+00015a80: 290a 0a20 2020 2064 6566 205f 7363 726f  )..    def _scro
+00015a90: 6c6c 5f77 6974 686f 7574 5f6c 696e 6577  ll_without_linew
+00015aa0: 7261 7070 696e 6728 0a20 2020 2020 2020  rapping(.       
+00015ab0: 2073 656c 662c 2075 695f 636f 6e74 656e   self, ui_conten
+00015ac0: 743a 2055 4943 6f6e 7465 6e74 2c20 7769  t: UIContent, wi
+00015ad0: 6474 683a 2069 6e74 2c20 6865 6967 6874  dth: int, height
+00015ae0: 3a20 696e 740a 2020 2020 2920 2d3e 204e  : int.    ) -> N
+00015af0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00015b00: 0a20 2020 2020 2020 2053 6372 6f6c 6c20  .        Scroll 
+00015b10: 746f 206d 616b 6520 7375 7265 2074 6865  to make sure the
+00015b20: 2063 7572 736f 7220 706f 7369 7469 6f6e   cursor position
+00015b30: 2069 7320 7669 7369 626c 6520 616e 6420   is visible and 
+00015b40: 7468 6174 2077 6520 6d61 696e 7461 696e  that we maintain
+00015b50: 0a20 2020 2020 2020 2074 6865 2072 6571  .        the req
+00015b60: 7565 7374 6564 2073 6372 6f6c 6c20 6f66  uested scroll of
+00015b70: 6673 6574 2e0a 0a20 2020 2020 2020 2053  fset...        S
+00015b80: 6574 2060 7365 6c66 2e68 6f72 697a 6f6e  et `self.horizon
+00015b90: 7461 6c5f 7363 726f 6c6c 2f76 6572 7469  tal_scroll/verti
+00015ba0: 6361 6c5f 7363 726f 6c6c 602e 0a20 2020  cal_scroll`..   
+00015bb0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00015bc0: 2063 7572 736f 725f 706f 7369 7469 6f6e   cursor_position
+00015bd0: 203d 2075 695f 636f 6e74 656e 742e 6375   = ui_content.cu
+00015be0: 7273 6f72 5f70 6f73 6974 696f 6e20 6f72  rsor_position or
+00015bf0: 2050 6f69 6e74 2878 3d30 2c20 793d 3029   Point(x=0, y=0)
+00015c00: 0a0a 2020 2020 2020 2020 2320 5769 7468  ..        # With
+00015c10: 6f75 7420 6c69 6e65 2077 7261 7070 696e  out line wrappin
+00015c20: 672c 2077 6520 7769 6c6c 206e 6576 6572  g, we will never
+00015c30: 2068 6176 6520 746f 2073 6372 6f6c 6c20   have to scroll 
+00015c40: 7665 7274 6963 616c 6c79 2069 6e73 6964  vertically insid
+00015c50: 650a 2020 2020 2020 2020 2320 6120 7369  e.        # a si
+00015c60: 6e67 6c65 206c 696e 652e 0a20 2020 2020  ngle line..     
+00015c70: 2020 2073 656c 662e 7665 7274 6963 616c     self.vertical
+00015c80: 5f73 6372 6f6c 6c5f 3220 3d20 300a 0a20  _scroll_2 = 0.. 
+00015c90: 2020 2020 2020 2069 6620 7569 5f63 6f6e         if ui_con
+00015ca0: 7465 6e74 2e6c 696e 655f 636f 756e 7420  tent.line_count 
+00015cb0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00015cc0: 2020 7365 6c66 2e76 6572 7469 6361 6c5f    self.vertical_
+00015cd0: 7363 726f 6c6c 203d 2030 0a20 2020 2020  scroll = 0.     
+00015ce0: 2020 2020 2020 2073 656c 662e 686f 7269         self.hori
+00015cf0: 7a6f 6e74 616c 5f73 6372 6f6c 6c20 3d20  zontal_scroll = 
+00015d00: 300a 2020 2020 2020 2020 2020 2020 7265  0.            re
+00015d10: 7475 726e 0a20 2020 2020 2020 2065 6c73  turn.        els
+00015d20: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
+00015d30: 7572 7265 6e74 5f6c 696e 655f 7465 7874  urrent_line_text
+00015d40: 203d 2066 7261 676d 656e 745f 6c69 7374   = fragment_list
+00015d50: 5f74 6f5f 7465 7874 280a 2020 2020 2020  _to_text(.      
+00015d60: 2020 2020 2020 2020 2020 7569 5f63 6f6e            ui_con
+00015d70: 7465 6e74 2e67 6574 5f6c 696e 6528 6375  tent.get_line(cu
+00015d80: 7273 6f72 5f70 6f73 6974 696f 6e2e 7929  rsor_position.y)
+00015d90: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+00015da0: 2020 2020 2020 2020 6465 6620 646f 5f73          def do_s
+00015db0: 6372 6f6c 6c28 0a20 2020 2020 2020 2020  croll(.         
+00015dc0: 2020 2063 7572 7265 6e74 5f73 6372 6f6c     current_scrol
+00015dd0: 6c3a 2069 6e74 2c0a 2020 2020 2020 2020  l: int,.        
+00015de0: 2020 2020 7363 726f 6c6c 5f6f 6666 7365      scroll_offse
+00015df0: 745f 7374 6172 743a 2069 6e74 2c0a 2020  t_start: int,.  
+00015e00: 2020 2020 2020 2020 2020 7363 726f 6c6c            scroll
+00015e10: 5f6f 6666 7365 745f 656e 643a 2069 6e74  _offset_end: int
+00015e20: 2c0a 2020 2020 2020 2020 2020 2020 6375  ,.            cu
+00015e30: 7273 6f72 5f70 6f73 3a20 696e 742c 0a20  rsor_pos: int,. 
+00015e40: 2020 2020 2020 2020 2020 2077 696e 646f             windo
+00015e50: 775f 7369 7a65 3a20 696e 742c 0a20 2020  w_size: int,.   
+00015e60: 2020 2020 2020 2020 2063 6f6e 7465 6e74           content
+00015e70: 5f73 697a 653a 2069 6e74 2c0a 2020 2020  _size: int,.    
+00015e80: 2020 2020 2920 2d3e 2069 6e74 3a0a 2020      ) -> int:.  
+00015e90: 2020 2020 2020 2020 2020 2253 6372 6f6c            "Scrol
+00015ea0: 6c69 6e67 2061 6c67 6f72 6974 686d 2e20  ling algorithm. 
+00015eb0: 5573 6564 2066 6f72 2062 6f74 6820 686f  Used for both ho
+00015ec0: 7269 7a6f 6e74 616c 2061 6e64 2076 6572  rizontal and ver
+00015ed0: 7469 6361 6c20 7363 726f 6c6c 696e 672e  tical scrolling.
+00015ee0: 220a 2020 2020 2020 2020 2020 2020 2320  ".            # 
+00015ef0: 4361 6c63 756c 6174 6520 7468 6520 7363  Calculate the sc
+00015f00: 726f 6c6c 206f 6666 7365 7420 746f 2061  roll offset to a
+00015f10: 7070 6c79 2e0a 2020 2020 2020 2020 2020  pply..          
+00015f20: 2020 2320 5468 6973 2063 616e 206f 6276    # This can obv
+00015f30: 696f 7573 6c79 206e 6576 6572 2062 6520  iously never be 
+00015f40: 6d6f 7265 2074 6861 6e20 6861 7665 2074  more than have t
+00015f50: 6865 2073 6372 6565 6e20 7369 7a65 2e20  he screen size. 
+00015f60: 416c 736f 2c20 7768 656e 2074 6865 0a20  Also, when the. 
+00015f70: 2020 2020 2020 2020 2020 2023 2063 7572             # cur
+00015f80: 736f 7220 6170 7065 6172 7320 6174 2074  sor appears at t
+00015f90: 6865 2074 6f70 206f 7220 626f 7474 6f6d  he top or bottom
+00015fa0: 2c20 7765 2064 6f6e 2774 2061 7070 6c79  , we don't apply
+00015fb0: 2074 6865 206f 6666 7365 742e 0a20 2020   the offset..   
+00015fc0: 2020 2020 2020 2020 2073 6372 6f6c 6c5f           scroll_
+00015fd0: 6f66 6673 6574 5f73 7461 7274 203d 2069  offset_start = i
+00015fe0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+00015ff0: 2020 2020 6d69 6e28 7363 726f 6c6c 5f6f      min(scroll_o
+00016000: 6666 7365 745f 7374 6172 742c 2077 696e  ffset_start, win
+00016010: 646f 775f 7369 7a65 202f 2032 2c20 6375  dow_size / 2, cu
+00016020: 7273 6f72 5f70 6f73 290a 2020 2020 2020  rsor_pos).      
+00016030: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00016040: 2020 2020 7363 726f 6c6c 5f6f 6666 7365      scroll_offse
+00016050: 745f 656e 6420 3d20 696e 7428 0a20 2020  t_end = int(.   
+00016060: 2020 2020 2020 2020 2020 2020 206d 696e               min
+00016070: 2873 6372 6f6c 6c5f 6f66 6673 6574 5f65  (scroll_offset_e
+00016080: 6e64 2c20 7769 6e64 6f77 5f73 697a 6520  nd, window_size 
+00016090: 2f20 322c 2063 6f6e 7465 6e74 5f73 697a  / 2, content_siz
+000160a0: 6520 2d20 3120 2d20 6375 7273 6f72 5f70  e - 1 - cursor_p
+000160b0: 6f73 290a 2020 2020 2020 2020 2020 2020  os).            
+000160c0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+000160d0: 2050 7265 7665 6e74 206e 6567 6174 6976   Prevent negativ
+000160e0: 6520 7363 726f 6c6c 206f 6666 7365 7473  e scroll offsets
+000160f0: 2e0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00016100: 2063 7572 7265 6e74 5f73 6372 6f6c 6c20   current_scroll 
+00016110: 3c20 303a 0a20 2020 2020 2020 2020 2020  < 0:.           
+00016120: 2020 2020 2063 7572 7265 6e74 5f73 6372       current_scr
+00016130: 6f6c 6c20 3d20 300a 0a20 2020 2020 2020  oll = 0..       
+00016140: 2020 2020 2023 2053 6372 6f6c 6c20 6261       # Scroll ba
+00016150: 636b 2069 6620 7765 2073 6372 6f6c 6c65  ck if we scrolle
+00016160: 6420 746f 206d 7563 6820 616e 6420 7468  d to much and th
+00016170: 6572 6527 7320 7374 696c 6c20 7370 6163  ere's still spac
+00016180: 6520 746f 2073 686f 7720 6d6f 7265 206f  e to show more o
+00016190: 6620 7468 6520 646f 6375 6d65 6e74 2e0a  f the document..
+000161a0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+000161b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000161c0: 206e 6f74 2073 656c 662e 616c 6c6f 775f   not self.allow_
+000161d0: 7363 726f 6c6c 5f62 6579 6f6e 645f 626f  scroll_beyond_bo
+000161e0: 7474 6f6d 2829 0a20 2020 2020 2020 2020  ttom().         
+000161f0: 2020 2020 2020 2061 6e64 2063 7572 7265         and curre
+00016200: 6e74 5f73 6372 6f6c 6c20 3e20 636f 6e74  nt_scroll > cont
+00016210: 656e 745f 7369 7a65 202d 2077 696e 646f  ent_size - windo
+00016220: 775f 7369 7a65 0a20 2020 2020 2020 2020  w_size.         
+00016230: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+00016240: 2020 2020 2020 6375 7272 656e 745f 7363        current_sc
+00016250: 726f 6c6c 203d 206d 6178 2830 2c20 636f  roll = max(0, co
+00016260: 6e74 656e 745f 7369 7a65 202d 2077 696e  ntent_size - win
+00016270: 646f 775f 7369 7a65 290a 0a20 2020 2020  dow_size)..     
+00016280: 2020 2020 2020 2023 2053 6372 6f6c 6c20         # Scroll 
+00016290: 7570 2069 6620 6375 7273 6f72 2069 7320  up if cursor is 
+000162a0: 6265 666f 7265 2076 6973 6962 6c65 2070  before visible p
+000162b0: 6172 742e 0a20 2020 2020 2020 2020 2020  art..           
+000162c0: 2069 6620 6375 7272 656e 745f 7363 726f   if current_scro
+000162d0: 6c6c 203e 2063 7572 736f 725f 706f 7320  ll > cursor_pos 
+000162e0: 2d20 7363 726f 6c6c 5f6f 6666 7365 745f  - scroll_offset_
+000162f0: 7374 6172 743a 0a20 2020 2020 2020 2020  start:.         
+00016300: 2020 2020 2020 2063 7572 7265 6e74 5f73         current_s
+00016310: 6372 6f6c 6c20 3d20 6d61 7828 302c 2063  croll = max(0, c
+00016320: 7572 736f 725f 706f 7320 2d20 7363 726f  ursor_pos - scro
+00016330: 6c6c 5f6f 6666 7365 745f 7374 6172 7429  ll_offset_start)
+00016340: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00016350: 5363 726f 6c6c 2064 6f77 6e20 6966 2063  Scroll down if c
+00016360: 7572 736f 7220 6973 2061 6674 6572 2076  ursor is after v
+00016370: 6973 6962 6c65 2070 6172 742e 0a20 2020  isible part..   
+00016380: 2020 2020 2020 2020 2069 6620 6375 7272           if curr
+00016390: 656e 745f 7363 726f 6c6c 203c 2028 6375  ent_scroll < (cu
+000163a0: 7273 6f72 5f70 6f73 202b 2031 2920 2d20  rsor_pos + 1) - 
+000163b0: 7769 6e64 6f77 5f73 697a 6520 2b20 7363  window_size + sc
+000163c0: 726f 6c6c 5f6f 6666 7365 745f 656e 643a  roll_offset_end:
+000163d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000163e0: 2063 7572 7265 6e74 5f73 6372 6f6c 6c20   current_scroll 
+000163f0: 3d20 2863 7572 736f 725f 706f 7320 2b20  = (cursor_pos + 
+00016400: 3129 202d 2077 696e 646f 775f 7369 7a65  1) - window_size
+00016410: 202b 2073 6372 6f6c 6c5f 6f66 6673 6574   + scroll_offset
+00016420: 5f65 6e64 0a0a 2020 2020 2020 2020 2020  _end..          
+00016430: 2020 7265 7475 726e 2063 7572 7265 6e74    return current
+00016440: 5f73 6372 6f6c 6c0a 0a20 2020 2020 2020  _scroll..       
+00016450: 2023 2057 6865 6e20 6120 7072 6566 6572   # When a prefer
+00016460: 7265 6420 7363 726f 6c6c 2069 7320 6769  red scroll is gi
+00016470: 7665 6e2c 2074 616b 6520 7468 6174 2066  ven, take that f
+00016480: 6972 7374 2069 6e74 6f20 6163 636f 756e  irst into accoun
+00016490: 742e 0a20 2020 2020 2020 2069 6620 7365  t..        if se
+000164a0: 6c66 2e67 6574 5f76 6572 7469 6361 6c5f  lf.get_vertical_
+000164b0: 7363 726f 6c6c 3a0a 2020 2020 2020 2020  scroll:.        
+000164c0: 2020 2020 7365 6c66 2e76 6572 7469 6361      self.vertica
+000164d0: 6c5f 7363 726f 6c6c 203d 2073 656c 662e  l_scroll = self.
+000164e0: 6765 745f 7665 7274 6963 616c 5f73 6372  get_vertical_scr
+000164f0: 6f6c 6c28 7365 6c66 290a 2020 2020 2020  oll(self).      
+00016500: 2020 2020 2020 6173 7365 7274 2069 7369        assert isi
+00016510: 6e73 7461 6e63 6528 7365 6c66 2e76 6572  nstance(self.ver
+00016520: 7469 6361 6c5f 7363 726f 6c6c 2c20 696e  tical_scroll, in
+00016530: 7429 0a20 2020 2020 2020 2069 6620 7365  t).        if se
+00016540: 6c66 2e67 6574 5f68 6f72 697a 6f6e 7461  lf.get_horizonta
+00016550: 6c5f 7363 726f 6c6c 3a0a 2020 2020 2020  l_scroll:.      
+00016560: 2020 2020 2020 7365 6c66 2e68 6f72 697a        self.horiz
+00016570: 6f6e 7461 6c5f 7363 726f 6c6c 203d 2073  ontal_scroll = s
+00016580: 656c 662e 6765 745f 686f 7269 7a6f 6e74  elf.get_horizont
+00016590: 616c 5f73 6372 6f6c 6c28 7365 6c66 290a  al_scroll(self).
+000165a0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+000165b0: 7274 2069 7369 6e73 7461 6e63 6528 7365  rt isinstance(se
+000165c0: 6c66 2e68 6f72 697a 6f6e 7461 6c5f 7363  lf.horizontal_sc
+000165d0: 726f 6c6c 2c20 696e 7429 0a0a 2020 2020  roll, int)..    
+000165e0: 2020 2020 2320 5570 6461 7465 2068 6f72      # Update hor
+000165f0: 697a 6f6e 7461 6c2f 7665 7274 6963 616c  izontal/vertical
+00016600: 2073 6372 6f6c 6c20 746f 206d 616b 6520   scroll to make 
+00016610: 7375 7265 2074 6861 7420 7468 6520 6375  sure that the cu
+00016620: 7273 6f72 0a20 2020 2020 2020 2023 2072  rsor.        # r
+00016630: 656d 6169 6e73 2076 6973 6962 6c65 2e0a  emains visible..
+00016640: 2020 2020 2020 2020 6f66 6673 6574 7320          offsets 
+00016650: 3d20 7365 6c66 2e73 6372 6f6c 6c5f 6f66  = self.scroll_of
+00016660: 6673 6574 730a 0a20 2020 2020 2020 2073  fsets..        s
+00016670: 656c 662e 7665 7274 6963 616c 5f73 6372  elf.vertical_scr
+00016680: 6f6c 6c20 3d20 646f 5f73 6372 6f6c 6c28  oll = do_scroll(
+00016690: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
+000166a0: 7265 6e74 5f73 6372 6f6c 6c3d 7365 6c66  rent_scroll=self
+000166b0: 2e76 6572 7469 6361 6c5f 7363 726f 6c6c  .vertical_scroll
+000166c0: 2c0a 2020 2020 2020 2020 2020 2020 7363  ,.            sc
+000166d0: 726f 6c6c 5f6f 6666 7365 745f 7374 6172  roll_offset_star
+000166e0: 743d 6f66 6673 6574 732e 746f 702c 0a20  t=offsets.top,. 
+000166f0: 2020 2020 2020 2020 2020 2073 6372 6f6c             scrol
+00016700: 6c5f 6f66 6673 6574 5f65 6e64 3d6f 6666  l_offset_end=off
+00016710: 7365 7473 2e62 6f74 746f 6d2c 0a20 2020  sets.bottom,.   
+00016720: 2020 2020 2020 2020 2063 7572 736f 725f           cursor_
+00016730: 706f 733d 7569 5f63 6f6e 7465 6e74 2e63  pos=ui_content.c
+00016740: 7572 736f 725f 706f 7369 7469 6f6e 2e79  ursor_position.y
+00016750: 2c0a 2020 2020 2020 2020 2020 2020 7769  ,.            wi
+00016760: 6e64 6f77 5f73 697a 653d 6865 6967 6874  ndow_size=height
+00016770: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
+00016780: 6e74 656e 745f 7369 7a65 3d75 695f 636f  ntent_size=ui_co
+00016790: 6e74 656e 742e 6c69 6e65 5f63 6f75 6e74  ntent.line_count
+000167a0: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
+000167b0: 2020 2020 2069 6620 7365 6c66 2e67 6574       if self.get
+000167c0: 5f6c 696e 655f 7072 6566 6978 3a0a 2020  _line_prefix:.  
+000167d0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+000167e0: 745f 6c69 6e65 5f70 7265 6669 785f 7769  t_line_prefix_wi
+000167f0: 6474 6820 3d20 6672 6167 6d65 6e74 5f6c  dth = fragment_l
+00016800: 6973 745f 7769 6474 6828 0a20 2020 2020  ist_width(.     
+00016810: 2020 2020 2020 2020 2020 2074 6f5f 666f             to_fo
+00016820: 726d 6174 7465 645f 7465 7874 2873 656c  rmatted_text(sel
+00016830: 662e 6765 745f 6c69 6e65 5f70 7265 6669  f.get_line_prefi
+00016840: 7828 7569 5f63 6f6e 7465 6e74 2e63 7572  x(ui_content.cur
+00016850: 736f 725f 706f 7369 7469 6f6e 2e79 2c20  sor_position.y, 
+00016860: 3029 290a 2020 2020 2020 2020 2020 2020  0)).            
+00016870: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00016880: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+00016890: 656e 745f 6c69 6e65 5f70 7265 6669 785f  ent_line_prefix_
+000168a0: 7769 6474 6820 3d20 300a 0a20 2020 2020  width = 0..     
+000168b0: 2020 2073 656c 662e 686f 7269 7a6f 6e74     self.horizont
+000168c0: 616c 5f73 6372 6f6c 6c20 3d20 646f 5f73  al_scroll = do_s
+000168d0: 6372 6f6c 6c28 0a20 2020 2020 2020 2020  croll(.         
+000168e0: 2020 2063 7572 7265 6e74 5f73 6372 6f6c     current_scrol
+000168f0: 6c3d 7365 6c66 2e68 6f72 697a 6f6e 7461  l=self.horizonta
+00016900: 6c5f 7363 726f 6c6c 2c0a 2020 2020 2020  l_scroll,.      
+00016910: 2020 2020 2020 7363 726f 6c6c 5f6f 6666        scroll_off
+00016920: 7365 745f 7374 6172 743d 6f66 6673 6574  set_start=offset
+00016930: 732e 6c65 6674 2c0a 2020 2020 2020 2020  s.left,.        
+00016940: 2020 2020 7363 726f 6c6c 5f6f 6666 7365      scroll_offse
+00016950: 745f 656e 643d 6f66 6673 6574 732e 7269  t_end=offsets.ri
+00016960: 6768 742c 0a20 2020 2020 2020 2020 2020  ght,.           
+00016970: 2063 7572 736f 725f 706f 733d 6765 745f   cursor_pos=get_
+00016980: 6377 6964 7468 2863 7572 7265 6e74 5f6c  cwidth(current_l
+00016990: 696e 655f 7465 7874 5b3a 2075 695f 636f  ine_text[: ui_co
+000169a0: 6e74 656e 742e 6375 7273 6f72 5f70 6f73  ntent.cursor_pos
+000169b0: 6974 696f 6e2e 785d 292c 0a20 2020 2020  ition.x]),.     
+000169c0: 2020 2020 2020 2077 696e 646f 775f 7369         window_si
+000169d0: 7a65 3d77 6964 7468 202d 2063 7572 7265  ze=width - curre
+000169e0: 6e74 5f6c 696e 655f 7072 6566 6978 5f77  nt_line_prefix_w
+000169f0: 6964 7468 2c0a 2020 2020 2020 2020 2020  idth,.          
+00016a00: 2020 2320 5765 2063 616e 206f 6e6c 7920    # We can only 
+00016a10: 616e 616c 7973 6520 7468 6520 6375 7272  analyse the curr
+00016a20: 656e 7420 6c69 6e65 2e20 4361 6c63 756c  ent line. Calcul
+00016a30: 6174 696e 6720 7468 6520 7769 6474 6820  ating the width 
+00016a40: 6f66 660a 2020 2020 2020 2020 2020 2020  off.            
+00016a50: 2320 616c 6c20 7468 6520 6c69 6e65 7320  # all the lines 
+00016a60: 6973 2074 6f6f 2065 7870 656e 7369 7665  is too expensive
+00016a70: 2e0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+00016a80: 6e74 656e 745f 7369 7a65 3d6d 6178 280a  ntent_size=max(.
+00016a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016aa0: 6765 745f 6377 6964 7468 2863 7572 7265  get_cwidth(curre
+00016ab0: 6e74 5f6c 696e 655f 7465 7874 292c 2073  nt_line_text), s
+00016ac0: 656c 662e 686f 7269 7a6f 6e74 616c 5f73  elf.horizontal_s
+00016ad0: 6372 6f6c 6c20 2b20 7769 6474 680a 2020  croll + width.  
+00016ae0: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
+00016af0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00016b00: 5f6d 6f75 7365 5f68 616e 646c 6572 2873  _mouse_handler(s
+00016b10: 656c 662c 206d 6f75 7365 5f65 7665 6e74  elf, mouse_event
+00016b20: 3a20 4d6f 7573 6545 7665 6e74 2920 2d3e  : MouseEvent) ->
+00016b30: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00016b40: 2222 0a20 2020 2020 2020 204d 6f75 7365  "".        Mouse
+00016b50: 2068 616e 646c 6572 2e20 4361 6c6c 6564   handler. Called
+00016b60: 2077 6865 6e20 7468 6520 5549 2063 6f6e   when the UI con
+00016b70: 7472 6f6c 2064 6f65 736e 2774 2068 616e  trol doesn't han
+00016b80: 646c 6520 7468 6973 0a20 2020 2020 2020  dle this.       
+00016b90: 2070 6172 7469 6375 6c61 7220 6576 656e   particular even
+00016ba0: 742e 0a20 2020 2020 2020 2022 2222 0a20  t..        """. 
+00016bb0: 2020 2020 2020 2069 6620 6d6f 7573 655f         if mouse_
+00016bc0: 6576 656e 742e 6576 656e 745f 7479 7065  event.event_type
+00016bd0: 203d 3d20 4d6f 7573 6545 7665 6e74 5479   == MouseEventTy
+00016be0: 7065 2e53 4352 4f4c 4c5f 444f 574e 3a0a  pe.SCROLL_DOWN:.
+00016bf0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00016c00: 2e5f 7363 726f 6c6c 5f64 6f77 6e28 290a  ._scroll_down().
+00016c10: 2020 2020 2020 2020 656c 6966 206d 6f75          elif mou
+00016c20: 7365 5f65 7665 6e74 2e65 7665 6e74 5f74  se_event.event_t
+00016c30: 7970 6520 3d3d 204d 6f75 7365 4576 656e  ype == MouseEven
+00016c40: 7454 7970 652e 5343 524f 4c4c 5f55 503a  tType.SCROLL_UP:
+00016c50: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00016c60: 662e 5f73 6372 6f6c 6c5f 7570 2829 0a0a  f._scroll_up()..
+00016c70: 2020 2020 6465 6620 5f73 6372 6f6c 6c5f      def _scroll_
+00016c80: 646f 776e 2873 656c 6629 202d 3e20 4e6f  down(self) -> No
+00016c90: 6e65 3a0a 2020 2020 2020 2020 2253 6372  ne:.        "Scr
+00016ca0: 6f6c 6c20 7769 6e64 6f77 2064 6f77 6e2e  oll window down.
+00016cb0: 220a 2020 2020 2020 2020 696e 666f 203d  ".        info =
+00016cc0: 2073 656c 662e 7265 6e64 6572 5f69 6e66   self.render_inf
+00016cd0: 6f0a 0a20 2020 2020 2020 2069 6620 696e  o..        if in
+00016ce0: 666f 2069 7320 4e6f 6e65 3a0a 2020 2020  fo is None:.    
+00016cf0: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+00016d00: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00016d10: 7665 7274 6963 616c 5f73 6372 6f6c 6c20  vertical_scroll 
+00016d20: 3c20 696e 666f 2e63 6f6e 7465 6e74 5f68  < info.content_h
+00016d30: 6569 6768 7420 2d20 696e 666f 2e77 696e  eight - info.win
+00016d40: 646f 775f 6865 6967 6874 3a0a 2020 2020  dow_height:.    
+00016d50: 2020 2020 2020 2020 6966 2069 6e66 6f2e          if info.
+00016d60: 6375 7273 6f72 5f70 6f73 6974 696f 6e2e  cursor_position.
+00016d70: 7920 3c3d 2069 6e66 6f2e 636f 6e66 6967  y <= info.config
+00016d80: 7572 6564 5f73 6372 6f6c 6c5f 6f66 6673  ured_scroll_offs
+00016d90: 6574 732e 746f 703a 0a20 2020 2020 2020  ets.top:.       
+00016da0: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
+00016db0: 6e74 656e 742e 6d6f 7665 5f63 7572 736f  ntent.move_curso
+00016dc0: 725f 646f 776e 2829 0a0a 2020 2020 2020  r_down()..      
+00016dd0: 2020 2020 2020 7365 6c66 2e76 6572 7469        self.verti
+00016de0: 6361 6c5f 7363 726f 6c6c 202b 3d20 310a  cal_scroll += 1.
+00016df0: 0a20 2020 2064 6566 205f 7363 726f 6c6c  .    def _scroll
+00016e00: 5f75 7028 7365 6c66 2920 2d3e 204e 6f6e  _up(self) -> Non
+00016e10: 653a 0a20 2020 2020 2020 2022 5363 726f  e:.        "Scro
+00016e20: 6c6c 2077 696e 646f 7720 7570 2e22 0a20  ll window up.". 
+00016e30: 2020 2020 2020 2069 6e66 6f20 3d20 7365         info = se
+00016e40: 6c66 2e72 656e 6465 725f 696e 666f 0a0a  lf.render_info..
+00016e50: 2020 2020 2020 2020 6966 2069 6e66 6f20          if info 
+00016e60: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00016e70: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
+00016e80: 2020 2020 2069 6620 696e 666f 2e76 6572       if info.ver
+00016e90: 7469 6361 6c5f 7363 726f 6c6c 203e 2030  tical_scroll > 0
+00016ea0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00016eb0: 544f 444f 3a20 6e6f 7420 656e 7469 7265  TODO: not entire
+00016ec0: 6c79 2063 6f72 7265 6374 2079 6574 2069  ly correct yet i
+00016ed0: 6e20 6361 7365 206f 6620 6c69 6e65 2077  n case of line w
+00016ee0: 7261 7070 696e 6720 616e 6420 6c6f 6e67  rapping and long
+00016ef0: 206c 696e 6573 2e0a 2020 2020 2020 2020   lines..        
+00016f00: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
+00016f10: 2020 2020 2020 2020 2069 6e66 6f2e 6375           info.cu
+00016f20: 7273 6f72 5f70 6f73 6974 696f 6e2e 790a  rsor_position.y.
+00016f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f40: 3e3d 2069 6e66 6f2e 7769 6e64 6f77 5f68  >= info.window_h
+00016f50: 6569 6768 7420 2d20 3120 2d20 696e 666f  eight - 1 - info
+00016f60: 2e63 6f6e 6669 6775 7265 645f 7363 726f  .configured_scro
+00016f70: 6c6c 5f6f 6666 7365 7473 2e62 6f74 746f  ll_offsets.botto
+00016f80: 6d0a 2020 2020 2020 2020 2020 2020 293a  m.            ):
+00016f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016fa0: 2073 656c 662e 636f 6e74 656e 742e 6d6f   self.content.mo
+00016fb0: 7665 5f63 7572 736f 725f 7570 2829 0a0a  ve_cursor_up()..
+00016fc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00016fd0: 2e76 6572 7469 6361 6c5f 7363 726f 6c6c  .vertical_scroll
+00016fe0: 202d 3d20 310a 0a20 2020 2064 6566 2067   -= 1..    def g
+00016ff0: 6574 5f6b 6579 5f62 696e 6469 6e67 7328  et_key_bindings(
+00017000: 7365 6c66 2920 2d3e 204f 7074 696f 6e61  self) -> Optiona
+00017010: 6c5b 4b65 7942 696e 6469 6e67 7342 6173  l[KeyBindingsBas
+00017020: 655d 3a0a 2020 2020 2020 2020 7265 7475  e]:.        retu
+00017030: 726e 2073 656c 662e 636f 6e74 656e 742e  rn self.content.
+00017040: 6765 745f 6b65 795f 6269 6e64 696e 6773  get_key_bindings
+00017050: 2829 0a0a 2020 2020 6465 6620 6765 745f  ()..    def get_
+00017060: 6368 696c 6472 656e 2873 656c 6629 202d  children(self) -
+00017070: 3e20 4c69 7374 5b43 6f6e 7461 696e 6572  > List[Container
+00017080: 5d3a 0a20 2020 2020 2020 2072 6574 7572  ]:.        retur
+00017090: 6e20 5b5d 0a0a 0a63 6c61 7373 2043 6f6e  n []...class Con
+000170a0: 6469 7469 6f6e 616c 436f 6e74 6169 6e65  ditionalContaine
+000170b0: 7228 436f 6e74 6169 6e65 7229 3a0a 2020  r(Container):.  
+000170c0: 2020 2222 220a 2020 2020 5772 6170 7065    """.    Wrappe
+000170d0: 7220 6172 6f75 6e64 2061 6e79 206f 7468  r around any oth
+000170e0: 6572 2063 6f6e 7461 696e 6572 2074 6861  er container tha
+000170f0: 7420 6361 6e20 6368 616e 6765 2074 6865  t can change the
+00017100: 2076 6973 6962 696c 6974 792e 2054 6865   visibility. The
+00017110: 0a20 2020 2072 6563 6569 7665 6420 6066  .    received `f
+00017120: 696c 7465 7260 2064 6574 6572 6d69 6e65  ilter` determine
+00017130: 7320 7768 6574 6865 7220 7468 6520 6769  s whether the gi
+00017140: 7665 6e20 636f 6e74 6169 6e65 7220 7368  ven container sh
+00017150: 6f75 6c64 2062 650a 2020 2020 6469 7370  ould be.    disp
+00017160: 6c61 7965 6420 6f72 206e 6f74 2e0a 0a20  layed or not... 
+00017170: 2020 203a 7061 7261 6d20 636f 6e74 656e     :param conten
+00017180: 743a 203a 636c 6173 733a 602e 436f 6e74  t: :class:`.Cont
+00017190: 6169 6e65 7260 2069 6e73 7461 6e63 652e  ainer` instance.
+000171a0: 0a20 2020 203a 7061 7261 6d20 6669 6c74  .    :param filt
+000171b0: 6572 3a20 3a63 6c61 7373 3a60 2e46 696c  er: :class:`.Fil
+000171c0: 7465 7260 2069 6e73 7461 6e63 652e 0a20  ter` instance.. 
+000171d0: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
+000171e0: 5f5f 696e 6974 5f5f 2873 656c 662c 2063  __init__(self, c
+000171f0: 6f6e 7465 6e74 3a20 416e 7943 6f6e 7461  ontent: AnyConta
+00017200: 696e 6572 2c20 6669 6c74 6572 3a20 4669  iner, filter: Fi
+00017210: 6c74 6572 4f72 426f 6f6c 2920 2d3e 204e  lterOrBool) -> N
+00017220: 6f6e 653a 0a20 2020 2020 2020 2073 656c  one:.        sel
+00017230: 662e 636f 6e74 656e 7420 3d20 746f 5f63  f.content = to_c
+00017240: 6f6e 7461 696e 6572 2863 6f6e 7465 6e74  ontainer(content
+00017250: 290a 2020 2020 2020 2020 7365 6c66 2e66  ).        self.f
+00017260: 696c 7465 7220 3d20 746f 5f66 696c 7465  ilter = to_filte
+00017270: 7228 6669 6c74 6572 290a 0a20 2020 2064  r(filter)..    d
+00017280: 6566 205f 5f72 6570 725f 5f28 7365 6c66  ef __repr__(self
+00017290: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
+000172a0: 2020 7265 7475 726e 2022 436f 6e64 6974    return "Condit
+000172b0: 696f 6e61 6c43 6f6e 7461 696e 6572 2825  ionalContainer(%
+000172c0: 722c 2066 696c 7465 723d 2572 2922 2025  r, filter=%r)" %
+000172d0: 2028 7365 6c66 2e63 6f6e 7465 6e74 2c20   (self.content, 
+000172e0: 7365 6c66 2e66 696c 7465 7229 0a0a 2020  self.filter)..  
+000172f0: 2020 6465 6620 7265 7365 7428 7365 6c66    def reset(self
+00017300: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00017310: 2020 2073 656c 662e 636f 6e74 656e 742e     self.content.
+00017320: 7265 7365 7428 290a 0a20 2020 2064 6566  reset()..    def
+00017330: 2070 7265 6665 7272 6564 5f77 6964 7468   preferred_width
+00017340: 2873 656c 662c 206d 6178 5f61 7661 696c  (self, max_avail
+00017350: 6162 6c65 5f77 6964 7468 3a20 696e 7429  able_width: int)
+00017360: 202d 3e20 4469 6d65 6e73 696f 6e3a 0a20   -> Dimension:. 
+00017370: 2020 2020 2020 2069 6620 7365 6c66 2e66         if self.f
+00017380: 696c 7465 7228 293a 0a20 2020 2020 2020  ilter():.       
+00017390: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000173a0: 2e63 6f6e 7465 6e74 2e70 7265 6665 7272  .content.preferr
+000173b0: 6564 5f77 6964 7468 286d 6178 5f61 7661  ed_width(max_ava
+000173c0: 696c 6162 6c65 5f77 6964 7468 290a 2020  ilable_width).  
+000173d0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000173e0: 2020 2020 2020 2020 7265 7475 726e 2044          return D
+000173f0: 696d 656e 7369 6f6e 2e7a 6572 6f28 290a  imension.zero().
+00017400: 0a20 2020 2064 6566 2070 7265 6665 7272  .    def preferr
+00017410: 6564 5f68 6569 6768 7428 7365 6c66 2c20  ed_height(self, 
+00017420: 7769 6474 683a 2069 6e74 2c20 6d61 785f  width: int, max_
+00017430: 6176 6169 6c61 626c 655f 6865 6967 6874  available_height
+00017440: 3a20 696e 7429 202d 3e20 4469 6d65 6e73  : int) -> Dimens
+00017450: 696f 6e3a 0a20 2020 2020 2020 2069 6620  ion:.        if 
+00017460: 7365 6c66 2e66 696c 7465 7228 293a 0a20  self.filter():. 
+00017470: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00017480: 6e20 7365 6c66 2e63 6f6e 7465 6e74 2e70  n self.content.p
+00017490: 7265 6665 7272 6564 5f68 6569 6768 7428  referred_height(
+000174a0: 7769 6474 682c 206d 6178 5f61 7661 696c  width, max_avail
+000174b0: 6162 6c65 5f68 6569 6768 7429 0a20 2020  able_height).   
+000174c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000174d0: 2020 2020 2020 2072 6574 7572 6e20 4469         return Di
+000174e0: 6d65 6e73 696f 6e2e 7a65 726f 2829 0a0a  mension.zero()..
+000174f0: 2020 2020 6465 6620 7772 6974 655f 746f      def write_to
+00017500: 5f73 6372 6565 6e28 0a20 2020 2020 2020  _screen(.       
+00017510: 2073 656c 662c 0a20 2020 2020 2020 2073   self,.        s
+00017520: 6372 6565 6e3a 2053 6372 6565 6e2c 0a20  creen: Screen,. 
+00017530: 2020 2020 2020 206d 6f75 7365 5f68 616e         mouse_han
+00017540: 646c 6572 733a 204d 6f75 7365 4861 6e64  dlers: MouseHand
+00017550: 6c65 7273 2c0a 2020 2020 2020 2020 7772  lers,.        wr
+00017560: 6974 655f 706f 7369 7469 6f6e 3a20 5772  ite_position: Wr
+00017570: 6974 6550 6f73 6974 696f 6e2c 0a20 2020  itePosition,.   
+00017580: 2020 2020 2070 6172 656e 745f 7374 796c       parent_styl
+00017590: 653a 2073 7472 2c0a 2020 2020 2020 2020  e: str,.        
+000175a0: 6572 6173 655f 6267 3a20 626f 6f6c 2c0a  erase_bg: bool,.
+000175b0: 2020 2020 2020 2020 7a5f 696e 6465 783a          z_index:
+000175c0: 204f 7074 696f 6e61 6c5b 696e 745d 2c0a   Optional[int],.
+000175d0: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
+000175e0: 2020 2020 2020 2069 6620 7365 6c66 2e66         if self.f
+000175f0: 696c 7465 7228 293a 0a20 2020 2020 2020  ilter():.       
+00017600: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00017610: 2e63 6f6e 7465 6e74 2e77 7269 7465 5f74  .content.write_t
+00017620: 6f5f 7363 7265 656e 280a 2020 2020 2020  o_screen(.      
+00017630: 2020 2020 2020 2020 2020 7363 7265 656e            screen
+00017640: 2c20 6d6f 7573 655f 6861 6e64 6c65 7273  , mouse_handlers
+00017650: 2c20 7772 6974 655f 706f 7369 7469 6f6e  , write_position
+00017660: 2c20 7061 7265 6e74 5f73 7479 6c65 2c20  , parent_style, 
+00017670: 6572 6173 655f 6267 2c20 7a5f 696e 6465  erase_bg, z_inde
+00017680: 780a 2020 2020 2020 2020 2020 2020 290a  x.            ).
+00017690: 0a20 2020 2064 6566 2067 6574 5f63 6869  .    def get_chi
+000176a0: 6c64 7265 6e28 7365 6c66 2920 2d3e 204c  ldren(self) -> L
+000176b0: 6973 745b 436f 6e74 6169 6e65 725d 3a0a  ist[Container]:.
+000176c0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+000176d0: 7365 6c66 2e63 6f6e 7465 6e74 5d0a 0a0a  self.content]...
+000176e0: 636c 6173 7320 4479 6e61 6d69 6343 6f6e  class DynamicCon
+000176f0: 7461 696e 6572 2843 6f6e 7461 696e 6572  tainer(Container
+00017700: 293a 0a20 2020 2022 2222 0a20 2020 2043  ):.    """.    C
+00017710: 6f6e 7461 696e 6572 2063 6c61 7373 2074  ontainer class t
+00017720: 6861 7420 6479 6e61 6d69 6361 6c6c 7920  hat dynamically 
+00017730: 7265 7475 726e 7320 616e 7920 436f 6e74  returns any Cont
+00017740: 6169 6e65 722e 0a0a 2020 2020 3a70 6172  ainer...    :par
+00017750: 616d 2067 6574 5f63 6f6e 7461 696e 6572  am get_container
+00017760: 3a20 4361 6c6c 6162 6c65 2074 6861 7420  : Callable that 
+00017770: 7265 7475 726e 7320 6120 3a63 6c61 7373  returns a :class
+00017780: 3a60 2e43 6f6e 7461 696e 6572 6020 696e  :`.Container` in
+00017790: 7374 616e 6365 0a20 2020 2020 2020 206f  stance.        o
+000177a0: 7220 616e 7920 7769 6467 6574 2077 6974  r any widget wit
+000177b0: 6820 6120 6060 5f5f 7074 5f63 6f6e 7461  h a ``__pt_conta
+000177c0: 696e 6572 5f5f 6060 206d 6574 686f 642e  iner__`` method.
+000177d0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+000177e0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+000177f0: 2067 6574 5f63 6f6e 7461 696e 6572 3a20   get_container: 
+00017800: 4361 6c6c 6162 6c65 5b5b 5d2c 2041 6e79  Callable[[], Any
+00017810: 436f 6e74 6169 6e65 725d 2920 2d3e 204e  Container]) -> N
+00017820: 6f6e 653a 0a20 2020 2020 2020 2073 656c  one:.        sel
+00017830: 662e 6765 745f 636f 6e74 6169 6e65 7220  f.get_container 
+00017840: 3d20 6765 745f 636f 6e74 6169 6e65 720a  = get_container.
+00017850: 0a20 2020 2064 6566 205f 6765 745f 636f  .    def _get_co
+00017860: 6e74 6169 6e65 7228 7365 6c66 2920 2d3e  ntainer(self) ->
+00017870: 2043 6f6e 7461 696e 6572 3a0a 2020 2020   Container:.    
+00017880: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00017890: 5265 7475 726e 2074 6865 2063 7572 7265  Return the curre
+000178a0: 6e74 2063 6f6e 7461 696e 6572 206f 626a  nt container obj
+000178b0: 6563 742e 0a0a 2020 2020 2020 2020 5765  ect...        We
+000178c0: 2063 616c 6c20 6074 6f5f 636f 6e74 6169   call `to_contai
+000178d0: 6e65 7260 2c20 6265 6361 7573 6520 6067  ner`, because `g
+000178e0: 6574 5f63 6f6e 7461 696e 6572 6020 6361  et_container` ca
+000178f0: 6e20 616c 736f 2072 6574 7572 6e20 610a  n also return a.
+00017900: 2020 2020 2020 2020 7769 6467 6574 2077          widget w
+00017910: 6974 6820 6120 6060 5f5f 7074 5f63 6f6e  ith a ``__pt_con
+00017920: 7461 696e 6572 5f5f 6060 206d 6574 686f  tainer__`` metho
+00017930: 642e 0a20 2020 2020 2020 2022 2222 0a20  d..        """. 
+00017940: 2020 2020 2020 206f 626a 203d 2073 656c         obj = sel
+00017950: 662e 6765 745f 636f 6e74 6169 6e65 7228  f.get_container(
+00017960: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00017970: 2074 6f5f 636f 6e74 6169 6e65 7228 6f62   to_container(ob
+00017980: 6a29 0a0a 2020 2020 6465 6620 7265 7365  j)..    def rese
+00017990: 7428 7365 6c66 2920 2d3e 204e 6f6e 653a  t(self) -> None:
+000179a0: 0a20 2020 2020 2020 2073 656c 662e 5f67  .        self._g
+000179b0: 6574 5f63 6f6e 7461 696e 6572 2829 2e72  et_container().r
+000179c0: 6573 6574 2829 0a0a 2020 2020 6465 6620  eset()..    def 
+000179d0: 7072 6566 6572 7265 645f 7769 6474 6828  preferred_width(
+000179e0: 7365 6c66 2c20 6d61 785f 6176 6169 6c61  self, max_availa
+000179f0: 626c 655f 7769 6474 683a 2069 6e74 2920  ble_width: int) 
+00017a00: 2d3e 2044 696d 656e 7369 6f6e 3a0a 2020  -> Dimension:.  
+00017a10: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00017a20: 662e 5f67 6574 5f63 6f6e 7461 696e 6572  f._get_container
+00017a30: 2829 2e70 7265 6665 7272 6564 5f77 6964  ().preferred_wid
+00017a40: 7468 286d 6178 5f61 7661 696c 6162 6c65  th(max_available
+00017a50: 5f77 6964 7468 290a 0a20 2020 2064 6566  _width)..    def
+00017a60: 2070 7265 6665 7272 6564 5f68 6569 6768   preferred_heigh
+00017a70: 7428 7365 6c66 2c20 7769 6474 683a 2069  t(self, width: i
+00017a80: 6e74 2c20 6d61 785f 6176 6169 6c61 626c  nt, max_availabl
+00017a90: 655f 6865 6967 6874 3a20 696e 7429 202d  e_height: int) -
+00017aa0: 3e20 4469 6d65 6e73 696f 6e3a 0a20 2020  > Dimension:.   
+00017ab0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00017ac0: 2e5f 6765 745f 636f 6e74 6169 6e65 7228  ._get_container(
+00017ad0: 292e 7072 6566 6572 7265 645f 6865 6967  ).preferred_heig
+00017ae0: 6874 2877 6964 7468 2c20 6d61 785f 6176  ht(width, max_av
+00017af0: 6169 6c61 626c 655f 6865 6967 6874 290a  ailable_height).
+00017b00: 0a20 2020 2064 6566 2077 7269 7465 5f74  .    def write_t
+00017b10: 6f5f 7363 7265 656e 280a 2020 2020 2020  o_screen(.      
+00017b20: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00017b30: 7363 7265 656e 3a20 5363 7265 656e 2c0a  screen: Screen,.
+00017b40: 2020 2020 2020 2020 6d6f 7573 655f 6861          mouse_ha
+00017b50: 6e64 6c65 7273 3a20 4d6f 7573 6548 616e  ndlers: MouseHan
+00017b60: 646c 6572 732c 0a20 2020 2020 2020 2077  dlers,.        w
+00017b70: 7269 7465 5f70 6f73 6974 696f 6e3a 2057  rite_position: W
+00017b80: 7269 7465 506f 7369 7469 6f6e 2c0a 2020  ritePosition,.  
+00017b90: 2020 2020 2020 7061 7265 6e74 5f73 7479        parent_sty
+00017ba0: 6c65 3a20 7374 722c 0a20 2020 2020 2020  le: str,.       
+00017bb0: 2065 7261 7365 5f62 673a 2062 6f6f 6c2c   erase_bg: bool,
+00017bc0: 0a20 2020 2020 2020 207a 5f69 6e64 6578  .        z_index
+00017bd0: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d2c  : Optional[int],
+00017be0: 0a20 2020 2029 202d 3e20 4e6f 6e65 3a0a  .    ) -> None:.
+00017bf0: 2020 2020 2020 2020 7365 6c66 2e5f 6765          self._ge
+00017c00: 745f 636f 6e74 6169 6e65 7228 292e 7772  t_container().wr
+00017c10: 6974 655f 746f 5f73 6372 6565 6e28 0a20  ite_to_screen(. 
+00017c20: 2020 2020 2020 2020 2020 2073 6372 6565             scree
+00017c30: 6e2c 206d 6f75 7365 5f68 616e 646c 6572  n, mouse_handler
+00017c40: 732c 2077 7269 7465 5f70 6f73 6974 696f  s, write_positio
+00017c50: 6e2c 2070 6172 656e 745f 7374 796c 652c  n, parent_style,
+00017c60: 2065 7261 7365 5f62 672c 207a 5f69 6e64   erase_bg, z_ind
+00017c70: 6578 0a20 2020 2020 2020 2029 0a0a 2020  ex.        )..  
+00017c80: 2020 6465 6620 6973 5f6d 6f64 616c 2873    def is_modal(s
+00017c90: 656c 6629 202d 3e20 626f 6f6c 3a0a 2020  elf) -> bool:.  
+00017ca0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00017cb0: 7365 0a0a 2020 2020 6465 6620 6765 745f  se..    def get_
+00017cc0: 6b65 795f 6269 6e64 696e 6773 2873 656c  key_bindings(sel
+00017cd0: 6629 202d 3e20 4f70 7469 6f6e 616c 5b4b  f) -> Optional[K
+00017ce0: 6579 4269 6e64 696e 6773 4261 7365 5d3a  eyBindingsBase]:
+00017cf0: 0a20 2020 2020 2020 2023 204b 6579 2062  .        # Key b
+00017d00: 696e 6469 6e67 7320 7769 6c6c 2062 6520  indings will be 
+00017d10: 636f 6c6c 6563 7465 6420 7768 656e 2060  collected when `
+00017d20: 6c61 796f 7574 2e77 616c 6b28 2960 2066  layout.walk()` f
+00017d30: 696e 6473 2074 6865 2063 6869 6c64 0a20  inds the child. 
+00017d40: 2020 2020 2020 2023 2063 6f6e 7461 696e         # contain
+00017d50: 6572 2e0a 2020 2020 2020 2020 7265 7475  er..        retu
+00017d60: 726e 204e 6f6e 650a 0a20 2020 2064 6566  rn None..    def
+00017d70: 2067 6574 5f63 6869 6c64 7265 6e28 7365   get_children(se
+00017d80: 6c66 2920 2d3e 204c 6973 745b 436f 6e74  lf) -> List[Cont
+00017d90: 6169 6e65 725d 3a0a 2020 2020 2020 2020  ainer]:.        
+00017da0: 2320 4865 7265 2077 6520 6861 7665 2074  # Here we have t
+00017db0: 6f20 7265 7475 726e 2074 6865 2063 7572  o return the cur
+00017dc0: 7265 6e74 2061 6374 6976 6520 636f 6e74  rent active cont
+00017dd0: 6169 6e65 7220 6974 7365 6c66 2c20 6e6f  ainer itself, no
+00017de0: 7420 6974 730a 2020 2020 2020 2020 2320  t its.        # 
+00017df0: 6368 696c 6472 656e 2e20 4f74 6865 7277  children. Otherw
+00017e00: 6973 652c 2077 6520 7275 6e20 696e 746f  ise, we run into
+00017e10: 2069 7373 7565 7320 7768 6572 6520 606c   issues where `l
+00017e20: 6179 6f75 742e 7761 6c6b 2829 6020 7769  ayout.walk()` wi
+00017e30: 6c6c 0a20 2020 2020 2020 2023 206e 6576  ll.        # nev
+00017e40: 6572 2073 6565 2061 6e20 6f62 6a65 6374  er see an object
+00017e50: 206f 6620 7479 7065 2060 5769 6e64 6f77   of type `Window
+00017e60: 6020 6966 2074 6869 7320 636f 6e74 6169  ` if this contai
+00017e70: 6e73 2061 2077 696e 646f 772e 2057 650a  ns a window. We.
+00017e80: 2020 2020 2020 2020 2320 6361 6e27 742f          # can't/
+00017e90: 7368 6f75 6c64 6e27 7420 7072 6f78 7920  shouldn't proxy 
+00017ea0: 7468 6520 2269 7369 6e73 7461 6e63 6522  the "isinstance"
+00017eb0: 2063 6865 636b 2e0a 2020 2020 2020 2020   check..        
+00017ec0: 7265 7475 726e 205b 7365 6c66 2e5f 6765  return [self._ge
+00017ed0: 745f 636f 6e74 6169 6e65 7228 295d 0a0a  t_container()]..
+00017ee0: 0a64 6566 2074 6f5f 636f 6e74 6169 6e65  .def to_containe
+00017ef0: 7228 636f 6e74 6169 6e65 723a 2041 6e79  r(container: Any
+00017f00: 436f 6e74 6169 6e65 7229 202d 3e20 436f  Container) -> Co
+00017f10: 6e74 6169 6e65 723a 0a20 2020 2022 2222  ntainer:.    """
+00017f20: 0a20 2020 204d 616b 6520 7375 7265 2074  .    Make sure t
+00017f30: 6861 7420 7468 6520 6769 7665 6e20 6f62  hat the given ob
+00017f40: 6a65 6374 2069 7320 6120 3a63 6c61 7373  ject is a :class
+00017f50: 3a60 2e43 6f6e 7461 696e 6572 602e 0a20  :`.Container`.. 
+00017f60: 2020 2022 2222 0a20 2020 2069 6620 6973     """.    if is
+00017f70: 696e 7374 616e 6365 2863 6f6e 7461 696e  instance(contain
+00017f80: 6572 2c20 436f 6e74 6169 6e65 7229 3a0a  er, Container):.
+00017f90: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+00017fa0: 6f6e 7461 696e 6572 0a20 2020 2065 6c69  ontainer.    eli
+00017fb0: 6620 6861 7361 7474 7228 636f 6e74 6169  f hasattr(contai
+00017fc0: 6e65 722c 2022 5f5f 7074 5f63 6f6e 7461  ner, "__pt_conta
+00017fd0: 696e 6572 5f5f 2229 3a0a 2020 2020 2020  iner__"):.      
+00017fe0: 2020 7265 7475 726e 2074 6f5f 636f 6e74    return to_cont
+00017ff0: 6169 6e65 7228 636f 6e74 6169 6e65 722e  ainer(container.
+00018000: 5f5f 7074 5f63 6f6e 7461 696e 6572 5f5f  __pt_container__
+00018010: 2829 290a 2020 2020 656c 7365 3a0a 0a20  ()).    else:.. 
+00018020: 2020 2020 2020 2072 6169 7365 2065 7272         raise err
+00018030: 6f72 732e 5573 6167 6545 7272 6f72 2822  ors.UsageError("
+00018040: 5c6e 2025 7220 6973 204e 4f54 2061 2063  \n %r is NOT a c
+00018050: 6f6e 7461 696e 6572 206f 626a 6563 742e  ontainer object.
+00018060: 5c6e 2043 6865 636b 2074 6865 2064 6f63  \n Check the doc
+00018070: 756d 656e 7461 7469 6f6e 2066 6f72 206d  umentation for m
+00018080: 6974 6967 6174 696f 6e20 7374 6570 732e  itigation steps.
+00018090: 5c6e 5c6e 2068 7474 7073 3a2f 2f71 756f  \n\n https://quo
+000180a0: 2e72 6561 6474 6865 646f 6373 2e69 6f2f  .readthedocs.io/
+000180b0: 656e 2f6c 6174 6573 7422 2025 2028 636f  en/latest" % (co
+000180c0: 6e74 6169 6e65 7229 290a 0a0a 6465 6620  ntainer))...def 
+000180d0: 746f 5f77 696e 646f 7728 636f 6e74 6169  to_window(contai
+000180e0: 6e65 723a 2041 6e79 436f 6e74 6169 6e65  ner: AnyContaine
+000180f0: 7229 202d 3e20 5769 6e64 6f77 3a0a 2020  r) -> Window:.  
+00018100: 2020 2222 220a 2020 2020 4d61 6b65 2073    """.    Make s
+00018110: 7572 6520 7468 6174 2074 6865 2067 6976  ure that the giv
+00018120: 656e 2061 7267 756d 656e 7420 6973 2061  en argument is a
+00018130: 203a 636c 6173 733a 602e 5769 6e64 6f77   :class:`.Window
+00018140: 602e 0a20 2020 2022 2222 0a20 2020 2069  `..    """.    i
+00018150: 6620 6973 696e 7374 616e 6365 2863 6f6e  f isinstance(con
+00018160: 7461 696e 6572 2c20 5769 6e64 6f77 293a  tainer, Window):
+00018170: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00018180: 636f 6e74 6169 6e65 720a 2020 2020 656c  container.    el
+00018190: 6966 2068 6173 6174 7472 2863 6f6e 7461  if hasattr(conta
+000181a0: 696e 6572 2c20 225f 5f70 745f 636f 6e74  iner, "__pt_cont
+000181b0: 6169 6e65 725f 5f22 293a 0a20 2020 2020  ainer__"):.     
+000181c0: 2020 2072 6574 7572 6e20 746f 5f77 696e     return to_win
+000181d0: 646f 7728 6361 7374 2822 4d61 6769 6343  dow(cast("MagicC
+000181e0: 6f6e 7461 696e 6572 222c 2063 6f6e 7461  ontainer", conta
+000181f0: 696e 6572 292e 5f5f 7074 5f63 6f6e 7461  iner).__pt_conta
+00018200: 696e 6572 5f5f 2829 290a 2020 2020 656c  iner__()).    el
+00018210: 7365 3a0a 2020 2020 2020 2020 7261 6973  se:.        rais
+00018220: 6520 6572 726f 7273 2e55 7361 6765 4572  e errors.UsageEr
+00018230: 726f 7228 225c 6ee2 9aa0 efb8 8f20 4e6f  ror("\n...... No
+00018240: 7420 6120 5769 6e64 6f77 206f 626a 6563  t a Window objec
+00018250: 743a 2025 722e 2220 2520 2863 6f6e 7461  t: %r." % (conta
+00018260: 696e 6572 2c29 290a 0a0a 6465 6620 6973  iner,))...def is
+00018270: 5f63 6f6e 7461 696e 6572 2876 616c 7565  _container(value
+00018280: 3a20 6f62 6a65 6374 2920 2d3e 2062 6f6f  : object) -> boo
+00018290: 6c3a 0a20 2020 2022 2222 0a20 2020 2043  l:.    """.    C
+000182a0: 6865 636b 7320 7768 6574 6865 7220 7468  hecks whether th
+000182b0: 6520 6769 7665 6e20 7661 6c75 6520 6973  e given value is
+000182c0: 2061 2063 6f6e 7461 696e 6572 206f 626a   a container obj
+000182d0: 6563 740a 2020 2020 2866 6f72 2075 7365  ect.    (for use
+000182e0: 2069 6e20 6173 7365 7274 2073 7461 7465   in assert state
+000182f0: 6d65 6e74 7329 2e0a 2020 2020 2222 220a  ments)..    """.
+00018300: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00018310: 6528 7661 6c75 652c 2043 6f6e 7461 696e  e(value, Contain
+00018320: 6572 293a 0a20 2020 2020 2020 2072 6574  er):.        ret
+00018330: 7572 6e20 5472 7565 0a20 2020 2069 6620  urn True.    if 
+00018340: 6861 7361 7474 7228 7661 6c75 652c 2022  hasattr(value, "
+00018350: 5f5f 7074 5f63 6f6e 7461 696e 6572 5f5f  __pt_container__
+00018360: 2229 3a0a 2020 2020 2020 2020 7265 7475  "):.        retu
+00018370: 726e 2069 735f 636f 6e74 6169 6e65 7228  rn is_container(
+00018380: 6361 7374 2822 4d61 6769 6343 6f6e 7461  cast("MagicConta
+00018390: 696e 6572 222c 2076 616c 7565 292e 5f5f  iner", value).__
+000183a0: 7074 5f63 6f6e 7461 696e 6572 5f5f 2829  pt_container__()
+000183b0: 290a 2020 2020 7265 7475 726e 2046 616c  ).    return Fal
+000183c0: 7365 0a                                  se.
```

## quo/layout/margin.py

```diff
@@ -165,18 +165,25 @@
 
     def __init__(
         self,
         display_arrows: FilterOrBool = False,
         up_arrow_symbol: str = None,
         down_arrow_symbol: str = None,
     ) -> None:
-        
-        
-        up_arrow_symbol = "↑" #"\u27F0"
-        down_arrow_symbol = "↓" # \u27F1"
+        from quo.accordance import WIN
+
+        if WIN:
+            up_arrow_symbol = "↑"
+            down_arrow_symbol = "↓"
+
+        else:
+            up_arrow_symbol = "\u27F0"
+            down_arrow_symbol = "\u27F1"
+
+
         self.display_arrows = to_filter(display_arrows)
         self.up_arrow_symbol = up_arrow_symbol
         self.down_arrow_symbol = down_arrow_symbol
 
     def get_width(self, get_ui_content: Callable[[], UIContent]) -> int:
         return 1
```

## quo/layout/menus.py

```diff
@@ -285,15 +285,15 @@
         super().__init__(
             content=Window(
                 content=CompletionsMenuControl(),
                 width=Dimension(min=8),
                 height=Dimension(min=1, max=max_height),
                 scroll_offsets=ScrollOffsets(top=scroll_offset, bottom=scroll_offset),
                 right_margins=[ScrollbarMargin(display_arrows=display_arrows)],
-                dont_extend_width=True,
+                fixed_width=True,
                 style="class:completion-menu",
                 z_index=z_index,
             ),
             # Show when there are completions but not at the point we are
             # returning the input.
             filter=has_completions & ~is_done & extra_filter,
         )
```

## quo/progress/core.py

```diff
@@ -93,19 +93,19 @@
 
     Usage ::
 
         with ProgressBar(...) as pb:
             for item in pb(data):
                 ...
 
-    :param title: Text to be displayed above the progress bars. This can be plain text or formatted text as well.
+    :param title: Text to be displayed above the progress bars. This can be a
+        callable or formatted text as well.
     :param formatters: List of :class:`.Formatter` instances.
-    :param start: Appears right before the progress bar. Default is a space.
-    :param end: Appears right after the progress bar. Default is a space.
-    :param bottom_toolbar: Text to be displayed in the bottom toolbar. This can be plain text or formatted text.
+    :param bottom_toolbar: Text to be displayed in the bottom toolbar. This
+        can be a callable or formatted text.
     :param style: :class:`quo.styles.BaseStyle` instance.
     :param bind: :class:`.KeyBinder` instance.
     :param file: The file object used for rendering, by default `sys.stderr` is used.
 
     :param color_depth: `quo` `ColorDepth` instance.
     :param output: :class:`~quo.output.Output` instance.
     :param input: :class:`~quo.input.Input` instance.
@@ -113,92 +113,28 @@
     from quo.keys import bind as _bind
 
     def __init__(
         self,
         title: RichText = None,
         formatters: Optional[Sequence[Formatter]] = None,
         bottom_toolbar: RichText = None,
-        start: str = "",
-        end: str = "",
-        spinner: str = "",
-        rainbow: bool = False,
         style: Optional[BaseStyle] = None,
         bind: Optional[KeyBinder] = _bind, # None,
         file: Optional[TextIO] = None,
-        color_depth: Optional[ColorDepth] = ColorDepth.eight_bit,
+        color_depth: Optional[ColorDepth] = None,
         output: Optional[Output] = None,
         input: Optional[Input] = None,
+    ) -> None:
 
-        ) -> None:
-
-        
-        if title is not None:
-            from quo.text.html import Text
-            self.title = Text(title)
-        else:
-            self.title = title
-
-        if bottom_toolbar is not None:
-            from quo.text.html import Text
-            self.bottom_toolbar = Text(bottom_toolbar)
-        else:
-            self.bottom_toolbar = bottom_toolbar
-
+        self.title = title
+        self.formatters = formatters or create_default_formatters()
+        self.bottom_toolbar = bottom_toolbar
         self.counters: List[ProgressBarCounter[object]] = []
         self.style = style
         self.bind= bind
-        self.start= start
-        self.end=end
-
-        import platform
-
-        if "Windows" in platform.system():
-            opener = "eta [ "
-            closer = " ]"
-
-        else:
-            opener = "eta \u27EE"
-            closer = " \u27EF"
-        
-        from .formatters import Label, Bar, Text as PbText, TimeLeft, Percentage, SpinningWheel, Progress
-        
-        if rainbow:
-            from .formatters import Rainbow
-
-            custom_formatters = [
-                Label(),
-                PbText(" "),
-                Rainbow(SpinningWheel(spinner=spinner)),
-                Rainbow(Percentage()),
-                Rainbow(Bar(start=" " + start + " ", end=end)),
-                Rainbow(Progress()),
-                Rainbow(PbText(" left: ")),
-                Rainbow(PbText(opener)),
-                Rainbow(TimeLeft()),
-                Rainbow(PbText(closer)),
-            ]
-            self.formatters = custom_formatters
-        else:
-
-            custom_formatters = [
-                Label(),
-                PbText(" "),
-                SpinningWheel(spinner=spinner),
-                Percentage(),
-                Bar(start=" " + start + " ", end=end),
-                Progress(),
-                PbText(" left: "),
-                PbText(opener),
-                TimeLeft(),
-                PbText(closer),
-
-                ]
-            self.formatters = custom_formatters
-
-
 
         # Note that we use __stderr__ as default error output, because that
         # works best with `patch_stdout`.
         self.color_depth = color_depth
         self.output = output or get_app_session().output
         self.input = input or get_app_session().input
 
@@ -210,15 +146,16 @@
         self._app_started = threading.Event()
 
     def __enter__(self) -> "ProgressBar":
         # Create UI Suite.
         title_toolbar = ConditionalContainer(
             Window(
                 FormattedTextControl(lambda: self.title),
-                height=1,# height between the title and the pb
+                height=1,
+                style="class:progressbar,title",
             ),
             filter=Condition(lambda: self.title is not None),
         )
 
         bottom_toolbar = ConditionalContainer(
             Window(
                 FormattedTextControl(
@@ -300,34 +237,29 @@
             self._thread.join()
         self._app_loop.close()
 
     def __call__(
         self,
         data: Optional[Iterable[_T]] = None,
         label: RichText = "",
-        auto_hide: bool = False,
+        remove_when_done: bool = False,
         total: Optional[int] = None,
     ) -> "ProgressBarCounter[_T]":
         """
         Start a new counter.
 
-        :param label: Title text or description for this progress. (This can be formatted text as well).
-        :param auto_hide: When `True`, hide this progress bar after consuming the iterator.
+        :param label: Title text or description for this progress. (This can be
+            formatted text as well).
+        :param remove_when_done: When `True`, hide this progress bar.
         :param total: Specify the maximum value if it can't be calculated by
             calling ``len``.
         """
-        if "<" and "</" in label:
-            from quo.text.html import Text
-            counter = ProgressBarCounter(
-                self, data, label=Text(label), auto_hide=auto_hide, total=total
-                )
-        else:
-            counter = ProgressBarCounter(
-            self, data, label=label, auto_hide=auto_hide, total=total
-            )
+        counter = ProgressBarCounter(
+            self, data, label=label, remove_when_done=remove_when_done, total=total
+        )
         self.counters.append(counter)
         return counter
 
     def invalidate(self) -> None:
         self.app.invalidate()
 
 
@@ -374,25 +306,25 @@
     """
 
     def __init__(
         self,
         progress_bar: ProgressBar,
         data: Optional[Iterable[_CounterItem]] = None,
         label: RichText = "",
-        auto_hide: bool = False,
+        remove_when_done: bool = False,
         total: Optional[int] = None,
     ) -> None:
 
         self.start_time = datetime.datetime.now()
         self.stop_time: Optional[datetime.datetime] = None
         self.progress_bar = progress_bar
         self.data = data
         self.items_completed = 0
         self.label = label
-        self.auto_hide = auto_hide
+        self.remove_when_done = remove_when_done
         self._done = False
         self.total: Optional[int]
 
         if total is None:
             try:
                 self.total = len(cast(Sized, data))
             except TypeError:
@@ -438,15 +370,15 @@
         return self._done
 
     @done.setter
     def done(self, value: bool) -> None:
         self._done = value
         self.stopped = value
 
-        if value and self.auto_hide:
+        if value and self.remove_when_done:
             self.progress_bar.counters.remove(self)
 
     @property
     def stopped(self) -> bool:
         """Whether a counter has been stopped.
 
         Stopped counters no longer have increasing time_elapsed. This distinction is
```

## quo/progress/formatters.py

```diff
@@ -86,16 +86,14 @@
     """
 
     def __init__(self, width: AnyDimension = None, suffix: str = "") -> None:
         self.width = width
         self.suffix = suffix
 
     def _add_suffix(self, label: RichText) -> StyleAndTextTuples:
-
-        # khaki bold is there default pb label color style
         label = to_formatted_text(label, style="fg:khaki bold") #Progressbar label #lass:label")
         return label + [("", self.suffix)]
 
     def format(
         self,
         progress_bar: "ProgressBar",
         progress: "ProgressBarCounter[object]",
@@ -147,69 +145,71 @@
 
 
 class Bar(Formatter):
     """
     Display the progress bar itself.
     """
 
-    template = "<bar>{start}<bar-a fg='cyan'>{bar_a}</bar-a><bar-b fg='red'>{barTip}</bar-b><bar-c fg='grey'>{bar_c}</bar-c>{end}</bar>"
+    template = "<bar>{start}<bar-a fg='cyan'>{bar_a}</bar-a><bar-b fg='red'>{bar_b}</bar-b><bar-c fg='grey'>{bar_c}</bar-c>{end}</bar>"
 
     def __init__(
         self,
-        start: str = "", #"[",
+        start: str = " ", #"[",
         end: str = " ", #"]",
         sym_a: str = "\u2501", #"=",
-        barTipStyle: str = "\u257E",
+        sym_b: str = "\u257E", # ">",
         sym_c: str = "\u2500", # " ", this is what is being replaced as we consume an iterator
         unknown: str = "#",
     ) -> None:
 
         assert len(sym_a) == 1 and get_cwidth(sym_a) == 1
         assert len(sym_c) == 1 and get_cwidth(sym_c) == 1
 
         self.start = start
         self.end = end
         self.sym_a = sym_a
-        self.barTipStyle = barTipStyle
+        self.sym_b = sym_b
         self.sym_c = sym_c
         self.unknown = unknown
 
     def format(
         self,
         progress_bar: "ProgressBar",
         progress: "ProgressBarCounter[object]",
         width: int,
     ) -> RichText:
         if progress.done or progress.total or progress.stopped:
-            sym_a, barTipStyle, sym_c = self.sym_a, self.barTipStyle, self.sym_c
+            sym_a, sym_b, sym_c = self.sym_a, self.sym_b, self.sym_c
 
             # Compute pb_a based on done, total, or stopped states.
             if progress.done:
                 # 100% completed irrelevant of how much was actually marked as completed.
                 percent = 1.0
             else:
                 # Show percentage completed.
                 percent = progress.percentage / 100
         else:
             # Total is unknown and bar is still running.
-            sym_a, barTipStyle, sym_c = self.sym_c, self.unknown, self.sym_c
+            sym_a, sym_b, sym_c = self.sym_c, self.unknown, self.sym_c
 
             # Compute percent based on the time.
             percent = time.time() * 20 % 100 / 100
 
         # Subtract left, sym_b, and right.
-        width -= get_cwidth(self.start + barTipStyle + self.end)
+        width -= get_cwidth(self.start + sym_b + self.end)
 
         # Scale percent by width
         pb_a = int(percent * width)
         bar_a = sym_a * pb_a
-        barTip = barTipStyle
+        bar_b = sym_b
         bar_c = sym_c * (width - pb_a)
 
-        return Te(self.template).format(start=self.start, end=self.end, bar_a=bar_a, barTip=barTip, bar_c=bar_c)
+        return Te(self.template).format(
+            start=self.start, end=self.end, bar_a=bar_a, bar_b=bar_b, bar_c=bar_c
+        )
 
     def get_width(self, progress_bar: "ProgressBar") -> AnyDimension:
         return D(min=9)
 
 
 class Progress(Formatter):
     """
@@ -335,44 +335,33 @@
         return 0
 
 
 class SpinningWheel(Formatter):
     """
     Display a spinning wheel.
     """
+    from quo._spinners import SPINNERS
 
-    def __init__(self, spinner:str="") -> None:
-        self.spinner=spinner  
-
-        from quo._spinners import Spinners
-
-        if spinner == "arrows":
-            self.spinner= Spinners.arrows
-            
-        elif spinner == "hamburger":
-            self.spinner= Spinners.hamburger
-        else:
-            self.spinner= Spinners.dots3
-    
+    characters = SPINNERS.dots3
     win_chars = r"/-\|"
 
     def format(
         self,
         progress_bar: "ProgressBar",
         progress: "ProgressBarCounter[object]",
         width: int,
-        ) -> RichText:
-        import platform
+    ) -> RichText:
+        from quo.accordance import WIN
 
-        if "Windows" in platform.system():
+        if WIN:
             index = int(time.time() * 7) % len(self.win_chars)
             return Te("<spinning-wheel><b>{0}</b></spinning-wheel>").format(self.win_chars[index])
         else:
-            index = int(time.time() * 7) % len(self.spinner)
-            return Te("<spinning-wheel><b>{0}</b></spinning-wheel>").format(self.spinner[index])
+            index = int(time.time() * 7) % len(self.characters)
+            return Te("<spinning-wheel><b>{0}</b></spinning-wheel>").format(self.characters[index])
 
     def get_width(self, progress_bar: "ProgressBar") -> AnyDimension:
         return D.exact(1)
 
 
 def _hue_to_rgb(hue: float) -> Tuple[int, int, int]:
     """
@@ -432,17 +421,17 @@
         return self.formatter.get_width(progress_bar)
 
 
 def create_default_formatters() -> List[Formatter]:
     """
     Return the list of default formatters.
     """
-    import platform
+    from quo.accordance import WIN
 
-    if "Windows" in platform.system():
+    if WIN:
         return [
                 Label(),
                 Text(" "),
                 SpinningWheel(),
                 Percentage(),
                 Text(" "),
                 Bar(),
```

## quo/widget/__init__.py

```diff
@@ -13,14 +13,15 @@
     CheckboxList,
     Frame,
     HorizontalLine,
     Label,
     ProgressBar,
     RadioList,
     Shadow,
+    TextArea,
     VerticalLine,
 )
 from .dialogs import Dialog
 from .menus import MenuContainer, MenuItem
 from .toolbars import (
     ArgToolbar,
     CompletionsToolbar,
@@ -54,7 +55,9 @@
 # Dialogs.
 #   "Dialog",
 # Menus.
 #   "MenuContainer",
 #    "MenuItem",
 # ]
 
+
+TextField = TextArea
```

## quo/widget/core.py

```diff
@@ -92,16 +92,15 @@
     # "\u2503"
     TOP_LEFT = "\u256D"
     TOP_RIGHT = "\u256E"
     BOTTOM_LEFT = "\u2570"
     BOTTOM_RIGHT = "\u256F"
 
 
-
-class TextField:
+class TextArea:
     """
     A simple input field.
 
     This is a higher level abstraction on top of several other classes with
     sane defaults.
 
     This widget does have the most common options, but it does not intend to
@@ -138,19 +137,18 @@
 
     :param highlighter: :class:`~quo.lexers.Lexer` instance for syntax
         highlighting.
     :param wrap_lines: When `True`, don't scroll horizontally, but wrap lines.
     :param width: Window width. (:class:`~quo.layout.Dimension` object.)
     :param height: Window height. (:class:`~quo.layout.Dimension` object.)
     :param scrollbar: When `True`, display a scroll bar.
-    :param fg: Foreground color string.
-    :param bg: Background color string.
-    :param dont_extend_width: When `True`, don't take up more width then the
+    :param style: A style string.
+    :param fixed_width: When `True`, don't take up more width then the
                               preferred width reported by the control.
-    :param dont_extend_height: When `True`, don't take up more width then the
+    :param fixed_height: When `True`, don't take up more width then the
                                preferred height reported by the control.
     :param get_line_prefix: None or a callable that returns formatted text to
         be inserted before a line. It takes a line number (int) and a
         wrap_count and returns formatted text. This can be used for
         implementation of line continuations, things like Vim "breakindent" and
         so on.
 
@@ -168,28 +166,27 @@
         auto_suggest: Optional[AutoSuggest] = None,
         completer: Optional[Completer] = None,
         complete_while_typing: FilterOrBool = True,
         type: Optional[Validator] = None,
         accept_handler: Optional[BufferAcceptHandler] = None,
         history: Optional[History] = None,
         focusable: FilterOrBool = True,
-        focus_on_click: FilterOrBool = True,
+        focus_on_click: FilterOrBool = False,
         wrap_lines: FilterOrBool = True,
         read_only: FilterOrBool = False,
         width: AnyDimension = None,
         height: AnyDimension = None,
         extend_height: FilterOrBool = False,  # True,
         extend_width: FilterOrBool = True,
-        dont_extend_height: FilterOrBool = False,
-        dont_extend_width: FilterOrBool = False,
+        fixed_height: FilterOrBool = False,
+        fixed_width: FilterOrBool = False,
         line_numbers: bool = False,
         get_line_prefix: Optional[GetLinePrefixCallable] = None,
         scrollbar: bool = False,
-        fg: str = "",
-        bg: str = "",
+        style: str = "",
         search_field: Optional[SearchToolbar] = None,
         preview_search: FilterOrBool = True,
         prompt: AnyFormattedText = "",
         input_processors: Optional[List[Processor]] = None,
     ) -> None:
 
         if search_field is None:
@@ -252,38 +249,27 @@
             else:
                 left_margins = []
         else:
             height = D.exact(1)
             left_margins = []
             right_margins = []
 
-        if fg == "" and bg == "":
-            txtfldstyle = ""
-        elif fg != "" and bg != "":
-            txtfldstyle = fg + " bg:" + bg
-        elif fg != "" and bg == "":
-            txtfldstyle = fg
-        elif fg == "" and bg != "":
-            txtfldstyle="bg:" + bg
-
-
-        #style = "{  class:text-area " + "fg:" fg + " bg:" + bg
-
+        style = "class:text-area " + style
 
         # If no height was given, guarantee height of at least 1.
         if height is None:
             height = D(min=1)
 
         self.window = Window(
             height=height,
             width=width,
-            dont_extend_height=dont_extend_height,
-            dont_extend_width=dont_extend_width,
+            fixed_height=fixed_height,
+            fixed_width=fixed_width,
             content=self.control,
-            style=txtfldstyle,
+            style=style,
             wrap_lines=Condition(lambda: is_true(self.wrap_lines)),
             left_margins=left_margins,
             right_margins=right_margins,
             get_line_prefix=get_line_prefix,
         )
 
     @property
@@ -329,34 +315,32 @@
 
     :param text: Text to display. Can be multiline. All value types accepted by
         :class:`quo.layout.FormattedTextControl` are allowed,
         including a callable.
     :param style: A style string.
     :param width: When given, use this width, rather than calculating it from
         the text size.
-    :param dont_extend_width: When `True`, don't take up more width than
+    :param fixed_width: When `True`, don't take up more width than
                               preferred, i.e. the length of the longest line of
                               the text, or value of `width` parameter, if
                               given. `True` by default
-    :param dont_extend_height: When `True`, don't take up more width than the
+    :param fixed_height: When `True`, don't take up more width than the
                                preferred height, i.e. the number of lines of
                                the text. `False` by default.
     """
 
     def __init__(
         self,
         text: AnyFormattedText,
         style: str = "",
-        fg: str = "",
-        bg: str = "",
         width: AnyDimension = None,
         extend_height: bool = False,
         extend_width: bool = True,
-        dont_extend_height: bool = True,
-        dont_extend_width: bool = False,
+        fixed_height: bool = True,
+        fixed_width: bool = False,
     ) -> None:
 
         self.text = text
 
         def get_width() -> AnyDimension:
             if width is None:
                 text_fragments = to_formatted_text(self.text)
@@ -367,35 +351,21 @@
                     return D(preferred=0)
                 return D(preferred=longest_line)
             else:
                 return width
 
         self.formatted_text_control = FormattedTextControl(text=lambda: self.text)
 
-
-        if fg == "" and bg == "":
-            txtfldstyle = ""
-        elif fg != "" and bg != "":
-            txtfldstyle = fg + " bg:" + bg
-        elif fg != "" and bg == "":
-            txtfldstyle = fg
-        elif fg == "" and bg != "":
-            txtfldstyle="bg:" + bg
-
-        from quo.text.html import Text
-
-
         self.window = Window(
-            FormattedTextControl(Text(text)),
-           # content=self.formatted_text_control,
-          #  width=get_width,
-          #  height=D(min=1),
-          #  style="class:label " + style,
-           # dont_extend_height=dont_extend_height,
-            #dont_extend_width=dont_extend_width,
+            content=self.formatted_text_control,
+            width=get_width,
+            height=D(min=1),
+            style="class:label " + style,
+            fixed_height=fixed_height,
+            fixed_width=fixed_width,
         )
 
     def __pt_container__(self) -> Container:
         return self.window
 
 
 class Button:
@@ -424,43 +394,43 @@
         self.handler = handler
         self.width = width
         self.control = FormattedTextControl(
             self._get_text_fragments,
             bind=self._get_key_bindings(),
             focusable=True,
         )
-        import platform
+        from quo.accordance import WIN
 
-        if "Windows" in platform.system():
+        if WIN:
             self.left_symbol="«["
             self.right_symbol="]»"
         else:
             self.left_symbol="«\u27EC"
             self.right_symbol="\u27ED»"
 
         def get_style() -> str:
             if get_app().layout.has_focus(self):
                 return "class:button.focused"
             else:
                 return "class:button"
 
-        # Note: `dont_extend_width` is False, because we want to allow buttons
+        # Note: `fixed_width` is False, because we want to allow buttons
         #       to take more space if the parent container provides more space.
         #       Otherwise, we will also truncate the text.
         #       Probably we need a better way here to adjust to width of the
         #       button to the text.
 
         self.window = Window(
             self.control,
             align="center",
             height=1,
             width=width,
             style=get_style,
-            dont_extend_width=False,
-            dont_extend_height=True,
+            fixed_width=False,
+            fixed_height=True,
         )
 
     def _get_text_fragments(self) -> StyleAndTextTuples:
         width = self.width - (
             get_cwidth(self.left_symbol) + get_cwidth(self.right_symbol)
         )
         text = ("{{:^{}}}".format(width)).format(self.text)
@@ -534,15 +504,15 @@
                 fill(char=Border.HORIZONTAL),
                 fill(width=1, height=1, char="\u2563"),
                 # Notice: we use `Template` here, because `self.title` can be an
                 # `quo.text.Text` object for instance.
                 Label(
                     lambda: Template(" {} ").format(self.title),
                     style="class:frame.label",
-                    dont_extend_width=True,
+                    fixed_width=True,
                 ),
                 fill(width=1, height=1, char="\u2560"),
                 fill(char=Border.HORIZONTAL),
                 fill(width=1, height=1, char=Border.TOP_RIGHT),
             ],
             height=1,
         )
@@ -659,16 +629,14 @@
         padding_left: AnyDimension = None,
         padding_right: AnyDimension = None,
         padding_top: AnyDimension = None,
         padding_bottom: AnyDimension = None,
         width: AnyDimension = None,
         height: AnyDimension = None,
         style: str = "",
-        fg: str = "",
-        bg: str = "",
         char: Union[None, str, Callable[[], str]] = None,
         modal: bool = False,
         bind: Optional[Bind] = None,
     ) -> None:
 
         if padding is None:
             padding = D(preferred=0)
@@ -694,15 +662,15 @@
                         Window(width=self.padding_right, char=char),
                     ]
                 ),
                 Window(height=self.padding_bottom, char=char),
             ],
             width=width,
             height=height,
-            style="fg:" + fg + " bg:" + bg,
+            style=style,
             modal=modal,
             bind=None,
         )
 
     def __pt_container__(self) -> Container:
         return self.container
 
@@ -792,15 +760,15 @@
             style=self.container_style,
             right_margins=[
                 ConditionalMargin(
                     margin=ScrollbarMargin(display_arrows=True),
                     filter=Condition(lambda: self.show_scrollbar),
                 ),
             ],
-            dont_extend_height=True,
+            fixed_height=True,
         )
 
     def _handle_enter(self) -> None:
         if self.multiple_selection:
             val = self.values[self._selected_index][0]
             if val in self.current_values:
                 self.current_values.remove(val)
@@ -986,10 +954,7 @@
     def percentage(self, value: int) -> None:
         self._percentage = value
         self.label.text = "{0}%".format(value)
 
     def __pt_container__(self) -> Container:
         return self.container
 
-
-#:TODO:
-# Change dont_extend_width and dont_extend_height
```

## Comparing `quo-2023.3.dist-info/LICENSE` & `quo-2023.4.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `quo-2023.3.dist-info/METADATA` & `quo-2023.4.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: quo
-Version: 2023.3
+Version: 2023.4
 Summary: Toolkit for writing Command-Line Interface applications and a Text User Interface framework for Python.
 Home-page: https://quo.rtfd.io
 Author: Gerrishon Sirere
 Author-email: scalabli@proton.me
 Maintainer: Scalabli.
 Maintainer-email: scalabli@proton.me
 License: MIT
@@ -163,15 +163,15 @@
 <p align="center">
   <img src="https://github.com/scalabli/quo/raw/master/docs/images/print/white-on-green.png" />
 </p>
 
 ## Quo prompt
  - Using ``quo.prompt`` method.
 ```python
- from quo import prompt
+ from quo.prompt import prompt
 
  prompt("What is your name?")
 ```
 <p align="center">
   <img src="https://github.com/scalabli/quo/raw/master/docs/images/prompt/prompt1.png" />
 </p>
 
@@ -253,18 +253,17 @@
 A placeholder  text that's displayed as long as no input s given.
 
 :bulb: This won't be returned as part of the output.
 
 ```python
 
   from quo.prompt import Prompt
-  from quo.text import Text
 
-  session = Prompt(placeholder=Text('<gray>(please type something)</gray>'))
-  session.prompt("What is your name?: ")
+  session = Prompt() 
+  session.prompt("What is your name?: ", placeholder='<gray>(please type something)</gray>')
 ```
 <p align="center">
   <img src="https://github.com/scalabli/quo/raw/master/docs/images/prompt/gray-placeholder.png" />
 </p>
 
 **Example 7**
```

## Comparing `quo-2023.3.dist-info/RECORD` & `quo-2023.4.dist-info/RECORD`

 * *Files 4% similar despite different names*

```diff
@@ -1,19 +1,19 @@
-quo/__init__.py,sha256=0ppY9qDRHRAbCxsEFgXRJh3tascc042O6n5yZJU41sY,3776
+quo/__init__.py,sha256=kPyZ-CRF55XHSvMFsYqv0WLRj1uGrOA3EgA57_9jeS8,2970
 quo/__main__.py,sha256=qxCh698K9XpWqBRMEbhVx374b9dTUDtRwomOCvURfAA,3877
 quo/__spinners.py,sha256=U2r1_g_1zSjsjiUdAESc2iAMc3i4ri_S8PYP6kQ5z1I,19919
-quo/_spinners.py,sha256=yLJLQc6peqPCrYIPvWKgiBtwebGoCatd-SThUu-3Gew,1597
+quo/_spinners.py,sha256=CmWfjRYdTi8CJhcksZ7AmnXNBRRgnnCy8P-E_W3BkdE,1622
 quo/accordance.py,sha256=kZ59p_XeyoxzDOKSMDbIGUqAZdxX4sFwBtE-qCU-wmE,17520
 quo/argparse.py,sha256=WI5wyAIvgPYOhhLdtPYxYbwNo4z7QyfOiN5aouX_fZI,99285
 quo/bar.py,sha256=TtYydWrowXp_qsVsJq23wTrTAk25lgsGggK0EB8H0ac,12380
 quo/box.py,sha256=CHqrp0kLsHDGnyNrfc9JBlUQbO7A3QJLVD_9hUKv6XE,31
 quo/buffer.py,sha256=NCabEqBUUblwqTxqEvCpGGKioHvwBnPgZnAuQVqe300,72647
 quo/button.py,sha256=RPR0Jf0u8oQvsldPW5sEuNxfV0jqytuM0UWeQ1hNlQM,34
 quo/consoleapp.py,sha256=P368ztPPXQ31pIHe6mRfweVlPlJE6nt_rqZvnx3MYA4,7539
-quo/dialog.py,sha256=x9XsTOgtaVrG2GZbspwuuMpbxKQmb38ae7EcKeJG7YY,13607
+quo/dialog.py,sha256=-zokVmj3V7ful4TXfOBPVIiAmZSaGQbLJRbH6GjB_r0,13494
 quo/document.py,sha256=hg_LUFAfcYdZl4qV-ouiKOJLK5I0fvSd6Gn0124LryQ,40681
 quo/enums.py,sha256=T54v5C2Adz1qcWIXJLWqrrTnOyKouJ1i5wwNuY4YV7E,322
 quo/errors.py,sha256=Dl1vi1XuEj649gwtbLFV8nDBpqQrqt7vfO8EF40Pb2w,9589
 quo/event.py,sha256=sSnT2o9ZioEFLXafjOI0SUOqULXl4OtVifuQPM8SNl0,85
 quo/frame.py,sha256=bQmqpPlzhufgZrFLZ4AZU3EIRmiSC2Ut3RcG_vxhQKQ,322
 quo/history.py,sha256=XYqQFK2QV1xdHHCyTwe9SbXn87zpSCbD4V2_SS9-YQM,9418
 quo/implementation.py,sha256=dsu7Q_cpysobZnZ-QSsQ_QQobo_BKUW9oGcSFghI_ng,12457
@@ -21,18 +21,19 @@
 quo/log.py,sha256=mM3nJZ0GvsDSyr4awNl7ywzKXAu3Cc_o5lIoQTpC1bs,116
 quo/main.py,sha256=wM0q1HMCyjhknxgvMqch2XvZw7jdbgn7vyF1xOnQDco,354
 quo/mouse_events.py,sha256=feIH84cl9spsGyhD6Xr35A4IkrGWbeyk9hr24DhKgko,1409
 quo/parse.py,sha256=1y2JCWoTg37uQZYpIAe8StwXawtD-KfyRhVxkmNjknw,101134
 quo/parser.py,sha256=csmKtgpEi1v7PSCiKxV9CddJMu9pT-KuFW24cRoyavQ,14738
 quo/patch_stdout.py,sha256=lZuTTNVfwD3uWFgElTusDyEBvpqVv6pTPIzHAMjFP9k,9108
 quo/pause.py,sha256=fzvLWK_fZiODOVf1pkIG87ub9VNqUC_UjbDAHF5jVF0,982
-quo/prompt.py,sha256=pB1T8kZuTgIwXNRLDXcY6oUaYbdaFOT5uYWx9fb7M_o,59997
+quo/prompt.py,sha256=vs_3H7Ij-LRPO2unvtaVTtfeqAMrTBHeZ71e0VYeAbY,59985
 quo/renderer.py,sha256=E0H5F-rClnZ4IHqnH558J_ronPbzisetWUTOztJl1gA,28427
 quo/rmreplica.py,sha256=Yl8CzjObkNVxjYiYZI_KZBOJP8Yc9n2jVPDhaMMM9rY,132
 quo/rule.py,sha256=ysVXN1-k99ytKfobpQkDUftTNfmAsS1eFkncaHuzj9w,1433
+quo/rules.py,sha256=hlvuy5SwanRGHsGCuTWXUQhi63gWsaqvywsZHnJ7Ym4,1361
 quo/search.py,sha256=nV6KG2OLqLL3ku5xSjWf_XW3RKVEi623N1yQlCnCfdE,6994
 quo/selection.py,sha256=XvQLJ0OIx30f1x83uGJvYidYU-RqQuBO730NOyZDOCE,1289
 quo/setout.py,sha256=KiIsRLKeSTMUkCqHG7bfpLw8y5l7ODSti2ePehUexAY,9096
 quo/shelldone.py,sha256=OrZxvuEC_dRy3VIpiE4H1GLtdeezTCuIMrd0C7kybdc,21656
 quo/something.py,sha256=eTe5Jr5sEvzBr2sDCRFlcprflG2O-JoPrRdq_T6HHSM,9114
 quo/spin.py,sha256=q50mgPssxHaeGBW__oLPWMZPtF0nru7aCJSFZS6wS9o,2231
 quo/syntax.py,sha256=oV31kL3vmSBTxIXmh8hYmpAwyLrdxv7J5NnvIUjIyvk,884
@@ -57,15 +58,15 @@
 quo/completion/auto_suggest.py,sha256=o-8oq-6dKoGVgksUkpPFCtDTA22Um4oN7EeRMk4jiH4,5921
 quo/completion/core.py,sha256=wazKb4tGByaDBppTzsfD7WidSu7nPhr57NykY40z2Us,13295
 quo/completion/deduplicate.py,sha256=RM_BG6WskzjH4vypXuvEMAjY54Mqs6xACvA38gtJTn0,1394
 quo/completion/filesystem.py,sha256=viHxojjZQeSE-RNbHzdBLpz1dMwtvi-BhLzx6twI1gE,3816
 quo/completion/fuzzy_completer.py,sha256=Zeu-uDJxNi2tOnpxURJBJnD6iFyX90WvCIc6LtminV4,7056
 quo/completion/nested.py,sha256=hSR9gssGqskGRSm3Swdl7u_Hyg_PX3sKIbZzPXyAURQ,3822
 quo/completion/word_completer.py,sha256=-eWacF5wHwaCOv5tiV8NlJhU8QaLr15wDCazbArI__E,3539
-quo/console/__init__.py,sha256=wTMeziY4hXiCQr1D694Og6Zh7tb0Gxw9Z4C7kU51K2Y,613
+quo/console/__init__.py,sha256=AVjS97PO-zzHpIuBfnLvroSjLeXg6SWf3PT1mcg3Alw,584
 quo/console/console.py,sha256=WL6RElY4DIBEJES5c9KC9JBAynzPV15XxbyocQL8QBM,52390
 quo/console/current.py,sha256=h8lJKHxJwgQSDmIhCfc2NggWta8INLq6btnC91lnzr8,4968
 quo/console/dummy.py,sha256=Lf54ag2gOrTTNnWNPlmvV_7K8pwQ-bywSfRqAiZYNiE,1342
 quo/console/run_in_terminal.py,sha256=wx7JLRDMUiMi-5UYy2fdMQDyRFCYckzYyqtTSB4KF8c,3687
 quo/context/__init__.py,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
 quo/context/current.py,sha256=v20ek_E7DdHCUIq3zvRh2BoE2Tiw6J2WrvHOVZP3Yhk,709
 quo/contrib/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
@@ -142,37 +143,37 @@
 quo/keys/key_binding/bindings/named_commands.py,sha256=WROAjcGK_3Ta_XNOL9otT6nSympU6SN6_JXEX9QboyU,18302
 quo/keys/key_binding/bindings/open_in_editor.py,sha256=1kfmOAzA0JHsv2y_88zSUcarHoUaw9cA9NuFZEPaV1s,1343
 quo/keys/key_binding/bindings/page_navigation.py,sha256=Pz0oM_NmV2E18ChYrWS8gqu1tH0161T5qLB0wDUA1QY,2369
 quo/keys/key_binding/bindings/scroll.py,sha256=IBrHqcxF95QPzbI5F0roXvTllsW6YZaJ3utmuFqI5u8,5570
 quo/keys/key_binding/bindings/search.py,sha256=zzkbOASPK7i3Ive-OaU4CVryl5WotrGwvaCd29vCw6Y,2571
 quo/keys/key_binding/bindings/vi.py,sha256=iUDJKhU0Xes9Hrn3QrLvnTffjcZ6GQI0gbv-N7Wh_NA,75437
 quo/layout/__init__.py,sha256=CDFtsu4T66wXWHN1BzXhqqKWRAV7gaL53aL5uX1e73g,3602
-quo/layout/containers.py,sha256=nCDPOr7ZY4KEysR49CFZc0bE1kTSUCXpiBnSwGzi8XY,99453
+quo/layout/containers.py,sha256=eL5HjuIenymNN0Rzc1RexsqgWBskhQDiK4AgyAJiRs4,99267
 quo/layout/controls.py,sha256=R8OUs1gfFahr35yTyvpjW0i4nU0Bi0OhOznmi_K58SQ,36001
 quo/layout/dimension.py,sha256=R0DluKGrjCGTgGSlyHVOjoELT6QkTatqrv-HGq7OB1M,7000
 quo/layout/dummy.py,sha256=e6qn-87xhY5-j_grpqc5Niavfy-iCbgEn_c4riMTWIo,1008
 quo/layout/layout.py,sha256=O2MKpFBHGBmZXSOBNlH19K11ZsBWH962uXxYNVxn0Xs,14099
-quo/layout/margin.py,sha256=knl4UIkQpiyGftetZT1u42Eu6_gGWiHx2HHas0LvoSY,8242
-quo/layout/menus.py,sha256=JS3i5XFlLg8g7a78c7GV2D5XC1hFx9SAHidxm61Ud1g,25279
+quo/layout/margin.py,sha256=E2W16RHOn2DkRFTDOulHBPkAdIxKb7_CSYqkUxki1a0,8365
+quo/layout/menus.py,sha256=20ZVVYmUpIoNPOflzlYgEY8TZTF2TM817QimnYV9zGg,25273
 quo/layout/mouse_handlers.py,sha256=iMSe-d8jD8iYLg7KWkDbtk6BaeP8pFK_CcC1WFxc1vs,1394
 quo/layout/processors.py,sha256=yqb2OWJO5UW5Y--8cz70iyzzEIm1eMr2rjjmCBUkL7I,34046
 quo/layout/screen.py,sha256=zYNYBrlByBf61jGh6hURHo94fzw8XJtoCIh9IqoeliU,9926
 quo/layout/scrollable_pane.py,sha256=KG-xZM2Cwp2KM2T203Dzsnx8IOIh_Ale61wIfz9iC10,19129
 quo/layout/utils.py,sha256=gl0hDBZ5DX62orqLXdBtxok9m-n9vezm5eoYNtmSNEc,2397
 quo/output/__init__.py,sha256=dkAvVcabj9i-TTod3E_BbbeCc_yq_1epkGQoxGKyku8,255
 quo/output/color.py,sha256=uDH7hWU75IaZsCShkMookMMLSJlQ7cPh0uD25xRi6p4,1380
 quo/output/console_emulator.py,sha256=SucxcTU8PIZAzyZPMz2vgwobhJjd934QYRsibFkNPas,1842
 quo/output/core.py,sha256=OX4dycOlrhLS-DBB4nUa756oqc6dnKBTJvqMeVFUiAU,7835
 quo/output/defaults.py,sha256=xxknH8oPwk6aTsDEihGQlxmB3wLtbAOmxJMoUFqZpI0,2559
 quo/output/videoterminal.py,sha256=TMnxKqHMK0JeSTF1kAaGqrid2me9bFQF161oV3kvGY0,24612
 quo/output/win32.py,sha256=quLakqnJ7CUOOJqfYQVwjOCQWLTLaSodW5122XKeAkg,21671
 quo/output/windows10.py,sha256=0enr7aMB28e2PKzh2aTdaa7ErY4BV-0FDQdQsu_u3Dw,3149
 quo/progress/__init__.py,sha256=FfUtlSeCxMlFLU2XgV832smJeyiEzpH53qJKWaKTuJg,517
-quo/progress/core.py,sha256=IHDnupklXrVOLR3jpnhiaSb_R2eQ7hBtmrYcFixTcRI,15639
-quo/progress/formatters.py,sha256=tFBnKdKYCr5a_T5ySgzd331vBe_qW6Gsl9UhjIyFi7w,13052
+quo/progress/core.py,sha256=93_Y51PGjlfHVr0uP9RW6Z-jBuvAwRO0Kq4eLLvQdGE,13552
+quo/progress/formatters.py,sha256=ee41R5msWYvcUTpdEGWxsJMXjUjA1NgSc6ePtsPqdZo,12666
 quo/shortcuts/__init__.py,sha256=hNOyt0GCeqffuOY8F6Zv-vSeQcdSj2lChATtoXB2Yvs,214
 quo/shortcuts/utils.py,sha256=_PVBhYCHwJB8ys1M577l15nYJcGmW24CiQg2ffJi938,7721
 quo/style/__init__.py,sha256=xxq7L3l6KidtkePIhP5v_XVdNltEDXNtU1vCMFjqs0s,1652
 quo/style/core.py,sha256=eJ4kb0sV54Y-GofO_pOnSLV_4bczcxiIikOLNUjB4Is,5185
 quo/style/defaults.py,sha256=9h7b_kKLYi7zuWYUZ9xNC7-5k8y02VuhrRwMe03oOJg,8622
 quo/style/pygments.py,sha256=095vrHkPLHPzwISSJshyyhXRFCY20vI6AH82rx-e1d0,1918
 quo/style/style.py,sha256=7b5ptN8rg_IMgORFodaKh4GM1_r34oD0DU2Is7seVVY,13392
@@ -181,24 +182,24 @@
 quo/text/__init__.py,sha256=xeATAJ2hZ9c0acuns6NEfZryqYlgMYsaStALGclTBdo,1351
 quo/text/core.py,sha256=Rb-BgCa70PCLCrZ4uWdwtM-dp27XJo0eZHMyuvsCwME,4988
 quo/text/html.py,sha256=ncb53P3frREARApCKtCV0BNGhDGFYKMCyH2V289GDls,4337
 quo/text/pygments.py,sha256=GS6AGSU6y-swganzESnPw0LrOBZBbpBybta9jAWvnZY,736
 quo/text/utils.py,sha256=WCxBduZZbMAk0mopGkvEtzy0u50URI4C0VFxxjAijXU,2743
 quo/utils/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 quo/utils/utils.py,sha256=_JICD40gaaMi1sZ1u73ZQL56wG4W6yyZHtS1VG1r1Ag,8621
-quo/widget/__init__.py,sha256=10WAcNyf1hgJOx3t3OUwF_jeyniwAQuh0sN5lsqD0pA,1163
-quo/widget/core.py,sha256=NkoejP6NRuc2w_6joObyZxmpAB2YDh6znuitDcpPSC8,31771
+quo/widget/__init__.py,sha256=NzpwYKyRvpN_S7mn-d6P-l4TS4b6L5fst92aRR3NV9A,1199
+quo/widget/core.py,sha256=5jo8GbaGTB4WKTrhpZGj4SJZEAPwR7ihHPpakLQqmfg,30720
 quo/widget/design.py,sha256=tdQdVQGmP8IW_jumMFp88r3JE2DBumBurV5F3nDwL9Q,30
 quo/widget/dialogs.py,sha256=WkxZaMwckU8QwbWq8GmOWGJyOKkTX_wrrulzKoSLc4c,3200
 quo/widget/menus.py,sha256=KRIoGQqZBqvLJDAYDXY0ReUE_Fx0mvWb6dxwPWWGt58,12598
 quo/widget/toolbars.py,sha256=lf3Fot_Em5LgsdkapVyRkY3odhbAyCpyoZPe0RkJfFE,12098
 quo/width/__init__.py,sha256=21e0eEHnS6-Xqf-4JkVGfK_h3FUng9OZsePyVFxBE9M,102
 quo/width/estasian_table.py,sha256=IyqR_CMS7y1lf0a6bMgih2lrJS-LYaCCbUh9kIbT5pA,10571
 quo/width/width.py,sha256=iPere1TKP0caDcsStsPpA6a6yufr0P-S-xaIKwSRT08,7918
 quo/width/zero_width_table.py,sha256=I8jDuUX8Rn5hyS9WtCqvcGURhCFFpHsUrn1P3wqHLd8,31453
 quo/wrapper/__init__.py,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
 quo/wrapper/textshawl.py,sha256=F7ePYQ7X3aA0UxlkqnAPZ_Pr2MN6RJpYCpgpjhVaOqU,1201
-quo-2023.3.dist-info/LICENSE,sha256=AbTrfeAXOEvC24ZB6TysG4DRBsyjQfJiSJi2mKV6LnM,1073
-quo-2023.3.dist-info/METADATA,sha256=urJyvbdvlfVwZlU9tjJ_ADkxjXOkle7IC09hh8dW8VQ,19263
-quo-2023.3.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-quo-2023.3.dist-info/top_level.txt,sha256=hry4kBh-RT-T6lIkbfUHCBZB8SnSfGIAq9sR-fqz1Wc,4
-quo-2023.3.dist-info/RECORD,,
+quo-2023.4.dist-info/LICENSE,sha256=AbTrfeAXOEvC24ZB6TysG4DRBsyjQfJiSJi2mKV6LnM,1073
+quo-2023.4.dist-info/METADATA,sha256=j7-MGJJ8KL6mb2ytcNZCW9ougv4UrRqSGEphL67K_qU,19239
+quo-2023.4.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+quo-2023.4.dist-info/top_level.txt,sha256=hry4kBh-RT-T6lIkbfUHCBZB8SnSfGIAq9sR-fqz1Wc,4
+quo-2023.4.dist-info/RECORD,,
```

